import{_ as De,Z as He,w as We,l as Ve,c as ce,a as ze,p as ue,b as le,d as oe,g as te,I as ge,i as ke,T as Ue,e as Je,m as Le,f as Be,h as J,o,j as Fe,k as me,n as B,q as fe,r as de,U as ae,s as Ge,A as Ke,t as Ze,u as Xe,z as R,v as U,x as e,y as p,B as Y,C as s,D as I,E as Ee,F as A,G as F,H as Q,J as ye,K as pe,L as Ye}from"./index-CjSUouGJ.js";import"./index-DY4lwpwP.js";function Qe(n){return De(He,n)}var ve=o({error:o({message:e(),type:e().nullish(),param:ye().nullish(),code:Q([e(),s()]).nullish()})}),ie=Ze({errorSchema:ve,errorToMessage:n=>n.error.message});function Ne(n){const u=n.startsWith("o3")||n.startsWith("o4-mini")||n.startsWith("gpt-5")&&!n.startsWith("gpt-5-chat"),y=n.startsWith("gpt-4")||n.startsWith("gpt-5-mini")||n.startsWith("gpt-5")&&!n.startsWith("gpt-5-nano")&&!n.startsWith("gpt-5-chat")||n.startsWith("o3")||n.startsWith("o4-mini"),m=!(n.startsWith("gpt-3")||n.startsWith("gpt-4")||n.startsWith("chatgpt-4o")||n.startsWith("gpt-5-chat")),h=n.startsWith("gpt-5.1")||n.startsWith("gpt-5.2");return{supportsFlexProcessing:u,supportsPriorityProcessing:y,isReasoningModel:m,systemMessageMode:m?"developer":"system",supportsNonReasoningParameters:h}}function et({prompt:n,systemMessageMode:u="system"}){const y=[],m=[];for(const{role:h,content:_}of n)switch(h){case"system":{switch(u){case"system":{y.push({role:"system",content:_});break}case"developer":{y.push({role:"developer",content:_});break}case"remove":{m.push({type:"other",message:"system messages are removed for this model"});break}default:{const l=u;throw new Error(`Unsupported system message mode: ${l}`)}}break}case"user":{if(_.length===1&&_[0].type==="text"){y.push({role:"user",content:_[0].text});break}y.push({role:"user",content:_.map((l,a)=>{var d,v,k;switch(l.type){case"text":return{type:"text",text:l.text};case"file":if(l.mediaType.startsWith("image/")){const S=l.mediaType==="image/*"?"image/jpeg":l.mediaType;return{type:"image_url",image_url:{url:l.data instanceof URL?l.data.toString():`data:${S};base64,${de(l.data)}`,detail:(v=(d=l.providerOptions)==null?void 0:d.openai)==null?void 0:v.imageDetail}}}else if(l.mediaType.startsWith("audio/")){if(l.data instanceof URL)throw new ae({functionality:"audio file parts with URLs"});switch(l.mediaType){case"audio/wav":return{type:"input_audio",input_audio:{data:de(l.data),format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:de(l.data),format:"mp3"}};default:throw new ae({functionality:`audio content parts with media type ${l.mediaType}`})}}else if(l.mediaType==="application/pdf"){if(l.data instanceof URL)throw new ae({functionality:"PDF file parts with URLs"});return{type:"file",file:typeof l.data=="string"&&l.data.startsWith("file-")?{file_id:l.data}:{filename:(k=l.filename)!=null?k:`part-${a}.pdf`,file_data:`data:application/pdf;base64,${de(l.data)}`}}}else throw new ae({functionality:`file part media type ${l.mediaType}`})}})});break}case"assistant":{let l="";const a=[];for(const d of _)switch(d.type){case"text":{l+=d.text;break}case"tool-call":{a.push({id:d.toolCallId,type:"function",function:{name:d.toolName,arguments:JSON.stringify(d.input)}});break}}y.push({role:"assistant",content:l,tool_calls:a.length>0?a:void 0});break}case"tool":{for(const l of _){const a=l.output;let d;switch(a.type){case"text":case"error-text":d=a.value;break;case"content":case"json":case"error-json":d=JSON.stringify(a.value);break}y.push({role:"tool",tool_call_id:l.toolCallId,content:d})}break}default:{const l=h;throw new Error(`Unsupported role: ${l}`)}}return{messages:y,warnings:m}}function _e({id:n,model:u,created:y}){return{id:n??void 0,modelId:u??void 0,timestamp:y?new Date(y*1e3):void 0}}function xe(n){switch(n){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var tt=B(()=>R(o({id:e().nullish(),created:s().nullish(),model:e().nullish(),choices:I(o({message:o({role:p("assistant").nullish(),content:e().nullish(),tool_calls:I(o({id:e().nullish(),type:p("function"),function:o({name:e(),arguments:e()})})).nullish(),annotations:I(o({type:p("url_citation"),url_citation:o({start_index:s(),end_index:s(),url:e(),title:e()})})).nullish()}),index:s(),logprobs:o({content:I(o({token:e(),logprob:s(),top_logprobs:I(o({token:e(),logprob:s()}))})).nullish()}).nullish(),finish_reason:e().nullish()})),usage:o({prompt_tokens:s().nullish(),completion_tokens:s().nullish(),total_tokens:s().nullish(),prompt_tokens_details:o({cached_tokens:s().nullish()}).nullish(),completion_tokens_details:o({reasoning_tokens:s().nullish(),accepted_prediction_tokens:s().nullish(),rejected_prediction_tokens:s().nullish()}).nullish()}).nullish()}))),nt=B(()=>R(Q([o({id:e().nullish(),created:s().nullish(),model:e().nullish(),choices:I(o({delta:o({role:A(["assistant"]).nullish(),content:e().nullish(),tool_calls:I(o({index:s(),id:e().nullish(),type:p("function").nullish(),function:o({name:e().nullish(),arguments:e().nullish()})})).nullish(),annotations:I(o({type:p("url_citation"),url_citation:o({start_index:s(),end_index:s(),url:e(),title:e()})})).nullish()}).nullish(),logprobs:o({content:I(o({token:e(),logprob:s(),top_logprobs:I(o({token:e(),logprob:s()}))})).nullish()}).nullish(),finish_reason:e().nullish(),index:s()})),usage:o({prompt_tokens:s().nullish(),completion_tokens:s().nullish(),total_tokens:s().nullish(),prompt_tokens_details:o({cached_tokens:s().nullish()}).nullish(),completion_tokens_details:o({reasoning_tokens:s().nullish(),accepted_prediction_tokens:s().nullish(),rejected_prediction_tokens:s().nullish()}).nullish()}).nullish()}),ve]))),ot=B(()=>R(o({logitBias:Y(Qe(),s()).optional(),logprobs:Q([F(),s()]).optional(),parallelToolCalls:F().optional(),user:e().optional(),reasoningEffort:A(["none","minimal","low","medium","high","xhigh"]).optional(),maxCompletionTokens:s().optional(),store:F().optional(),metadata:Y(e().max(64),e().max(512)).optional(),prediction:Y(e(),ye()).optional(),structuredOutputs:F().optional(),serviceTier:A(["auto","flex","priority","default"]).optional(),strictJsonSchema:F().optional(),textVerbosity:A(["low","medium","high"]).optional(),promptCacheKey:e().optional(),promptCacheRetention:A(["in_memory","24h"]).optional(),safetyIdentifier:e().optional()})));function it({tools:n,toolChoice:u,structuredOutputs:y,strictJsonSchema:m}){n=n?.length?n:void 0;const h=[];if(n==null)return{tools:void 0,toolChoice:void 0,toolWarnings:h};const _=[];for(const a of n)a.type==="function"?_.push({type:"function",function:{name:a.name,description:a.description,parameters:a.inputSchema,strict:y?m:void 0}}):h.push({type:"unsupported-tool",tool:a});if(u==null)return{tools:_,toolChoice:void 0,toolWarnings:h};const l=u.type;switch(l){case"auto":case"none":case"required":return{tools:_,toolChoice:l,toolWarnings:h};case"tool":return{tools:_,toolChoice:{type:"function",function:{name:u.toolName}},toolWarnings:h};default:{const a=l;throw new ae({functionality:`tool choice type: ${a}`})}}}var st=class{constructor(n,u){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=n,this.config=u}get provider(){return this.config.provider}async getArgs({prompt:n,maxOutputTokens:u,temperature:y,topP:m,topK:h,frequencyPenalty:_,presencePenalty:l,stopSequences:a,responseFormat:d,seed:v,tools:k,toolChoice:S,providerOptions:b}){var r,g,f,c;const w=[],x=(r=await ue({provider:"openai",providerOptions:b,schema:ot}))!=null?r:{},i=(g=x.structuredOutputs)!=null?g:!0,P=Ne(this.modelId);h!=null&&w.push({type:"unsupported-setting",setting:"topK"}),d?.type==="json"&&d.schema!=null&&!i&&w.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const{messages:W,warnings:V}=et({prompt:n,systemMessageMode:P.systemMessageMode});w.push(...V);const E=(f=x.strictJsonSchema)!=null?f:!1,q={model:this.modelId,logit_bias:x.logitBias,logprobs:x.logprobs===!0||typeof x.logprobs=="number"?!0:void 0,top_logprobs:typeof x.logprobs=="number"?x.logprobs:typeof x.logprobs=="boolean"&&x.logprobs?0:void 0,user:x.user,parallel_tool_calls:x.parallelToolCalls,max_tokens:u,temperature:y,top_p:m,frequency_penalty:_,presence_penalty:l,response_format:d?.type==="json"?i&&d.schema!=null?{type:"json_schema",json_schema:{schema:d.schema,strict:E,name:(c=d.name)!=null?c:"response",description:d.description}}:{type:"json_object"}:void 0,stop:a,seed:v,verbosity:x.textVerbosity,max_completion_tokens:x.maxCompletionTokens,store:x.store,metadata:x.metadata,prediction:x.prediction,reasoning_effort:x.reasoningEffort,service_tier:x.serviceTier,prompt_cache_key:x.promptCacheKey,prompt_cache_retention:x.promptCacheRetention,safety_identifier:x.safetyIdentifier,messages:W};P.isReasoningModel?((x.reasoningEffort!=="none"||!P.supportsNonReasoningParameters)&&(q.temperature!=null&&(q.temperature=void 0,w.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),q.top_p!=null&&(q.top_p=void 0,w.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),q.logprobs!=null&&(q.logprobs=void 0,w.push({type:"other",message:"logprobs is not supported for reasoning models"}))),q.frequency_penalty!=null&&(q.frequency_penalty=void 0,w.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),q.presence_penalty!=null&&(q.presence_penalty=void 0,w.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),q.logit_bias!=null&&(q.logit_bias=void 0,w.push({type:"other",message:"logitBias is not supported for reasoning models"})),q.top_logprobs!=null&&(q.top_logprobs=void 0,w.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),q.max_tokens!=null&&(q.max_completion_tokens==null&&(q.max_completion_tokens=q.max_tokens),q.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&q.temperature!=null&&(q.temperature=void 0,w.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),x.serviceTier==="flex"&&!P.supportsFlexProcessing&&(w.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),q.service_tier=void 0),x.serviceTier==="priority"&&!P.supportsPriorityProcessing&&(w.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),q.service_tier=void 0);const{tools:D,toolChoice:j,toolWarnings:G}=it({tools:k,toolChoice:S,structuredOutputs:i,strictJsonSchema:E});return{args:{...q,tools:D,tool_choice:j},warnings:[...w,...G]}}async doGenerate(n){var u,y,m,h,_,l,a,d,v,k,S,b,r,g;const{args:f,warnings:c}=await this.getArgs(n),{responseHeaders:w,value:x,rawValue:i}=await le({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:oe(this.config.headers(),n.headers),body:f,failedResponseHandler:ie,successfulResponseHandler:me(tt),abortSignal:n.abortSignal,fetch:this.config.fetch}),P=x.choices[0],W=[],V=P.message.content;V!=null&&V.length>0&&W.push({type:"text",text:V});for(const j of(u=P.message.tool_calls)!=null?u:[])W.push({type:"tool-call",toolCallId:(y=j.id)!=null?y:te(),toolName:j.function.name,input:j.function.arguments});for(const j of(m=P.message.annotations)!=null?m:[])W.push({type:"source",sourceType:"url",id:te(),url:j.url_citation.url,title:j.url_citation.title});const E=(h=x.usage)==null?void 0:h.completion_tokens_details,q=(_=x.usage)==null?void 0:_.prompt_tokens_details,D={openai:{}};return E?.accepted_prediction_tokens!=null&&(D.openai.acceptedPredictionTokens=E?.accepted_prediction_tokens),E?.rejected_prediction_tokens!=null&&(D.openai.rejectedPredictionTokens=E?.rejected_prediction_tokens),((l=P.logprobs)==null?void 0:l.content)!=null&&(D.openai.logprobs=P.logprobs.content),{content:W,finishReason:xe(P.finish_reason),usage:{inputTokens:(d=(a=x.usage)==null?void 0:a.prompt_tokens)!=null?d:void 0,outputTokens:(k=(v=x.usage)==null?void 0:v.completion_tokens)!=null?k:void 0,totalTokens:(b=(S=x.usage)==null?void 0:S.total_tokens)!=null?b:void 0,reasoningTokens:(r=E?.reasoning_tokens)!=null?r:void 0,cachedInputTokens:(g=q?.cached_tokens)!=null?g:void 0},request:{body:f},response:{..._e(x),headers:w,body:i},warnings:c,providerMetadata:D}}async doStream(n){const{args:u,warnings:y}=await this.getArgs(n),m={...u,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:h,value:_}=await le({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:oe(this.config.headers(),n.headers),body:m,failedResponseHandler:ie,successfulResponseHandler:fe(nt),abortSignal:n.abortSignal,fetch:this.config.fetch}),l=[];let a="unknown";const d={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let v=!1,k=!1;const S={openai:{}};return{stream:_.pipeThrough(new TransformStream({start(b){b.enqueue({type:"stream-start",warnings:y})},transform(b,r){var g,f,c,w,x,i,P,W,V,E,q,D,j,G,Z,z,se,X,ne,N,ee,H,re,M;if(n.includeRawChunks&&r.enqueue({type:"raw",rawValue:b.rawValue}),!b.success){a="error",r.enqueue({type:"error",error:b.error});return}const $=b.value;if("error"in $){a="error",r.enqueue({type:"error",error:$.error});return}if(!v){const O=_e($);Object.values(O).some(Boolean)&&(v=!0,r.enqueue({type:"response-metadata",..._e($)}))}$.usage!=null&&(d.inputTokens=(g=$.usage.prompt_tokens)!=null?g:void 0,d.outputTokens=(f=$.usage.completion_tokens)!=null?f:void 0,d.totalTokens=(c=$.usage.total_tokens)!=null?c:void 0,d.reasoningTokens=(x=(w=$.usage.completion_tokens_details)==null?void 0:w.reasoning_tokens)!=null?x:void 0,d.cachedInputTokens=(P=(i=$.usage.prompt_tokens_details)==null?void 0:i.cached_tokens)!=null?P:void 0,((W=$.usage.completion_tokens_details)==null?void 0:W.accepted_prediction_tokens)!=null&&(S.openai.acceptedPredictionTokens=(V=$.usage.completion_tokens_details)==null?void 0:V.accepted_prediction_tokens),((E=$.usage.completion_tokens_details)==null?void 0:E.rejected_prediction_tokens)!=null&&(S.openai.rejectedPredictionTokens=(q=$.usage.completion_tokens_details)==null?void 0:q.rejected_prediction_tokens));const L=$.choices[0];if(L?.finish_reason!=null&&(a=xe(L.finish_reason)),((D=L?.logprobs)==null?void 0:D.content)!=null&&(S.openai.logprobs=L.logprobs.content),L?.delta==null)return;const K=L.delta;if(K.content!=null&&(k||(r.enqueue({type:"text-start",id:"0"}),k=!0),r.enqueue({type:"text-delta",id:"0",delta:K.content})),K.tool_calls!=null)for(const O of K.tool_calls){const t=O.index;if(l[t]==null){if(O.type!=="function")throw new ge({data:O,message:"Expected 'function' type."});if(O.id==null)throw new ge({data:O,message:"Expected 'id' to be a string."});if(((j=O.function)==null?void 0:j.name)==null)throw new ge({data:O,message:"Expected 'function.name' to be a string."});r.enqueue({type:"tool-input-start",id:O.id,toolName:O.function.name}),l[t]={id:O.id,type:"function",function:{name:O.function.name,arguments:(G=O.function.arguments)!=null?G:""},hasFinished:!1};const T=l[t];((Z=T.function)==null?void 0:Z.name)!=null&&((z=T.function)==null?void 0:z.arguments)!=null&&(T.function.arguments.length>0&&r.enqueue({type:"tool-input-delta",id:T.id,delta:T.function.arguments}),ke(T.function.arguments)&&(r.enqueue({type:"tool-input-end",id:T.id}),r.enqueue({type:"tool-call",toolCallId:(se=T.id)!=null?se:te(),toolName:T.function.name,input:T.function.arguments}),T.hasFinished=!0));continue}const C=l[t];C.hasFinished||(((X=O.function)==null?void 0:X.arguments)!=null&&(C.function.arguments+=(N=(ne=O.function)==null?void 0:ne.arguments)!=null?N:""),r.enqueue({type:"tool-input-delta",id:C.id,delta:(ee=O.function.arguments)!=null?ee:""}),((H=C.function)==null?void 0:H.name)!=null&&((re=C.function)==null?void 0:re.arguments)!=null&&ke(C.function.arguments)&&(r.enqueue({type:"tool-input-end",id:C.id}),r.enqueue({type:"tool-call",toolCallId:(M=C.id)!=null?M:te(),toolName:C.function.name,input:C.function.arguments}),C.hasFinished=!0))}if(K.annotations!=null)for(const O of K.annotations)r.enqueue({type:"source",sourceType:"url",id:te(),url:O.url_citation.url,title:O.url_citation.title})},flush(b){k&&b.enqueue({type:"text-end",id:"0"}),b.enqueue({type:"finish",finishReason:a,usage:d,...S!=null?{providerMetadata:S}:{}})}})),request:{body:m},response:{headers:h}}}};function at({prompt:n,user:u="user",assistant:y="assistant"}){let m="";n[0].role==="system"&&(m+=`${n[0].content}

`,n=n.slice(1));for(const{role:h,content:_}of n)switch(h){case"system":throw new Ge({message:"Unexpected system message in prompt: ${content}",prompt:n});case"user":{const l=_.map(a=>{if(a.type==="text")return a.text}).filter(Boolean).join("");m+=`${u}:
${l}

`;break}case"assistant":{const l=_.map(a=>{switch(a.type){case"text":return a.text;case"tool-call":throw new ae({functionality:"tool-call messages"})}}).join("");m+=`${y}:
${l}

`;break}case"tool":throw new ae({functionality:"tool messages"});default:{const l=h;throw new Error(`Unsupported role: ${l}`)}}return m+=`${y}:
`,{prompt:m,stopSequences:[`
${u}:`]}}function we({id:n,model:u,created:y}){return{id:n??void 0,modelId:u??void 0,timestamp:y!=null?new Date(y*1e3):void 0}}function Ie(n){switch(n){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var lt=B(()=>R(o({id:e().nullish(),created:s().nullish(),model:e().nullish(),choices:I(o({text:e(),finish_reason:e(),logprobs:o({tokens:I(e()),token_logprobs:I(s()),top_logprobs:I(Y(e(),s())).nullish()}).nullish()})),usage:o({prompt_tokens:s(),completion_tokens:s(),total_tokens:s()}).nullish()}))),rt=B(()=>R(Q([o({id:e().nullish(),created:s().nullish(),model:e().nullish(),choices:I(o({text:e(),finish_reason:e().nullish(),index:s(),logprobs:o({tokens:I(e()),token_logprobs:I(s()),top_logprobs:I(Y(e(),s())).nullish()}).nullish()})),usage:o({prompt_tokens:s(),completion_tokens:s(),total_tokens:s()}).nullish()}),ve]))),Ce=B(()=>R(o({echo:F().optional(),logitBias:Y(e(),s()).optional(),suffix:e().optional(),user:e().optional(),logprobs:Q([F(),s()]).optional()}))),ut=class{constructor(n,u){this.specificationVersion="v2",this.supportedUrls={},this.modelId=n,this.config=u}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:n,maxOutputTokens:u,temperature:y,topP:m,topK:h,frequencyPenalty:_,presencePenalty:l,stopSequences:a,responseFormat:d,tools:v,toolChoice:k,seed:S,providerOptions:b}){const r=[],g={...await ue({provider:"openai",providerOptions:b,schema:Ce}),...await ue({provider:this.providerOptionsName,providerOptions:b,schema:Ce})};h!=null&&r.push({type:"unsupported-setting",setting:"topK"}),v?.length&&r.push({type:"unsupported-setting",setting:"tools"}),k!=null&&r.push({type:"unsupported-setting",setting:"toolChoice"}),d!=null&&d.type!=="text"&&r.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:f,stopSequences:c}=at({prompt:n}),w=[...c??[],...a??[]];return{args:{model:this.modelId,echo:g.echo,logit_bias:g.logitBias,logprobs:g?.logprobs===!0?0:g?.logprobs===!1?void 0:g?.logprobs,suffix:g.suffix,user:g.user,max_tokens:u,temperature:y,top_p:m,frequency_penalty:_,presence_penalty:l,seed:S,prompt:f,stop:w.length>0?w:void 0},warnings:r}}async doGenerate(n){var u,y,m;const{args:h,warnings:_}=await this.getArgs(n),{responseHeaders:l,value:a,rawValue:d}=await le({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:oe(this.config.headers(),n.headers),body:h,failedResponseHandler:ie,successfulResponseHandler:me(lt),abortSignal:n.abortSignal,fetch:this.config.fetch}),v=a.choices[0],k={openai:{}};return v.logprobs!=null&&(k.openai.logprobs=v.logprobs),{content:[{type:"text",text:v.text}],usage:{inputTokens:(u=a.usage)==null?void 0:u.prompt_tokens,outputTokens:(y=a.usage)==null?void 0:y.completion_tokens,totalTokens:(m=a.usage)==null?void 0:m.total_tokens},finishReason:Ie(v.finish_reason),request:{body:h},response:{...we(a),headers:l,body:d},providerMetadata:k,warnings:_}}async doStream(n){const{args:u,warnings:y}=await this.getArgs(n),m={...u,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:h,value:_}=await le({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:oe(this.config.headers(),n.headers),body:m,failedResponseHandler:ie,successfulResponseHandler:fe(rt),abortSignal:n.abortSignal,fetch:this.config.fetch});let l="unknown";const a={openai:{}},d={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let v=!0;return{stream:_.pipeThrough(new TransformStream({start(k){k.enqueue({type:"stream-start",warnings:y})},transform(k,S){if(n.includeRawChunks&&S.enqueue({type:"raw",rawValue:k.rawValue}),!k.success){l="error",S.enqueue({type:"error",error:k.error});return}const b=k.value;if("error"in b){l="error",S.enqueue({type:"error",error:b.error});return}v&&(v=!1,S.enqueue({type:"response-metadata",...we(b)}),S.enqueue({type:"text-start",id:"0"})),b.usage!=null&&(d.inputTokens=b.usage.prompt_tokens,d.outputTokens=b.usage.completion_tokens,d.totalTokens=b.usage.total_tokens);const r=b.choices[0];r?.finish_reason!=null&&(l=Ie(r.finish_reason)),r?.logprobs!=null&&(a.openai.logprobs=r.logprobs),r?.text!=null&&r.text.length>0&&S.enqueue({type:"text-delta",id:"0",delta:r.text})},flush(k){v||k.enqueue({type:"text-end",id:"0"}),k.enqueue({type:"finish",finishReason:l,providerMetadata:a,usage:d})}})),request:{body:m},response:{headers:h}}}},pt=B(()=>R(o({dimensions:s().optional(),user:e().optional()}))),dt=B(()=>R(o({data:I(o({embedding:I(s())})),usage:o({prompt_tokens:s()}).nullish()}))),ct=class{constructor(n,u){this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=n,this.config=u}get provider(){return this.config.provider}async doEmbed({values:n,headers:u,abortSignal:y,providerOptions:m}){var h;if(n.length>this.maxEmbeddingsPerCall)throw new Ue({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:n});const _=(h=await ue({provider:"openai",providerOptions:m,schema:pt}))!=null?h:{},{responseHeaders:l,value:a,rawValue:d}=await le({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:oe(this.config.headers(),u),body:{model:this.modelId,input:n,encoding_format:"float",dimensions:_.dimensions,user:_.user},failedResponseHandler:ie,successfulResponseHandler:me(dt),abortSignal:y,fetch:this.config.fetch});return{embeddings:a.data.map(v=>v.embedding),usage:a.usage?{tokens:a.usage.prompt_tokens}:void 0,response:{headers:l,body:d}}}},mt=B(()=>R(o({created:s().nullish(),data:I(o({b64_json:e(),revised_prompt:e().nullish()})),background:e().nullish(),output_format:e().nullish(),size:e().nullish(),quality:e().nullish(),usage:o({input_tokens:s().nullish(),output_tokens:s().nullish(),total_tokens:s().nullish(),input_tokens_details:o({image_tokens:s().nullish(),text_tokens:s().nullish()}).nullish()}).nullish()}))),ht={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10,"gpt-image-1-mini":10,"gpt-image-1.5":10},gt=new Set(["gpt-image-1","gpt-image-1-mini","gpt-image-1.5"]),_t=class{constructor(n,u){this.modelId=n,this.config=u,this.specificationVersion="v2"}get maxImagesPerCall(){var n;return(n=ht[this.modelId])!=null?n:1}get provider(){return this.config.provider}async doGenerate({prompt:n,n:u,size:y,aspectRatio:m,seed:h,providerOptions:_,headers:l,abortSignal:a}){var d,v,k,S;const b=[];m!=null&&b.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),h!=null&&b.push({type:"unsupported-setting",setting:"seed"});const r=(k=(v=(d=this.config._internal)==null?void 0:d.currentDate)==null?void 0:v.call(d))!=null?k:new Date,{value:g,responseHeaders:f}=await le({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:oe(this.config.headers(),l),body:{model:this.modelId,prompt:n,n:u,size:y,...(S=_.openai)!=null?S:{},...gt.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:ie,successfulResponseHandler:me(mt),abortSignal:a,fetch:this.config.fetch});return{images:g.data.map(c=>c.b64_json),warnings:b,response:{timestamp:r,modelId:this.modelId,headers:f},providerMetadata:{openai:{images:g.data.map(c=>({...c.revised_prompt?{revisedPrompt:c.revised_prompt}:{},...g.created!=null?{created:g.created}:{},...g.size!=null?{size:g.size}:{},...g.quality!=null?{quality:g.quality}:{},...g.background!=null?{background:g.background}:{},...g.output_format!=null?{outputFormat:g.output_format}:{}}))}}}}},ft=J(()=>R(o({code:e().nullish(),containerId:e()}))),yt=J(()=>R(o({outputs:I(U("type",[o({type:p("logs"),logs:e()}),o({type:p("image"),url:e()})])).nullish()}))),vt=J(()=>R(o({container:Q([e(),o({fileIds:I(e()).optional()})]).optional()}))),bt=ce({id:"openai.code_interpreter",name:"code_interpreter",inputSchema:ft,outputSchema:yt}),kt=(n={})=>bt(n),Me=o({key:e(),type:A(["eq","ne","gt","gte","lt","lte","in","nin"]),value:Q([e(),s(),F(),I(e())])}),Pe=o({type:A(["and","or"]),filters:I(Q([Me,Ye(()=>Pe)]))}),xt=J(()=>R(o({vectorStoreIds:I(e()),maxNumResults:s().optional(),ranking:o({ranker:e().optional(),scoreThreshold:s().optional()}).optional(),filters:Q([Me,Pe]).optional()}))),wt=J(()=>R(o({queries:I(e()),results:I(o({attributes:Y(e(),Ee()),fileId:e(),filename:e(),score:s(),text:e()})).nullable()}))),It=ce({id:"openai.file_search",name:"file_search",inputSchema:o({}),outputSchema:wt}),Ct=J(()=>R(o({background:A(["auto","opaque","transparent"]).optional(),inputFidelity:A(["low","high"]).optional(),inputImageMask:o({fileId:e().optional(),imageUrl:e().optional()}).optional(),model:e().optional(),moderation:A(["auto"]).optional(),outputCompression:s().int().min(0).max(100).optional(),outputFormat:A(["png","jpeg","webp"]).optional(),partialImages:s().int().min(0).max(3).optional(),quality:A(["auto","low","medium","high"]).optional(),size:A(["1024x1024","1024x1536","1536x1024","auto"]).optional()}).strict())),St=J(()=>R(o({}))),Tt=J(()=>R(o({result:e()}))),qt=ce({id:"openai.image_generation",name:"image_generation",inputSchema:St,outputSchema:Tt}),Rt=(n={})=>qt(n),$e=J(()=>R(o({action:o({type:p("exec"),command:I(e()),timeoutMs:s().optional(),user:e().optional(),workingDirectory:e().optional(),env:Y(e(),e()).optional()})}))),Ae=J(()=>R(o({output:e()}))),Ot=ce({id:"openai.local_shell",name:"local_shell",inputSchema:$e,outputSchema:Ae}),Et=J(()=>R(o({externalWebAccess:F().optional(),filters:o({allowedDomains:I(e()).optional()}).optional(),searchContextSize:A(["low","medium","high"]).optional(),userLocation:o({type:p("approximate"),country:e().optional(),city:e().optional(),region:e().optional(),timezone:e().optional()}).optional()}))),Nt=J(()=>R(o({}))),Mt=J(()=>R(o({action:U("type",[o({type:p("search"),query:e().optional()}),o({type:p("openPage"),url:e().nullish()}),o({type:p("findInPage"),url:e().nullish(),pattern:e().nullish()})]),sources:I(U("type",[o({type:p("url"),url:e()}),o({type:p("api"),name:e()})])).optional()}))),Pt=ce({id:"openai.web_search",name:"web_search",inputSchema:Nt,outputSchema:Mt}),$t=(n={})=>Pt(n),At=J(()=>R(o({searchContextSize:A(["low","medium","high"]).optional(),userLocation:o({type:p("approximate"),country:e().optional(),city:e().optional(),region:e().optional(),timezone:e().optional()}).optional()}))),jt=J(()=>R(o({}))),Dt=J(()=>R(o({action:U("type",[o({type:p("search"),query:e().optional()}),o({type:p("openPage"),url:e().nullish()}),o({type:p("findInPage"),url:e().nullish(),pattern:e().nullish()})])}))),Ht=ce({id:"openai.web_search_preview",name:"web_search_preview",inputSchema:jt,outputSchema:Dt}),Wt={codeInterpreter:kt,fileSearch:It,imageGeneration:Rt,localShell:Ot,webSearchPreview:Ht,webSearch:$t};function Se(n,u){return u?u.some(y=>n.startsWith(y)):!1}async function Vt({prompt:n,systemMessageMode:u,fileIdPrefixes:y,store:m,hasLocalShellTool:h=!1}){var _,l,a,d;const v=[],k=[];for(const{role:S,content:b}of n)switch(S){case"system":{switch(u){case"system":{v.push({role:"system",content:b});break}case"developer":{v.push({role:"developer",content:b});break}case"remove":{k.push({type:"other",message:"system messages are removed for this model"});break}default:{const r=u;throw new Error(`Unsupported system message mode: ${r}`)}}break}case"user":{v.push({role:"user",content:b.map((r,g)=>{var f,c,w;switch(r.type){case"text":return{type:"input_text",text:r.text};case"file":if(r.mediaType.startsWith("image/")){const x=r.mediaType==="image/*"?"image/jpeg":r.mediaType;return{type:"input_image",...r.data instanceof URL?{image_url:r.data.toString()}:typeof r.data=="string"&&Se(r.data,y)?{file_id:r.data}:{image_url:`data:${x};base64,${de(r.data)}`},detail:(c=(f=r.providerOptions)==null?void 0:f.openai)==null?void 0:c.imageDetail}}else{if(r.mediaType==="application/pdf")return r.data instanceof URL?{type:"input_file",file_url:r.data.toString()}:{type:"input_file",...typeof r.data=="string"&&Se(r.data,y)?{file_id:r.data}:{filename:(w=r.filename)!=null?w:`part-${g}.pdf`,file_data:`data:application/pdf;base64,${de(r.data)}`}};throw new ae({functionality:`file part media type ${r.mediaType}`})}}})});break}case"assistant":{const r={},g={};for(const f of b)switch(f.type){case"text":{const c=(l=(_=f.providerOptions)==null?void 0:_.openai)==null?void 0:l.itemId;if(m&&c!=null){v.push({type:"item_reference",id:c});break}v.push({role:"assistant",content:[{type:"output_text",text:f.text}],id:c});break}case"tool-call":{if(g[f.toolCallId]=f,f.providerExecuted)break;const c=(d=(a=f.providerOptions)==null?void 0:a.openai)==null?void 0:d.itemId;if(m&&c!=null){v.push({type:"item_reference",id:c});break}if(h&&f.toolName==="local_shell"){const w=await pe({value:f.input,schema:$e});v.push({type:"local_shell_call",call_id:f.toolCallId,id:c,action:{type:"exec",command:w.action.command,timeout_ms:w.action.timeoutMs,user:w.action.user,working_directory:w.action.workingDirectory,env:w.action.env}});break}v.push({type:"function_call",call_id:f.toolCallId,name:f.toolName,arguments:JSON.stringify(f.input),id:c});break}case"tool-result":{m?v.push({type:"item_reference",id:f.toolCallId}):k.push({type:"other",message:`Results for OpenAI tool ${f.toolName} are not sent to the API when store is false`});break}case"reasoning":{const c=await ue({provider:"openai",providerOptions:f.providerOptions,schema:zt}),w=c?.itemId;if(w!=null){const x=r[w];if(m)x===void 0&&(v.push({type:"item_reference",id:w}),r[w]={type:"reasoning",id:w,summary:[]});else{const i=[];f.text.length>0?i.push({type:"summary_text",text:f.text}):x!==void 0&&k.push({type:"other",message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(f)}.`}),x===void 0?(r[w]={type:"reasoning",id:w,encrypted_content:c?.reasoningEncryptedContent,summary:i},v.push(r[w])):(x.summary.push(...i),c?.reasoningEncryptedContent!=null&&(x.encrypted_content=c.reasoningEncryptedContent))}}else k.push({type:"other",message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(f)}.`});break}}break}case"tool":{for(const r of b){const g=r.output;if(h&&r.toolName==="local_shell"&&g.type==="json"){const c=await pe({value:g.value,schema:Ae});v.push({type:"local_shell_call_output",call_id:r.toolCallId,output:c.output});break}let f;switch(g.type){case"text":case"error-text":f=g.value;break;case"json":case"error-json":f=JSON.stringify(g.value);break;case"content":f=g.value.map(c=>{switch(c.type){case"text":return{type:"input_text",text:c.text};case"media":return c.mediaType.startsWith("image/")?{type:"input_image",image_url:`data:${c.mediaType};base64,${c.data}`}:{type:"input_file",filename:"data",file_data:`data:${c.mediaType};base64,${c.data}`}}});break}v.push({type:"function_call_output",call_id:r.toolCallId,output:f})}break}default:{const r=S;throw new Error(`Unsupported role: ${r}`)}}return{input:v,warnings:k}}var zt=o({itemId:e().nullish(),reasoningEncryptedContent:e().nullish()});function Te({finishReason:n,hasFunctionCall:u}){switch(n){case void 0:case null:return u?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return u?"tool-calls":"unknown"}}var Ut=B(()=>R(Q([o({type:p("response.output_text.delta"),item_id:e(),delta:e(),logprobs:I(o({token:e(),logprob:s(),top_logprobs:I(o({token:e(),logprob:s()}))})).nullish()}),o({type:A(["response.completed","response.incomplete"]),response:o({incomplete_details:o({reason:e()}).nullish(),usage:o({input_tokens:s(),input_tokens_details:o({cached_tokens:s().nullish()}).nullish(),output_tokens:s(),output_tokens_details:o({reasoning_tokens:s().nullish()}).nullish()}),service_tier:e().nullish()})}),o({type:p("response.created"),response:o({id:e(),created_at:s(),model:e(),service_tier:e().nullish()})}),o({type:p("response.output_item.added"),output_index:s(),item:U("type",[o({type:p("message"),id:e()}),o({type:p("reasoning"),id:e(),encrypted_content:e().nullish()}),o({type:p("function_call"),id:e(),call_id:e(),name:e(),arguments:e()}),o({type:p("web_search_call"),id:e(),status:e()}),o({type:p("computer_call"),id:e(),status:e()}),o({type:p("file_search_call"),id:e()}),o({type:p("image_generation_call"),id:e()}),o({type:p("code_interpreter_call"),id:e(),container_id:e(),code:e().nullable(),outputs:I(U("type",[o({type:p("logs"),logs:e()}),o({type:p("image"),url:e()})])).nullable(),status:e()})])}),o({type:p("response.output_item.done"),output_index:s(),item:U("type",[o({type:p("message"),id:e()}),o({type:p("reasoning"),id:e(),encrypted_content:e().nullish()}),o({type:p("function_call"),id:e(),call_id:e(),name:e(),arguments:e(),status:p("completed")}),o({type:p("code_interpreter_call"),id:e(),code:e().nullable(),container_id:e(),outputs:I(U("type",[o({type:p("logs"),logs:e()}),o({type:p("image"),url:e()})])).nullable()}),o({type:p("image_generation_call"),id:e(),result:e()}),o({type:p("web_search_call"),id:e(),status:e(),action:U("type",[o({type:p("search"),query:e().nullish(),sources:I(U("type",[o({type:p("url"),url:e()}),o({type:p("api"),name:e()})])).nullish()}),o({type:p("open_page"),url:e().nullish()}),o({type:p("find_in_page"),url:e().nullish(),pattern:e().nullish()})])}),o({type:p("file_search_call"),id:e(),queries:I(e()),results:I(o({attributes:Y(e(),Ee()),file_id:e(),filename:e(),score:s(),text:e()})).nullish()}),o({type:p("local_shell_call"),id:e(),call_id:e(),action:o({type:p("exec"),command:I(e()),timeout_ms:s().optional(),user:e().optional(),working_directory:e().optional(),env:Y(e(),e()).optional()})}),o({type:p("computer_call"),id:e(),status:p("completed")})])}),o({type:p("response.function_call_arguments.delta"),item_id:e(),output_index:s(),delta:e()}),o({type:p("response.image_generation_call.partial_image"),item_id:e(),output_index:s(),partial_image_b64:e()}),o({type:p("response.code_interpreter_call_code.delta"),item_id:e(),output_index:s(),delta:e()}),o({type:p("response.code_interpreter_call_code.done"),item_id:e(),output_index:s(),code:e()}),o({type:p("response.output_text.annotation.added"),annotation:U("type",[o({type:p("url_citation"),start_index:s(),end_index:s(),url:e(),title:e()}),o({type:p("file_citation"),file_id:e(),filename:e().nullish(),index:s().nullish(),start_index:s().nullish(),end_index:s().nullish(),quote:e().nullish()})])}),o({type:p("response.reasoning_summary_part.added"),item_id:e(),summary_index:s()}),o({type:p("response.reasoning_summary_text.delta"),item_id:e(),summary_index:s(),delta:e()}),o({type:p("response.reasoning_summary_part.done"),item_id:e(),summary_index:s()}),o({type:p("error"),sequence_number:s(),error:o({type:e(),code:e(),message:e(),param:e().nullish()})}),o({type:e()}).loose().transform(n=>({type:"unknown_chunk",message:n.type}))]))),Jt=B(()=>R(o({id:e().optional(),created_at:s().optional(),error:o({message:e(),type:e(),param:e().nullish(),code:e()}).nullish(),model:e().optional(),output:I(U("type",[o({type:p("message"),role:p("assistant"),id:e(),content:I(o({type:p("output_text"),text:e(),logprobs:I(o({token:e(),logprob:s(),top_logprobs:I(o({token:e(),logprob:s()}))})).nullish(),annotations:I(U("type",[o({type:p("url_citation"),start_index:s(),end_index:s(),url:e(),title:e()}),o({type:p("file_citation"),file_id:e(),filename:e().nullish(),index:s().nullish(),start_index:s().nullish(),end_index:s().nullish(),quote:e().nullish()}),o({type:p("container_file_citation"),container_id:e(),file_id:e(),filename:e().nullish(),start_index:s().nullish(),end_index:s().nullish(),index:s().nullish()}),o({type:p("file_path"),file_id:e(),index:s().nullish()})]))}))}),o({type:p("web_search_call"),id:e(),status:e(),action:U("type",[o({type:p("search"),query:e().nullish(),sources:I(U("type",[o({type:p("url"),url:e()}),o({type:p("api"),name:e()})])).nullish()}),o({type:p("open_page"),url:e().nullish()}),o({type:p("find_in_page"),url:e().nullish(),pattern:e().nullish()})])}),o({type:p("file_search_call"),id:e(),queries:I(e()),results:I(o({attributes:Y(e(),Q([e(),s(),F()])),file_id:e(),filename:e(),score:s(),text:e()})).nullish()}),o({type:p("code_interpreter_call"),id:e(),code:e().nullable(),container_id:e(),outputs:I(U("type",[o({type:p("logs"),logs:e()}),o({type:p("image"),url:e()})])).nullable()}),o({type:p("image_generation_call"),id:e(),result:e()}),o({type:p("local_shell_call"),id:e(),call_id:e(),action:o({type:p("exec"),command:I(e()),timeout_ms:s().optional(),user:e().optional(),working_directory:e().optional(),env:Y(e(),e()).optional()})}),o({type:p("function_call"),call_id:e(),name:e(),arguments:e(),id:e()}),o({type:p("computer_call"),id:e(),status:e().optional()}),o({type:p("reasoning"),id:e(),encrypted_content:e().nullish(),summary:I(o({type:p("summary_text"),text:e()}))})])).optional(),service_tier:e().nullish(),incomplete_details:o({reason:e()}).nullish(),usage:o({input_tokens:s(),input_tokens_details:o({cached_tokens:s().nullish()}).nullish(),output_tokens:s(),output_tokens_details:o({reasoning_tokens:s().nullish()}).nullish()}).optional()}))),je=20,Lt=B(()=>R(o({conversation:e().nullish(),include:I(A(["reasoning.encrypted_content","file_search_call.results","message.output_text.logprobs"])).nullish(),instructions:e().nullish(),logprobs:Q([F(),s().min(1).max(je)]).optional(),maxToolCalls:s().nullish(),metadata:ye().nullish(),parallelToolCalls:F().nullish(),previousResponseId:e().nullish(),promptCacheKey:e().nullish(),promptCacheRetention:A(["in_memory","24h"]).nullish(),reasoningEffort:e().nullish(),reasoningSummary:e().nullish(),safetyIdentifier:e().nullish(),serviceTier:A(["auto","flex","priority","default"]).nullish(),store:F().nullish(),strictJsonSchema:F().nullish(),textVerbosity:A(["low","medium","high"]).nullish(),truncation:A(["auto","disabled"]).nullish(),user:e().nullish()})));async function Bt({tools:n,toolChoice:u,strictJsonSchema:y}){n=n?.length?n:void 0;const m=[];if(n==null)return{tools:void 0,toolChoice:void 0,toolWarnings:m};const h=[];for(const l of n)switch(l.type){case"function":h.push({type:"function",name:l.name,description:l.description,parameters:l.inputSchema,strict:y});break;case"provider-defined":{switch(l.id){case"openai.file_search":{const a=await pe({value:l.args,schema:xt});h.push({type:"file_search",vector_store_ids:a.vectorStoreIds,max_num_results:a.maxNumResults,ranking_options:a.ranking?{ranker:a.ranking.ranker,score_threshold:a.ranking.scoreThreshold}:void 0,filters:a.filters});break}case"openai.local_shell":{h.push({type:"local_shell"});break}case"openai.web_search_preview":{const a=await pe({value:l.args,schema:At});h.push({type:"web_search_preview",search_context_size:a.searchContextSize,user_location:a.userLocation});break}case"openai.web_search":{const a=await pe({value:l.args,schema:Et});h.push({type:"web_search",filters:a.filters!=null?{allowed_domains:a.filters.allowedDomains}:void 0,external_web_access:a.externalWebAccess,search_context_size:a.searchContextSize,user_location:a.userLocation});break}case"openai.code_interpreter":{const a=await pe({value:l.args,schema:vt});h.push({type:"code_interpreter",container:a.container==null?{type:"auto",file_ids:void 0}:typeof a.container=="string"?a.container:{type:"auto",file_ids:a.container.fileIds}});break}case"openai.image_generation":{const a=await pe({value:l.args,schema:Ct});h.push({type:"image_generation",background:a.background,input_fidelity:a.inputFidelity,input_image_mask:a.inputImageMask?{file_id:a.inputImageMask.fileId,image_url:a.inputImageMask.imageUrl}:void 0,model:a.model,size:a.size,quality:a.quality,moderation:a.moderation,output_format:a.outputFormat,output_compression:a.outputCompression});break}}break}default:m.push({type:"unsupported-tool",tool:l});break}if(u==null)return{tools:h,toolChoice:void 0,toolWarnings:m};const _=u.type;switch(_){case"auto":case"none":case"required":return{tools:h,toolChoice:_,toolWarnings:m};case"tool":return{tools:h,toolChoice:u.toolName==="code_interpreter"||u.toolName==="file_search"||u.toolName==="image_generation"||u.toolName==="web_search_preview"||u.toolName==="web_search"?{type:u.toolName}:{type:"function",name:u.toolName},toolWarnings:m};default:{const l=_;throw new ae({functionality:`tool choice type: ${l}`})}}}var Ft=class{constructor(n,u){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=n,this.config=u}get provider(){return this.config.provider}async getArgs({maxOutputTokens:n,temperature:u,stopSequences:y,topP:m,topK:h,presencePenalty:_,frequencyPenalty:l,seed:a,prompt:d,providerOptions:v,tools:k,toolChoice:S,responseFormat:b}){var r,g,f,c;const w=[],x=Ne(this.modelId);h!=null&&w.push({type:"unsupported-setting",setting:"topK"}),a!=null&&w.push({type:"unsupported-setting",setting:"seed"}),_!=null&&w.push({type:"unsupported-setting",setting:"presencePenalty"}),l!=null&&w.push({type:"unsupported-setting",setting:"frequencyPenalty"}),y!=null&&w.push({type:"unsupported-setting",setting:"stopSequences"});const i=await ue({provider:"openai",providerOptions:v,schema:Lt});i?.conversation&&i?.previousResponseId&&w.push({type:"unsupported-setting",setting:"conversation",details:"conversation and previousResponseId cannot be used together"});const{input:P,warnings:W}=await Vt({prompt:d,systemMessageMode:x.systemMessageMode,fileIdPrefixes:this.config.fileIdPrefixes,store:(r=i?.store)!=null?r:!0,hasLocalShellTool:D("openai.local_shell")});w.push(...W);const V=(g=i?.strictJsonSchema)!=null?g:!1;let E=i?.include;function q(N){E==null?E=[N]:E.includes(N)||(E=[...E,N])}function D(N){return k?.find(ee=>ee.type==="provider-defined"&&ee.id===N)!=null}const j=typeof i?.logprobs=="number"?i?.logprobs:i?.logprobs===!0?je:void 0;j&&q("message.output_text.logprobs");const G=(f=k?.find(N=>N.type==="provider-defined"&&(N.id==="openai.web_search"||N.id==="openai.web_search_preview")))==null?void 0:f.name;G&&q("web_search_call.action.sources"),D("openai.code_interpreter")&&q("code_interpreter_call.outputs");const Z=i?.store;Z===!1&&x.isReasoningModel&&q("reasoning.encrypted_content");const z={model:this.modelId,input:P,temperature:u,top_p:m,max_output_tokens:n,...(b?.type==="json"||i?.textVerbosity)&&{text:{...b?.type==="json"&&{format:b.schema!=null?{type:"json_schema",strict:V,name:(c=b.name)!=null?c:"response",description:b.description,schema:b.schema}:{type:"json_object"}},...i?.textVerbosity&&{verbosity:i.textVerbosity}}},conversation:i?.conversation,max_tool_calls:i?.maxToolCalls,metadata:i?.metadata,parallel_tool_calls:i?.parallelToolCalls,previous_response_id:i?.previousResponseId,store:Z,user:i?.user,instructions:i?.instructions,service_tier:i?.serviceTier,include:E,prompt_cache_key:i?.promptCacheKey,prompt_cache_retention:i?.promptCacheRetention,safety_identifier:i?.safetyIdentifier,top_logprobs:j,truncation:i?.truncation,...x.isReasoningModel&&(i?.reasoningEffort!=null||i?.reasoningSummary!=null)&&{reasoning:{...i?.reasoningEffort!=null&&{effort:i.reasoningEffort},...i?.reasoningSummary!=null&&{summary:i.reasoningSummary}}}};x.isReasoningModel?i?.reasoningEffort==="none"&&x.supportsNonReasoningParameters||(z.temperature!=null&&(z.temperature=void 0,w.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),z.top_p!=null&&(z.top_p=void 0,w.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))):(i?.reasoningEffort!=null&&w.push({type:"unsupported-setting",setting:"reasoningEffort",details:"reasoningEffort is not supported for non-reasoning models"}),i?.reasoningSummary!=null&&w.push({type:"unsupported-setting",setting:"reasoningSummary",details:"reasoningSummary is not supported for non-reasoning models"})),i?.serviceTier==="flex"&&!x.supportsFlexProcessing&&(w.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),delete z.service_tier),i?.serviceTier==="priority"&&!x.supportsPriorityProcessing&&(w.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),delete z.service_tier);const{tools:se,toolChoice:X,toolWarnings:ne}=await Bt({tools:k,toolChoice:S,strictJsonSchema:V});return{webSearchToolName:G,args:{...z,tools:se,tool_choice:X},warnings:[...w,...ne],store:Z}}async doGenerate(n){var u,y,m,h,_,l,a,d,v,k,S,b,r,g,f,c,w,x,i,P,W,V,E,q,D,j,G,Z;const{args:z,warnings:se,webSearchToolName:X}=await this.getArgs(n),ne=this.config.url({path:"/responses",modelId:this.modelId}),N=this.config.provider.replace(".responses",""),{responseHeaders:ee,value:H,rawValue:re}=await le({url:ne,headers:oe(this.config.headers(),n.headers),body:z,failedResponseHandler:ie,successfulResponseHandler:me(Jt),abortSignal:n.abortSignal,fetch:this.config.fetch});if(H.error)throw new Ke({message:H.error.message,url:ne,requestBodyValues:z,statusCode:400,responseHeaders:ee,responseBody:re,isRetryable:!1});const M=[],$=[];let L=!1;for(const t of H.output)switch(t.type){case"reasoning":{t.summary.length===0&&t.summary.push({type:"summary_text",text:""});for(const C of t.summary)M.push({type:"reasoning",text:C.text,providerMetadata:{[N]:{itemId:t.id,reasoningEncryptedContent:(u=t.encrypted_content)!=null?u:null}}});break}case"image_generation_call":{M.push({type:"tool-call",toolCallId:t.id,toolName:"image_generation",input:"{}",providerExecuted:!0}),M.push({type:"tool-result",toolCallId:t.id,toolName:"image_generation",result:{result:t.result},providerExecuted:!0});break}case"local_shell_call":{M.push({type:"tool-call",toolCallId:t.call_id,toolName:"local_shell",input:JSON.stringify({action:t.action}),providerMetadata:{[N]:{itemId:t.id}}});break}case"message":{for(const C of t.content){(m=(y=n.providerOptions)==null?void 0:y.openai)!=null&&m.logprobs&&C.logprobs&&$.push(C.logprobs),M.push({type:"text",text:C.text,providerMetadata:{[N]:{itemId:t.id}}});for(const T of C.annotations)T.type==="url_citation"?M.push({type:"source",sourceType:"url",id:(l=(_=(h=this.config).generateId)==null?void 0:_.call(h))!=null?l:te(),url:T.url,title:T.title}):T.type==="file_citation"?M.push({type:"source",sourceType:"document",id:(v=(d=(a=this.config).generateId)==null?void 0:d.call(a))!=null?v:te(),mediaType:"text/plain",title:(S=(k=T.quote)!=null?k:T.filename)!=null?S:"Document",filename:(b=T.filename)!=null?b:T.file_id,...T.file_id?{providerMetadata:{[N]:{fileId:T.file_id}}}:{}}):T.type==="container_file_citation"?M.push({type:"source",sourceType:"document",id:(f=(g=(r=this.config).generateId)==null?void 0:g.call(r))!=null?f:te(),mediaType:"text/plain",title:(w=(c=T.filename)!=null?c:T.file_id)!=null?w:"Document",filename:(x=T.filename)!=null?x:T.file_id,providerMetadata:{[N]:{fileId:T.file_id,containerId:T.container_id,...T.index!=null?{index:T.index}:{}}}}):T.type==="file_path"&&M.push({type:"source",sourceType:"document",id:(W=(P=(i=this.config).generateId)==null?void 0:P.call(i))!=null?W:te(),mediaType:"application/octet-stream",title:T.file_id,filename:T.file_id,providerMetadata:{[N]:{fileId:T.file_id,...T.index!=null?{index:T.index}:{}}}})}break}case"function_call":{L=!0,M.push({type:"tool-call",toolCallId:t.call_id,toolName:t.name,input:t.arguments,providerMetadata:{[N]:{itemId:t.id}}});break}case"web_search_call":{M.push({type:"tool-call",toolCallId:t.id,toolName:X??"web_search",input:JSON.stringify({}),providerExecuted:!0}),M.push({type:"tool-result",toolCallId:t.id,toolName:X??"web_search",result:Re(t.action),providerExecuted:!0});break}case"computer_call":{M.push({type:"tool-call",toolCallId:t.id,toolName:"computer_use",input:"",providerExecuted:!0}),M.push({type:"tool-result",toolCallId:t.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:t.status||"completed"},providerExecuted:!0});break}case"file_search_call":{M.push({type:"tool-call",toolCallId:t.id,toolName:"file_search",input:"{}",providerExecuted:!0}),M.push({type:"tool-result",toolCallId:t.id,toolName:"file_search",result:{queries:t.queries,results:(E=(V=t.results)==null?void 0:V.map(C=>({attributes:C.attributes,fileId:C.file_id,filename:C.filename,score:C.score,text:C.text})))!=null?E:null},providerExecuted:!0});break}case"code_interpreter_call":{M.push({type:"tool-call",toolCallId:t.id,toolName:"code_interpreter",input:JSON.stringify({code:t.code,containerId:t.container_id}),providerExecuted:!0}),M.push({type:"tool-result",toolCallId:t.id,toolName:"code_interpreter",result:{outputs:t.outputs},providerExecuted:!0});break}}const K={[N]:{...H.id!=null?{responseId:H.id}:{}}};$.length>0&&(K[N].logprobs=$),typeof H.service_tier=="string"&&(K[N].serviceTier=H.service_tier);const O=H.usage;return{content:M,finishReason:Te({finishReason:(q=H.incomplete_details)==null?void 0:q.reason,hasFunctionCall:L}),usage:{inputTokens:O.input_tokens,outputTokens:O.output_tokens,totalTokens:O.input_tokens+O.output_tokens,reasoningTokens:(j=(D=O.output_tokens_details)==null?void 0:D.reasoning_tokens)!=null?j:void 0,cachedInputTokens:(Z=(G=O.input_tokens_details)==null?void 0:G.cached_tokens)!=null?Z:void 0},request:{body:z},response:{id:H.id,timestamp:new Date(H.created_at*1e3),modelId:H.model,headers:ee,body:re},providerMetadata:K,warnings:se}}async doStream(n){const{args:u,warnings:y,webSearchToolName:m,store:h}=await this.getArgs(n),{responseHeaders:_,value:l}=await le({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:oe(this.config.headers(),n.headers),body:{...u,stream:!0},failedResponseHandler:ie,successfulResponseHandler:fe(Ut),abortSignal:n.abortSignal,fetch:this.config.fetch}),a=this,d=this.config.provider.replace(".responses","");let v="unknown";const k={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},S=[];let b=null;const r={},g=[];let f=!1;const c={};let w;return{stream:l.pipeThrough(new TransformStream({start(x){x.enqueue({type:"stream-start",warnings:y})},transform(x,i){var P,W,V,E,q,D,j,G,Z,z,se,X,ne,N,ee,H,re,M,$,L,K,O;if(n.includeRawChunks&&i.enqueue({type:"raw",rawValue:x.rawValue}),!x.success){v="error",i.enqueue({type:"error",error:x.error});return}const t=x.value;if(qe(t))t.item.type==="function_call"?(r[t.output_index]={toolName:t.item.name,toolCallId:t.item.call_id},i.enqueue({type:"tool-input-start",id:t.item.call_id,toolName:t.item.name})):t.item.type==="web_search_call"?(r[t.output_index]={toolName:m??"web_search",toolCallId:t.item.id},i.enqueue({type:"tool-input-start",id:t.item.id,toolName:m??"web_search",providerExecuted:!0}),i.enqueue({type:"tool-input-end",id:t.item.id}),i.enqueue({type:"tool-call",toolCallId:t.item.id,toolName:m??"web_search",input:JSON.stringify({}),providerExecuted:!0})):t.item.type==="computer_call"?(r[t.output_index]={toolName:"computer_use",toolCallId:t.item.id},i.enqueue({type:"tool-input-start",id:t.item.id,toolName:"computer_use",providerExecuted:!0})):t.item.type==="code_interpreter_call"?(r[t.output_index]={toolName:"code_interpreter",toolCallId:t.item.id,codeInterpreter:{containerId:t.item.container_id}},i.enqueue({type:"tool-input-start",id:t.item.id,toolName:"code_interpreter",providerExecuted:!0}),i.enqueue({type:"tool-input-delta",id:t.item.id,delta:`{"containerId":"${t.item.container_id}","code":"`})):t.item.type==="file_search_call"?i.enqueue({type:"tool-call",toolCallId:t.item.id,toolName:"file_search",input:"{}",providerExecuted:!0}):t.item.type==="image_generation_call"?i.enqueue({type:"tool-call",toolCallId:t.item.id,toolName:"image_generation",input:"{}",providerExecuted:!0}):t.item.type==="message"?(g.splice(0,g.length),i.enqueue({type:"text-start",id:t.item.id,providerMetadata:{[d]:{itemId:t.item.id}}})):qe(t)&&t.item.type==="reasoning"&&(c[t.item.id]={encryptedContent:t.item.encrypted_content,summaryParts:{0:"active"}},i.enqueue({type:"reasoning-start",id:`${t.item.id}:0`,providerMetadata:{[d]:{itemId:t.item.id,reasoningEncryptedContent:(P=t.item.encrypted_content)!=null?P:null}}}));else if(Kt(t)){if(t.item.type==="message")i.enqueue({type:"text-end",id:t.item.id,providerMetadata:{[d]:{itemId:t.item.id,...g.length>0&&{annotations:g}}}});else if(t.item.type==="function_call")r[t.output_index]=void 0,f=!0,i.enqueue({type:"tool-input-end",id:t.item.call_id}),i.enqueue({type:"tool-call",toolCallId:t.item.call_id,toolName:t.item.name,input:t.item.arguments,providerMetadata:{[d]:{itemId:t.item.id}}});else if(t.item.type==="web_search_call")r[t.output_index]=void 0,i.enqueue({type:"tool-result",toolCallId:t.item.id,toolName:m??"web_search",result:Re(t.item.action),providerExecuted:!0});else if(t.item.type==="computer_call")r[t.output_index]=void 0,i.enqueue({type:"tool-input-end",id:t.item.id}),i.enqueue({type:"tool-call",toolCallId:t.item.id,toolName:"computer_use",input:"",providerExecuted:!0}),i.enqueue({type:"tool-result",toolCallId:t.item.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:t.item.status||"completed"},providerExecuted:!0});else if(t.item.type==="file_search_call")r[t.output_index]=void 0,i.enqueue({type:"tool-result",toolCallId:t.item.id,toolName:"file_search",result:{queries:t.item.queries,results:(V=(W=t.item.results)==null?void 0:W.map(C=>({attributes:C.attributes,fileId:C.file_id,filename:C.filename,score:C.score,text:C.text})))!=null?V:null},providerExecuted:!0});else if(t.item.type==="code_interpreter_call")r[t.output_index]=void 0,i.enqueue({type:"tool-result",toolCallId:t.item.id,toolName:"code_interpreter",result:{outputs:t.item.outputs},providerExecuted:!0});else if(t.item.type==="image_generation_call")i.enqueue({type:"tool-result",toolCallId:t.item.id,toolName:"image_generation",result:{result:t.item.result},providerExecuted:!0});else if(t.item.type==="local_shell_call")r[t.output_index]=void 0,i.enqueue({type:"tool-call",toolCallId:t.item.call_id,toolName:"local_shell",input:JSON.stringify({action:{type:"exec",command:t.item.action.command,timeoutMs:t.item.action.timeout_ms,user:t.item.action.user,workingDirectory:t.item.action.working_directory,env:t.item.action.env}}),providerMetadata:{[d]:{itemId:t.item.id}}});else if(t.item.type==="reasoning"){const C=c[t.item.id],T=Object.entries(C.summaryParts).filter(([he,be])=>be==="active"||be==="can-conclude").map(([he])=>he);for(const he of T)i.enqueue({type:"reasoning-end",id:`${t.item.id}:${he}`,providerMetadata:{[d]:{itemId:t.item.id,reasoningEncryptedContent:(E=t.item.encrypted_content)!=null?E:null}}});delete c[t.item.id]}}else if(Yt(t)){const C=r[t.output_index];C!=null&&i.enqueue({type:"tool-input-delta",id:C.toolCallId,delta:t.delta})}else if(Qt(t)){const C=r[t.output_index];C!=null&&i.enqueue({type:"tool-input-delta",id:C.toolCallId,delta:JSON.stringify(t.delta).slice(1,-1)})}else if(en(t)){const C=r[t.output_index];C!=null&&(i.enqueue({type:"tool-input-delta",id:C.toolCallId,delta:'"}'}),i.enqueue({type:"tool-input-end",id:C.toolCallId}),i.enqueue({type:"tool-call",toolCallId:C.toolCallId,toolName:"code_interpreter",input:JSON.stringify({code:t.code,containerId:C.codeInterpreter.containerId}),providerExecuted:!0}))}else if(Xt(t))b=t.response.id,i.enqueue({type:"response-metadata",id:t.response.id,timestamp:new Date(t.response.created_at*1e3),modelId:t.response.model});else if(Gt(t))i.enqueue({type:"text-delta",id:t.item_id,delta:t.delta}),(D=(q=n.providerOptions)==null?void 0:q.openai)!=null&&D.logprobs&&t.logprobs&&S.push(t.logprobs);else if(t.type==="response.reasoning_summary_part.added"){if(t.summary_index>0){const C=c[t.item_id];C.summaryParts[t.summary_index]="active";for(const T of Object.keys(C.summaryParts))C.summaryParts[T]==="can-conclude"&&(i.enqueue({type:"reasoning-end",id:`${t.item_id}:${T}`,providerMetadata:{[d]:{itemId:t.item_id}}}),C.summaryParts[T]="concluded");i.enqueue({type:"reasoning-start",id:`${t.item_id}:${t.summary_index}`,providerMetadata:{[d]:{itemId:t.item_id,reasoningEncryptedContent:(G=(j=c[t.item_id])==null?void 0:j.encryptedContent)!=null?G:null}}})}}else t.type==="response.reasoning_summary_text.delta"?i.enqueue({type:"reasoning-delta",id:`${t.item_id}:${t.summary_index}`,delta:t.delta,providerMetadata:{[d]:{itemId:t.item_id}}}):t.type==="response.reasoning_summary_part.done"?h?(i.enqueue({type:"reasoning-end",id:`${t.item_id}:${t.summary_index}`,providerMetadata:{[d]:{itemId:t.item_id}}}),c[t.item_id].summaryParts[t.summary_index]="concluded"):c[t.item_id].summaryParts[t.summary_index]="can-conclude":Zt(t)?(v=Te({finishReason:(Z=t.response.incomplete_details)==null?void 0:Z.reason,hasFunctionCall:f}),k.inputTokens=t.response.usage.input_tokens,k.outputTokens=t.response.usage.output_tokens,k.totalTokens=t.response.usage.input_tokens+t.response.usage.output_tokens,k.reasoningTokens=(se=(z=t.response.usage.output_tokens_details)==null?void 0:z.reasoning_tokens)!=null?se:void 0,k.cachedInputTokens=(ne=(X=t.response.usage.input_tokens_details)==null?void 0:X.cached_tokens)!=null?ne:void 0,typeof t.response.service_tier=="string"&&(w=t.response.service_tier)):tn(t)?(g.push(t.annotation),t.annotation.type==="url_citation"?i.enqueue({type:"source",sourceType:"url",id:(H=(ee=(N=a.config).generateId)==null?void 0:ee.call(N))!=null?H:te(),url:t.annotation.url,title:t.annotation.title}):t.annotation.type==="file_citation"&&i.enqueue({type:"source",sourceType:"document",id:($=(M=(re=a.config).generateId)==null?void 0:M.call(re))!=null?$:te(),mediaType:"text/plain",title:(K=(L=t.annotation.quote)!=null?L:t.annotation.filename)!=null?K:"Document",filename:(O=t.annotation.filename)!=null?O:t.annotation.file_id,...t.annotation.file_id?{providerMetadata:{[d]:{fileId:t.annotation.file_id}}}:{}})):nn(t)&&i.enqueue({type:"error",error:t})},flush(x){const i={[d]:{responseId:b}};S.length>0&&(i[d].logprobs=S),w!==void 0&&(i[d].serviceTier=w),x.enqueue({type:"finish",finishReason:v,usage:k,providerMetadata:i})}})),request:{body:u},response:{headers:_}}}};function Gt(n){return n.type==="response.output_text.delta"}function Kt(n){return n.type==="response.output_item.done"}function Zt(n){return n.type==="response.completed"||n.type==="response.incomplete"}function Xt(n){return n.type==="response.created"}function Yt(n){return n.type==="response.function_call_arguments.delta"}function Qt(n){return n.type==="response.code_interpreter_call_code.delta"}function en(n){return n.type==="response.code_interpreter_call_code.done"}function qe(n){return n.type==="response.output_item.added"}function tn(n){return n.type==="response.output_text.annotation.added"}function nn(n){return n.type==="error"}function Re(n){var u;switch(n.type){case"search":return{action:{type:"search",query:(u=n.query)!=null?u:void 0},...n.sources!=null&&{sources:n.sources}};case"open_page":return{action:{type:"openPage",url:n.url}};case"find_in_page":return{action:{type:"findInPage",url:n.url,pattern:n.pattern}}}}var on=B(()=>R(o({instructions:e().nullish(),speed:s().min(.25).max(4).default(1).nullish()}))),sn=class{constructor(n,u){this.modelId=n,this.config=u,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({text:n,voice:u="alloy",outputFormat:y="mp3",speed:m,instructions:h,language:_,providerOptions:l}){const a=[],d=await ue({provider:"openai",providerOptions:l,schema:on}),v={model:this.modelId,input:n,voice:u,response_format:"mp3",speed:m,instructions:h};if(y&&(["mp3","opus","aac","flac","wav","pcm"].includes(y)?v.response_format=y:a.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${y}. Using mp3 instead.`})),d){const k={};for(const S in k){const b=k[S];b!==void 0&&(v[S]=b)}}return _&&a.push({type:"unsupported-setting",setting:"language",details:`OpenAI speech models do not support language selection. Language parameter "${_}" was ignored.`}),{requestBody:v,warnings:a}}async doGenerate(n){var u,y,m;const h=(m=(y=(u=this.config._internal)==null?void 0:u.currentDate)==null?void 0:y.call(u))!=null?m:new Date,{requestBody:_,warnings:l}=await this.getArgs(n),{value:a,responseHeaders:d,rawValue:v}=await le({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:oe(this.config.headers(),n.headers),body:_,failedResponseHandler:ie,successfulResponseHandler:Xe(),abortSignal:n.abortSignal,fetch:this.config.fetch});return{audio:a,warnings:l,request:{body:JSON.stringify(_)},response:{timestamp:h,modelId:this.modelId,headers:d,body:v}}}},an=B(()=>R(o({text:e(),language:e().nullish(),duration:s().nullish(),words:I(o({word:e(),start:s(),end:s()})).nullish(),segments:I(o({id:s(),seek:s(),start:s(),end:s(),text:e(),tokens:I(s()),temperature:s(),avg_logprob:s(),compression_ratio:s(),no_speech_prob:s()})).nullish()}))),ln=B(()=>R(o({include:I(e()).optional(),language:e().optional(),prompt:e().optional(),temperature:s().min(0).max(1).default(0).optional(),timestampGranularities:I(A(["word","segment"])).default(["segment"]).optional()}))),Oe={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},rn=class{constructor(n,u){this.modelId=n,this.config=u,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({audio:n,mediaType:u,providerOptions:y}){const m=[],h=await ue({provider:"openai",providerOptions:y,schema:ln}),_=new FormData,l=n instanceof Uint8Array?new Blob([n]):new Blob([Je(n)]);_.append("model",this.modelId);const a=Le(u);if(_.append("file",new File([l],"audio",{type:u}),`audio.${a}`),h){const d={include:h.include,language:h.language,prompt:h.prompt,response_format:["gpt-4o-transcribe","gpt-4o-mini-transcribe"].includes(this.modelId)?"json":"verbose_json",temperature:h.temperature,timestamp_granularities:h.timestampGranularities};for(const[v,k]of Object.entries(d))if(k!=null)if(Array.isArray(k))for(const S of k)_.append(`${v}[]`,String(S));else _.append(v,String(k))}return{formData:_,warnings:m}}async doGenerate(n){var u,y,m,h,_,l,a,d;const v=(m=(y=(u=this.config._internal)==null?void 0:u.currentDate)==null?void 0:y.call(u))!=null?m:new Date,{formData:k,warnings:S}=await this.getArgs(n),{value:b,responseHeaders:r,rawValue:g}=await Be({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:oe(this.config.headers(),n.headers),formData:k,failedResponseHandler:ie,successfulResponseHandler:me(an),abortSignal:n.abortSignal,fetch:this.config.fetch}),f=b.language!=null&&b.language in Oe?Oe[b.language]:void 0;return{text:b.text,segments:(a=(l=(h=b.segments)==null?void 0:h.map(c=>({text:c.text,startSecond:c.start,endSecond:c.end})))!=null?l:(_=b.words)==null?void 0:_.map(c=>({text:c.word,startSecond:c.start,endSecond:c.end})))!=null?a:[],language:f,durationInSeconds:(d=b.duration)!=null?d:void 0,warnings:S,response:{timestamp:v,modelId:this.modelId,headers:r,body:g}}}},un="2.0.88";function pn(n={}){var u,y;const m=(u=We(Ve({settingValue:n.baseURL,environmentVariableName:"OPENAI_BASE_URL"})))!=null?u:"https://api.openai.com/v1",h=(y=n.name)!=null?y:"openai",_=()=>ze({Authorization:`Bearer ${Fe({apiKey:n.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":n.organization,"OpenAI-Project":n.project,...n.headers},`ai-sdk/openai/${un}`),l=f=>new st(f,{provider:`${h}.chat`,url:({path:c})=>`${m}${c}`,headers:_,fetch:n.fetch}),a=f=>new ut(f,{provider:`${h}.completion`,url:({path:c})=>`${m}${c}`,headers:_,fetch:n.fetch}),d=f=>new ct(f,{provider:`${h}.embedding`,url:({path:c})=>`${m}${c}`,headers:_,fetch:n.fetch}),v=f=>new _t(f,{provider:`${h}.image`,url:({path:c})=>`${m}${c}`,headers:_,fetch:n.fetch}),k=f=>new rn(f,{provider:`${h}.transcription`,url:({path:c})=>`${m}${c}`,headers:_,fetch:n.fetch}),S=f=>new sn(f,{provider:`${h}.speech`,url:({path:c})=>`${m}${c}`,headers:_,fetch:n.fetch}),b=f=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return r(f)},r=f=>new Ft(f,{provider:`${h}.responses`,url:({path:c})=>`${m}${c}`,headers:_,fetch:n.fetch,fileIdPrefixes:["file-"]}),g=function(f){return b(f)};return g.languageModel=b,g.chat=l,g.completion=a,g.responses=r,g.embedding=d,g.textEmbedding=d,g.textEmbeddingModel=d,g.image=v,g.imageModel=v,g.transcription=k,g.transcriptionModel=k,g.speech=S,g.speechModel=S,g.tools=Wt,g}var mn=pn();export{un as VERSION,pn as createOpenAI,mn as openai};
