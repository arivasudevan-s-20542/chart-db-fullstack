import{w as Cn,M as de,b as Dt,t as ot,J as Le,k as xt,o as M,d as $t,l as kt,a as Re,n as He,N as Ba,A as Ar,O as Je,B as it,D as we,x as h,y as I,q as An,z as Ye,E as H,C as Ut,F as bt,H as be,g as _a,P as Nr,Q as U,R as rt,S as jt,V as Ht,W as Ee,X as Yt,Y as Kt,$ as lt,K as Ke,a0 as Fe,a1 as Sa,a2 as Nn,L as On,a3 as Ft,G as L,a4 as wa,e as zt,a5 as ut,s as st,a6 as Pn,a7 as Or,a8 as Z,a9 as Ne,aa as Pr,ab as qr,U as Ma,ac as Gt,ad as La,ae as qn,af as kn,v as Dn,ag as Q}from"./index-CjSUouGJ.js";import{ah as Iu,I as xu,ai as _u,aj as Su,ak as Mu,T as Eu,al as Ru,am as Cu,an as Au}from"./index-CjSUouGJ.js";import"./index-DY4lwpwP.js";var ua,Wa;function $n(){if(Wa)return ua;Wa=1;var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,n=(c,d)=>{for(var f in d)e(c,f,{get:d[f],enumerable:!0})},s=(c,d,f,p)=>{if(d&&typeof d=="object"||typeof d=="function")for(let m of a(d))!r.call(c,m)&&m!==f&&e(c,m,{get:()=>d[m],enumerable:!(p=t(d,m))||p.enumerable});return c},i=c=>s(e({},"__esModule",{value:!0}),c),o={};n(o,{SYMBOL_FOR_REQ_CONTEXT:()=>u,getContext:()=>l}),ua=i(o);const u=Symbol.for("@vercel/request-context");function l(){return globalThis[u]?.get?.()??{}}return ua}var da,Ha;function Un(){if(Ha)return da;Ha=1;var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,n=(d,f)=>{for(var p in f)e(d,p,{get:f[p],enumerable:!0})},s=(d,f,p,m)=>{if(f&&typeof f=="object"||typeof f=="function")for(let y of a(f))!r.call(d,y)&&y!==p&&e(d,y,{get:()=>f[y],enumerable:!(m=t(f,y))||m.enumerable});return d},i=d=>s(e({},"__esModule",{value:!0}),d),o={};n(o,{getContext:()=>u.getContext,getVercelOidcToken:()=>l,getVercelOidcTokenSync:()=>c}),da=i(o);var u=$n();async function l(){return""}function c(){return""}return da}var kr=Un(),jn="vercel.ai.gateway.error",pa=Symbol.for(jn),Ya,Ka,Se=class Dr extends(Ka=Error,Ya=pa,Ka){constructor({message:t,statusCode:a=500,cause:r}){super(t),this[Ya]=!0,this.statusCode=a,this.cause=r}static isInstance(t){return Dr.hasMarker(t)}static hasMarker(t){return typeof t=="object"&&t!==null&&pa in t&&t[pa]===!0}},$r="GatewayAuthenticationError",Fn=`vercel.ai.gateway.error.${$r}`,za=Symbol.for(Fn),Xa,Qa,Ea=class Ur extends(Qa=Se,Xa=za,Qa){constructor({message:t="Authentication failed",statusCode:a=401,cause:r}={}){super({message:t,statusCode:a,cause:r}),this[Xa]=!0,this.name=$r,this.type="authentication_error"}static isInstance(t){return Se.hasMarker(t)&&za in t}static createContextualError({apiKeyProvided:t,oidcTokenProvided:a,message:r="Authentication failed",statusCode:n=401,cause:s}){let i;return t?i=`AI Gateway authentication failed: Invalid API key.

Create a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys

Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:a?i=`AI Gateway authentication failed: Invalid OIDC token.

Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.

Alternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`:i=`AI Gateway authentication failed: No authentication provided.

Option 1 - API key:
Create an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys
Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

Option 2 - OIDC token:
Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`,new Ur({message:i,statusCode:n,cause:s})}},jr="GatewayInvalidRequestError",Gn=`vercel.ai.gateway.error.${jr}`,Za=Symbol.for(Gn),er,tr,Jn=class extends(tr=Se,er=Za,tr){constructor({message:e="Invalid request",statusCode:t=400,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[er]=!0,this.name=jr,this.type="invalid_request_error"}static isInstance(e){return Se.hasMarker(e)&&Za in e}},Fr="GatewayRateLimitError",Vn=`vercel.ai.gateway.error.${Fr}`,ar=Symbol.for(Vn),rr,sr,Bn=class extends(sr=Se,rr=ar,sr){constructor({message:e="Rate limit exceeded",statusCode:t=429,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[rr]=!0,this.name=Fr,this.type="rate_limit_exceeded"}static isInstance(e){return Se.hasMarker(e)&&ar in e}},Gr="GatewayModelNotFoundError",Ln=`vercel.ai.gateway.error.${Gr}`,nr=Symbol.for(Ln),Wn=He(()=>Ye(M({modelId:h()}))),or,ir,Hn=class extends(ir=Se,or=nr,ir){constructor({message:e="Model not found",statusCode:t=404,modelId:a,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[or]=!0,this.name=Gr,this.type="model_not_found",this.modelId=a}static isInstance(e){return Se.hasMarker(e)&&nr in e}},Jr="GatewayInternalServerError",Yn=`vercel.ai.gateway.error.${Jr}`,lr=Symbol.for(Yn),ur,dr,pr=class extends(dr=Se,ur=lr,dr){constructor({message:e="Internal server error",statusCode:t=500,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[ur]=!0,this.name=Jr,this.type="internal_server_error"}static isInstance(e){return Se.hasMarker(e)&&lr in e}},Vr="GatewayResponseError",Kn=`vercel.ai.gateway.error.${Vr}`,cr=Symbol.for(Kn),mr,fr,zn=class extends(fr=Se,mr=cr,fr){constructor({message:e="Invalid response from Gateway",statusCode:t=502,response:a,validationError:r,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[mr]=!0,this.name=Vr,this.type="response_error",this.response=a,this.validationError=r}static isInstance(e){return Se.hasMarker(e)&&cr in e}};async function gr({response:e,statusCode:t,defaultMessage:a="Gateway request failed",cause:r,authMethod:n}){const s=await Je({value:e,schema:Xn});if(!s.success)return new zn({message:`Invalid error response format: ${a}`,statusCode:t,response:e,validationError:s.error,cause:r});const i=s.value,o=i.error.type,u=i.error.message;switch(o){case"authentication_error":return Ea.createContextualError({apiKeyProvided:n==="api-key",oidcTokenProvided:n==="oidc",statusCode:t,cause:r});case"invalid_request_error":return new Jn({message:u,statusCode:t,cause:r});case"rate_limit_exceeded":return new Bn({message:u,statusCode:t,cause:r});case"model_not_found":{const l=await Je({value:i.error.param,schema:Wn});return new Hn({message:u,statusCode:t,modelId:l.success?l.value.modelId:void 0,cause:r})}case"internal_server_error":return new pr({message:u,statusCode:t,cause:r});default:return new pr({message:u,statusCode:t,cause:r})}}var Xn=He(()=>Ye(M({error:M({message:h(),type:h().nullish(),param:H().nullish(),code:be([h(),Ut()]).nullish()})})));function We(e,t){var a;return Se.isInstance(e)?e:Ar.isInstance(e)?gr({response:Qn(e),statusCode:(a=e.statusCode)!=null?a:500,defaultMessage:"Gateway request failed",cause:e,authMethod:t}):gr({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:"Unknown Gateway error",cause:e,authMethod:t})}function Qn(e){if(e.data!==void 0)return e.data;if(e.responseBody!=null)try{return JSON.parse(e.responseBody)}catch{return e.responseBody}return{}}var Br="ai-gateway-auth-method";async function dt(e){const t=await Je({value:e[Br],schema:Zn});return t.success?t.value:void 0}var Zn=He(()=>Ye(be([I("api-key"),I("oidc")]))),hr=class{constructor(e){this.config=e}async getAvailableModels(){try{const{value:e}=await Ba({url:`${this.config.baseURL}/config`,headers:await de(this.config.headers()),successfulResponseHandler:xt(eo),failedResponseHandler:ot({errorSchema:Le(),errorToMessage:t=>t}),fetch:this.config.fetch});return e}catch(e){throw await We(e)}}async getCredits(){try{const e=new URL(this.config.baseURL),{value:t}=await Ba({url:`${e.origin}/v1/credits`,headers:await de(this.config.headers()),successfulResponseHandler:xt(to),failedResponseHandler:ot({errorSchema:Le(),errorToMessage:a=>a}),fetch:this.config.fetch});return t}catch(e){throw await We(e)}}},eo=He(()=>Ye(M({models:we(M({id:h(),name:h(),description:h().nullish(),pricing:M({input:h(),output:h(),input_cache_read:h().nullish(),input_cache_write:h().nullish()}).transform(({input:e,output:t,input_cache_read:a,input_cache_write:r})=>({input:e,output:t,...a?{cachedInputTokens:a}:{},...r?{cacheCreationInputTokens:r}:{}})).nullish(),specification:M({specificationVersion:I("v2"),provider:h(),modelId:h()}),modelType:bt(["language","embedding","image"]).nullish()}))}))),to=He(()=>Ye(M({balance:h(),total_used:h()}).transform(({balance:e,total_used:t})=>({balance:e,totalUsed:t})))),ao=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){const{abortSignal:t,...a}=e;return{args:this.maybeEncodeFileParts(a),warnings:[]}}async doGenerate(e){const{args:t,warnings:a}=await this.getArgs(e),{abortSignal:r}=e,n=await de(this.config.headers());try{const{responseHeaders:s,value:i,rawValue:o}=await Dt({url:this.getUrl(),headers:$t(n,e.headers,this.getModelConfigHeaders(this.modelId,!1),await de(this.config.o11yHeaders)),body:t,successfulResponseHandler:xt(Le()),failedResponseHandler:ot({errorSchema:Le(),errorToMessage:u=>u}),...r&&{abortSignal:r},fetch:this.config.fetch});return{...i,request:{body:t},response:{headers:s,body:o},warnings:a}}catch(s){throw await We(s,await dt(n))}}async doStream(e){const{args:t,warnings:a}=await this.getArgs(e),{abortSignal:r}=e,n=await de(this.config.headers());try{const{value:s,responseHeaders:i}=await Dt({url:this.getUrl(),headers:$t(n,e.headers,this.getModelConfigHeaders(this.modelId,!0),await de(this.config.o11yHeaders)),body:t,successfulResponseHandler:An(Le()),failedResponseHandler:ot({errorSchema:Le(),errorToMessage:o=>o}),...r&&{abortSignal:r},fetch:this.config.fetch});return{stream:s.pipeThrough(new TransformStream({start(o){a.length>0&&o.enqueue({type:"stream-start",warnings:a})},transform(o,u){if(o.success){const l=o.value;if(l.type==="raw"&&!e.includeRawChunks)return;l.type==="response-metadata"&&l.timestamp&&typeof l.timestamp=="string"&&(l.timestamp=new Date(l.timestamp)),u.enqueue(l)}else u.error(o.error)}})),request:{body:t},response:{headers:i}}}catch(s){throw await We(s,await dt(n))}}isFilePart(e){return e&&typeof e=="object"&&"type"in e&&e.type==="file"}maybeEncodeFileParts(e){for(const t of e.prompt)for(const a of t.content)if(this.isFilePart(a)){const r=a;if(r.data instanceof Uint8Array){const n=Uint8Array.from(r.data),s=Buffer.from(n).toString("base64");r.data=new URL(`data:${r.mediaType||"application/octet-stream"};base64,${s}`)}}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":"2","ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},ro=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:a,providerOptions:r}){var n;const s=await de(this.config.headers());try{const{responseHeaders:i,value:o,rawValue:u}=await Dt({url:this.getUrl(),headers:$t(s,t??{},this.getModelConfigHeaders(),await de(this.config.o11yHeaders)),body:{input:e.length===1?e[0]:e,...r?{providerOptions:r}:{}},successfulResponseHandler:xt(so),failedResponseHandler:ot({errorSchema:Le(),errorToMessage:l=>l}),...a&&{abortSignal:a},fetch:this.config.fetch});return{embeddings:o.embeddings,usage:(n=o.usage)!=null?n:void 0,providerMetadata:o.providerMetadata,response:{headers:i,body:u}}}catch(i){throw await We(i,await dt(s))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"2","ai-model-id":this.modelId}}},so=He(()=>Ye(M({embeddings:we(we(Ut())),usage:M({tokens:Ut()}).nullish(),providerMetadata:it(h(),it(h(),H())).optional()}))),no=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.maxImagesPerCall=Number.MAX_SAFE_INTEGER}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:a,aspectRatio:r,seed:n,providerOptions:s,headers:i,abortSignal:o}){var u;const l=await de(this.config.headers());try{const{responseHeaders:c,value:d,rawValue:f}=await Dt({url:this.getUrl(),headers:$t(l,i??{},this.getModelConfigHeaders(),await de(this.config.o11yHeaders)),body:{prompt:e,n:t,...a&&{size:a},...r&&{aspectRatio:r},...n&&{seed:n},...s&&{providerOptions:s}},successfulResponseHandler:xt(io),failedResponseHandler:ot({errorSchema:Le(),errorToMessage:p=>p}),...o&&{abortSignal:o},fetch:this.config.fetch});return{images:d.images,warnings:(u=d.warnings)!=null?u:[],providerMetadata:d.providerMetadata,response:{timestamp:new Date,modelId:this.modelId,headers:c}}}catch(c){throw We(c,await dt(l))}}getUrl(){return`${this.config.baseURL}/image-model`}getModelConfigHeaders(){return{"ai-image-model-specification-version":"2","ai-model-id":this.modelId}}},oo=M({images:we(H()).optional()}).catchall(H()),io=M({images:we(h()),warnings:we(M({type:I("other"),message:h()})).optional(),providerMetadata:it(h(),oo).optional()});async function lo(){var e;return(e=kr.getContext().headers)==null?void 0:e["x-vercel-id"]}var uo="2.0.23",po="0.0.1";function co(e={}){var t,a;let r=null,n=null;const s=(t=e.metadataCacheRefreshMillis)!=null?t:1e3*60*5;let i=0;const o=(a=Cn(e.baseURL))!=null?a:"https://ai-gateway.vercel.sh/v1/ai",u=async()=>{const m=await fo(e);if(m)return Re({Authorization:`Bearer ${m.token}`,"ai-gateway-protocol-version":po,[Br]:m.authMethod,...e.headers},`ai-sdk/gateway/${uo}`);throw Ea.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},l=()=>{const m=kt({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),y=kt({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),w=kt({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{const v=await lo();return{...m&&{"ai-o11y-deployment-id":m},...y&&{"ai-o11y-environment":y},...w&&{"ai-o11y-region":w},...v&&{"ai-o11y-request-id":v}}}},c=m=>new ao(m,{provider:"gateway",baseURL:o,headers:u,fetch:e.fetch,o11yHeaders:l()}),d=async()=>{var m,y,w;const v=(w=(y=(m=e._internal)==null?void 0:m.currentDate)==null?void 0:y.call(m).getTime())!=null?w:Date.now();return(!r||v-i>s)&&(i=v,r=new hr({baseURL:o,headers:u,fetch:e.fetch}).getAvailableModels().then(S=>(n=S,S)).catch(async S=>{throw await We(S,await dt(await u()))})),n?Promise.resolve(n):r},f=async()=>new hr({baseURL:o,headers:u,fetch:e.fetch}).getCredits().catch(async m=>{throw await We(m,await dt(await u()))}),p=function(m){if(new.target)throw new Error("The Gateway Provider model function cannot be called with the new keyword.");return c(m)};return p.getAvailableModels=d,p.getCredits=f,p.imageModel=m=>new no(m,{provider:"gateway",baseURL:o,headers:u,fetch:e.fetch,o11yHeaders:l()}),p.languageModel=c,p.textEmbeddingModel=m=>new ro(m,{provider:"gateway",baseURL:o,headers:u,fetch:e.fetch,o11yHeaders:l()}),p}var mo=co();async function fo(e){const t=kt({settingValue:e.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(t)return{token:t,authMethod:"api-key"};try{return{token:await kr.getVercelOidcToken(),authMethod:"oidc"}}catch{return null}}var go=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},ze="1.9.0",vr=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function ho(e){var t=new Set([e]),a=new Set,r=e.match(vr);if(!r)return function(){return!1};var n={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(n.prerelease!=null)return function(u){return u===e};function s(o){return a.add(o),!1}function i(o){return t.add(o),!0}return function(u){if(t.has(u))return!0;if(a.has(u))return!1;var l=u.match(vr);if(!l)return s(u);var c={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return c.prerelease!=null||n.major!==c.major?s(u):n.major===0?n.minor===c.minor&&n.patch<=c.patch?i(u):s(u):n.minor<=c.minor?i(u):s(u)}}var vo=ho(ze),yo=ze.split(".")[0],_t=Symbol.for("opentelemetry.js.api."+yo),St=go;function Ra(e,t,a,r){var n;r===void 0&&(r=!1);var s=St[_t]=(n=St[_t])!==null&&n!==void 0?n:{version:ze};if(!r&&s[e]){var i=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return a.error(i.stack||i.message),!1}if(s.version!==ze){var i=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+e+" does not match previously registered API v"+ze);return a.error(i.stack||i.message),!1}return s[e]=t,a.debug("@opentelemetry/api: Registered a global for "+e+" v"+ze+"."),!0}function Mt(e){var t,a,r=(t=St[_t])===null||t===void 0?void 0:t.version;if(!(!r||!vo(r)))return(a=St[_t])===null||a===void 0?void 0:a[e]}function Ca(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+ze+".");var a=St[_t];a&&delete a[e]}var wo=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var r=a.call(e),n,s=[],i;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(o){i={error:o}}finally{try{n&&!n.done&&(a=r.return)&&a.call(r)}finally{if(i)throw i.error}}return s},bo=function(e,t,a){if(a||arguments.length===2)for(var r=0,n=t.length,s;r<n;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},To=(function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return yt("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return yt("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return yt("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return yt("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return yt("verbose",this._namespace,t)},e})();function yt(e,t,a){var r=Mt("diag");if(r)return a.unshift(t),r[e].apply(r,bo([],wo(a),!1))}var _e;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(_e||(_e={}));function Io(e,t){e<_e.NONE?e=_e.NONE:e>_e.ALL&&(e=_e.ALL),t=t||{};function a(r,n){var s=t[r];return typeof s=="function"&&e>=n?s.bind(t):function(){}}return{error:a("error",_e.ERROR),warn:a("warn",_e.WARN),info:a("info",_e.INFO),debug:a("debug",_e.DEBUG),verbose:a("verbose",_e.VERBOSE)}}var xo=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var r=a.call(e),n,s=[],i;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(o){i={error:o}}finally{try{n&&!n.done&&(a=r.return)&&a.call(r)}finally{if(i)throw i.error}}return s},_o=function(e,t,a){if(a||arguments.length===2)for(var r=0,n=t.length,s;r<n;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},So="diag",Jt=(function(){function e(){function t(n){return function(){for(var s=[],i=0;i<arguments.length;i++)s[i]=arguments[i];var o=Mt("diag");if(o)return o[n].apply(o,_o([],xo(s),!1))}}var a=this,r=function(n,s){var i,o,u;if(s===void 0&&(s={logLevel:_e.INFO}),n===a){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return a.error((i=l.stack)!==null&&i!==void 0?i:l.message),!1}typeof s=="number"&&(s={logLevel:s});var c=Mt("diag"),d=Io((o=s.logLevel)!==null&&o!==void 0?o:_e.INFO,n);if(c&&!s.suppressOverrideMessage){var f=(u=new Error().stack)!==null&&u!==void 0?u:"<failed to generate stacktrace>";c.warn("Current logger will be overwritten from "+f),d.warn("Current logger will overwrite one already registered from "+f)}return Ra("diag",d,a,!0)};a.setLogger=r,a.disable=function(){Ca(So,a)},a.createComponentLogger=function(n){return new To(n)},a.verbose=t("verbose"),a.debug=t("debug"),a.info=t("info"),a.warn=t("warn"),a.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e})();function Mo(e){return Symbol.for(e)}var Eo=(function(){function e(t){var a=this;a._currentContext=t?new Map(t):new Map,a.getValue=function(r){return a._currentContext.get(r)},a.setValue=function(r,n){var s=new e(a._currentContext);return s._currentContext.set(r,n),s},a.deleteValue=function(r){var n=new e(a._currentContext);return n._currentContext.delete(r),n}}return e})(),Ro=new Eo,Co=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var r=a.call(e),n,s=[],i;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(o){i={error:o}}finally{try{n&&!n.done&&(a=r.return)&&a.call(r)}finally{if(i)throw i.error}}return s},Ao=function(e,t,a){if(a||arguments.length===2)for(var r=0,n=t.length,s;r<n;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},No=(function(){function e(){}return e.prototype.active=function(){return Ro},e.prototype.with=function(t,a,r){for(var n=[],s=3;s<arguments.length;s++)n[s-3]=arguments[s];return a.call.apply(a,Ao([r],Co(n),!1))},e.prototype.bind=function(t,a){return a},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e})(),Oo=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var r=a.call(e),n,s=[],i;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(o){i={error:o}}finally{try{n&&!n.done&&(a=r.return)&&a.call(r)}finally{if(i)throw i.error}}return s},Po=function(e,t,a){if(a||arguments.length===2)for(var r=0,n=t.length,s;r<n;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},ca="context",qo=new No,Lr=(function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return Ra(ca,t,Jt.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,a,r){for(var n,s=[],i=3;i<arguments.length;i++)s[i-3]=arguments[i];return(n=this._getContextManager()).with.apply(n,Po([t,a,r],Oo(s),!1))},e.prototype.bind=function(t,a){return this._getContextManager().bind(t,a)},e.prototype._getContextManager=function(){return Mt(ca)||qo},e.prototype.disable=function(){this._getContextManager().disable(),Ca(ca,Jt.instance())},e})(),ba;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(ba||(ba={}));var Wr="0000000000000000",Hr="00000000000000000000000000000000",ko={traceId:Hr,spanId:Wr,traceFlags:ba.NONE},Tt=(function(){function e(t){t===void 0&&(t=ko),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,a){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,a){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,a){},e})(),Aa=Mo("OpenTelemetry Context Key SPAN");function Na(e){return e.getValue(Aa)||void 0}function Do(){return Na(Lr.getInstance().active())}function Oa(e,t){return e.setValue(Aa,t)}function $o(e){return e.deleteValue(Aa)}function Uo(e,t){return Oa(e,new Tt(t))}function Yr(e){var t;return(t=Na(e))===null||t===void 0?void 0:t.spanContext()}var jo=/^([0-9a-f]{32})$/i,Fo=/^[0-9a-f]{16}$/i;function Go(e){return jo.test(e)&&e!==Hr}function Jo(e){return Fo.test(e)&&e!==Wr}function Kr(e){return Go(e.traceId)&&Jo(e.spanId)}function Vo(e){return new Tt(e)}var ma=Lr.getInstance(),zr=(function(){function e(){}return e.prototype.startSpan=function(t,a,r){r===void 0&&(r=ma.active());var n=!!a?.root;if(n)return new Tt;var s=r&&Yr(r);return Bo(s)&&Kr(s)?new Tt(s):new Tt},e.prototype.startActiveSpan=function(t,a,r,n){var s,i,o;if(!(arguments.length<2)){arguments.length===2?o=a:arguments.length===3?(s=a,o=r):(s=a,i=r,o=n);var u=i??ma.active(),l=this.startSpan(t,s,u),c=Oa(u,l);return ma.with(c,o,void 0,l)}},e})();function Bo(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var Lo=new zr,Wo=(function(){function e(t,a,r,n){this._provider=t,this.name=a,this.version=r,this.options=n}return e.prototype.startSpan=function(t,a,r){return this._getTracer().startSpan(t,a,r)},e.prototype.startActiveSpan=function(t,a,r,n){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):Lo},e})(),Ho=(function(){function e(){}return e.prototype.getTracer=function(t,a,r){return new zr},e})(),Yo=new Ho,yr=(function(){function e(){}return e.prototype.getTracer=function(t,a,r){var n;return(n=this.getDelegateTracer(t,a,r))!==null&&n!==void 0?n:new Wo(this,t,a,r)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:Yo},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,a,r){var n;return(n=this._delegate)===null||n===void 0?void 0:n.getTracer(t,a,r)},e})(),Vt;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(Vt||(Vt={}));var fa="trace",Ko=(function(){function e(){this._proxyTracerProvider=new yr,this.wrapSpanContext=Vo,this.isSpanContextValid=Kr,this.deleteSpan=$o,this.getSpan=Na,this.getActiveSpan=Do,this.getSpanContext=Yr,this.setSpan=Oa,this.setSpanContext=Uo}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var a=Ra(fa,this._proxyTracerProvider,Jt.instance());return a&&this._proxyTracerProvider.setDelegate(t),a},e.prototype.getTracerProvider=function(){return Mt(fa)||this._proxyTracerProvider},e.prototype.getTracer=function(t,a){return this.getTracerProvider().getTracer(t,a)},e.prototype.disable=function(){Ca(fa,Jt.instance()),this._proxyTracerProvider=new yr},e})(),zo=Ko.getInstance(),Xo=Object.defineProperty,Qo=(e,t)=>{for(var a in t)Xo(e,a,{get:t[a],enumerable:!0})},Xr="AI_NoOutputSpecifiedError",Qr=`vercel.ai.error.${Xr}`,Zo=Symbol.for(Qr),Zr,es=class extends U{constructor({message:e="No output specified."}={}){super({name:Xr,message:e}),this[Zr]=!0}static isInstance(e){return U.hasMarker(e,Qr)}};Zr=Zo;function ei(e){const t="AI SDK Warning:";switch(e.type){case"unsupported-setting":{let a=`${t} The "${e.setting}" setting is not supported by this model`;return e.details&&(a+=` - ${e.details}`),a}case"unsupported-tool":{const a="name"in e.tool?e.tool.name:"unknown tool";let r=`${t} The tool "${a}" is not supported by this model`;return e.details&&(r+=` - ${e.details}`),r}case"other":return`${t} ${e.message}`;default:return`${t} ${JSON.stringify(e,null,2)}`}}var ti="AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.",wr=!1,Ze=e=>{if(e.length===0)return;const t=globalThis.AI_SDK_LOG_WARNINGS;if(t!==!1){if(typeof t=="function"){t(e);return}wr||(wr=!0,console.info(ti));for(const a of e)console.warn(ei(a))}},ts="AI_InvalidArgumentError",as=`vercel.ai.error.${ts}`,ai=Symbol.for(as),rs,K=class extends U{constructor({parameter:e,value:t,message:a}){super({name:ts,message:`Invalid argument for parameter ${e}: ${a}`}),this[rs]=!0,this.parameter=e,this.value=t}static isInstance(e){return U.hasMarker(e,as)}};rs=ai;var ss="AI_InvalidStreamPartError",ns=`vercel.ai.error.${ss}`,ri=Symbol.for(ns),os,Fl=class extends U{constructor({chunk:e,message:t}){super({name:ss,message:t}),this[os]=!0,this.chunk=e}static isInstance(e){return U.hasMarker(e,ns)}};os=ri;var is="AI_InvalidToolInputError",ls=`vercel.ai.error.${is}`,si=Symbol.for(ls),us,ds=class extends U{constructor({toolInput:e,toolName:t,cause:a,message:r=`Invalid input for tool ${t}: ${Ht(a)}`}){super({name:is,message:r,cause:a}),this[us]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return U.hasMarker(e,ls)}};us=si;var ps="AI_NoImageGeneratedError",cs=`vercel.ai.error.${ps}`,ni=Symbol.for(cs),ms,oi=class extends U{constructor({message:e="No image generated.",cause:t,responses:a}){super({name:ps,message:e,cause:t}),this[ms]=!0,this.responses=a}static isInstance(e){return U.hasMarker(e,cs)}};ms=ni;var fs="AI_NoObjectGeneratedError",gs=`vercel.ai.error.${fs}`,ii=Symbol.for(gs),hs,Xe=class extends U{constructor({message:e="No object generated.",cause:t,text:a,response:r,usage:n,finishReason:s}){super({name:fs,message:e,cause:t}),this[hs]=!0,this.text=a,this.response=r,this.usage=n,this.finishReason=s}static isInstance(e){return U.hasMarker(e,gs)}};hs=ii;var vs="AI_NoOutputGeneratedError",ys=`vercel.ai.error.${vs}`,li=Symbol.for(ys),ws,ui=class extends U{constructor({message:e="No output generated.",cause:t}={}){super({name:vs,message:e,cause:t}),this[ws]=!0}static isInstance(e){return U.hasMarker(e,ys)}};ws=li;var di=class extends U{constructor(e){super({name:"AI_NoSpeechGeneratedError",message:"No speech audio generated."}),this.responses=e.responses}},bs="AI_NoSuchToolError",Ts=`vercel.ai.error.${bs}`,pi=Symbol.for(Ts),Is,Ta=class extends U{constructor({toolName:e,availableTools:t=void 0,message:a=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:bs,message:a}),this[Is]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return U.hasMarker(e,Ts)}};Is=pi;var xs="AI_ToolCallRepairError",_s=`vercel.ai.error.${xs}`,ci=Symbol.for(_s),Ss,mi=class extends U{constructor({cause:e,originalError:t,message:a=`Error repairing tool call: ${Ht(e)}`}){super({name:xs,message:a,cause:e}),this[Ss]=!0,this.originalError=t}static isInstance(e){return U.hasMarker(e,_s)}};Ss=ci;var Ct=class extends U{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},Ms="AI_InvalidDataContentError",Es=`vercel.ai.error.${Ms}`,fi=Symbol.for(Es),Rs,br=class extends U{constructor({content:e,cause:t,message:a=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:Ms,message:a,cause:t}),this[Rs]=!0,this.content=e}static isInstance(e){return U.hasMarker(e,Es)}};Rs=fi;var Cs="AI_InvalidMessageRoleError",As=`vercel.ai.error.${Cs}`,gi=Symbol.for(As),Ns,hi=class extends U{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:Cs,message:t}),this[Ns]=!0,this.role=e}static isInstance(e){return U.hasMarker(e,As)}};Ns=gi;var Os="AI_MessageConversionError",Ps=`vercel.ai.error.${Os}`,vi=Symbol.for(Ps),qs,yi=class extends U{constructor({originalMessage:e,message:t}){super({name:Os,message:t}),this[qs]=!0,this.originalMessage=e}static isInstance(e){return U.hasMarker(e,Ps)}};qs=vi;var ks="AI_DownloadError",Ds=`vercel.ai.error.${ks}`,wi=Symbol.for(Ds),$s,ga=class extends U{constructor({url:e,statusCode:t,statusText:a,cause:r,message:n=r==null?`Failed to download ${e}: ${t} ${a}`:`Failed to download ${e}: ${r}`}){super({name:ks,message:n,cause:r}),this[$s]=!0,this.url=e,this.statusCode=t,this.statusText=a}static isInstance(e){return U.hasMarker(e,Ds)}};$s=wi;var Us="AI_RetryError",js=`vercel.ai.error.${Us}`,bi=Symbol.for(js),Fs,Tr=class extends U{constructor({message:e,reason:t,errors:a}){super({name:Us,message:e}),this[Fs]=!0,this.reason=t,this.errors=a,this.lastError=a[a.length-1]}static isInstance(e){return U.hasMarker(e,js)}};Fs=bi;function pt(e){if(typeof e!="string"){if(e.specificationVersion!=="v2")throw new Ct({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return Pa().languageModel(e)}function Gs(e){if(typeof e!="string"){if(e.specificationVersion!=="v2")throw new Ct({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return Pa().textEmbeddingModel(e)}function Ti(e){if(typeof e!="string"){if(e.specificationVersion!=="v2")throw new Ct({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return Pa().imageModel(e)}function Pa(){var e;return(e=globalThis.AI_SDK_DEFAULT_PROVIDER)!=null?e:mo}var Js=[{mediaType:"image/gif",bytesPrefix:[71,73,70]},{mediaType:"image/png",bytesPrefix:[137,80,78,71]},{mediaType:"image/jpeg",bytesPrefix:[255,216]},{mediaType:"image/webp",bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:"image/bmp",bytesPrefix:[66,77]},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0]},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42]},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],Vs=[{mediaType:"audio/mpeg",bytesPrefix:[255,251]},{mediaType:"audio/mpeg",bytesPrefix:[255,250]},{mediaType:"audio/mpeg",bytesPrefix:[255,243]},{mediaType:"audio/mpeg",bytesPrefix:[255,242]},{mediaType:"audio/mpeg",bytesPrefix:[255,227]},{mediaType:"audio/mpeg",bytesPrefix:[255,226]},{mediaType:"audio/wav",bytesPrefix:[82,73,70,70,null,null,null,null,87,65,86,69]},{mediaType:"audio/ogg",bytesPrefix:[79,103,103,83]},{mediaType:"audio/flac",bytesPrefix:[102,76,97,67]},{mediaType:"audio/aac",bytesPrefix:[64,21,0,0]},{mediaType:"audio/mp4",bytesPrefix:[102,116,121,112]},{mediaType:"audio/webm",bytesPrefix:[26,69,223,163]}],Ii=e=>{const t=typeof e=="string"?zt(e):e,a=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(a+10)};function xi(e){return typeof e=="string"&&e.startsWith("SUQz")||typeof e!="string"&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?Ii(e):e}function Xt({data:e,signatures:t}){const a=xi(e),r=typeof a=="string"?zt(a.substring(0,Math.min(a.length,24))):a;for(const n of t)if(r.length>=n.bytesPrefix.length&&n.bytesPrefix.every((s,i)=>s===null||r[i]===s))return n.mediaType}var Oe="5.0.116",Bs=async({url:e})=>{var t;const a=e.toString();try{const r=await fetch(a,{headers:Re({},`ai-sdk/${Oe}`,jt())});if(!r.ok)throw new ga({url:a,statusCode:r.status,statusText:r.statusText});return{data:new Uint8Array(await r.arrayBuffer()),mediaType:(t=r.headers.get("content-type"))!=null?t:void 0}}catch(r){throw ga.isInstance(r)?r:new ga({url:a,cause:r})}},_i=(e=Bs)=>t=>Promise.all(t.map(async a=>a.isUrlSupportedByModel?null:e(a)));function Si(e){try{const[t,a]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:a}}catch{return{mediaType:void 0,base64Content:void 0}}}var Ls=be([h(),Ft(Uint8Array),Ft(ArrayBuffer),qr(e=>{var t,a;return(a=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?a:!1},{message:"Must be a Buffer"})]);function Ws(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if(typeof e=="string")try{e=new URL(e)}catch{}if(e instanceof URL&&e.protocol==="data:"){const{mediaType:t,base64Content:a}=Si(e.toString());if(t==null||a==null)throw new U({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:a,mediaType:t}}return{data:e,mediaType:void 0}}function Mi(e){return typeof e=="string"?e:e instanceof ArrayBuffer?wa(new Uint8Array(e)):wa(e)}function Ei(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return zt(e)}catch(t){throw new br({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new br({content:e})}async function Qt({prompt:e,supportedUrls:t,download:a=_i()}){const r=await Ci(e.messages,a,t);return[...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(n=>Ri({message:n,downloadedAssets:r}))]}function Ri({message:e,downloadedAssets:t}){const a=e.role;switch(a){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions}:{role:"user",content:e.content.map(r=>Ai(r,t)).filter(r=>r.type!=="text"||r.text!==""),providerOptions:e.providerOptions};case"assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions}:{role:"assistant",content:e.content.filter(r=>r.type!=="text"||r.text!==""||r.providerOptions!=null).map(r=>{const n=r.providerOptions;switch(r.type){case"file":{const{data:s,mediaType:i}=Ws(r.data);return{type:"file",data:s,filename:r.filename,mediaType:i??r.mediaType,providerOptions:n}}case"reasoning":return{type:"reasoning",text:r.text,providerOptions:n};case"text":return{type:"text",text:r.text,providerOptions:n};case"tool-call":return{type:"tool-call",toolCallId:r.toolCallId,toolName:r.toolName,input:r.input,providerExecuted:r.providerExecuted,providerOptions:n};case"tool-result":return{type:"tool-result",toolCallId:r.toolCallId,toolName:r.toolName,output:r.output,providerOptions:n}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.map(r=>({type:"tool-result",toolCallId:r.toolCallId,toolName:r.toolName,output:r.output,providerOptions:r.providerOptions})),providerOptions:e.providerOptions};default:{const r=a;throw new hi({role:r})}}}async function Ci(e,t,a){const r=e.filter(s=>s.role==="user").map(s=>s.content).filter(s=>Array.isArray(s)).flat().filter(s=>s.type==="image"||s.type==="file").map(s=>{var i;const o=(i=s.mediaType)!=null?i:s.type==="image"?"image/*":void 0;let u=s.type==="image"?s.image:s.data;if(typeof u=="string")try{u=new URL(u)}catch{}return{mediaType:o,data:u}}).filter(s=>s.data instanceof URL).map(s=>({url:s.data,isUrlSupportedByModel:s.mediaType!=null&&qn({url:s.data.toString(),mediaType:s.mediaType,supportedUrls:a})})),n=await t(r);return Object.fromEntries(n.map((s,i)=>s==null?null:[r[i].url.toString(),{data:s.data,mediaType:s.mediaType}]).filter(s=>s!=null))}function Ai(e,t){var a;if(e.type==="text")return{type:"text",text:e.text,providerOptions:e.providerOptions};let r;const n=e.type;switch(n){case"image":r=e.image;break;case"file":r=e.data;break;default:throw new Error(`Unsupported part type: ${n}`)}const{data:s,mediaType:i}=Ws(r);let o=i??e.mediaType,u=s;if(u instanceof URL){const l=t[u.toString()];l&&(u=l.data,o??(o=l.mediaType))}switch(n){case"image":return(u instanceof Uint8Array||typeof u=="string")&&(o=(a=Xt({data:u,signatures:Js}))!=null?a:o),{type:"file",mediaType:o??"image/*",filename:void 0,data:u,providerOptions:e.providerOptions};case"file":{if(o==null)throw new Error("Media type is missing for file part");return{type:"file",mediaType:o,filename:e.filename,data:u,providerOptions:e.providerOptions}}}}function Qe({maxOutputTokens:e,temperature:t,topP:a,topK:r,presencePenalty:n,frequencyPenalty:s,seed:i,stopSequences:o}){if(e!=null){if(!Number.isInteger(e))throw new K({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new K({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new K({parameter:"temperature",value:t,message:"temperature must be a number"});if(a!=null&&typeof a!="number")throw new K({parameter:"topP",value:a,message:"topP must be a number"});if(r!=null&&typeof r!="number")throw new K({parameter:"topK",value:r,message:"topK must be a number"});if(n!=null&&typeof n!="number")throw new K({parameter:"presencePenalty",value:n,message:"presencePenalty must be a number"});if(s!=null&&typeof s!="number")throw new K({parameter:"frequencyPenalty",value:s,message:"frequencyPenalty must be a number"});if(i!=null&&!Number.isInteger(i))throw new K({parameter:"seed",value:i,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:a,topK:r,presencePenalty:n,frequencyPenalty:s,stopSequences:o,seed:i}}function Ni(e){return e!=null&&Object.keys(e).length>0}function Hs({tools:e,toolChoice:t,activeTools:a}){return Ni(e)?{tools:(a!=null?Object.entries(e).filter(([n])=>a.includes(n)):Object.entries(e)).map(([n,s])=>{const i=s.type;switch(i){case void 0:case"dynamic":case"function":return{type:"function",name:n,description:s.description,inputSchema:ut(s.inputSchema).jsonSchema,providerOptions:s.providerOptions};case"provider-defined":return{type:"provider-defined",name:n,id:s.id,args:s.args};default:{const o=i;throw new Error(`Unsupported tool type: ${o}`)}}}),toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var Et=On(()=>be([kn(),h(),Ut(),L(),it(h(),Et),we(Et)])),$=it(h(),it(h(),Et)),Ys=M({type:I("text"),text:h(),providerOptions:$.optional()}),Oi=M({type:I("image"),image:be([Ls,Ft(URL)]),mediaType:h().optional(),providerOptions:$.optional()}),Ks=M({type:I("file"),data:be([Ls,Ft(URL)]),filename:h().optional(),mediaType:h(),providerOptions:$.optional()}),Pi=M({type:I("reasoning"),text:h(),providerOptions:$.optional()}),qi=M({type:I("tool-call"),toolCallId:h(),toolName:h(),input:H(),providerOptions:$.optional(),providerExecuted:L().optional()}),ki=Dn("type",[M({type:I("text"),value:h()}),M({type:I("json"),value:Et}),M({type:I("error-text"),value:h()}),M({type:I("error-json"),value:Et}),M({type:I("content"),value:we(be([M({type:I("text"),text:h()}),M({type:I("media"),data:h(),mediaType:h()})]))})]),zs=M({type:I("tool-result"),toolCallId:h(),toolName:h(),output:ki,providerOptions:$.optional()}),Xs=M({role:I("system"),content:h(),providerOptions:$.optional()}),Gl=Xs,Qs=M({role:I("user"),content:be([h(),we(be([Ys,Oi,Ks]))]),providerOptions:$.optional()}),Jl=Qs,Zs=M({role:I("assistant"),content:be([h(),we(be([Ys,Ks,Pi,qi,zs]))]),providerOptions:$.optional()}),Vl=Zs,en=M({role:I("tool"),content:we(zs),providerOptions:$.optional()}),Bl=en,tn=be([Xs,Qs,Zs,en]),Ll=tn;async function Zt(e){if(e.prompt==null&&e.messages==null)throw new st({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new st({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new st({prompt:e,message:"system must be a string"});let t;if(e.prompt!=null&&typeof e.prompt=="string")t=[{role:"user",content:e.prompt}];else if(e.prompt!=null&&Array.isArray(e.prompt))t=e.prompt;else if(e.messages!=null)t=e.messages;else throw new st({prompt:e,message:"prompt or messages must be defined"});if(t.length===0)throw new st({prompt:e,message:"messages must not be empty"});const a=await Je({value:t,schema:we(tn)});if(!a.success)throw new st({prompt:e,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:a.error});return{messages:t,system:e.system}}function ea(e){if(!Ea.isInstance(e))return e;const t=(process==null?void 0:"production")==="production",a="https://ai-sdk.dev/unauthenticated-ai-gateway";return t?new U({name:"GatewayError",message:`Unauthenticated. Configure AI_GATEWAY_API_KEY or use a provider module. Learn more: ${a}`}):Object.assign(new Error(`\x1B[1m\x1B[31mUnauthenticated request to AI Gateway.\x1B[0m

To authenticate, set the \x1B[33mAI_GATEWAY_API_KEY\x1B[0m environment variable with your API key.

Alternatively, you can use a provider module instead of the AI Gateway.

Learn more: \x1B[34m${a}\x1B[0m

`),{name:"GatewayAuthenticationError"})}function me({operationId:e,telemetry:t}){return{"operation.name":`${e}${t?.functionId!=null?` ${t.functionId}`:""}`,"resource.name":t?.functionId,"ai.operationId":e,"ai.telemetry.functionId":t?.functionId}}function ct({model:e,settings:t,telemetry:a,headers:r}){var n;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((s,[i,o])=>(s[`ai.settings.${i}`]=o,s),{}),...Object.entries((n=a?.metadata)!=null?n:{}).reduce((s,[i,o])=>(s[`ai.telemetry.metadata.${i}`]=o,s),{}),...Object.entries(r??{}).reduce((s,[i,o])=>(o!==void 0&&(s[`ai.request.headers.${i}`]=o),s),{})}}var Di={startSpan(){return qt},startActiveSpan(e,t,a,r){if(typeof t=="function")return t(qt);if(typeof a=="function")return a(qt);if(typeof r=="function")return r(qt)}},qt={spanContext(){return $i},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},$i={traceId:"",spanId:"",traceFlags:0};function mt({isEnabled:e=!1,tracer:t}={}){return e?t||zo.getTracer("ai"):Di}function fe({name:e,tracer:t,attributes:a,fn:r,endWhenDone:n=!0}){return t.startActiveSpan(e,{attributes:a},async s=>{try{const i=await r(s);return n&&s.end(),i}catch(i){try{qa(s,i)}finally{s.end()}throw i}})}function qa(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:Vt.ERROR,message:t.message})):e.setStatus({code:Vt.ERROR})}function G({telemetry:e,attributes:t}){return e?.isEnabled!==!0?{}:Object.entries(t).reduce((a,[r,n])=>{if(n==null)return a;if(typeof n=="object"&&"input"in n&&typeof n.input=="function"){if(e?.recordInputs===!1)return a;const s=n.input();return s==null?a:{...a,[r]:s}}if(typeof n=="object"&&"output"in n&&typeof n.output=="function"){if(e?.recordOutputs===!1)return a;const s=n.output();return s==null?a:{...a,[r]:s}}return{...a,[r]:n}},{})}function ta(e){return JSON.stringify(e.map(t=>({...t,content:typeof t.content=="string"?t.content:t.content.map(a=>a.type==="file"?{...a,data:a.data instanceof Uint8Array?Mi(a.data):a.data}:a)})))}function an(e,t){return{inputTokens:wt(e.inputTokens,t.inputTokens),outputTokens:wt(e.outputTokens,t.outputTokens),totalTokens:wt(e.totalTokens,t.totalTokens),reasoningTokens:wt(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:wt(e.cachedInputTokens,t.cachedInputTokens)}}function wt(e,t){return e==null&&t==null?void 0:(e??0)+(t??0)}function Bt(e){return e===void 0?[]:Array.isArray(e)?e:[e]}function Ui({error:e,exponentialBackoffDelay:t}){const a=e.responseHeaders;if(!a)return t;let r;const n=a["retry-after-ms"];if(n){const i=parseFloat(n);Number.isNaN(i)||(r=i)}const s=a["retry-after"];if(s&&r===void 0){const i=parseFloat(s);Number.isNaN(i)?r=Date.parse(s)-Date.now():r=i*1e3}return r!=null&&!Number.isNaN(r)&&0<=r&&(r<60*1e3||r<t)?r:t}var ji=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:a=2,abortSignal:r}={})=>async n=>rn(n,{maxRetries:e,delayInMs:t,backoffFactor:a,abortSignal:r});async function rn(e,{maxRetries:t,delayInMs:a,backoffFactor:r,abortSignal:n},s=[]){try{return await e()}catch(i){if(Pr(i)||t===0)throw i;const o=Yt(i),u=[...s,i],l=u.length;if(l>t)throw new Tr({message:`Failed after ${l} attempts. Last error: ${o}`,reason:"maxRetriesExceeded",errors:u});if(i instanceof Error&&Ar.isInstance(i)&&i.isRetryable===!0&&l<=t)return await Sa(Ui({error:i,exponentialBackoffDelay:a}),{abortSignal:n}),rn(e,{maxRetries:t,delayInMs:r*a,backoffFactor:r,abortSignal:n},u);throw l===1?i:new Tr({message:`Failed after ${l} attempts with non-retryable error: '${o}'`,reason:"errorNotRetryable",errors:u})}}function Ve({maxRetries:e,abortSignal:t}){if(e!=null){if(!Number.isInteger(e))throw new K({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new K({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}const a=e??2;return{maxRetries:a,retry:ji({maxRetries:a,abortSignal:t})}}function Ia(e){const t=e.filter(a=>a.type==="text");if(t.length!==0)return t.map(a=>a.text).join("")}var aa=class{constructor({data:e,mediaType:t}){const a=e instanceof Uint8Array;this.base64Data=a?void 0:e,this.uint8ArrayData=a?e:void 0,this.mediaType=t}get base64(){return this.base64Data==null&&(this.base64Data=wa(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=zt(this.base64Data)),this.uint8ArrayData}},Fi=class extends aa{constructor(e){super(e),this.type="file"}};async function sn({toolCall:e,tools:t,repairToolCall:a,system:r,messages:n}){try{if(t==null)throw new Ta({toolName:e.toolName});try{return await Ir({toolCall:e,tools:t})}catch(s){if(a==null||!(Ta.isInstance(s)||ds.isInstance(s)))throw s;let i=null;try{i=await a({toolCall:e,tools:t,inputSchema:({toolName:o})=>{const{inputSchema:u}=t[o];return ut(u).jsonSchema},system:r,messages:n,error:s})}catch(o){throw new mi({cause:o,originalError:s})}if(i==null)throw s;return await Ir({toolCall:i,tools:t})}}catch(s){const i=await lt({text:e.input}),o=i.success?i.value:e.input;return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:o,dynamic:!0,invalid:!0,error:s,providerMetadata:e.providerMetadata}}}async function Ir({toolCall:e,tools:t}){const a=e.toolName,r=t[a];if(r==null)throw new Ta({toolName:e.toolName,availableTools:Object.keys(t)});const n=ut(r.inputSchema),s=e.input.trim()===""?await Je({value:{},schema:n}):await lt({text:e.input,schema:n});if(s.success===!1)throw new ds({toolName:a,toolInput:e.input,cause:s.error});return r.type==="dynamic"?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:s.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:e.toolCallId,toolName:a,input:s.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}var nn=class{constructor({content:e,finishReason:t,usage:a,warnings:r,request:n,response:s,providerMetadata:i}){this.content=e,this.finishReason=t,this.usage=a,this.warnings=r,this.request=n,this.response=s,this.providerMetadata=i}get text(){return this.content.filter(e=>e.type==="text").map(e=>e.text).join("")}get reasoning(){return this.content.filter(e=>e.type==="reasoning")}get reasoningText(){return this.reasoning.length===0?void 0:this.reasoning.map(e=>e.text).join("")}get files(){return this.content.filter(e=>e.type==="file").map(e=>e.file)}get sources(){return this.content.filter(e=>e.type==="source")}get toolCalls(){return this.content.filter(e=>e.type==="tool-call")}get staticToolCalls(){return this.toolCalls.filter(e=>e.dynamic!==!0)}get dynamicToolCalls(){return this.toolCalls.filter(e=>e.dynamic===!0)}get toolResults(){return this.content.filter(e=>e.type==="tool-result")}get staticToolResults(){return this.toolResults.filter(e=>e.dynamic!==!0)}get dynamicToolResults(){return this.toolResults.filter(e=>e.dynamic===!0)}};function on(e){return({steps:t})=>t.length===e}function Wl(e){return({steps:t})=>{var a,r,n;return(n=(r=(a=t[t.length-1])==null?void 0:a.toolCalls)==null?void 0:r.some(s=>s.toolName===e))!=null?n:!1}}async function ln({stopConditions:e,steps:t}){return(await Promise.all(e.map(a=>a({steps:t})))).some(a=>a)}function It({output:e,tool:t,errorMode:a}){return a==="text"?{type:"error-text",value:Ht(e)}:a==="json"?{type:"error-json",value:xr(e)}:t?.toModelOutput?t.toModelOutput(e):typeof e=="string"?{type:"text",value:e}:{type:"json",value:xr(e)}}function xr(e){return e===void 0?null:e}function xa({content:e,tools:t}){const a=[],r=e.filter(s=>s.type!=="source").filter(s=>(s.type!=="tool-result"||s.providerExecuted)&&(s.type!=="tool-error"||s.providerExecuted)).filter(s=>s.type!=="text"||s.text.length>0).map(s=>{switch(s.type){case"text":return{type:"text",text:s.text,providerOptions:s.providerMetadata};case"reasoning":return{type:"reasoning",text:s.text,providerOptions:s.providerMetadata};case"file":return{type:"file",data:s.file.base64,mediaType:s.file.mediaType,providerOptions:s.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:s.toolCallId,toolName:s.toolName,input:s.input,providerExecuted:s.providerExecuted,providerOptions:s.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,output:It({tool:t?.[s.toolName],output:s.output,errorMode:"none"}),providerExecuted:!0,providerOptions:s.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,output:It({tool:t?.[s.toolName],output:s.error,errorMode:"json"}),providerOptions:s.providerMetadata}}});r.length>0&&a.push({role:"assistant",content:r});const n=e.filter(s=>s.type==="tool-result"||s.type==="tool-error").filter(s=>!s.providerExecuted).map(s=>({type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,output:It({tool:t?.[s.toolName],output:s.type==="tool-result"?s.output:s.error,errorMode:s.type==="tool-error"?"text":"none"}),...s.providerMetadata!=null?{providerOptions:s.providerMetadata}:{}}));return n.length>0&&a.push({role:"tool",content:n}),a}var Gi=Kt({prefix:"aitxt",size:24});async function Ji({model:e,tools:t,toolChoice:a,system:r,prompt:n,messages:s,maxRetries:i,abortSignal:o,headers:u,stopWhen:l=on(1),experimental_output:c,experimental_telemetry:d,providerOptions:f,experimental_activeTools:p,activeTools:m=p,experimental_prepareStep:y,prepareStep:w=y,experimental_repairToolCall:v,experimental_download:S,experimental_context:q,_internal:{generateId:g=Gi,currentDate:P=()=>new Date}={},onStepFinish:C,...b}){const x=pt(e),R=Bt(l),{maxRetries:O,retry:J}=Ve({maxRetries:i,abortSignal:o}),z=Qe(b),V=Re(u??{},`ai/${Oe}`),j=ct({model:x,telemetry:d,headers:V,settings:{...z,maxRetries:O}}),se=await Zt({system:r,prompt:n,messages:s}),te=mt(d);try{return await fe({name:"ai.generateText",attributes:G({telemetry:d,attributes:{...me({operationId:"ai.generateText",telemetry:d}),...j,"ai.model.provider":x.provider,"ai.model.id":x.modelId,"ai.prompt":{input:()=>JSON.stringify({system:r,prompt:n,messages:s})}}}),tracer:te,fn:async pe=>{var ge,Me,X,Ce,ie,ne,ae;const ue=Qe(b);let Y,he=[],ve=[];const ye=[],B=[];do{const W=[...se.messages,...ye],k=await w?.({model:x,steps:B,stepNumber:B.length,messages:W}),N=pt((ge=k?.model)!=null?ge:x),E=await Qt({prompt:{system:(Me=k?.system)!=null?Me:se.system,messages:(X=k?.messages)!=null?X:W},supportedUrls:await N.supportedUrls,download:S}),{toolChoice:_,tools:re}=Hs({tools:t,toolChoice:(Ce=k?.toolChoice)!=null?Ce:a,activeTools:(ie=k?.activeTools)!=null?ie:m});Y=await J(()=>{var F;return fe({name:"ai.generateText.doGenerate",attributes:G({telemetry:d,attributes:{...me({operationId:"ai.generateText.doGenerate",telemetry:d}),...j,"ai.model.provider":N.provider,"ai.model.id":N.modelId,"ai.prompt.messages":{input:()=>ta(E)},"ai.prompt.tools":{input:()=>re?.map(qe=>JSON.stringify(qe))},"ai.prompt.toolChoice":{input:()=>_!=null?JSON.stringify(_):void 0},"gen_ai.system":N.provider,"gen_ai.request.model":N.modelId,"gen_ai.request.frequency_penalty":b.frequencyPenalty,"gen_ai.request.max_tokens":b.maxOutputTokens,"gen_ai.request.presence_penalty":b.presencePenalty,"gen_ai.request.stop_sequences":b.stopSequences,"gen_ai.request.temperature":(F=b.temperature)!=null?F:void 0,"gen_ai.request.top_k":b.topK,"gen_ai.request.top_p":b.topP}}),tracer:te,fn:async qe=>{var ft,Be,xe,De,gt,et,tt,Nt;const oe=await N.doGenerate({...ue,tools:re,toolChoice:_,responseFormat:c?.responseFormat,prompt:E,providerOptions:f,abortSignal:o,headers:V}),$e={id:(Be=(ft=oe.response)==null?void 0:ft.id)!=null?Be:g(),timestamp:(De=(xe=oe.response)==null?void 0:xe.timestamp)!=null?De:P(),modelId:(et=(gt=oe.response)==null?void 0:gt.modelId)!=null?et:N.modelId,headers:(tt=oe.response)==null?void 0:tt.headers,body:(Nt=oe.response)==null?void 0:Nt.body};return qe.setAttributes(G({telemetry:d,attributes:{"ai.response.finishReason":oe.finishReason,"ai.response.text":{output:()=>Ia(oe.content)},"ai.response.toolCalls":{output:()=>{const Ue=_r(oe.content);return Ue==null?void 0:JSON.stringify(Ue)}},"ai.response.id":$e.id,"ai.response.model":$e.modelId,"ai.response.timestamp":$e.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(oe.providerMetadata),"ai.usage.promptTokens":oe.usage.inputTokens,"ai.usage.completionTokens":oe.usage.outputTokens,"gen_ai.response.finish_reasons":[oe.finishReason],"gen_ai.response.id":$e.id,"gen_ai.response.model":$e.modelId,"gen_ai.usage.input_tokens":oe.usage.inputTokens,"gen_ai.usage.output_tokens":oe.usage.outputTokens}})),{...oe,response:$e}}})});const Ie=await Promise.all(Y.content.filter(F=>F.type==="tool-call").map(F=>sn({toolCall:F,tools:t,repairToolCall:v,system:r,messages:W})));for(const F of Ie){if(F.invalid)continue;const qe=t[F.toolName];qe?.onInputAvailable!=null&&await qe.onInputAvailable({input:F.input,toolCallId:F.toolCallId,messages:W,abortSignal:o,experimental_context:q})}const T=Ie.filter(F=>F.invalid&&F.dynamic);ve=[];for(const F of T)ve.push({type:"tool-error",toolCallId:F.toolCallId,toolName:F.toolName,input:F.input,error:Yt(F.error),dynamic:!0});he=Ie.filter(F=>!F.providerExecuted),t!=null&&ve.push(...await Vi({toolCalls:he.filter(F=>!F.invalid),tools:t,tracer:te,telemetry:d,messages:W,abortSignal:o,experimental_context:q}));const D=Li({content:Y.content,toolCalls:Ie,toolOutputs:ve});ye.push(...xa({content:D,tools:t}));const Pe=new nn({content:D,finishReason:Y.finishReason,usage:Y.usage,warnings:Y.warnings,providerMetadata:Y.providerMetadata,request:(ne=Y.request)!=null?ne:{},response:{...Y.response,messages:structuredClone(ye)}});Ze((ae=Y.warnings)!=null?ae:[]),B.push(Pe),await C?.(Pe)}while(he.length>0&&ve.length===he.length&&!await ln({stopConditions:R,steps:B}));pe.setAttributes(G({telemetry:d,attributes:{"ai.response.finishReason":Y.finishReason,"ai.response.text":{output:()=>Ia(Y.content)},"ai.response.toolCalls":{output:()=>{const W=_r(Y.content);return W==null?void 0:JSON.stringify(W)}},"ai.response.providerMetadata":JSON.stringify(Y.providerMetadata),"ai.usage.promptTokens":Y.usage.inputTokens,"ai.usage.completionTokens":Y.usage.outputTokens}}));const ee=B[B.length-1];let Te;return ee.finishReason==="stop"&&(Te=await c?.parseOutput({text:ee.text},{response:ee.response,usage:ee.usage,finishReason:ee.finishReason})),new Bi({steps:B,resolvedOutput:Te})}})}catch(pe){throw ea(pe)}}async function Vi({toolCalls:e,tools:t,tracer:a,telemetry:r,messages:n,abortSignal:s,experimental_context:i}){return(await Promise.all(e.map(async({toolCallId:u,toolName:l,input:c})=>{const d=t[l];if(d?.execute!=null)return fe({name:"ai.toolCall",attributes:G({telemetry:r,attributes:{...me({operationId:"ai.toolCall",telemetry:r}),"ai.toolCall.name":l,"ai.toolCall.id":u,"ai.toolCall.args":{output:()=>JSON.stringify(c)}}}),tracer:a,fn:async f=>{try{const p=Or({execute:d.execute.bind(d),input:c,options:{toolCallId:u,messages:n,abortSignal:s,experimental_context:i}});let m;for await(const y of p)y.type==="final"&&(m=y.output);try{f.setAttributes(G({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(m)}}}))}catch{}return{type:"tool-result",toolCallId:u,toolName:l,input:c,output:m,dynamic:d.type==="dynamic"}}catch(p){return qa(f,p),{type:"tool-error",toolCallId:u,toolName:l,input:c,error:p,dynamic:d.type==="dynamic"}}}})}))).filter(u=>u!=null)}var Bi=class{constructor(e){this.steps=e.steps,this.resolvedOutput=e.resolvedOutput}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get totalUsage(){return this.steps.reduce((e,t)=>an(e,t.usage),{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0})}get experimental_output(){if(this.resolvedOutput==null)throw new es;return this.resolvedOutput}};function _r(e){const t=e.filter(a=>a.type==="tool-call");if(t.length!==0)return t.map(a=>({toolCallId:a.toolCallId,toolName:a.toolName,input:a.input}))}function Li({content:e,toolCalls:t,toolOutputs:a}){return[...e.map(r=>{switch(r.type){case"text":case"reasoning":case"source":return r;case"file":return{type:"file",file:new aa(r)};case"tool-call":return t.find(n=>n.toolCallId===r.toolCallId);case"tool-result":{const n=t.find(s=>s.toolCallId===r.toolCallId);if(n==null)throw new Error(`Tool call ${r.toolCallId} not found.`);return r.isError?{type:"tool-error",toolCallId:r.toolCallId,toolName:r.toolName,input:n.input,error:r.result,providerExecuted:!0,dynamic:n.dynamic}:{type:"tool-result",toolCallId:r.toolCallId,toolName:r.toolName,input:n.input,output:r.result,providerExecuted:!0,dynamic:n.dynamic}}}}),...a]}function At(e,t){const a=new Headers(e??{});for(const[r,n]of Object.entries(t))a.has(r)||a.set(r,n);return a}function un({status:e,statusText:t,headers:a,textStream:r}){return new Response(r.pipeThrough(new TextEncoderStream),{status:e??200,statusText:t,headers:At(a,{"content-type":"text/plain; charset=utf-8"})})}function dn({response:e,status:t,statusText:a,headers:r,stream:n}){const s=t??200;a!==void 0?e.writeHead(s,a,r):e.writeHead(s,r);const i=n.getReader();(async()=>{try{for(;;){const{done:u,value:l}=await i.read();if(u)break;e.write(l)||await new Promise(d=>{e.once("drain",d)})}}catch(u){throw u}finally{e.end()}})()}function pn({response:e,status:t,statusText:a,headers:r,textStream:n}){dn({response:e,status:t,statusText:a,headers:Object.fromEntries(At(r,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:n.pipeThrough(new TextEncoderStream)})}var cn=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue(`data: [DONE]

`)}})}},mn={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"};function Wi({status:e,statusText:t,headers:a,stream:r,consumeSseStream:n}){let s=r.pipeThrough(new cn);if(n){const[i,o]=s.tee();s=i,n({stream:o})}return new Response(s.pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:At(a,mn)})}function Hi({originalMessages:e,responseMessageId:t}){if(e==null)return;const a=e[e.length-1];return a?.role==="assistant"?a.id:typeof t=="function"?t():t}var fn=He(()=>Ye(be([Q({type:I("text-start"),id:h(),providerMetadata:$.optional()}),Q({type:I("text-delta"),id:h(),delta:h(),providerMetadata:$.optional()}),Q({type:I("text-end"),id:h(),providerMetadata:$.optional()}),Q({type:I("error"),errorText:h()}),Q({type:I("tool-input-start"),toolCallId:h(),toolName:h(),providerExecuted:L().optional(),dynamic:L().optional()}),Q({type:I("tool-input-delta"),toolCallId:h(),inputTextDelta:h()}),Q({type:I("tool-input-available"),toolCallId:h(),toolName:h(),input:H(),providerExecuted:L().optional(),providerMetadata:$.optional(),dynamic:L().optional()}),Q({type:I("tool-input-error"),toolCallId:h(),toolName:h(),input:H(),providerExecuted:L().optional(),providerMetadata:$.optional(),dynamic:L().optional(),errorText:h()}),Q({type:I("tool-output-available"),toolCallId:h(),output:H(),providerExecuted:L().optional(),dynamic:L().optional(),preliminary:L().optional()}),Q({type:I("tool-output-error"),toolCallId:h(),errorText:h(),providerExecuted:L().optional(),dynamic:L().optional()}),Q({type:I("reasoning-start"),id:h(),providerMetadata:$.optional()}),Q({type:I("reasoning-delta"),id:h(),delta:h(),providerMetadata:$.optional()}),Q({type:I("reasoning-end"),id:h(),providerMetadata:$.optional()}),Q({type:I("source-url"),sourceId:h(),url:h(),title:h().optional(),providerMetadata:$.optional()}),Q({type:I("source-document"),sourceId:h(),mediaType:h(),title:h(),filename:h().optional(),providerMetadata:$.optional()}),Q({type:I("file"),url:h(),mediaType:h(),providerMetadata:$.optional()}),Q({type:qr(e=>typeof e=="string"&&e.startsWith("data-"),{message:'Type must start with "data-"'}),id:h().optional(),data:H(),transient:L().optional()}),Q({type:I("start-step")}),Q({type:I("finish-step")}),Q({type:I("start"),messageId:h().optional(),messageMetadata:H().optional()}),Q({type:I("finish"),finishReason:bt(["stop","length","content-filter","tool-calls","error","other","unknown"]).optional(),messageMetadata:H().optional()}),Q({type:I("abort")}),Q({type:I("message-metadata"),messageMetadata:H()})])));function Yi(e){return e.type.startsWith("data-")}function ka(e,t){if(e===void 0&&t===void 0)return;if(e===void 0)return t;if(t===void 0)return e;const a={...e};for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const n=t[r];if(n===void 0)continue;const s=r in e?e[r]:void 0,i=n!==null&&typeof n=="object"&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp),o=s!=null&&typeof s=="object"&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp);i&&o?a[r]=ka(s,n):a[r]=n}return a}function Ki(e){const t=["ROOT"];let a=-1,r=null;function n(u,l,c){switch(u){case'"':{a=l,t.pop(),t.push(c),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{a=l,r=l,t.pop(),t.push(c),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{a=l,t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"{":{a=l,t.pop(),t.push(c),t.push("INSIDE_OBJECT_START");break}case"[":{a=l,t.pop(),t.push(c),t.push("INSIDE_ARRAY_START");break}}}function s(u,l){switch(u){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{a=l,t.pop();break}}}function i(u,l){switch(u){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{a=l,t.pop();break}}}for(let u=0;u<e.length;u++){const l=e[u];switch(t[t.length-1]){case"ROOT":n(l,u,"FINISH");break;case"INSIDE_OBJECT_START":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{a=u,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{l==='"'&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break}case"INSIDE_OBJECT_KEY":{l==='"'&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break}case"INSIDE_OBJECT_AFTER_KEY":{l===":"&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break}case"INSIDE_OBJECT_BEFORE_VALUE":{n(l,u,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{s(l,u);break}case"INSIDE_STRING":{switch(l){case'"':{t.pop(),a=u;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:a=u}break}case"INSIDE_ARRAY_START":{l==="]"?(a=u,t.pop()):(a=u,n(l,u,"INSIDE_ARRAY_AFTER_VALUE"));break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(l){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{a=u,t.pop();break}default:{a=u;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{n(l,u,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),a=u;break}case"INSIDE_NUMBER":{switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{a=u;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(l,u),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(l,u);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(l,u);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(l,u);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const d=e.substring(r,u+1);!"false".startsWith(d)&&!"true".startsWith(d)&&!"null".startsWith(d)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?s(l,u):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(l,u)):a=u;break}}}let o=e.slice(0,a+1);for(let u=t.length-1;u>=0;u--)switch(t[u]){case"INSIDE_STRING":{o+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{o+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{o+="]";break}case"INSIDE_LITERAL":{const c=e.substring(r,e.length);"true".startsWith(c)?o+="true".slice(c.length):"false".startsWith(c)?o+="false".slice(c.length):"null".startsWith(c)&&(o+="null".slice(c.length))}}return o}async function Da(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=await lt({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await lt({text:Ki(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function ha(e){return e.type.startsWith("data-")}function va(e){return e.type==="text"}function ya(e){return e.type==="file"}function Sr(e){return e.type==="reasoning"}function nt(e){return e.type.startsWith("tool-")}function $a(e){return e.type==="dynamic-tool"}function Rt(e){return nt(e)||$a(e)}function Lt(e){return e.type.split("-").slice(1).join("-")}function zi(e){return $a(e)?e.toolName:Lt(e)}function Ua({lastMessage:e,messageId:t}){return{message:e?.role==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function ja({stream:e,messageMetadataSchema:t,dataPartSchemas:a,runUpdateMessageJob:r,onError:n,onToolCall:s,onData:i}){return e.pipeThrough(new TransformStream({async transform(o,u){await r(async({state:l,write:c})=>{var d,f,p,m;function y(g){const C=l.message.parts.filter(nt).find(b=>b.toolCallId===g);if(C==null)throw new Error("tool-output-error must be preceded by a tool-input-available");return C}function w(g){const C=l.message.parts.filter(b=>b.type==="dynamic-tool").find(b=>b.toolCallId===g);if(C==null)throw new Error("tool-output-error must be preceded by a tool-input-available");return C}function v(g){var P;const C=l.message.parts.find(R=>nt(R)&&R.toolCallId===g.toolCallId),b=g,x=C;C!=null?(C.state=g.state,x.input=b.input,x.output=b.output,x.errorText=b.errorText,x.rawInput=b.rawInput,x.preliminary=b.preliminary,x.providerExecuted=(P=b.providerExecuted)!=null?P:C.providerExecuted,b.providerMetadata!=null&&C.state==="input-available"&&(C.callProviderMetadata=b.providerMetadata)):l.message.parts.push({type:`tool-${g.toolName}`,toolCallId:g.toolCallId,state:g.state,input:b.input,output:b.output,rawInput:b.rawInput,errorText:b.errorText,providerExecuted:b.providerExecuted,preliminary:b.preliminary,...b.providerMetadata!=null?{callProviderMetadata:b.providerMetadata}:{}})}function S(g){var P,C;const b=l.message.parts.find(O=>O.type==="dynamic-tool"&&O.toolCallId===g.toolCallId),x=g,R=b;b!=null?(b.state=g.state,R.toolName=g.toolName,R.input=x.input,R.output=x.output,R.errorText=x.errorText,R.rawInput=(P=x.rawInput)!=null?P:R.rawInput,R.preliminary=x.preliminary,R.providerExecuted=(C=x.providerExecuted)!=null?C:b.providerExecuted,x.providerMetadata!=null&&b.state==="input-available"&&(b.callProviderMetadata=x.providerMetadata)):l.message.parts.push({type:"dynamic-tool",toolName:g.toolName,toolCallId:g.toolCallId,state:g.state,input:x.input,output:x.output,errorText:x.errorText,preliminary:x.preliminary,providerExecuted:x.providerExecuted,...x.providerMetadata!=null?{callProviderMetadata:x.providerMetadata}:{}})}async function q(g){if(g!=null){const P=l.message.metadata!=null?ka(l.message.metadata,g):g;t!=null&&await Ke({value:P,schema:t}),l.message.metadata=P}}switch(o.type){case"text-start":{const g={type:"text",text:"",providerMetadata:o.providerMetadata,state:"streaming"};l.activeTextParts[o.id]=g,l.message.parts.push(g),c();break}case"text-delta":{const g=l.activeTextParts[o.id];g.text+=o.delta,g.providerMetadata=(d=o.providerMetadata)!=null?d:g.providerMetadata,c();break}case"text-end":{const g=l.activeTextParts[o.id];g.state="done",g.providerMetadata=(f=o.providerMetadata)!=null?f:g.providerMetadata,delete l.activeTextParts[o.id],c();break}case"reasoning-start":{const g={type:"reasoning",text:"",providerMetadata:o.providerMetadata,state:"streaming"};l.activeReasoningParts[o.id]=g,l.message.parts.push(g),c();break}case"reasoning-delta":{const g=l.activeReasoningParts[o.id];g.text+=o.delta,g.providerMetadata=(p=o.providerMetadata)!=null?p:g.providerMetadata,c();break}case"reasoning-end":{const g=l.activeReasoningParts[o.id];g.providerMetadata=(m=o.providerMetadata)!=null?m:g.providerMetadata,g.state="done",delete l.activeReasoningParts[o.id],c();break}case"file":{l.message.parts.push({type:"file",mediaType:o.mediaType,url:o.url}),c();break}case"source-url":{l.message.parts.push({type:"source-url",sourceId:o.sourceId,url:o.url,title:o.title,providerMetadata:o.providerMetadata}),c();break}case"source-document":{l.message.parts.push({type:"source-document",sourceId:o.sourceId,mediaType:o.mediaType,title:o.title,filename:o.filename,providerMetadata:o.providerMetadata}),c();break}case"tool-input-start":{const g=l.message.parts.filter(nt);l.partialToolCalls[o.toolCallId]={text:"",toolName:o.toolName,index:g.length,dynamic:o.dynamic},o.dynamic?S({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0,providerExecuted:o.providerExecuted}):v({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0,providerExecuted:o.providerExecuted}),c();break}case"tool-input-delta":{const g=l.partialToolCalls[o.toolCallId];g.text+=o.inputTextDelta;const{value:P}=await Da(g.text);g.dynamic?S({toolCallId:o.toolCallId,toolName:g.toolName,state:"input-streaming",input:P}):v({toolCallId:o.toolCallId,toolName:g.toolName,state:"input-streaming",input:P}),c();break}case"tool-input-available":{o.dynamic?S({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}):v({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),c(),s&&!o.providerExecuted&&await s({toolCall:o});break}case"tool-input-error":{o.dynamic?S({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:o.input,errorText:o.errorText,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}):v({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:void 0,rawInput:o.input,errorText:o.errorText,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),c();break}case"tool-output-available":{if(o.dynamic){const g=w(o.toolCallId);S({toolCallId:o.toolCallId,toolName:g.toolName,state:"output-available",input:g.input,output:o.output,preliminary:o.preliminary})}else{const g=y(o.toolCallId);v({toolCallId:o.toolCallId,toolName:Lt(g),state:"output-available",input:g.input,output:o.output,providerExecuted:o.providerExecuted,preliminary:o.preliminary})}c();break}case"tool-output-error":{if(o.dynamic){const g=w(o.toolCallId);S({toolCallId:o.toolCallId,toolName:g.toolName,state:"output-error",input:g.input,errorText:o.errorText,providerExecuted:o.providerExecuted})}else{const g=y(o.toolCallId);v({toolCallId:o.toolCallId,toolName:Lt(g),state:"output-error",input:g.input,rawInput:g.rawInput,errorText:o.errorText,providerExecuted:o.providerExecuted})}c();break}case"start-step":{l.message.parts.push({type:"step-start"});break}case"finish-step":{l.activeTextParts={},l.activeReasoningParts={};break}case"start":{o.messageId!=null&&(l.message.id=o.messageId),await q(o.messageMetadata),(o.messageId!=null||o.messageMetadata!=null)&&c();break}case"finish":{o.finishReason!=null&&(l.finishReason=o.finishReason),await q(o.messageMetadata),o.messageMetadata!=null&&c();break}case"message-metadata":{await q(o.messageMetadata),o.messageMetadata!=null&&c();break}case"error":{n?.(new Error(o.errorText));break}default:if(Yi(o)){a?.[o.type]!=null&&await Ke({value:o.data,schema:a[o.type]});const g=o;if(g.transient){i?.(g);break}const P=g.id!=null?l.message.parts.find(C=>g.type===C.type&&g.id===C.id):void 0;P!=null?P.data=g.data:l.message.parts.push(g),i?.(g),c()}}u.enqueue(o)})}}))}function gn({messageId:e,originalMessages:t=[],onFinish:a,onError:r,stream:n}){let s=t?.[t.length-1];s?.role!=="assistant"?s=void 0:e=s.id;let i=!1;const o=n.pipeThrough(new TransformStream({transform(f,p){if(f.type==="start"){const m=f;m.messageId==null&&e!=null&&(m.messageId=e)}f.type==="abort"&&(i=!0),p.enqueue(f)}}));if(a==null)return o;const u=Ua({lastMessage:s?structuredClone(s):void 0,messageId:e??""}),l=async f=>{await f({state:u,write:()=>{}})};let c=!1;const d=async()=>{if(c||!a)return;c=!0;const f=u.message.id===s?.id;await a({isAborted:i,isContinuation:f,responseMessage:u.message,messages:[...f?t.slice(0,-1):t,u.message],finishReason:u.finishReason})};return ja({stream:o,runUpdateMessageJob:l,onError:r}).pipeThrough(new TransformStream({transform(f,p){p.enqueue(f)},async cancel(){await d()},async flush(){await d()}}))}function Xi({response:e,status:t,statusText:a,headers:r,stream:n,consumeSseStream:s}){let i=n.pipeThrough(new cn);if(s){const[o,u]=i.tee();i=o,s({stream:u})}dn({response:e,status:t,statusText:a,headers:Object.fromEntries(At(r,mn).entries()),stream:i.pipeThrough(new TextEncoderStream)})}function Ge(e){const t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=function(){const a=this.getReader();let r=!1;async function n(s){var i;r=!0;try{s&&await((i=a.cancel)==null?void 0:i.call(a))}finally{try{a.releaseLock()}catch{}}}return{async next(){if(r)return{done:!0,value:void 0};const{done:s,value:i}=await a.read();return s?(await n(!0),{done:!0,value:void 0}):{done:!1,value:i}},async return(){return await n(!0),{done:!0,value:void 0}},async throw(s){throw await n(!0),s}}},t}async function ra({stream:e,onError:t}){const a=e.getReader();try{for(;;){const{done:r}=await a.read();if(r)break}}catch(r){t?.(r)}finally{a.releaseLock()}}function Mr(){let e,t;return{promise:new Promise((r,n)=>{e=r,t=n}),resolve:e,reject:t}}function hn(){let e=[],t=null,a=!1,r=Mr();const n=()=>{a=!0,r.resolve(),e.forEach(i=>i.cancel()),e=[],t?.close()},s=async()=>{if(a&&e.length===0){t?.close();return}if(e.length===0)return r=Mr(),await r.promise,s();try{const{value:i,done:o}=await e[0].read();o?(e.shift(),e.length>0?await s():a&&t?.close()):t?.enqueue(i)}catch(i){t?.error(i),e.shift(),n()}};return{stream:new ReadableStream({start(i){t=i},pull:s,async cancel(){for(const i of e)await i.cancel();e=[],a=!0}}),addStream:i=>{if(a)throw new Error("Cannot add inner stream: outer stream is closed");e.push(i.getReader()),r.resolve()},close:()=>{a=!0,r.resolve(),e.length===0&&t?.close()},terminate:n}}function vn(){var e,t;return(t=(e=globalThis?.performance)==null?void 0:e.now())!=null?t:Date.now()}function Qi({tools:e,generatorStream:t,tracer:a,telemetry:r,system:n,messages:s,abortSignal:i,repairToolCall:o,experimental_context:u}){let l=null;const c=new ReadableStream({start(v){l=v}}),d=new Set,f=new Map;let p=!1,m;function y(){p&&d.size===0&&(m!=null&&l.enqueue(m),l.close())}const w=new TransformStream({async transform(v,S){const q=v.type;switch(q){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":{S.enqueue(v);break}case"file":{S.enqueue({type:"file",file:new Fi({data:v.data,mediaType:v.mediaType})});break}case"finish":{m={type:"finish",finishReason:v.finishReason,usage:v.usage,providerMetadata:v.providerMetadata};break}case"tool-call":{try{const g=await sn({toolCall:v,tools:e,repairToolCall:o,system:n,messages:s});if(S.enqueue(g),g.invalid){l.enqueue({type:"tool-error",toolCallId:g.toolCallId,toolName:g.toolName,input:g.input,error:Yt(g.error),dynamic:!0});break}const P=e[g.toolName];if(f.set(g.toolCallId,g.input),P.onInputAvailable!=null&&await P.onInputAvailable({input:g.input,toolCallId:g.toolCallId,messages:s,abortSignal:i,experimental_context:u}),P.execute!=null&&g.providerExecuted!==!0){const C=_a();d.add(C),fe({name:"ai.toolCall",attributes:G({telemetry:r,attributes:{...me({operationId:"ai.toolCall",telemetry:r}),"ai.toolCall.name":g.toolName,"ai.toolCall.id":g.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(g.input)}}}),tracer:a,fn:async b=>{let x;try{const R=Or({execute:P.execute.bind(P),input:g.input,options:{toolCallId:g.toolCallId,messages:s,abortSignal:i,experimental_context:u}});for await(const O of R)l.enqueue({...g,type:"tool-result",output:O.output,...O.type==="preliminary"&&{preliminary:!0}}),O.type==="final"&&(x=O.output)}catch(R){qa(b,R),l.enqueue({...g,type:"tool-error",error:R}),d.delete(C),y();return}d.delete(C),y();try{b.setAttributes(G({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(x)}}}))}catch{}}})}}catch(g){l.enqueue({type:"error",error:g})}break}case"tool-result":{const g=v.toolName;v.isError?l.enqueue({type:"tool-error",toolCallId:v.toolCallId,toolName:g,input:f.get(v.toolCallId),providerExecuted:v.providerExecuted,error:v.result}):S.enqueue({type:"tool-result",toolCallId:v.toolCallId,toolName:g,input:f.get(v.toolCallId),output:v.result,providerExecuted:v.providerExecuted});break}default:{const g=q;throw new Error(`Unhandled chunk type: ${g}`)}}},flush(){p=!0,y()}});return new ReadableStream({async start(v){return Promise.all([t.pipeThrough(w).pipeTo(new WritableStream({write(S){v.enqueue(S)},close(){}})),c.pipeTo(new WritableStream({write(S){v.enqueue(S)},close(){v.close()}}))])}})}var Zi=Kt({prefix:"aitxt",size:24});function el({model:e,tools:t,toolChoice:a,system:r,prompt:n,messages:s,maxRetries:i,abortSignal:o,headers:u,stopWhen:l=on(1),experimental_output:c,experimental_telemetry:d,prepareStep:f,providerOptions:p,experimental_activeTools:m,activeTools:y=m,experimental_repairToolCall:w,experimental_transform:v,experimental_download:S,includeRawChunks:q=!1,onChunk:g,onError:P=({error:j})=>{console.error(j)},onFinish:C,onAbort:b,onStepFinish:x,experimental_context:R,_internal:{now:O=vn,generateId:J=Zi,currentDate:z=()=>new Date}={},...V}){return new al({model:pt(e),telemetry:d,headers:u,settings:V,maxRetries:i,abortSignal:o,system:r,prompt:n,messages:s,tools:t,toolChoice:a,transforms:Bt(v),activeTools:y,repairToolCall:w,stopConditions:Bt(l),output:c,providerOptions:p,prepareStep:f,includeRawChunks:q,onChunk:g,onError:P,onFinish:C,onAbort:b,onStepFinish:x,now:O,currentDate:z,generateId:J,experimental_context:R,download:S})}function tl(e){if(!e)return new TransformStream({transform(i,o){o.enqueue({part:i,partialOutput:void 0})}});let t,a="",r="",n="";function s({controller:i,partialOutput:o=void 0}){i.enqueue({part:{type:"text-delta",id:t,text:r},partialOutput:o}),r=""}return new TransformStream({async transform(i,o){if(i.type==="finish-step"&&r.length>0&&s({controller:o}),i.type!=="text-delta"&&i.type!=="text-start"&&i.type!=="text-end"){o.enqueue({part:i,partialOutput:void 0});return}if(t==null)t=i.id;else if(i.id!==t){o.enqueue({part:i,partialOutput:void 0});return}if(i.type==="text-start"){o.enqueue({part:i,partialOutput:void 0});return}if(i.type==="text-end"){r.length>0&&s({controller:o}),o.enqueue({part:i,partialOutput:void 0});return}a+=i.text,r+=i.text;const u=await e.parsePartial({text:a});if(u!=null){const l=JSON.stringify(u.partial);l!==n&&(s({controller:o,partialOutput:u.partial}),n=l)}}})}var al=class{constructor({model:e,telemetry:t,headers:a,settings:r,maxRetries:n,abortSignal:s,system:i,prompt:o,messages:u,tools:l,toolChoice:c,transforms:d,activeTools:f,repairToolCall:p,stopConditions:m,output:y,providerOptions:w,prepareStep:v,includeRawChunks:S,now:q,currentDate:g,generateId:P,onChunk:C,onError:b,onFinish:x,onAbort:R,onStepFinish:O,experimental_context:J,download:z}){this._totalUsage=new Ne,this._finishReason=new Ne,this._steps=new Ne,this.output=y,this.includeRawChunks=S,this.tools=l;let V,j=[];const se=[];let te,pe,ge={},Me=[];const X=[];let Ce,ie={},ne={};const ae=new TransformStream({async transform(k,N){var E,_,re,Ie;N.enqueue(k);const{part:T}=k;if((T.type==="text-delta"||T.type==="reasoning-delta"||T.type==="source"||T.type==="tool-call"||T.type==="tool-result"||T.type==="tool-input-start"||T.type==="tool-input-delta"||T.type==="raw")&&await C?.({chunk:T}),T.type==="error"&&await b({error:ea(T.error)}),T.type==="text-start"&&(ie[T.id]={type:"text",text:"",providerMetadata:T.providerMetadata},j.push(ie[T.id])),T.type==="text-delta"){const D=ie[T.id];if(D==null){N.enqueue({part:{type:"error",error:`text part ${T.id} not found`},partialOutput:void 0});return}D.text+=T.text,D.providerMetadata=(E=T.providerMetadata)!=null?E:D.providerMetadata}if(T.type==="text-end"){const D=ie[T.id];if(D==null){N.enqueue({part:{type:"error",error:`text part ${T.id} not found`},partialOutput:void 0});return}D.providerMetadata=(_=T.providerMetadata)!=null?_:D.providerMetadata,delete ie[T.id]}if(T.type==="reasoning-start"&&(ne[T.id]={type:"reasoning",text:"",providerMetadata:T.providerMetadata},j.push(ne[T.id])),T.type==="reasoning-delta"){const D=ne[T.id];if(D==null){N.enqueue({part:{type:"error",error:`reasoning part ${T.id} not found`},partialOutput:void 0});return}D.text+=T.text,D.providerMetadata=(re=T.providerMetadata)!=null?re:D.providerMetadata}if(T.type==="reasoning-end"){const D=ne[T.id];if(D==null){N.enqueue({part:{type:"error",error:`reasoning part ${T.id} not found`},partialOutput:void 0});return}D.providerMetadata=(Ie=T.providerMetadata)!=null?Ie:D.providerMetadata,delete ne[T.id]}if(T.type==="file"&&j.push({type:"file",file:T.file}),T.type==="source"&&j.push(T),T.type==="tool-call"&&j.push(T),T.type==="tool-result"&&!T.preliminary&&j.push(T),T.type==="tool-error"&&j.push(T),T.type==="start-step"&&(ge=T.request,Me=T.warnings),T.type==="finish-step"){const D=xa({content:j,tools:l}),Pe=new nn({content:j,finishReason:T.finishReason,usage:T.usage,warnings:Me,request:ge,response:{...T.response,messages:[...se,...D]},providerMetadata:T.providerMetadata});await O?.(Pe),Ze(Me),X.push(Pe),j=[],ne={},ie={},se.push(...D),V.resolve()}T.type==="finish"&&(pe=T.totalUsage,te=T.finishReason)},async flush(k){try{if(X.length===0){const re=new ui({message:"No output generated. Check the stream for errors."});W._finishReason.reject(re),W._totalUsage.reject(re),W._steps.reject(re);return}const N=te??"unknown",E=pe??{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};W._finishReason.resolve(N),W._totalUsage.resolve(E),W._steps.resolve(X);const _=X[X.length-1];await x?.({finishReason:N,totalUsage:E,usage:_.usage,content:_.content,text:_.text,reasoningText:_.reasoningText,reasoning:_.reasoning,files:_.files,sources:_.sources,toolCalls:_.toolCalls,staticToolCalls:_.staticToolCalls,dynamicToolCalls:_.dynamicToolCalls,toolResults:_.toolResults,staticToolResults:_.staticToolResults,dynamicToolResults:_.dynamicToolResults,request:_.request,response:_.response,warnings:_.warnings,providerMetadata:_.providerMetadata,steps:X}),Ce.setAttributes(G({telemetry:t,attributes:{"ai.response.finishReason":N,"ai.response.text":{output:()=>_.text},"ai.response.toolCalls":{output:()=>{var re;return(re=_.toolCalls)!=null&&re.length?JSON.stringify(_.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(_.providerMetadata),"ai.usage.inputTokens":E.inputTokens,"ai.usage.outputTokens":E.outputTokens,"ai.usage.totalTokens":E.totalTokens,"ai.usage.reasoningTokens":E.reasoningTokens,"ai.usage.cachedInputTokens":E.cachedInputTokens}}))}catch(N){k.error(N)}finally{Ce.end()}}}),ue=hn();this.addStream=ue.addStream,this.closeStream=ue.close;const Y=ue.stream.getReader();let he=new ReadableStream({async start(k){k.enqueue({type:"start"})},async pull(k){function N(){R?.({steps:X}),k.enqueue({type:"abort"}),k.close()}try{const{done:E,value:_}=await Y.read();if(E){k.close();return}if(s?.aborted){N();return}k.enqueue(_)}catch(E){Pr(E)&&s?.aborted?N():k.error(E)}},cancel(k){return ue.stream.cancel(k)}});for(const k of d)he=he.pipeThrough(k({tools:l,stopStream(){ue.terminate()}}));this.baseStream=he.pipeThrough(tl(y)).pipeThrough(ae);const{maxRetries:ve,retry:ye}=Ve({maxRetries:n,abortSignal:s}),B=mt(t),ee=Qe(r),Te=ct({model:e,telemetry:t,headers:a,settings:{...ee,maxRetries:ve}}),W=this;fe({name:"ai.streamText",attributes:G({telemetry:t,attributes:{...me({operationId:"ai.streamText",telemetry:t}),...Te,"ai.prompt":{input:()=>JSON.stringify({system:i,prompt:o,messages:u})}}}),tracer:B,endWhenDone:!1,fn:async k=>{Ce=k;async function N({currentStep:E,responseMessages:_,usage:re}){var Ie,T,D,Pe,F;const qe=W.includeRawChunks;V=new Ne;const ft=await Zt({system:i,prompt:o,messages:u}),Be=[...ft.messages,..._],xe=await v?.({model:e,steps:X,stepNumber:X.length,messages:Be}),De=pt((Ie=xe?.model)!=null?Ie:e),gt=await Qt({prompt:{system:(T=xe?.system)!=null?T:ft.system,messages:(D=xe?.messages)!=null?D:Be},supportedUrls:await De.supportedUrls,download:z}),{toolChoice:et,tools:tt}=Hs({tools:l,toolChoice:(Pe=xe?.toolChoice)!=null?Pe:c,activeTools:(F=xe?.activeTools)!=null?F:f}),{result:{stream:Nt,response:oe,request:$e},doStreamSpan:Ue,startTimestampMs:Fa}=await ye(()=>fe({name:"ai.streamText.doStream",attributes:G({telemetry:t,attributes:{...me({operationId:"ai.streamText.doStream",telemetry:t}),...Te,"ai.model.provider":De.provider,"ai.model.id":De.modelId,"ai.prompt.messages":{input:()=>ta(gt)},"ai.prompt.tools":{input:()=>tt?.map(A=>JSON.stringify(A))},"ai.prompt.toolChoice":{input:()=>et!=null?JSON.stringify(et):void 0},"gen_ai.system":De.provider,"gen_ai.request.model":De.modelId,"gen_ai.request.frequency_penalty":ee.frequencyPenalty,"gen_ai.request.max_tokens":ee.maxOutputTokens,"gen_ai.request.presence_penalty":ee.presencePenalty,"gen_ai.request.stop_sequences":ee.stopSequences,"gen_ai.request.temperature":ee.temperature,"gen_ai.request.top_k":ee.topK,"gen_ai.request.top_p":ee.topP}}),tracer:B,endWhenDone:!1,fn:async A=>({startTimestampMs:q(),doStreamSpan:A,result:await De.doStream({...ee,tools:tt,toolChoice:et,responseFormat:y?.responseFormat,prompt:gt,providerOptions:w,abortSignal:s,headers:a,includeRawChunks:qe})})})),En=Qi({tools:l,generatorStream:Nt,tracer:B,telemetry:t,system:i,messages:Be,repairToolCall:p,abortSignal:s,experimental_context:J}),Rn=$e??{},Ot=[],sa=[];let na;const oa={};let at="unknown",Ae={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},ia,Ga=!0,ke={id:P(),timestamp:g(),modelId:e.modelId},Ja="";W.addStream(En.pipeThrough(new TransformStream({async transform(A,le){var ht,vt,Pt,je;if(A.type==="stream-start"){na=A.warnings;return}if(Ga){const ce=q()-Fa;Ga=!1,Ue.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":ce}),Ue.setAttributes({"ai.response.msToFirstChunk":ce}),le.enqueue({type:"start-step",request:Rn,warnings:na??[]})}const Va=A.type;switch(Va){case"text-start":case"text-end":{le.enqueue(A);break}case"text-delta":{A.delta.length>0&&(le.enqueue({type:"text-delta",id:A.id,text:A.delta,providerMetadata:A.providerMetadata}),Ja+=A.delta);break}case"reasoning-start":case"reasoning-end":{le.enqueue(A);break}case"reasoning-delta":{le.enqueue({type:"reasoning-delta",id:A.id,text:A.delta,providerMetadata:A.providerMetadata});break}case"tool-call":{le.enqueue(A),Ot.push(A);break}case"tool-result":{le.enqueue(A),A.preliminary||sa.push(A);break}case"tool-error":{le.enqueue(A),sa.push(A);break}case"response-metadata":{ke={id:(ht=A.id)!=null?ht:ke.id,timestamp:(vt=A.timestamp)!=null?vt:ke.timestamp,modelId:(Pt=A.modelId)!=null?Pt:ke.modelId};break}case"finish":{Ae=A.usage,at=A.finishReason,ia=A.providerMetadata;const ce=q()-Fa;Ue.addEvent("ai.stream.finish"),Ue.setAttributes({"ai.response.msToFinish":ce,"ai.response.avgOutputTokensPerSecond":1e3*((je=Ae.outputTokens)!=null?je:0)/ce});break}case"file":{le.enqueue(A);break}case"source":{le.enqueue(A);break}case"tool-input-start":{oa[A.id]=A.toolName;const ce=l?.[A.toolName];ce?.onInputStart!=null&&await ce.onInputStart({toolCallId:A.id,messages:Be,abortSignal:s,experimental_context:J}),le.enqueue({...A,dynamic:ce?.type==="dynamic"});break}case"tool-input-end":{delete oa[A.id],le.enqueue(A);break}case"tool-input-delta":{const ce=oa[A.id],la=l?.[ce];la?.onInputDelta!=null&&await la.onInputDelta({inputTextDelta:A.delta,toolCallId:A.id,messages:Be,abortSignal:s,experimental_context:J}),le.enqueue(A);break}case"error":{le.enqueue(A),at="error";break}case"raw":{qe&&le.enqueue(A);break}default:{const ce=Va;throw new Error(`Unknown chunk type: ${ce}`)}}},async flush(A){const le=Ot.length>0?JSON.stringify(Ot):void 0;try{Ue.setAttributes(G({telemetry:t,attributes:{"ai.response.finishReason":at,"ai.response.text":{output:()=>Ja},"ai.response.toolCalls":{output:()=>le},"ai.response.id":ke.id,"ai.response.model":ke.modelId,"ai.response.timestamp":ke.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(ia),"ai.usage.inputTokens":Ae.inputTokens,"ai.usage.outputTokens":Ae.outputTokens,"ai.usage.totalTokens":Ae.totalTokens,"ai.usage.reasoningTokens":Ae.reasoningTokens,"ai.usage.cachedInputTokens":Ae.cachedInputTokens,"gen_ai.response.finish_reasons":[at],"gen_ai.response.id":ke.id,"gen_ai.response.model":ke.modelId,"gen_ai.usage.input_tokens":Ae.inputTokens,"gen_ai.usage.output_tokens":Ae.outputTokens}}))}catch{}finally{Ue.end()}A.enqueue({type:"finish-step",finishReason:at,usage:Ae,providerMetadata:ia,response:{...ke,headers:oe?.headers}});const ht=an(re,Ae);await V.promise;const vt=Ot.filter(je=>je.providerExecuted!==!0),Pt=sa.filter(je=>je.providerExecuted!==!0);if(vt.length>0&&Pt.length===vt.length&&!await ln({stopConditions:m,steps:X})){_.push(...xa({content:X[X.length-1].content,tools:l}));try{await N({currentStep:E+1,responseMessages:_,usage:ht})}catch(je){A.enqueue({type:"error",error:je}),W.closeStream()}}else A.enqueue({type:"finish",finishReason:at,totalUsage:ht}),W.closeStream()}})))}await N({currentStep:0,responseMessages:[],usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0}})}}).catch(k=>{W.addStream(new ReadableStream({start(N){N.enqueue({type:"error",error:k}),N.close()}})),W.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(e=>e[e.length-1])}get content(){return this.finalStep.then(e=>e.content)}get warnings(){return this.finalStep.then(e=>e.warnings)}get providerMetadata(){return this.finalStep.then(e=>e.providerMetadata)}get text(){return this.finalStep.then(e=>e.text)}get reasoningText(){return this.finalStep.then(e=>e.reasoningText)}get reasoning(){return this.finalStep.then(e=>e.reasoning)}get sources(){return this.finalStep.then(e=>e.sources)}get files(){return this.finalStep.then(e=>e.files)}get toolCalls(){return this.finalStep.then(e=>e.toolCalls)}get staticToolCalls(){return this.finalStep.then(e=>e.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(e=>e.dynamicToolCalls)}get toolResults(){return this.finalStep.then(e=>e.toolResults)}get staticToolResults(){return this.finalStep.then(e=>e.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(e=>e.dynamicToolResults)}get usage(){return this.finalStep.then(e=>e.usage)}get request(){return this.finalStep.then(e=>e.request)}get response(){return this.finalStep.then(e=>e.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}teeStream(){const[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return Ge(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){e.type==="text-delta"&&t.enqueue(e.text)}})))}get fullStream(){return Ge(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await ra({stream:this.fullStream,onError:e?.onError})}catch(a){(t=e?.onError)==null||t.call(e,a)}}get experimental_partialOutputStream(){if(this.output==null)throw new es;return Ge(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){e!=null&&t.enqueue(e)}})))}toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:a,messageMetadata:r,sendReasoning:n=!0,sendSources:s=!1,sendStart:i=!0,sendFinish:o=!0,onError:u=Ht}={}){const l=t!=null?Hi({originalMessages:e,responseMessageId:t}):void 0,c={},d=p=>{var m,y;const w=c[p];return((y=(m=this.tools)==null?void 0:m[w])==null?void 0:y.type)==="dynamic"?!0:void 0},f=this.fullStream.pipeThrough(new TransformStream({transform:async(p,m)=>{const y=r?.({part:p}),w=p.type;switch(w){case"text-start":{m.enqueue({type:"text-start",id:p.id,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"text-delta":{m.enqueue({type:"text-delta",id:p.id,delta:p.text,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"text-end":{m.enqueue({type:"text-end",id:p.id,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"reasoning-start":{m.enqueue({type:"reasoning-start",id:p.id,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"reasoning-delta":{n&&m.enqueue({type:"reasoning-delta",id:p.id,delta:p.text,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"reasoning-end":{m.enqueue({type:"reasoning-end",id:p.id,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"file":{m.enqueue({type:"file",mediaType:p.file.mediaType,url:`data:${p.file.mediaType};base64,${p.file.base64}`});break}case"source":{s&&p.sourceType==="url"&&m.enqueue({type:"source-url",sourceId:p.id,url:p.url,title:p.title,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}}),s&&p.sourceType==="document"&&m.enqueue({type:"source-document",sourceId:p.id,mediaType:p.mediaType,title:p.title,filename:p.filename,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"tool-input-start":{c[p.id]=p.toolName;const v=d(p.id);m.enqueue({type:"tool-input-start",toolCallId:p.id,toolName:p.toolName,...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},...v!=null?{dynamic:v}:{}});break}case"tool-input-delta":{m.enqueue({type:"tool-input-delta",toolCallId:p.id,inputTextDelta:p.delta});break}case"tool-call":{c[p.toolCallId]=p.toolName;const v=d(p.toolCallId);p.invalid?m.enqueue({type:"tool-input-error",toolCallId:p.toolCallId,toolName:p.toolName,input:p.input,...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{},...v!=null?{dynamic:v}:{},errorText:u(p.error)}):m.enqueue({type:"tool-input-available",toolCallId:p.toolCallId,toolName:p.toolName,input:p.input,...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{},...v!=null?{dynamic:v}:{}});break}case"tool-result":{const v=d(p.toolCallId);m.enqueue({type:"tool-output-available",toolCallId:p.toolCallId,output:p.output,...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},...p.preliminary!=null?{preliminary:p.preliminary}:{},...v!=null?{dynamic:v}:{}});break}case"tool-error":{const v=d(p.toolCallId);m.enqueue({type:"tool-output-error",toolCallId:p.toolCallId,errorText:u(p.error),...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},...v!=null?{dynamic:v}:{}});break}case"error":{m.enqueue({type:"error",errorText:u(p.error)});break}case"start-step":{m.enqueue({type:"start-step"});break}case"finish-step":{m.enqueue({type:"finish-step"});break}case"start":{i&&m.enqueue({type:"start",...y!=null?{messageMetadata:y}:{},...l!=null?{messageId:l}:{}});break}case"finish":{o&&m.enqueue({type:"finish",finishReason:p.finishReason,...y!=null?{messageMetadata:y}:{}});break}case"abort":{m.enqueue(p);break}case"tool-input-end":break;case"raw":break;default:{const v=w;throw new Error(`Unknown chunk type: ${v}`)}}y!=null&&w!=="start"&&w!=="finish"&&m.enqueue({type:"message-metadata",messageMetadata:y})}}));return Ge(gn({stream:f,messageId:l??t?.(),originalMessages:e,onFinish:a,onError:u}))}pipeUIMessageStreamToResponse(e,{originalMessages:t,generateMessageId:a,onFinish:r,messageMetadata:n,sendReasoning:s,sendSources:i,sendFinish:o,sendStart:u,onError:l,...c}={}){Xi({response:e,stream:this.toUIMessageStream({originalMessages:t,generateMessageId:a,onFinish:r,messageMetadata:n,sendReasoning:s,sendSources:i,sendFinish:o,sendStart:u,onError:l}),...c})}pipeTextStreamToResponse(e,t){pn({response:e,textStream:this.textStream,...t})}toUIMessageStreamResponse({originalMessages:e,generateMessageId:t,onFinish:a,messageMetadata:r,sendReasoning:n,sendSources:s,sendFinish:i,sendStart:o,onError:u,...l}={}){return Wi({stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:a,messageMetadata:r,sendReasoning:n,sendSources:s,sendFinish:i,sendStart:o,onError:u}),...l})}toTextStreamResponse(e){return un({textStream:this.textStream,...e})}};function yn(e,t){const a=[];t?.ignoreIncompleteToolCalls&&(e=e.map(r=>({...r,parts:r.parts.filter(n=>!Rt(n)||n.state!=="input-streaming"&&n.state!=="input-available")})));for(const r of e)switch(r.role){case"system":{const n=r.parts.filter(i=>i.type==="text"),s=n.reduce((i,o)=>o.providerMetadata!=null?{...i,...o.providerMetadata}:i,{});a.push({role:"system",content:n.map(i=>i.text).join(""),...Object.keys(s).length>0?{providerOptions:s}:{}});break}case"user":{a.push({role:"user",content:r.parts.map(n=>{var s;if(va(n))return{type:"text",text:n.text,...n.providerMetadata!=null?{providerOptions:n.providerMetadata}:{}};if(ya(n))return{type:"file",mediaType:n.mediaType,filename:n.filename,data:n.url,...n.providerMetadata!=null?{providerOptions:n.providerMetadata}:{}};if(ha(n))return(s=t?.convertDataPart)==null?void 0:s.call(t,n)}).filter(n=>n!=null)});break}case"assistant":{if(r.parts!=null){let n=function(){var i,o,u;if(s.length===0)return;const l=[];for(const d of s)if(va(d))l.push({type:"text",text:d.text,...d.providerMetadata!=null?{providerOptions:d.providerMetadata}:{}});else if(ya(d))l.push({type:"file",mediaType:d.mediaType,filename:d.filename,data:d.url});else if(Sr(d))l.push({type:"reasoning",text:d.text,providerOptions:d.providerMetadata});else if($a(d)){const f=d.toolName;d.state!=="input-streaming"&&l.push({type:"tool-call",toolCallId:d.toolCallId,toolName:f,input:d.input,...d.callProviderMetadata!=null?{providerOptions:d.callProviderMetadata}:{}})}else if(nt(d)){const f=Lt(d);d.state!=="input-streaming"&&(l.push({type:"tool-call",toolCallId:d.toolCallId,toolName:f,input:d.state==="output-error"?(i=d.input)!=null?i:d.rawInput:d.input,providerExecuted:d.providerExecuted,...d.callProviderMetadata!=null?{providerOptions:d.callProviderMetadata}:{}}),d.providerExecuted===!0&&(d.state==="output-available"||d.state==="output-error")&&l.push({type:"tool-result",toolCallId:d.toolCallId,toolName:f,output:It({output:d.state==="output-error"?d.errorText:d.output,tool:(o=t?.tools)==null?void 0:o[f],errorMode:d.state==="output-error"?"json":"none"}),...d.callProviderMetadata!=null?{providerOptions:d.callProviderMetadata}:{}}))}else if(ha(d)){const f=(u=t?.convertDataPart)==null?void 0:u.call(t,d);f!=null&&l.push(f)}else{const f=d;throw new Error(`Unsupported part: ${f}`)}a.push({role:"assistant",content:l});const c=s.filter(d=>nt(d)&&d.providerExecuted!==!0||d.type==="dynamic-tool");c.length>0&&a.push({role:"tool",content:c.map(d=>{var f;switch(d.state){case"output-error":case"output-available":{const p=zi(d);return{type:"tool-result",toolCallId:d.toolCallId,toolName:p,output:It({output:d.state==="output-error"?d.errorText:d.output,tool:(f=t?.tools)==null?void 0:f[p],errorMode:d.state==="output-error"?"text":"none"}),...d.callProviderMetadata!=null?{providerOptions:d.callProviderMetadata}:{}}}default:return null}}).filter(d=>d!=null)}),s=[]},s=[];for(const i of r.parts)va(i)||Sr(i)||ya(i)||Rt(i)||ha(i)?s.push(i):i.type==="step-start"&&n();n();break}break}default:{const n=r.role;throw new yi({originalMessage:r,message:`Unsupported role: ${n}`})}}return a}var Hl=yn,Yl=class{constructor(e){this.settings=e}get tools(){return this.settings.tools}async generate(e){return Ji({...this.settings,...e})}stream(e){return el({...this.settings,...e})}respond(e){return this.stream({prompt:yn(e.messages)}).toUIMessageStreamResponse()}};async function Kl({model:e,value:t,providerOptions:a,maxRetries:r,abortSignal:n,headers:s,experimental_telemetry:i}){const o=Gs(e),{maxRetries:u,retry:l}=Ve({maxRetries:r,abortSignal:n}),c=Re(s??{},`ai/${Oe}`),d=ct({model:o,telemetry:i,headers:c,settings:{maxRetries:u}}),f=mt(i);return fe({name:"ai.embed",attributes:G({telemetry:i,attributes:{...me({operationId:"ai.embed",telemetry:i}),...d,"ai.value":{input:()=>JSON.stringify(t)}}}),tracer:f,fn:async p=>{const{embedding:m,usage:y,response:w,providerMetadata:v}=await l(()=>fe({name:"ai.embed.doEmbed",attributes:G({telemetry:i,attributes:{...me({operationId:"ai.embed.doEmbed",telemetry:i}),...d,"ai.values":{input:()=>[JSON.stringify(t)]}}}),tracer:f,fn:async S=>{var q;const g=await o.doEmbed({values:[t],abortSignal:n,headers:c,providerOptions:a}),P=g.embeddings[0],C=(q=g.usage)!=null?q:{tokens:NaN};return S.setAttributes(G({telemetry:i,attributes:{"ai.embeddings":{output:()=>g.embeddings.map(b=>JSON.stringify(b))},"ai.usage.tokens":C.tokens}})),{embedding:P,usage:C,providerMetadata:g.providerMetadata,response:g.response}}}));return p.setAttributes(G({telemetry:i,attributes:{"ai.embedding":{output:()=>JSON.stringify(m)},"ai.usage.tokens":y.tokens}})),new rl({value:t,embedding:m,usage:y,providerMetadata:v,response:w})}})}var rl=class{constructor(e){this.value=e.value,this.embedding=e.embedding,this.usage=e.usage,this.providerMetadata=e.providerMetadata,this.response=e.response}};function Er(e,t){if(t<=0)throw new Error("chunkSize must be greater than 0");const a=[];for(let r=0;r<e.length;r+=t)a.push(e.slice(r,r+t));return a}async function zl({model:e,values:t,maxParallelCalls:a=1/0,maxRetries:r,abortSignal:n,headers:s,providerOptions:i,experimental_telemetry:o}){const u=Gs(e),{maxRetries:l,retry:c}=Ve({maxRetries:r,abortSignal:n}),d=Re(s??{},`ai/${Oe}`),f=ct({model:u,telemetry:o,headers:d,settings:{maxRetries:l}}),p=mt(o);return fe({name:"ai.embedMany",attributes:G({telemetry:o,attributes:{...me({operationId:"ai.embedMany",telemetry:o}),...f,"ai.values":{input:()=>t.map(m=>JSON.stringify(m))}}}),tracer:p,fn:async m=>{var y;const[w,v]=await Promise.all([u.maxEmbeddingsPerCall,u.supportsParallelCalls]);if(w==null||w===1/0){const{embeddings:x,usage:R,response:O,providerMetadata:J}=await c(()=>fe({name:"ai.embedMany.doEmbed",attributes:G({telemetry:o,attributes:{...me({operationId:"ai.embedMany.doEmbed",telemetry:o}),...f,"ai.values":{input:()=>t.map(z=>JSON.stringify(z))}}}),tracer:p,fn:async z=>{var V;const j=await u.doEmbed({values:t,abortSignal:n,headers:d,providerOptions:i}),se=j.embeddings,te=(V=j.usage)!=null?V:{tokens:NaN};return z.setAttributes(G({telemetry:o,attributes:{"ai.embeddings":{output:()=>se.map(pe=>JSON.stringify(pe))},"ai.usage.tokens":te.tokens}})),{embeddings:se,usage:te,providerMetadata:j.providerMetadata,response:j.response}}}));return m.setAttributes(G({telemetry:o,attributes:{"ai.embeddings":{output:()=>x.map(z=>JSON.stringify(z))},"ai.usage.tokens":R.tokens}})),new Rr({values:t,embeddings:x,usage:R,providerMetadata:J,responses:[O]})}const S=Er(t,w),q=[],g=[];let P=0,C;const b=Er(S,v?a:1);for(const x of b){const R=await Promise.all(x.map(O=>c(()=>fe({name:"ai.embedMany.doEmbed",attributes:G({telemetry:o,attributes:{...me({operationId:"ai.embedMany.doEmbed",telemetry:o}),...f,"ai.values":{input:()=>O.map(J=>JSON.stringify(J))}}}),tracer:p,fn:async J=>{var z;const V=await u.doEmbed({values:O,abortSignal:n,headers:d,providerOptions:i}),j=V.embeddings,se=(z=V.usage)!=null?z:{tokens:NaN};return J.setAttributes(G({telemetry:o,attributes:{"ai.embeddings":{output:()=>j.map(te=>JSON.stringify(te))},"ai.usage.tokens":se.tokens}})),{embeddings:j,usage:se,providerMetadata:V.providerMetadata,response:V.response}}}))));for(const O of R)if(q.push(...O.embeddings),g.push(O.response),P+=O.usage.tokens,O.providerMetadata)if(!C)C={...O.providerMetadata};else for(const[J,z]of Object.entries(O.providerMetadata))C[J]={...(y=C[J])!=null?y:{},...z}}return m.setAttributes(G({telemetry:o,attributes:{"ai.embeddings":{output:()=>q.map(x=>JSON.stringify(x))},"ai.usage.tokens":P}})),new Rr({values:t,embeddings:q,usage:{tokens:P},providerMetadata:C,responses:g})}})}var Rr=class{constructor(e){this.values=e.values,this.embeddings=e.embeddings,this.usage=e.usage,this.providerMetadata=e.providerMetadata,this.responses=e.responses}};async function Xl({model:e,prompt:t,n:a=1,maxImagesPerCall:r,size:n,aspectRatio:s,seed:i,providerOptions:o,maxRetries:u,abortSignal:l,headers:c}){var d,f;const p=Ti(e),m=Re(c??{},`ai/${Oe}`),{retry:y}=Ve({maxRetries:u,abortSignal:l}),w=(d=r??await nl(p))!=null?d:1,v=Math.ceil(a/w),S=Array.from({length:v},(x,R)=>{if(R<v-1)return w;const O=a%w;return O===0?w:O}),q=await Promise.all(S.map(async x=>y(()=>p.doGenerate({prompt:t,n:x,abortSignal:l,headers:m,size:n,aspectRatio:s,seed:i,providerOptions:o??{}})))),g=[],P=[],C=[],b={};for(const x of q){if(g.push(...x.images.map(R=>{var O;return new aa({data:R,mediaType:(O=Xt({data:R,signatures:Js}))!=null?O:"image/png"})})),P.push(...x.warnings),x.providerMetadata)for(const[R,O]of Object.entries(x.providerMetadata))if(R==="gateway"){const J=b[R];J!=null&&typeof J=="object"?b[R]={...J,...O}:b[R]=O;const z=b[R].images;Array.isArray(z)&&z.length===0&&delete b[R].images}else(f=b[R])!=null||(b[R]={images:[]}),b[R].images.push(...x.providerMetadata[R].images);C.push(x.response)}if(Ze(P),!g.length)throw new oi({responses:C});return new sl({images:g,warnings:P,responses:C,providerMetadata:b})}var sl=class{constructor(e){this.images=e.images,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=e.providerMetadata}get image(){return this.images[0]}};async function nl(e){return e.maxImagesPerCall instanceof Function?e.maxImagesPerCall({modelId:e.modelId}):e.maxImagesPerCall}function ol(e){const t=e.filter(a=>a.type==="reasoning");return t.length===0?void 0:t.map(a=>a.text).join(`
`)}var il={type:"no-schema",jsonSchema:void 0,async validatePartialResult({value:e,textDelta:t}){return{success:!0,value:{partial:e,textDelta:t}}},async validateFinalResult(e,t){return e===void 0?{success:!1,error:new Xe({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e}},createElementStream(){throw new Ma({functionality:"element streams in no-schema mode"})}},ll=e=>({type:"object",jsonSchema:e.jsonSchema,async validatePartialResult({value:t,textDelta:a}){return{success:!0,value:{partial:t,textDelta:a}}},async validateFinalResult(t){return Je({value:t,schema:e})},createElementStream(){throw new Ma({functionality:"element streams in object mode"})}}),ul=e=>{const{$schema:t,...a}=e.jsonSchema;return{type:"array",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:a}},required:["elements"],additionalProperties:!1},async validatePartialResult({value:r,latestObject:n,isFirstDelta:s,isFinalDelta:i}){var o;if(!Gt(r)||!La(r.elements))return{success:!1,error:new Fe({value:r,cause:"value must be an object that contains an array of elements"})};const u=r.elements,l=[];for(let f=0;f<u.length;f++){const p=u[f],m=await Je({value:p,schema:e});if(!(f===u.length-1&&!i)){if(!m.success)return m;l.push(m.value)}}const c=(o=n?.length)!=null?o:0;let d="";return s&&(d+="["),c>0&&(d+=","),d+=l.slice(c).map(f=>JSON.stringify(f)).join(","),i&&(d+="]"),{success:!0,value:{partial:l,textDelta:d}}},async validateFinalResult(r){if(!Gt(r)||!La(r.elements))return{success:!1,error:new Fe({value:r,cause:"value must be an object that contains an array of elements"})};const n=r.elements;for(const s of n){const i=await Je({value:s,schema:e});if(!i.success)return i}return{success:!0,value:n}},createElementStream(r){let n=0;return Ge(r.pipeThrough(new TransformStream({transform(s,i){switch(s.type){case"object":{const o=s.object;for(;n<o.length;n++)i.enqueue(o[n]);break}case"text-delta":case"finish":case"error":break;default:{const o=s;throw new Error(`Unsupported chunk type: ${o}`)}}}})))}}},dl=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},async validateFinalResult(t){if(!Gt(t)||typeof t.result!="string")return{success:!1,error:new Fe({value:t,cause:'value must be an object that contains a string in the "result" property.'})};const a=t.result;return e.includes(a)?{success:!0,value:a}:{success:!1,error:new Fe({value:t,cause:"value must be a string in the enum"})}},async validatePartialResult({value:t,textDelta:a}){if(!Gt(t)||typeof t.result!="string")return{success:!1,error:new Fe({value:t,cause:'value must be an object that contains a string in the "result" property.'})};const r=t.result,n=e.filter(s=>s.startsWith(r));return t.result.length===0||n.length===0?{success:!1,error:new Fe({value:t,cause:"value must be a string in the enum"})}:{success:!0,value:{partial:n.length>1?r:n[0],textDelta:a}}},createElementStream(){throw new Ma({functionality:"element streams in enum mode"})}});function wn({output:e,schema:t,enumValues:a}){switch(e){case"object":return ll(ut(t));case"array":return ul(ut(t));case"enum":return dl(a);case"no-schema":return il;default:{const r=e;throw new Error(`Unsupported output: ${r}`)}}}async function Cr(e,t,a){const r=await lt({text:e});if(!r.success)throw new Xe({message:"No object generated: could not parse the response.",cause:r.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});const n=await t.validateFinalResult(r.value,{text:e,response:a.response,usage:a.usage});if(!n.success)throw new Xe({message:"No object generated: response did not match schema.",cause:n.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});return n.value}async function bn(e,t,a,r){try{return await Cr(e,t,r)}catch(n){if(a!=null&&Xe.isInstance(n)&&(Pn.isInstance(n.cause)||Fe.isInstance(n.cause))){const s=await a({text:e,error:n.cause});if(s===null)throw n;return await Cr(s,t,r)}throw n}}function Tn({output:e,schema:t,schemaName:a,schemaDescription:r,enumValues:n}){if(e!=null&&e!=="object"&&e!=="array"&&e!=="enum"&&e!=="no-schema")throw new K({parameter:"output",value:e,message:"Invalid output type."});if(e==="no-schema"){if(t!=null)throw new K({parameter:"schema",value:t,message:"Schema is not supported for no-schema output."});if(r!=null)throw new K({parameter:"schemaDescription",value:r,message:"Schema description is not supported for no-schema output."});if(a!=null)throw new K({parameter:"schemaName",value:a,message:"Schema name is not supported for no-schema output."});if(n!=null)throw new K({parameter:"enumValues",value:n,message:"Enum values are not supported for no-schema output."})}if(e==="object"){if(t==null)throw new K({parameter:"schema",value:t,message:"Schema is required for object output."});if(n!=null)throw new K({parameter:"enumValues",value:n,message:"Enum values are not supported for object output."})}if(e==="array"){if(t==null)throw new K({parameter:"schema",value:t,message:"Element schema is required for array output."});if(n!=null)throw new K({parameter:"enumValues",value:n,message:"Enum values are not supported for array output."})}if(e==="enum"){if(t!=null)throw new K({parameter:"schema",value:t,message:"Schema is not supported for enum output."});if(r!=null)throw new K({parameter:"schemaDescription",value:r,message:"Schema description is not supported for enum output."});if(a!=null)throw new K({parameter:"schemaName",value:a,message:"Schema name is not supported for enum output."});if(n==null)throw new K({parameter:"enumValues",value:n,message:"Enum values are required for enum output."});for(const s of n)if(typeof s!="string")throw new K({parameter:"enumValues",value:s,message:"Enum values must be strings."})}}var pl=Kt({prefix:"aiobj",size:24});async function Ql(e){const{model:t,output:a="object",system:r,prompt:n,messages:s,maxRetries:i,abortSignal:o,headers:u,experimental_repairText:l,experimental_telemetry:c,experimental_download:d,providerOptions:f,_internal:{generateId:p=pl,currentDate:m=()=>new Date}={},...y}=e,w=pt(t),v="enum"in e?e.enum:void 0,{schema:S,schemaDescription:q,schemaName:g}="schema"in e?e:{};Tn({output:a,schema:S,schemaName:g,schemaDescription:q,enumValues:v});const{maxRetries:P,retry:C}=Ve({maxRetries:i,abortSignal:o}),b=wn({output:a,schema:S,enumValues:v}),x=Qe(y),R=Re(u??{},`ai/${Oe}`),O=ct({model:w,telemetry:c,headers:R,settings:{...x,maxRetries:P}}),J=mt(c);try{return await fe({name:"ai.generateObject",attributes:G({telemetry:c,attributes:{...me({operationId:"ai.generateObject",telemetry:c}),...O,"ai.prompt":{input:()=>JSON.stringify({system:r,prompt:n,messages:s})},"ai.schema":b.jsonSchema!=null?{input:()=>JSON.stringify(b.jsonSchema)}:void 0,"ai.schema.name":g,"ai.schema.description":q,"ai.settings.output":b.type}}),tracer:J,fn:async z=>{var V;let j,se,te,pe,ge,Me,X,Ce;const ie=await Zt({system:r,prompt:n,messages:s}),ne=await Qt({prompt:ie,supportedUrls:await w.supportedUrls,download:d}),ae=await C(()=>fe({name:"ai.generateObject.doGenerate",attributes:G({telemetry:c,attributes:{...me({operationId:"ai.generateObject.doGenerate",telemetry:c}),...O,"ai.prompt.messages":{input:()=>ta(ne)},"gen_ai.system":w.provider,"gen_ai.request.model":w.modelId,"gen_ai.request.frequency_penalty":x.frequencyPenalty,"gen_ai.request.max_tokens":x.maxOutputTokens,"gen_ai.request.presence_penalty":x.presencePenalty,"gen_ai.request.temperature":x.temperature,"gen_ai.request.top_k":x.topK,"gen_ai.request.top_p":x.topP}}),tracer:J,fn:async Y=>{var he,ve,ye,B,ee,Te,W,k;const N=await w.doGenerate({responseFormat:{type:"json",schema:b.jsonSchema,name:g,description:q},...Qe(y),prompt:ne,providerOptions:f,abortSignal:o,headers:R}),E={id:(ve=(he=N.response)==null?void 0:he.id)!=null?ve:p(),timestamp:(B=(ye=N.response)==null?void 0:ye.timestamp)!=null?B:m(),modelId:(Te=(ee=N.response)==null?void 0:ee.modelId)!=null?Te:w.modelId,headers:(W=N.response)==null?void 0:W.headers,body:(k=N.response)==null?void 0:k.body},_=Ia(N.content),re=ol(N.content);if(_===void 0)throw new Xe({message:"No object generated: the model did not return a response.",response:E,usage:N.usage,finishReason:N.finishReason});return Y.setAttributes(G({telemetry:c,attributes:{"ai.response.finishReason":N.finishReason,"ai.response.object":{output:()=>_},"ai.response.id":E.id,"ai.response.model":E.modelId,"ai.response.timestamp":E.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(N.providerMetadata),"ai.usage.promptTokens":N.usage.inputTokens,"ai.usage.completionTokens":N.usage.outputTokens,"gen_ai.response.finish_reasons":[N.finishReason],"gen_ai.response.id":E.id,"gen_ai.response.model":E.modelId,"gen_ai.usage.input_tokens":N.usage.inputTokens,"gen_ai.usage.output_tokens":N.usage.outputTokens}})),{...N,objectText:_,reasoning:re,responseData:E}}}));j=ae.objectText,se=ae.finishReason,te=ae.usage,pe=ae.warnings,X=ae.providerMetadata,Me=(V=ae.request)!=null?V:{},ge=ae.responseData,Ce=ae.reasoning,Ze(pe);const ue=await bn(j,b,l,{response:ge,usage:te,finishReason:se});return z.setAttributes(G({telemetry:c,attributes:{"ai.response.finishReason":se,"ai.response.object":{output:()=>JSON.stringify(ue)},"ai.response.providerMetadata":JSON.stringify(X),"ai.usage.promptTokens":te.inputTokens,"ai.usage.completionTokens":te.outputTokens}})),new cl({object:ue,reasoning:Ce,finishReason:se,usage:te,warnings:pe,request:Me,response:ge,providerMetadata:X})}})}catch(z){throw ea(z)}}var cl=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.reasoning=e.reasoning}toJsonResponse(e){var t;return new Response(JSON.stringify(this.object),{status:(t=e?.status)!=null?t:200,headers:At(e?.headers,{"content-type":"application/json; charset=utf-8"})})}};function Zl(e,t){if(e.length!==t.length)throw new K({parameter:"vector1,vector2",value:{vector1Length:e.length,vector2Length:t.length},message:"Vectors must have the same length"});const a=e.length;if(a===0)return 0;let r=0,n=0,s=0;for(let i=0;i<a;i++){const o=e[i],u=t[i];r+=o*o,n+=u*u,s+=o*u}return r===0||n===0?0:s/(Math.sqrt(r)*Math.sqrt(n))}function eu(e){const[t,a]=e.split(",");if(t.split(";")[0].split(":")[1]==null||a==null)throw new Error("Invalid data URL format");try{return window.atob(a)}catch{throw new Error("Error decoding data URL")}}function Wt(e,t){if(e===t)return!0;if(e==null||t==null)return!1;if(typeof e!="object"&&typeof t!="object")return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Wt(e[n],t[n]))return!1;return!0}const a=Object.keys(e),r=Object.keys(t);if(a.length!==r.length)return!1;for(const n of a)if(!r.includes(n)||!Wt(e[n],t[n]))return!1;return!0}var ml=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(e){return new Promise((t,a)=>{this.queue.push(async()=>{try{await e(),t()}catch(r){a(r)}}),this.processQueue()})}};function tu({chunks:e,initialDelayInMs:t=0,chunkDelayInMs:a=0,_internal:r}){var n;const s=(n=r?.delay)!=null?n:Sa;let i=0;return new ReadableStream({async pull(o){i<e.length?(await s(i===0?t:a),o.enqueue(e[i++])):o.close()}})}var fl=Kt({prefix:"aiobj",size:24});function au(e){const{model:t,output:a="object",system:r,prompt:n,messages:s,maxRetries:i,abortSignal:o,headers:u,experimental_repairText:l,experimental_telemetry:c,experimental_download:d,providerOptions:f,onError:p=({error:x})=>{console.error(x)},onFinish:m,_internal:{generateId:y=fl,currentDate:w=()=>new Date,now:v=vn}={},...S}=e,q="enum"in e&&e.enum?e.enum:void 0,{schema:g,schemaDescription:P,schemaName:C}="schema"in e?e:{};Tn({output:a,schema:g,schemaName:C,schemaDescription:P,enumValues:q});const b=wn({output:a,schema:g,enumValues:q});return new gl({model:t,telemetry:c,headers:u,settings:S,maxRetries:i,abortSignal:o,outputStrategy:b,system:r,prompt:n,messages:s,schemaName:C,schemaDescription:P,providerOptions:f,repairText:l,onError:p,onFinish:m,download:d,generateId:y,currentDate:w,now:v})}var gl=class{constructor({model:e,headers:t,telemetry:a,settings:r,maxRetries:n,abortSignal:s,outputStrategy:i,system:o,prompt:u,messages:l,schemaName:c,schemaDescription:d,providerOptions:f,repairText:p,onError:m,onFinish:y,download:w,generateId:v,currentDate:S,now:q}){this._object=new Ne,this._usage=new Ne,this._providerMetadata=new Ne,this._warnings=new Ne,this._request=new Ne,this._response=new Ne,this._finishReason=new Ne;const g=pt(e),{maxRetries:P,retry:C}=Ve({maxRetries:n,abortSignal:s}),b=Qe(r),x=ct({model:g,telemetry:a,headers:t,settings:{...b,maxRetries:P}}),R=mt(a),O=this,J=hn(),z=new TransformStream({transform(V,j){j.enqueue(V),V.type==="error"&&m({error:ea(V.error)})}});this.baseStream=J.stream.pipeThrough(z),fe({name:"ai.streamObject",attributes:G({telemetry:a,attributes:{...me({operationId:"ai.streamObject",telemetry:a}),...x,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:u,messages:l})},"ai.schema":i.jsonSchema!=null?{input:()=>JSON.stringify(i.jsonSchema)}:void 0,"ai.schema.name":c,"ai.schema.description":d,"ai.settings.output":i.type}}),tracer:R,endWhenDone:!1,fn:async V=>{const j=await Zt({system:o,prompt:u,messages:l}),se={responseFormat:{type:"json",schema:i.jsonSchema,name:c,description:d},...Qe(r),prompt:await Qt({prompt:j,supportedUrls:await g.supportedUrls,download:w}),providerOptions:f,abortSignal:s,headers:t,includeRawChunks:!1},te={transform:(E,_)=>{switch(E.type){case"text-delta":_.enqueue(E.delta);break;case"response-metadata":case"finish":case"error":case"stream-start":_.enqueue(E);break}}},{result:{stream:pe,response:ge,request:Me},doStreamSpan:X,startTimestampMs:Ce}=await C(()=>fe({name:"ai.streamObject.doStream",attributes:G({telemetry:a,attributes:{...me({operationId:"ai.streamObject.doStream",telemetry:a}),...x,"ai.prompt.messages":{input:()=>ta(se.prompt)},"gen_ai.system":g.provider,"gen_ai.request.model":g.modelId,"gen_ai.request.frequency_penalty":b.frequencyPenalty,"gen_ai.request.max_tokens":b.maxOutputTokens,"gen_ai.request.presence_penalty":b.presencePenalty,"gen_ai.request.temperature":b.temperature,"gen_ai.request.top_k":b.topK,"gen_ai.request.top_p":b.topP}}),tracer:R,endWhenDone:!1,fn:async E=>({startTimestampMs:q(),doStreamSpan:E,result:await g.doStream(se)})}));O._request.resolve(Me??{});let ie,ne={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},ae,ue,Y,he,ve="",ye="",B={id:v(),timestamp:S(),modelId:g.modelId},ee,Te,W=!0,k=!0;const N=pe.pipeThrough(new TransformStream(te)).pipeThrough(new TransformStream({async transform(E,_){var re,Ie,T;if(typeof E=="object"&&E.type==="stream-start"){ie=E.warnings;return}if(W){const D=q()-Ce;W=!1,X.addEvent("ai.stream.firstChunk",{"ai.stream.msToFirstChunk":D}),X.setAttributes({"ai.stream.msToFirstChunk":D})}if(typeof E=="string"){ve+=E,ye+=E;const{value:D,state:Pe}=await Da(ve);if(D!==void 0&&!Wt(ee,D)){const F=await i.validatePartialResult({value:D,textDelta:ye,latestObject:Te,isFirstDelta:k,isFinalDelta:Pe==="successful-parse"});F.success&&!Wt(Te,F.value.partial)&&(ee=D,Te=F.value.partial,_.enqueue({type:"object",object:Te}),_.enqueue({type:"text-delta",textDelta:F.value.textDelta}),ye="",k=!1)}return}switch(E.type){case"response-metadata":{B={id:(re=E.id)!=null?re:B.id,timestamp:(Ie=E.timestamp)!=null?Ie:B.timestamp,modelId:(T=E.modelId)!=null?T:B.modelId};break}case"finish":{ye!==""&&_.enqueue({type:"text-delta",textDelta:ye}),ae=E.finishReason,ne=E.usage,ue=E.providerMetadata,_.enqueue({...E,usage:ne,response:B}),Ze(ie??[]),O._usage.resolve(ne),O._providerMetadata.resolve(ue),O._warnings.resolve(ie),O._response.resolve({...B,headers:ge?.headers}),O._finishReason.resolve(ae??"unknown");try{Y=await bn(ve,i,p,{response:B,usage:ne,finishReason:ae}),O._object.resolve(Y)}catch(D){he=D,O._object.reject(D)}break}default:{_.enqueue(E);break}}},async flush(E){try{const _=ne??{promptTokens:NaN,completionTokens:NaN,totalTokens:NaN};X.setAttributes(G({telemetry:a,attributes:{"ai.response.finishReason":ae,"ai.response.object":{output:()=>JSON.stringify(Y)},"ai.response.id":B.id,"ai.response.model":B.modelId,"ai.response.timestamp":B.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(ue),"ai.usage.inputTokens":_.inputTokens,"ai.usage.outputTokens":_.outputTokens,"ai.usage.totalTokens":_.totalTokens,"ai.usage.reasoningTokens":_.reasoningTokens,"ai.usage.cachedInputTokens":_.cachedInputTokens,"gen_ai.response.finish_reasons":[ae],"gen_ai.response.id":B.id,"gen_ai.response.model":B.modelId,"gen_ai.usage.input_tokens":_.inputTokens,"gen_ai.usage.output_tokens":_.outputTokens}})),X.end(),V.setAttributes(G({telemetry:a,attributes:{"ai.usage.inputTokens":_.inputTokens,"ai.usage.outputTokens":_.outputTokens,"ai.usage.totalTokens":_.totalTokens,"ai.usage.reasoningTokens":_.reasoningTokens,"ai.usage.cachedInputTokens":_.cachedInputTokens,"ai.response.object":{output:()=>JSON.stringify(Y)},"ai.response.providerMetadata":JSON.stringify(ue)}})),await y?.({usage:_,object:Y,error:he,response:{...B,headers:ge?.headers},warnings:ie,providerMetadata:ue})}catch(_){E.enqueue({type:"error",error:_})}finally{V.end()}}}));J.addStream(N)}}).catch(V=>{J.addStream(new ReadableStream({start(j){j.enqueue({type:"error",error:V}),j.close()}}))}).finally(()=>{J.close()}),this.outputStrategy=i}get object(){return this._object.promise}get usage(){return this._usage.promise}get providerMetadata(){return this._providerMetadata.promise}get warnings(){return this._warnings.promise}get request(){return this._request.promise}get response(){return this._response.promise}get finishReason(){return this._finishReason.promise}get partialObjectStream(){return Ge(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case"object":t.enqueue(e.object);break;case"text-delta":case"finish":case"error":break;default:{const a=e;throw new Error(`Unsupported chunk type: ${a}`)}}}})))}get elementStream(){return this.outputStrategy.createElementStream(this.baseStream)}get textStream(){return Ge(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case"text-delta":t.enqueue(e.textDelta);break;case"object":case"finish":case"error":break;default:{const a=e;throw new Error(`Unsupported chunk type: ${a}`)}}}})))}get fullStream(){return Ge(this.baseStream)}pipeTextStreamToResponse(e,t){pn({response:e,textStream:this.textStream,...t})}toTextStreamResponse(e){return un({textStream:this.textStream,...e})}},hl=class extends aa{constructor({data:e,mediaType:t}){super({data:e,mediaType:t});let a="mp3";if(t){const r=t.split("/");r.length===2&&t!=="audio/mpeg"&&(a=r[1])}if(!a)throw new Error("Audio format must be provided or determinable from media type");this.format=a}};async function ru({model:e,text:t,voice:a,outputFormat:r,instructions:n,speed:s,language:i,providerOptions:o={},maxRetries:u,abortSignal:l,headers:c}){var d;if(e.specificationVersion!=="v2")throw new Ct({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});const f=Re(c??{},`ai/${Oe}`),{retry:p}=Ve({maxRetries:u,abortSignal:l}),m=await p(()=>e.doGenerate({text:t,voice:a,outputFormat:r,instructions:n,speed:s,language:i,abortSignal:l,headers:f,providerOptions:o}));if(!m.audio||m.audio.length===0)throw new di({responses:[m.response]});return Ze(m.warnings),new vl({audio:new hl({data:m.audio,mediaType:(d=Xt({data:m.audio,signatures:Vs}))!=null?d:"audio/mp3"}),warnings:m.warnings,responses:[m.response],providerMetadata:m.providerMetadata})}var vl=class{constructor(e){var t;this.audio=e.audio,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=(t=e.providerMetadata)!=null?t:{}}},yl={};Qo(yl,{object:()=>bl,text:()=>wl});var wl=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:e}){return{partial:e}},async parseOutput({text:e}){return e}}),bl=({schema:e})=>{const t=ut(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial({text:a}){const r=await Da(a);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{const n=r.state;throw new Error(`Unsupported parse state: ${n}`)}}},async parseOutput({text:a},r){const n=await lt({text:a});if(!n.success)throw new Xe({message:"No object generated: could not parse the response.",cause:n.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});const s=await Je({value:n.value,schema:t});if(!s.success)throw new Xe({message:"No object generated: response did not match schema.",cause:s.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});return s.value}}};function su({messages:e,reasoning:t="none",toolCalls:a=[],emptyMessages:r="remove"}){(t==="all"||t==="before-last-message")&&(e=e.map((n,s)=>n.role!=="assistant"||typeof n.content=="string"||t==="before-last-message"&&s===e.length-1?n:{...n,content:n.content.filter(i=>i.type!=="reasoning")})),a==="none"?a=[]:a==="all"?a=[{type:"all"}]:a==="before-last-message"?a=[{type:"before-last-message"}]:typeof a=="string"&&(a=[{type:a}]);for(const n of a){const s=n.type==="all"?void 0:n.type==="before-last-message"?1:Number(n.type.slice(12).slice(0,-9)),i=new Set;if(s!=null){for(const o of e.slice(-s))if((o.role==="assistant"||o.role==="tool")&&typeof o.content!="string")for(const u of o.content)(u.type==="tool-call"||u.type==="tool-result")&&i.add(u.toolCallId)}e=e.map((o,u)=>{if(o.role!=="assistant"&&o.role!=="tool"||typeof o.content=="string"||s&&u>=e.length-s)return o;const l={};return{...o,content:o.content.filter(c=>c.type!=="tool-call"&&c.type!=="tool-result"||(c.type==="tool-call"&&(l[c.toolCallId]=c.toolName),(c.type==="tool-call"||c.type==="tool-result")&&i.has(c.toolCallId))?!0:n.tools!=null&&!n.tools.includes(c.toolName))}})}return r==="remove"&&(e=e.filter(n=>n.content.length>0)),e}var Tl={word:/\S+\s+/m,line:/\n+/m};function nu({delayInMs:e=10,chunking:t="word",_internal:{delay:a=Sa}={}}={}){let r;if(typeof t=="function")r=n=>{const s=t(n);if(s==null)return null;if(!s.length)throw new Error("Chunking function must return a non-empty string.");if(!n.startsWith(s))throw new Error(`Chunking function must return a match that is a prefix of the buffer. Received: "${s}" expected to start with "${n}"`);return s};else{const n=typeof t=="string"?Tl[t]:t;if(n==null)throw new Nn({argument:"chunking",message:`Chunking must be "word" or "line" or a RegExp. Received: ${t}`});r=s=>{const i=n.exec(s);return i?s.slice(0,i.index)+i?.[0]:null}}return()=>{let n="",s="";return new TransformStream({async transform(i,o){if(i.type!=="text-delta"){n.length>0&&(o.enqueue({type:"text-delta",text:n,id:s}),n=""),o.enqueue(i);return}i.id!==s&&n.length>0&&(o.enqueue({type:"text-delta",text:n,id:s}),n=""),n+=i.text,s=i.id;let u;for(;(u=r(n))!=null;)o.enqueue({type:"text-delta",text:u,id:s}),n=n.slice(u.length),await a(e)}})}}function ou({settings:e}){return{middlewareVersion:"v2",transformParams:async({params:t})=>ka(e,t)}}function Il(e,t){if(t.length===0)return null;const a=e.indexOf(t);if(a!==-1)return a;for(let r=e.length-1;r>=0;r--){const n=e.substring(r);if(t.startsWith(n))return r}return null}function iu({tagName:e,separator:t=`
`,startWithReasoning:a=!1}){const r=`<${e}>`,n=`</${e}>`;return{middlewareVersion:"v2",wrapGenerate:async({doGenerate:s})=>{const{content:i,...o}=await s(),u=[];for(const l of i){if(l.type!=="text"){u.push(l);continue}const c=a?r+l.text:l.text,d=new RegExp(`${r}(.*?)${n}`,"gs"),f=Array.from(c.matchAll(d));if(!f.length){u.push(l);continue}const p=f.map(y=>y[1]).join(t);let m=c;for(let y=f.length-1;y>=0;y--){const w=f[y],v=m.slice(0,w.index),S=m.slice(w.index+w[0].length);m=v+(v.length>0&&S.length>0?t:"")+S}u.push({type:"reasoning",text:p}),u.push({type:"text",text:m})}return{content:u,...o}},wrapStream:async({doStream:s})=>{const{stream:i,...o}=await s(),u={};let l;return{stream:i.pipeThrough(new TransformStream({transform:(c,d)=>{if(c.type==="text-start"){l=c;return}if(c.type==="text-end"&&l&&(d.enqueue(l),l=void 0),c.type!=="text-delta"){d.enqueue(c);return}u[c.id]==null&&(u[c.id]={isFirstReasoning:!0,isFirstText:!0,afterSwitch:!1,isReasoning:a,buffer:"",idCounter:0,textId:c.id});const f=u[c.id];f.buffer+=c.delta;function p(m){if(m.length>0){const y=f.afterSwitch&&(f.isReasoning?!f.isFirstReasoning:!f.isFirstText)?t:"";f.isReasoning&&(f.afterSwitch||f.isFirstReasoning)&&d.enqueue({type:"reasoning-start",id:`reasoning-${f.idCounter}`}),f.isReasoning?d.enqueue({type:"reasoning-delta",delta:y+m,id:`reasoning-${f.idCounter}`}):(l&&(d.enqueue(l),l=void 0),d.enqueue({type:"text-delta",delta:y+m,id:f.textId})),f.afterSwitch=!1,f.isReasoning?f.isFirstReasoning=!1:f.isFirstText=!1}}do{const m=f.isReasoning?n:r,y=Il(f.buffer,m);if(y==null){p(f.buffer),f.buffer="";break}if(p(f.buffer.slice(0,y)),y+m.length<=f.buffer.length)f.buffer=f.buffer.slice(y+m.length),f.isReasoning&&d.enqueue({type:"reasoning-end",id:`reasoning-${f.idCounter++}`}),f.isReasoning=!f.isReasoning,f.afterSwitch=!0;else{f.buffer=f.buffer.slice(y);break}}while(!0)}})),...o}}}}function lu(){return{middlewareVersion:"v2",wrapStream:async({doGenerate:e})=>{const t=await e();let a=0;return{stream:new ReadableStream({start(n){n.enqueue({type:"stream-start",warnings:t.warnings}),n.enqueue({type:"response-metadata",...t.response});for(const s of t.content)switch(s.type){case"text":{s.text.length>0&&(n.enqueue({type:"text-start",id:String(a)}),n.enqueue({type:"text-delta",id:String(a),delta:s.text}),n.enqueue({type:"text-end",id:String(a)}),a++);break}case"reasoning":{n.enqueue({type:"reasoning-start",id:String(a),providerMetadata:s.providerMetadata}),n.enqueue({type:"reasoning-delta",id:String(a),delta:s.text}),n.enqueue({type:"reasoning-end",id:String(a)}),a++;break}default:{n.enqueue(s);break}}n.enqueue({type:"finish",finishReason:t.finishReason,usage:t.usage,providerMetadata:t.providerMetadata}),n.close()}}),request:t.request,response:t.response}}}}var In=({model:e,middleware:t,modelId:a,providerId:r})=>[...Bt(t)].reverse().reduce((n,s)=>xl({model:n,middleware:s,modelId:a,providerId:r}),e),xl=({model:e,middleware:{transformParams:t,wrapGenerate:a,wrapStream:r,overrideProvider:n,overrideModelId:s,overrideSupportedUrls:i},modelId:o,providerId:u})=>{var l,c,d;async function f({params:p,type:m}){return t?await t({params:p,type:m,model:e}):p}return{specificationVersion:"v2",provider:(l=u??n?.({model:e}))!=null?l:e.provider,modelId:(c=o??s?.({model:e}))!=null?c:e.modelId,supportedUrls:(d=i?.({model:e}))!=null?d:e.supportedUrls,async doGenerate(p){const m=await f({params:p,type:"generate"}),y=async()=>e.doGenerate(m);return a?a({doGenerate:y,doStream:async()=>e.doStream(m),params:m,model:e}):y()},async doStream(p){const m=await f({params:p,type:"stream"}),y=async()=>e.doGenerate(m),w=async()=>e.doStream(m);return r?r({doGenerate:y,doStream:w,params:m,model:e}):w()}}};function uu({provider:e,languageModelMiddleware:t}){return{languageModel(r){let n=e.languageModel(r);return n=In({model:n,middleware:t}),n},textEmbeddingModel:e.textEmbeddingModel,imageModel:e.imageModel,transcriptionModel:e.transcriptionModel,speechModel:e.speechModel}}function _l({languageModels:e,textEmbeddingModels:t,imageModels:a,transcriptionModels:r,speechModels:n,fallbackProvider:s}){return{languageModel(i){if(e!=null&&i in e)return e[i];if(s)return s.languageModel(i);throw new Ee({modelId:i,modelType:"languageModel"})},textEmbeddingModel(i){if(t!=null&&i in t)return t[i];if(s)return s.textEmbeddingModel(i);throw new Ee({modelId:i,modelType:"textEmbeddingModel"})},imageModel(i){if(a!=null&&i in a)return a[i];if(s?.imageModel)return s.imageModel(i);throw new Ee({modelId:i,modelType:"imageModel"})},transcriptionModel(i){if(r!=null&&i in r)return r[i];if(s?.transcriptionModel)return s.transcriptionModel(i);throw new Ee({modelId:i,modelType:"transcriptionModel"})},speechModel(i){if(n!=null&&i in n)return n[i];if(s?.speechModel)return s.speechModel(i);throw new Ee({modelId:i,modelType:"speechModel"})}}}var du=_l,xn="AI_NoSuchProviderError",_n=`vercel.ai.error.${xn}`,Sl=Symbol.for(_n),Sn,Ml=class extends Ee{constructor({modelId:e,modelType:t,providerId:a,availableProviders:r,message:n=`No such provider: ${a} (available providers: ${r.join()})`}){super({errorName:xn,modelId:e,modelType:t,message:n}),this[Sn]=!0,this.providerId=a,this.availableProviders=r}static isInstance(e){return U.hasMarker(e,_n)}};Sn=Sl;function El(e,{separator:t=":",languageModelMiddleware:a}={}){const r=new Rl({separator:t,languageModelMiddleware:a});for(const[n,s]of Object.entries(e))r.registerProvider({id:n,provider:s});return r}var pu=El,Rl=class{constructor({separator:e,languageModelMiddleware:t}){this.providers={},this.separator=e,this.languageModelMiddleware=t}registerProvider({id:e,provider:t}){this.providers[e]=t}getProvider(e,t){const a=this.providers[e];if(a==null)throw new Ml({modelId:e,modelType:t,providerId:e,availableProviders:Object.keys(this.providers)});return a}splitId(e,t){const a=e.indexOf(this.separator);if(a===-1)throw new Ee({modelId:e,modelType:t,message:`Invalid ${t} id for registry: ${e} (must be in the format "providerId${this.separator}modelId")`});return[e.slice(0,a),e.slice(a+this.separator.length)]}languageModel(e){var t,a;const[r,n]=this.splitId(e,"languageModel");let s=(a=(t=this.getProvider(r,"languageModel")).languageModel)==null?void 0:a.call(t,n);if(s==null)throw new Ee({modelId:e,modelType:"languageModel"});return this.languageModelMiddleware!=null&&(s=In({model:s,middleware:this.languageModelMiddleware})),s}textEmbeddingModel(e){var t;const[a,r]=this.splitId(e,"textEmbeddingModel"),n=this.getProvider(a,"textEmbeddingModel"),s=(t=n.textEmbeddingModel)==null?void 0:t.call(n,r);if(s==null)throw new Ee({modelId:e,modelType:"textEmbeddingModel"});return s}imageModel(e){var t;const[a,r]=this.splitId(e,"imageModel"),n=this.getProvider(a,"imageModel"),s=(t=n.imageModel)==null?void 0:t.call(n,r);if(s==null)throw new Ee({modelId:e,modelType:"imageModel"});return s}transcriptionModel(e){var t;const[a,r]=this.splitId(e,"transcriptionModel"),n=this.getProvider(a,"transcriptionModel"),s=(t=n.transcriptionModel)==null?void 0:t.call(n,r);if(s==null)throw new Ee({modelId:e,modelType:"transcriptionModel"});return s}speechModel(e){var t;const[a,r]=this.splitId(e,"speechModel"),n=this.getProvider(a,"speechModel"),s=(t=n.speechModel)==null?void 0:t.call(n,r);if(s==null)throw new Ee({modelId:e,modelType:"speechModel"});return s}},Cl=class extends U{constructor(e){super({name:"AI_NoTranscriptGeneratedError",message:"No transcript generated."}),this.responses=e.responses}};async function cu({model:e,audio:t,providerOptions:a={},maxRetries:r,abortSignal:n,headers:s}){if(e.specificationVersion!=="v2")throw new Ct({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});const{retry:i}=Ve({maxRetries:r,abortSignal:n}),o=Re(s??{},`ai/${Oe}`),u=t instanceof URL?(await Bs({url:t})).data:Ei(t),l=await i(()=>{var c;return e.doGenerate({audio:u,abortSignal:n,headers:o,providerOptions:a,mediaType:(c=Xt({data:u,signatures:Vs}))!=null?c:"audio/wav"})});if(Ze(l.warnings),!l.text)throw new Cl({responses:[l.response]});return new Al({text:l.text,segments:l.segments,language:l.language,durationInSeconds:l.durationInSeconds,warnings:l.warnings,responses:[l.response],providerMetadata:l.providerMetadata})}var Al=class{constructor(e){var t;this.text=e.text,this.segments=e.segments,this.language=e.language,this.durationInSeconds=e.durationInSeconds,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=(t=e.providerMetadata)!=null?t:{}}};async function Nl({stream:e,onTextPart:t}){const a=e.pipeThrough(new TextDecoderStream).getReader();for(;;){const{done:r,value:n}=await a.read();if(r)break;await t(n)}}var Ol=()=>fetch;async function mu({api:e,prompt:t,credentials:a,headers:r,body:n,streamProtocol:s="data",setCompletion:i,setLoading:o,setError:u,setAbortController:l,onFinish:c,onError:d,fetch:f=Ol()}){var p;try{o(!0),u(void 0);const m=new AbortController;l(m),i("");const y=await f(e,{method:"POST",body:JSON.stringify({prompt:t,...n}),credentials:a,headers:Re({"Content-Type":"application/json",...r},`ai-sdk/${Oe}`,jt()),signal:m.signal}).catch(v=>{throw v});if(!y.ok)throw new Error((p=await y.text())!=null?p:"Failed to fetch the chat response.");if(!y.body)throw new Error("The response body is empty.");let w="";switch(s){case"text":{await Nl({stream:y.body,onTextPart:v=>{w+=v,i(w)}});break}case"data":{await ra({stream:Nr({stream:y.body,schema:fn}).pipeThrough(new TransformStream({async transform(v){if(!v.success)throw v.error;const S=v.value;if(S.type==="text-delta")w+=S.delta,i(w);else if(S.type==="error")throw new Error(S.errorText)}})),onError:v=>{throw v}});break}default:{const v=s;throw new Error(`Unknown stream protocol: ${v}`)}}return c&&c(t,w),l(null),w}catch(m){if(m.name==="AbortError")return l(null),null;m instanceof Error&&d&&d(m),u(m)}finally{o(!1)}}async function Pl(e){if(e==null)return[];if(!globalThis.FileList||!(e instanceof globalThis.FileList))throw new Error("FileList is not supported in the current environment");return Promise.all(Array.from(e).map(async t=>{const{name:a,type:r}=t,n=await new Promise((s,i)=>{const o=new FileReader;o.onload=u=>{var l;s((l=u.target)==null?void 0:l.result)},o.onerror=u=>i(u),o.readAsDataURL(t)});return{type:"file",mediaType:r,filename:a,url:n}}))}var Mn=class{constructor({api:e="/api/chat",credentials:t,headers:a,body:r,fetch:n,prepareSendMessagesRequest:s,prepareReconnectToStreamRequest:i}){this.api=e,this.credentials=t,this.headers=a,this.body=r,this.fetch=n,this.prepareSendMessagesRequest=s,this.prepareReconnectToStreamRequest=i}async sendMessages({abortSignal:e,...t}){var a,r,n,s,i;const o=await de(this.body),u=await de(this.headers),l=await de(this.credentials),c={...rt(u),...rt(t.headers)},d=await((a=this.prepareSendMessagesRequest)==null?void 0:a.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...o,...t.body},headers:c,credentials:l,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),f=(r=d?.api)!=null?r:this.api,p=d?.headers!==void 0?rt(d.headers):c,m=d?.body!==void 0?d.body:{...o,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},y=(n=d?.credentials)!=null?n:l,v=await((s=this.fetch)!=null?s:globalThis.fetch)(f,{method:"POST",headers:Re({"Content-Type":"application/json",...p},`ai-sdk/${Oe}`,jt()),body:JSON.stringify(m),credentials:y,signal:e});if(!v.ok)throw new Error((i=await v.text())!=null?i:"Failed to fetch the chat response.");if(!v.body)throw new Error("The response body is empty.");return this.processResponseStream(v.body)}async reconnectToStream(e){var t,a,r,n,s;const i=await de(this.body),o=await de(this.headers),u=await de(this.credentials),l={...rt(o),...rt(e.headers)},c=await((t=this.prepareReconnectToStreamRequest)==null?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...i,...e.body},headers:l,credentials:u,requestMetadata:e.metadata})),d=(a=c?.api)!=null?a:`${this.api}/${e.chatId}/stream`,f=c?.headers!==void 0?rt(c.headers):l,p=(r=c?.credentials)!=null?r:u,y=await((n=this.fetch)!=null?n:globalThis.fetch)(d,{method:"GET",headers:Re(f,`ai-sdk/${Oe}`,jt()),credentials:p});if(y.status===204)return null;if(!y.ok)throw new Error((s=await y.text())!=null?s:"Failed to fetch the chat response.");if(!y.body)throw new Error("The response body is empty.");return this.processResponseStream(y.body)}},ql=class extends Mn{constructor(e={}){super(e)}processResponseStream(e){return Nr({stream:e,schema:fn}).pipeThrough(new TransformStream({async transform(t,a){if(!t.success)throw t.error;a.enqueue(t.value)}}))}},fu=class{constructor({generateId:e=_a,id:t=e(),transport:a=new ql,messageMetadataSchema:r,dataPartSchemas:n,state:s,onError:i,onToolCall:o,onFinish:u,onData:l,sendAutomaticallyWhen:c}){this.activeResponse=void 0,this.jobExecutor=new ml,this.sendMessage=async(d,f)=>{var p,m,y,w;if(d==null){await this.makeRequest({trigger:"submit-message",messageId:(p=this.lastMessage)==null?void 0:p.id,...f});return}let v;if("text"in d||"files"in d?v={parts:[...Array.isArray(d.files)?d.files:await Pl(d.files),..."text"in d&&d.text!=null?[{type:"text",text:d.text}]:[]]}:v=d,d.messageId!=null){const S=this.state.messages.findIndex(q=>q.id===d.messageId);if(S===-1)throw new Error(`message with id ${d.messageId} not found`);if(this.state.messages[S].role!=="user")throw new Error(`message with id ${d.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,S+1),this.state.replaceMessage(S,{...v,id:d.messageId,role:(m=v.role)!=null?m:"user",metadata:d.metadata})}else this.state.pushMessage({...v,id:(y=v.id)!=null?y:this.generateId(),role:(w=v.role)!=null?w:"user",metadata:d.metadata});await this.makeRequest({trigger:"submit-message",messageId:d.messageId,...f})},this.regenerate=async({messageId:d,...f}={})=>{const p=d==null?this.state.messages.length-1:this.state.messages.findIndex(m=>m.id===d);if(p===-1)throw new Error(`message ${d} not found`);this.state.messages=this.state.messages.slice(0,this.messages[p].role==="assistant"?p:p+1),await this.makeRequest({trigger:"regenerate-message",messageId:d,...f})},this.resumeStream=async(d={})=>{await this.makeRequest({trigger:"resume-stream",...d})},this.clearError=()=>{this.status==="error"&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolOutput=async({state:d="output-available",tool:f,toolCallId:p,output:m,errorText:y})=>this.jobExecutor.run(async()=>{var w,v;const S=this.state.messages,q=S[S.length-1];this.state.replaceMessage(S.length-1,{...q,parts:q.parts.map(g=>Rt(g)&&g.toolCallId===p?{...g,state:d,output:m,errorText:y}:g)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(g=>Rt(g)&&g.toolCallId===p?{...g,state:d,output:m,errorText:y}:g)),this.status!=="streaming"&&this.status!=="submitted"&&((w=this.sendAutomaticallyWhen)!=null&&w.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:(v=this.lastMessage)==null?void 0:v.id})}),this.addToolResult=this.addToolOutput,this.stop=async()=>{var d;this.status!=="streaming"&&this.status!=="submitted"||(d=this.activeResponse)!=null&&d.abortController&&this.activeResponse.abortController.abort()},this.id=t,this.transport=a,this.generateId=e,this.messageMetadataSchema=r,this.dataPartSchemas=n,this.state=s,this.onError=i,this.onToolCall=o,this.onFinish=u,this.onData=l,this.sendAutomaticallyWhen=c}get status(){return this.state.status}setStatus({status:e,error:t}){this.status!==e&&(this.state.status=e,this.state.error=t)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(e){this.state.messages=e}async makeRequest({trigger:e,metadata:t,headers:a,body:r,messageId:n}){var s,i,o,u;this.setStatus({status:"submitted",error:void 0});const l=this.lastMessage;let c=!1,d=!1,f=!1;try{const p={state:Ua({lastMessage:this.state.snapshot(l),messageId:this.generateId()}),abortController:new AbortController};p.abortController.signal.addEventListener("abort",()=>{c=!0}),this.activeResponse=p;let m;if(e==="resume-stream"){const w=await this.transport.reconnectToStream({chatId:this.id,metadata:t,headers:a,body:r});if(w==null){this.setStatus({status:"ready"});return}m=w}else m=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:p.abortController.signal,metadata:t,headers:a,body:r,trigger:e,messageId:n});const y=w=>this.jobExecutor.run(()=>w({state:p.state,write:()=>{var v;this.setStatus({status:"streaming"}),p.state.message.id===((v=this.lastMessage)==null?void 0:v.id)?this.state.replaceMessage(this.state.messages.length-1,p.state.message):this.state.pushMessage(p.state.message)}}));await ra({stream:ja({stream:m,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:y,onError:w=>{throw w}}),onError:w=>{throw w}}),this.setStatus({status:"ready"})}catch(p){if(c||p.name==="AbortError")return c=!0,this.setStatus({status:"ready"}),null;f=!0,p instanceof TypeError&&(p.message.toLowerCase().includes("fetch")||p.message.toLowerCase().includes("network"))&&(d=!0),this.onError&&p instanceof Error&&this.onError(p),this.setStatus({status:"error",error:p})}finally{try{(i=this.onFinish)==null||i.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:c,isDisconnect:d,isError:f,finishReason:(s=this.activeResponse)==null?void 0:s.state.finishReason})}catch(p){console.error(p)}this.activeResponse=void 0}(o=this.sendAutomaticallyWhen)!=null&&o.call(this,{messages:this.state.messages})&&!f&&await this.makeRequest({trigger:"submit-message",messageId:(u=this.lastMessage)==null?void 0:u.id,metadata:t,headers:a,body:r})}};function gu({messages:e}){const t=e[e.length-1];if(!t||t.role!=="assistant")return!1;const a=t.parts.reduce((n,s,i)=>s.type==="step-start"?i:n,-1),r=t.parts.slice(a+1).filter(Rt).filter(n=>!n.providerExecuted);return r.length>0&&r.every(n=>n.state==="output-available"||n.state==="output-error")}function kl({stream:e}){return e.pipeThrough(new TransformStream({start(t){t.enqueue({type:"start"}),t.enqueue({type:"start-step"}),t.enqueue({type:"text-start",id:"text-1"})},async transform(t,a){a.enqueue({type:"text-delta",id:"text-1",delta:t})},async flush(t){t.enqueue({type:"text-end",id:"text-1"}),t.enqueue({type:"finish-step"}),t.enqueue({type:"finish"})}}))}var hu=class extends Mn{constructor(e={}){super(e)}processResponseStream(e){return kl({stream:e.pipeThrough(new TextDecoderStream)})}},Dl=He(()=>Ye(we(M({id:h(),role:bt(["system","user","assistant"]),metadata:H().optional(),parts:we(be([M({type:I("text"),text:h(),state:bt(["streaming","done"]).optional(),providerMetadata:$.optional()}),M({type:I("reasoning"),text:h(),state:bt(["streaming","done"]).optional(),providerMetadata:$.optional()}),M({type:I("source-url"),sourceId:h(),url:h(),title:h().optional(),providerMetadata:$.optional()}),M({type:I("source-document"),sourceId:h(),mediaType:h(),title:h(),filename:h().optional(),providerMetadata:$.optional()}),M({type:I("file"),mediaType:h(),filename:h().optional(),url:h(),providerMetadata:$.optional()}),M({type:I("step-start")}),M({type:h().startsWith("data-"),id:h().optional(),data:H()}),M({type:I("dynamic-tool"),toolName:h(),toolCallId:h(),state:I("input-streaming"),input:H().optional(),providerExecuted:L().optional(),output:Z().optional(),errorText:Z().optional()}),M({type:I("dynamic-tool"),toolName:h(),toolCallId:h(),state:I("input-available"),input:H(),providerExecuted:L().optional(),output:Z().optional(),errorText:Z().optional(),callProviderMetadata:$.optional()}),M({type:I("dynamic-tool"),toolName:h(),toolCallId:h(),state:I("output-available"),input:H(),providerExecuted:L().optional(),output:H(),errorText:Z().optional(),callProviderMetadata:$.optional(),preliminary:L().optional()}),M({type:I("dynamic-tool"),toolName:h(),toolCallId:h(),state:I("output-error"),input:H(),providerExecuted:L().optional(),output:Z().optional(),errorText:h(),callProviderMetadata:$.optional()}),M({type:h().startsWith("tool-"),toolCallId:h(),state:I("input-streaming"),providerExecuted:L().optional(),input:H().optional(),output:Z().optional(),errorText:Z().optional(),approval:Z().optional()}),M({type:h().startsWith("tool-"),toolCallId:h(),state:I("input-available"),providerExecuted:L().optional(),input:H(),output:Z().optional(),errorText:Z().optional(),callProviderMetadata:$.optional(),approval:Z().optional()}),M({type:h().startsWith("tool-"),toolCallId:h(),state:I("approval-requested"),input:H(),providerExecuted:L().optional(),output:Z().optional(),errorText:Z().optional(),callProviderMetadata:$.optional(),approval:M({id:h(),approved:Z().optional(),reason:Z().optional()})}),M({type:h().startsWith("tool-"),toolCallId:h(),state:I("approval-responded"),input:H(),providerExecuted:L().optional(),output:Z().optional(),errorText:Z().optional(),callProviderMetadata:$.optional(),approval:M({id:h(),approved:L(),reason:h().optional()})}),M({type:h().startsWith("tool-"),toolCallId:h(),state:I("output-available"),providerExecuted:L().optional(),input:H(),output:H(),errorText:Z().optional(),callProviderMetadata:$.optional(),preliminary:L().optional(),approval:M({id:h(),approved:I(!0),reason:h().optional()}).optional()}),M({type:h().startsWith("tool-"),toolCallId:h(),state:I("output-error"),providerExecuted:L().optional(),input:H(),output:Z().optional(),errorText:h(),callProviderMetadata:$.optional(),approval:M({id:h(),approved:I(!0),reason:h().optional()}).optional()}),M({type:h().startsWith("tool-"),toolCallId:h(),state:I("output-denied"),providerExecuted:L().optional(),input:H(),output:Z().optional(),errorText:Z().optional(),callProviderMetadata:$.optional(),approval:M({id:h(),approved:I(!1),reason:h().optional()})})])).nonempty("Message must contain at least one part")})).nonempty("Messages array must not be empty")));async function $l({messages:e,metadataSchema:t,dataSchemas:a,tools:r}){try{if(e==null)return{success:!1,error:new K({parameter:"messages",value:e,message:"messages parameter must be provided"})};const n=await Ke({value:e,schema:Dl});if(t)for(const s of n)await Ke({value:s.metadata,schema:t});if(a)for(const s of n){const i=s.parts.filter(o=>o.type.startsWith("data-"));for(const o of i){const u=o.type.slice(5),l=a[u];if(!l)return{success:!1,error:new Fe({value:o.data,cause:`No data schema found for data part ${u}`})};await Ke({value:o.data,schema:l})}}if(r)for(const s of n){const i=s.parts.filter(o=>o.type.startsWith("tool-"));for(const o of i){const u=o.type.slice(5),l=r[u];if(!l)return{success:!1,error:new Fe({value:o.input,cause:`No tool schema found for tool part ${u}`})};(o.state==="input-available"||o.state==="output-available"||o.state==="output-error")&&await Ke({value:o.input,schema:l.inputSchema}),o.state==="output-available"&&l.outputSchema&&await Ke({value:o.output,schema:l.outputSchema})}}return{success:!0,data:n}}catch(n){return{success:!1,error:n}}}async function vu({messages:e,metadataSchema:t,dataSchemas:a,tools:r}){const n=await $l({messages:e,metadataSchema:t,dataSchemas:a,tools:r});if(!n.success)throw n.error;return n.data}function yu({execute:e,onError:t=Yt,originalMessages:a,onFinish:r,generateId:n=_a}){let s;const i=[],o=new ReadableStream({start(c){s=c}});function u(c){try{s.enqueue(c)}catch{}}try{const c=e({writer:{write(d){u(d)},merge(d){i.push((async()=>{const f=d.getReader();for(;;){const{done:p,value:m}=await f.read();if(p)break;u(m)}})().catch(f=>{u({type:"error",errorText:t(f)})}))},onError:t}});c&&i.push(c.catch(d=>{u({type:"error",errorText:t(d)})}))}catch(c){u({type:"error",errorText:t(c)})}return new Promise(async c=>{for(;i.length>0;)await i.shift();c()}).finally(()=>{try{s.close()}catch{}}),gn({stream:o,messageId:n(),originalMessages:a,onFinish:r,onError:t})}function wu({message:e,stream:t,onError:a,terminateOnError:r=!1}){var n;let s,i=!1;const o=new ReadableStream({start(c){s=c}}),u=Ua({messageId:(n=e?.id)!=null?n:"",lastMessage:e}),l=c=>{a?.(c),!i&&r&&(i=!0,s?.error(c))};return ra({stream:ja({stream:t,runUpdateMessageJob(c){return c({state:u,write:()=>{s?.enqueue(structuredClone(u.message))}})},onError:l}),onError:l}).finally(()=>{i||s?.close()}),Ge(o)}export{U as AISDKError,Ar as APICallError,fu as AbstractChat,ql as DefaultChatTransport,ga as DownloadError,Iu as EmptyResponseBodyError,Yl as Experimental_Agent,Mn as HttpChatTransport,K as InvalidArgumentError,br as InvalidDataContentError,hi as InvalidMessageRoleError,st as InvalidPromptError,xu as InvalidResponseDataError,Fl as InvalidStreamPartError,ds as InvalidToolInputError,Pn as JSONParseError,cn as JsonToSseTransformStream,_u as LoadAPIKeyError,Su as LoadSettingError,yi as MessageConversionError,Mu as NoContentGeneratedError,oi as NoImageGeneratedError,Xe as NoObjectGeneratedError,ui as NoOutputGeneratedError,es as NoOutputSpecifiedError,di as NoSpeechGeneratedError,Ee as NoSuchModelError,Ml as NoSuchProviderError,Ta as NoSuchToolError,yl as Output,Tr as RetryError,ml as SerialJobExecutor,hu as TextStreamChatTransport,Eu as TooManyEmbeddingValuesForCallError,mi as ToolCallRepairError,Fe as TypeValidationError,mn as UI_MESSAGE_STREAM_HEADERS,Ma as UnsupportedFunctionalityError,Ct as UnsupportedModelVersionError,ut as asSchema,Zs as assistantModelMessageSchema,mu as callCompletionApi,ra as consumeStream,Pl as convertFileListToFileUIParts,Hl as convertToCoreMessages,yn as convertToModelMessages,Vl as coreAssistantMessageSchema,Ll as coreMessageSchema,Gl as coreSystemMessageSchema,Bl as coreToolMessageSchema,Jl as coreUserMessageSchema,Zl as cosineSimilarity,co as createGateway,Kt as createIdGenerator,El as createProviderRegistry,un as createTextStreamResponse,yu as createUIMessageStream,Wi as createUIMessageStreamResponse,_l as customProvider,ou as defaultSettingsMiddleware,Ru as dynamicTool,Kl as embed,zl as embedMany,pu as experimental_createProviderRegistry,du as experimental_customProvider,Xl as experimental_generateImage,ru as experimental_generateSpeech,cu as experimental_transcribe,iu as extractReasoningMiddleware,mo as gateway,_a as generateId,Ql as generateObject,Ji as generateText,eu as getTextFromDataUrl,Lt as getToolName,zi as getToolOrDynamicToolName,Wl as hasToolCall,ha as isDataUIPart,Wt as isDeepEqualData,ya as isFileUIPart,Sr as isReasoningUIPart,va as isTextUIPart,Rt as isToolOrDynamicToolUIPart,nt as isToolUIPart,Cu as jsonSchema,gu as lastAssistantMessageIsCompleteWithToolCalls,tn as modelMessageSchema,Nr as parseJsonEventStream,Da as parsePartialJson,pn as pipeTextStreamToResponse,Xi as pipeUIMessageStreamToResponse,su as pruneMessages,wu as readUIMessageStream,$l as safeValidateUIMessages,tu as simulateReadableStream,lu as simulateStreamingMiddleware,nu as smoothStream,on as stepCountIs,au as streamObject,el as streamText,Xs as systemModelMessageSchema,Au as tool,en as toolModelMessageSchema,fn as uiMessageChunkSchema,Qs as userModelMessageSchema,vu as validateUIMessages,In as wrapLanguageModel,uu as wrapProvider,Ye as zodSchema};
