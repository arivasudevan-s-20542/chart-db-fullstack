import{r as f,v as zs,p as Vd,R as S,j as i,E as ps,F as Gd,G as vn,T as xe,c as ge,e as ve,d as P,I as gi,J as Kd,K as zd,M as Xd,N as Wd,O as qd,P as Hd,Q as Yd,D as le,S as Vo,U as Go,V as Qd,W as Jd,X as $a,Y as Zd,$ as Ko,a0 as zo,a1 as eu,a2 as Pt,u as tu}from"./index-DY4lwpwP.js";import{D as sn,a as an,c as rn,d as $n,e as wt,j as It,f as Je,u as nu,k as Ys,S as Ls,l as ks,m as As,n as Ss,o as je,p as ma,q as mn,r as bn,P as Jt,s as xn,t as Es,v as vi,w as su,x as au,y as ru,z as iu,B as Ni,E as ou,F as lu,G as cu,H as du,I as Ei,J as Xo,K as Wo,T as uu,L as hu,M as yi,N as _i,O as fu,Q as pu,V as mu}from"./editor-page-DBwrEL6D.js";import{B as K,L as Ye,S as Vn,b as dr,l as bu}from"./label-BRUqhX6x.js";import{I as Ne}from"./input-BPPsHut0.js";import{_ as xu,h as gu,e as H,i as ba,g as Gn,G as xa,F as ur,j as vt,k as Kn,l as qo,m as Ho,E as Yo,n as Qo,S as Zt,o as sa,u as Ve,p as vu,q as Dr,r as Nu,s as Jo,V as Eu,t as Ds,X as wn,v as Qt,w as hr,x as yu,y as ga,z as Rr,A as _u,B as Tu,b as wu,P as Iu,c as Zo,H as Cu,I as ju,T as el,D as tl,O as nl,J as Lu,K as ku,L as Au,M as Su,N as Du,Q as Ru,U as Mu,W as sl,Y as Ou,Z as Pu,$ as Fu,a0 as Uu,a1 as Bu,a2 as $u,a3 as Vu,a4 as Gu,a5 as Ku,a6 as zu,a7 as Xu,a8 as Wu,a9 as qu,aa as Hu,ab as Yu,ac as Qu,ad as Ju,C as Zu,ae as eh,af as th,ag as nh,ah as sh}from"./create-relationship-node-BYICOGVW.js";import{u as va,a as Rs,b as en,G as zn,P as Xn,c as Ms,T as Na,e as ah,d as rh,K as al,M as ih,f as Mr,H as rl,A as oh,W as il,S as ol,g as Ti,D as lh}from"./canvas-DNr_NzL_.js";import{u as Q,C as ch,a as ll}from"./use-toast-CCsW8X7b.js";import{c as Ge,a as Or}from"./spinner-CVTCfUTm.js";import{T as cl}from"./textarea-WOrfQulB.js";import{u as Os}from"./use-theme-2X7Juh3D.js";import{u as Pr,k as Dn,K as Rn}from"./theme-provider-C3PqonoD.js";import{B as dh}from"./badge-C_-_NdiN.js";import{C as dl}from"./code-editor-CnstDFjw.js";import{a as uh,d as hh}from"./use-storage-CxHm3ldK.js";import{C as fh,a as ph}from"./logo-light-BFt8fYOX.js";import{D as mh}from"./diagram-icon-tBo8msAN.js";import{a as dn}from"./databases-DbMVk969.js";const bh=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],xh=Ge("book-open",bh);const gh=[["path",{d:"M8 3H7a2 2 0 0 0-2 2v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5c0 1.1.9 2 2 2h1",key:"ezmyqa"}],["path",{d:"M16 21h1a2 2 0 0 0 2-2v-5c0-1.1.9-2 2-2a2 2 0 0 1-2-2V5a2 2 0 0 0-2-2h-1",key:"e1hn23"}]],vh=Ge("braces",gh);const Nh=[["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"m17 7 5 5-5 5",key:"1xlxn0"}],["path",{d:"m7 7-5 5 5 5",key:"19njba"}],["path",{d:"M8 12h.01",key:"czm47f"}]],Eh=Ge("chevrons-left-right-ellipsis",Nh);const yh=[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]],_h=Ge("code-xml",yh);const Th=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Wn=Ge("ellipsis-vertical",Th);const wh=[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v6",key:"rc0qvx"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"4",cy:"16",r:"2",key:"1ehqvc"}],["path",{d:"m10 10-4.5 4.5",key:"7fwrp6"}],["path",{d:"m9 11 1 1",key:"wa6s5q"}]],fr=Ge("file-key-2",wh);const Ih=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 13v-1h6v1",key:"1bb014"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"M11 18h2",key:"12mj7e"}]],Ch=Ge("file-type",Ih);const jh=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Lh=Ge("folder-open",jh);const kh=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Ah=Ge("globe",kh);const Sh=[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"m3 10 3-3-3-3",key:"i7pm08"}],["path",{d:"m3 20 3-3-3-3",key:"20gx1n"}]],Dh=Ge("list-collapse",Sh);const Rh=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],Mh=Ge("pause",Rh);const Oh=[["path",{d:"m10 10-6.157 6.162a2 2 0 0 0-.5.833l-1.322 4.36a.5.5 0 0 0 .622.624l4.358-1.323a2 2 0 0 0 .83-.5L14 13.982",key:"bjo8r8"}],["path",{d:"m12.829 7.172 4.359-4.346a1 1 0 1 1 3.986 3.986l-4.353 4.353",key:"16h5ne"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ph=Ge("pencil-off",Oh);const Fh=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M17 12h.01",key:"1m0b6t"}],["path",{d:"M7 12h.01",key:"eqddd0"}]],Uh=Ge("rectangle-ellipsis",Fh);const Bh=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],$h=Ge("undo-2",Bh);function ul(e){var t=f.useRef(e);return t.current=e,t}var Vh=function(e){var t=ul(e);f.useEffect(function(){return function(){t.current()}},[])},Va,wi;function hl(){if(wi)return Va;wi=1;function e(t){var n=typeof t;return t!=null&&(n=="object"||n=="function")}return Va=e,Va}var Ga,Ii;function Gh(){if(Ii)return Ga;Ii=1;var e=typeof zs=="object"&&zs&&zs.Object===Object&&zs;return Ga=e,Ga}var Ka,Ci;function fl(){if(Ci)return Ka;Ci=1;var e=Gh(),t=typeof self=="object"&&self&&self.Object===Object&&self,n=e||t||Function("return this")();return Ka=n,Ka}var za,ji;function Kh(){if(ji)return za;ji=1;var e=fl(),t=function(){return e.Date.now()};return za=t,za}var Xa,Li;function zh(){if(Li)return Xa;Li=1;var e=/\s/;function t(n){for(var s=n.length;s--&&e.test(n.charAt(s)););return s}return Xa=t,Xa}var Wa,ki;function Xh(){if(ki)return Wa;ki=1;var e=zh(),t=/^\s+/;function n(s){return s&&s.slice(0,e(s)+1).replace(t,"")}return Wa=n,Wa}var qa,Ai;function pl(){if(Ai)return qa;Ai=1;var e=fl(),t=e.Symbol;return qa=t,qa}var Ha,Si;function Wh(){if(Si)return Ha;Si=1;var e=pl(),t=Object.prototype,n=t.hasOwnProperty,s=t.toString,a=e?e.toStringTag:void 0;function r(o){var l=n.call(o,a),d=o[a];try{o[a]=void 0;var u=!0}catch{}var c=s.call(o);return u&&(l?o[a]=d:delete o[a]),c}return Ha=r,Ha}var Ya,Di;function qh(){if(Di)return Ya;Di=1;var e=Object.prototype,t=e.toString;function n(s){return t.call(s)}return Ya=n,Ya}var Qa,Ri;function Hh(){if(Ri)return Qa;Ri=1;var e=pl(),t=Wh(),n=qh(),s="[object Null]",a="[object Undefined]",r=e?e.toStringTag:void 0;function o(l){return l==null?l===void 0?a:s:r&&r in Object(l)?t(l):n(l)}return Qa=o,Qa}var Ja,Mi;function Yh(){if(Mi)return Ja;Mi=1;function e(t){return t!=null&&typeof t=="object"}return Ja=e,Ja}var Za,Oi;function Qh(){if(Oi)return Za;Oi=1;var e=Hh(),t=Yh(),n="[object Symbol]";function s(a){return typeof a=="symbol"||t(a)&&e(a)==n}return Za=s,Za}var er,Pi;function Jh(){if(Pi)return er;Pi=1;var e=Xh(),t=hl(),n=Qh(),s=NaN,a=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,o=/^0o[0-7]+$/i,l=parseInt;function d(u){if(typeof u=="number")return u;if(n(u))return s;if(t(u)){var c=typeof u.valueOf=="function"?u.valueOf():u;u=t(c)?c+"":c}if(typeof u!="string")return u===0?u:+u;u=e(u);var h=r.test(u);return h||o.test(u)?l(u.slice(2),h?2:8):a.test(u)?s:+u}return er=d,er}var tr,Fi;function Zh(){if(Fi)return tr;Fi=1;var e=hl(),t=Kh(),n=Jh(),s="Expected a function",a=Math.max,r=Math.min;function o(l,d,u){var c,h,p,b,x,m,N=0,_=!1,y=!1,g=!0;if(typeof l!="function")throw new TypeError(s);d=n(d)||0,e(u)&&(_=!!u.leading,y="maxWait"in u,p=y?a(n(u.maxWait)||0,d):p,g="trailing"in u?!!u.trailing:g);function w($){var B=c,se=h;return c=h=void 0,N=$,b=l.apply(se,B),b}function I($){return N=$,x=setTimeout(C,d),_?w($):b}function L($){var B=$-m,se=$-N,Te=d-B;return y?r(Te,p-se):Te}function k($){var B=$-m,se=$-N;return m===void 0||B>=d||B<0||y&&se>=p}function C(){var $=t();if(k($))return j($);x=setTimeout(C,L($))}function j($){return x=void 0,g&&c?w($):(c=h=void 0,b)}function O(){x!==void 0&&clearTimeout(x),N=0,c=m=h=x=void 0}function V(){return x===void 0?b:j(t())}function D(){var $=t(),B=k($);if(c=arguments,h=this,m=$,B){if(x===void 0)return I(m);if(y)return clearTimeout(x),x=setTimeout(C,d),w(m)}return x===void 0&&(x=setTimeout(C,d)),b}return D.cancel=O,D.flush=V,D}return tr=o,tr}var ef=Zh();const tf=Vd(ef);function nf(){var e=(typeof global>"u"?"undefined":typeof global)=="object"&&global&&global.Object===Object&&global,t=typeof self=="object"&&self&&self.Object===Object&&self;return e||t}nf()||(global.Date=Date);function sf(e,t){var n,s=ul(e),a=(n=t?.wait)!==null&&n!==void 0?n:1e3,r=f.useMemo(function(){return tf(function(){for(var o=[],l=0;l<arguments.length;l++)o[l]=arguments[l];return s.current.apply(s,xu([],gu(o),!1))},a,t)},[]);return Vh(function(){r.cancel()}),{run:r,cancel:r.cancel,flush:r.flush}}const _e=S.forwardRef((e,t)=>i.jsx(K,{ref:t,variant:"ghost",className:"size-8 p-2 text-slate-500 hover:cursor-pointer hover:bg-primary-foreground hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",asChild:!0,...e}));_e.displayName="ListItemHeaderButton";function af(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return f.useMemo(()=>s=>{t.forEach(a=>a(s))},t)}const Ea=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function qn(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function Fr(e){return"nodeType"in e}function Ke(e){var t,n;return e?qn(e)?e:Fr(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function Ur(e){const{Document:t}=Ke(e);return e instanceof t}function Ps(e){return qn(e)?!1:e instanceof Ke(e).HTMLElement}function ml(e){return e instanceof Ke(e).SVGElement}function Hn(e){return e?qn(e)?e.document:Fr(e)?Ur(e)?e:Ps(e)||ml(e)?e.ownerDocument:document:document:document}const Ct=Ea?f.useLayoutEffect:f.useEffect;function Br(e){const t=f.useRef(e);return Ct(()=>{t.current=e}),f.useCallback(function(){for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return t.current==null?void 0:t.current(...s)},[])}function rf(){const e=f.useRef(null),t=f.useCallback((s,a)=>{e.current=setInterval(s,a)},[]),n=f.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function ys(e,t){t===void 0&&(t=[e]);const n=f.useRef(e);return Ct(()=>{n.current!==e&&(n.current=e)},t),n}function Fs(e,t){const n=f.useRef();return f.useMemo(()=>{const s=e(n.current);return n.current=s,s},[...t])}function aa(e){const t=Br(e),n=f.useRef(null),s=f.useCallback(a=>{a!==n.current&&t?.(a,n.current),n.current=a},[]);return[n,s]}function pr(e){const t=f.useRef();return f.useEffect(()=>{t.current=e},[e]),t.current}let nr={};function Us(e,t){return f.useMemo(()=>{if(t)return t;const n=nr[e]==null?0:nr[e]+1;return nr[e]=n,e+"-"+n},[e,t])}function bl(e){return function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];return s.reduce((r,o)=>{const l=Object.entries(o);for(const[d,u]of l){const c=r[d];c!=null&&(r[d]=c+e*u)}return r},{...t})}}const Fn=bl(1),ra=bl(-1);function of(e){return"clientX"in e&&"clientY"in e}function $r(e){if(!e)return!1;const{KeyboardEvent:t}=Ke(e.target);return t&&e instanceof t}function lf(e){if(!e)return!1;const{TouchEvent:t}=Ke(e.target);return t&&e instanceof t}function mr(e){if(lf(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return of(e)?{x:e.clientX,y:e.clientY}:null}const jt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[jt.Translate.toString(e),jt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:s}=e;return t+" "+n+"ms "+s}}}),Ui="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function cf(e){return e.matches(Ui)?e:e.querySelector(Ui)}const df={display:"none"};function uf(e){let{id:t,value:n}=e;return S.createElement("div",{id:t,style:df},n)}function hf(e){let{id:t,announcement:n,ariaLiveType:s="assertive"}=e;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return S.createElement("div",{id:t,style:a,role:"status","aria-live":s,"aria-atomic":!0},n)}function ff(){const[e,t]=f.useState("");return{announce:f.useCallback(s=>{s!=null&&t(s)},[]),announcement:e}}const xl=f.createContext(null);function pf(e){const t=f.useContext(xl);f.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function mf(){const[e]=f.useState(()=>new Set),t=f.useCallback(s=>(e.add(s),()=>e.delete(s)),[e]);return[f.useCallback(s=>{let{type:a,event:r}=s;e.forEach(o=>{var l;return(l=o[a])==null?void 0:l.call(o,r)})},[e]),t]}const bf={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},xf={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function gf(e){let{announcements:t=xf,container:n,hiddenTextDescribedById:s,screenReaderInstructions:a=bf}=e;const{announce:r,announcement:o}=ff(),l=Us("DndLiveRegion"),[d,u]=f.useState(!1);if(f.useEffect(()=>{u(!0)},[]),pf(f.useMemo(()=>({onDragStart(h){let{active:p}=h;r(t.onDragStart({active:p}))},onDragMove(h){let{active:p,over:b}=h;t.onDragMove&&r(t.onDragMove({active:p,over:b}))},onDragOver(h){let{active:p,over:b}=h;r(t.onDragOver({active:p,over:b}))},onDragEnd(h){let{active:p,over:b}=h;r(t.onDragEnd({active:p,over:b}))},onDragCancel(h){let{active:p,over:b}=h;r(t.onDragCancel({active:p,over:b}))}}),[r,t])),!d)return null;const c=S.createElement(S.Fragment,null,S.createElement(uf,{id:s,value:a.draggable}),S.createElement(hf,{id:l,announcement:o}));return n?ps.createPortal(c,n):c}var Ee;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(Ee||(Ee={}));function ia(){}function Yn(e,t){return f.useMemo(()=>({sensor:e,options:{}}),[e,t])}function Qn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return f.useMemo(()=>[...t].filter(s=>s!=null),[...t])}const bt=Object.freeze({x:0,y:0});function vf(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Nf(e,t){let{data:{value:n}}=e,{data:{value:s}}=t;return n-s}function Ef(e,t){let{data:{value:n}}=e,{data:{value:s}}=t;return s-n}function yf(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Bi(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const Jn=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:s}=e;const a=Bi(t,t.left,t.top),r=[];for(const o of s){const{id:l}=o,d=n.get(l);if(d){const u=vf(Bi(d),a);r.push({id:l,data:{droppableContainer:o,value:u}})}}return r.sort(Nf)};function _f(e,t){const n=Math.max(t.top,e.top),s=Math.max(t.left,e.left),a=Math.min(t.left+t.width,e.left+e.width),r=Math.min(t.top+t.height,e.top+e.height),o=a-s,l=r-n;if(s<a&&n<r){const d=t.width*t.height,u=e.width*e.height,c=o*l,h=c/(d+u-c);return Number(h.toFixed(4))}return 0}const Tf=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:s}=e;const a=[];for(const r of s){const{id:o}=r,l=n.get(o);if(l){const d=_f(l,t);d>0&&a.push({id:o,data:{droppableContainer:r,value:d}})}}return a.sort(Ef)};function wf(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function gl(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:bt}function If(e){return function(n){for(var s=arguments.length,a=new Array(s>1?s-1:0),r=1;r<s;r++)a[r-1]=arguments[r];return a.reduce((o,l)=>({...o,top:o.top+e*l.y,bottom:o.bottom+e*l.y,left:o.left+e*l.x,right:o.right+e*l.x}),{...n})}}const Cf=If(1);function jf(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Lf(e,t,n){const s=jf(t);if(!s)return e;const{scaleX:a,scaleY:r,x:o,y:l}=s,d=e.left-o-(1-a)*parseFloat(n),u=e.top-l-(1-r)*parseFloat(n.slice(n.indexOf(" ")+1)),c=a?e.width/a:e.width,h=r?e.height/r:e.height;return{width:c,height:h,top:u,right:d+c,bottom:u+h,left:d}}const kf={ignoreTransform:!1};function Zn(e,t){t===void 0&&(t=kf);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:u,transformOrigin:c}=Ke(e).getComputedStyle(e);u&&(n=Lf(n,u,c))}const{top:s,left:a,width:r,height:o,bottom:l,right:d}=n;return{top:s,left:a,width:r,height:o,bottom:l,right:d}}function $i(e){return Zn(e,{ignoreTransform:!0})}function Af(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function Sf(e,t){return t===void 0&&(t=Ke(e).getComputedStyle(e)),t.position==="fixed"}function Df(e,t){t===void 0&&(t=Ke(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const r=t[a];return typeof r=="string"?n.test(r):!1})}function Vr(e,t){const n=[];function s(a){if(t!=null&&n.length>=t||!a)return n;if(Ur(a)&&a.scrollingElement!=null&&!n.includes(a.scrollingElement))return n.push(a.scrollingElement),n;if(!Ps(a)||ml(a)||n.includes(a))return n;const r=Ke(e).getComputedStyle(a);return a!==e&&Df(a,r)&&n.push(a),Sf(a,r)?n:s(a.parentNode)}return e?s(e):n}function vl(e){const[t]=Vr(e,1);return t??null}function sr(e){return!Ea||!e?null:qn(e)?e:Fr(e)?Ur(e)||e===Hn(e).scrollingElement?window:Ps(e)?e:null:null}function Nl(e){return qn(e)?e.scrollX:e.scrollLeft}function El(e){return qn(e)?e.scrollY:e.scrollTop}function br(e){return{x:Nl(e),y:El(e)}}var we;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(we||(we={}));function yl(e){return!Ea||!e?!1:e===document.scrollingElement}function _l(e){const t={x:0,y:0},n=yl(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},s={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},a=e.scrollTop<=t.y,r=e.scrollLeft<=t.x,o=e.scrollTop>=s.y,l=e.scrollLeft>=s.x;return{isTop:a,isLeft:r,isBottom:o,isRight:l,maxScroll:s,minScroll:t}}const Rf={x:.2,y:.2};function Mf(e,t,n,s,a){let{top:r,left:o,right:l,bottom:d}=n;s===void 0&&(s=10),a===void 0&&(a=Rf);const{isTop:u,isBottom:c,isLeft:h,isRight:p}=_l(e),b={x:0,y:0},x={x:0,y:0},m={height:t.height*a.y,width:t.width*a.x};return!u&&r<=t.top+m.height?(b.y=we.Backward,x.y=s*Math.abs((t.top+m.height-r)/m.height)):!c&&d>=t.bottom-m.height&&(b.y=we.Forward,x.y=s*Math.abs((t.bottom-m.height-d)/m.height)),!p&&l>=t.right-m.width?(b.x=we.Forward,x.x=s*Math.abs((t.right-m.width-l)/m.width)):!h&&o<=t.left+m.width&&(b.x=we.Backward,x.x=s*Math.abs((t.left+m.width-o)/m.width)),{direction:b,speed:x}}function Of(e){if(e===document.scrollingElement){const{innerWidth:r,innerHeight:o}=window;return{top:0,left:0,right:r,bottom:o,width:r,height:o}}const{top:t,left:n,right:s,bottom:a}=e.getBoundingClientRect();return{top:t,left:n,right:s,bottom:a,width:e.clientWidth,height:e.clientHeight}}function Tl(e){return e.reduce((t,n)=>Fn(t,br(n)),bt)}function Pf(e){return e.reduce((t,n)=>t+Nl(n),0)}function Ff(e){return e.reduce((t,n)=>t+El(n),0)}function Uf(e,t){if(t===void 0&&(t=Zn),!e)return;const{top:n,left:s,bottom:a,right:r}=t(e);vl(e)&&(a<=0||r<=0||n>=window.innerHeight||s>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Bf=[["x",["left","right"],Pf],["y",["top","bottom"],Ff]];class Gr{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=Vr(n),a=Tl(s);this.rect={...t},this.width=t.width,this.height=t.height;for(const[r,o,l]of Bf)for(const d of o)Object.defineProperty(this,d,{get:()=>{const u=l(s),c=a[r]-u;return this.rect[d]+c},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class bs{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...n)})},this.target=t}add(t,n,s){var a;(a=this.target)==null||a.addEventListener(t,n,s),this.listeners.push([t,n,s])}}function $f(e){const{EventTarget:t}=Ke(e);return e instanceof t?e:Hn(e)}function ar(e,t){const n=Math.abs(e.x),s=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+s**2)>t:"x"in t&&"y"in t?n>t.x&&s>t.y:"x"in t?n>t.x:"y"in t?s>t.y:!1}var rt;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(rt||(rt={}));function Vi(e){e.preventDefault()}function Vf(e){e.stopPropagation()}var q;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(q||(q={}));const wl={start:[q.Space,q.Enter],cancel:[q.Esc],end:[q.Space,q.Enter,q.Tab]},Gf=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case q.Right:return{...n,x:n.x+25};case q.Left:return{...n,x:n.x-25};case q.Down:return{...n,y:n.y+25};case q.Up:return{...n,y:n.y-25}}};class Il{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new bs(Hn(n)),this.windowListeners=new bs(Ke(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(rt.Resize,this.handleCancel),this.windowListeners.add(rt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(rt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,s=t.node.current;s&&Uf(s),n(bt)}handleKeyDown(t){if($r(t)){const{active:n,context:s,options:a}=this.props,{keyboardCodes:r=wl,coordinateGetter:o=Gf,scrollBehavior:l="smooth"}=a,{code:d}=t;if(r.end.includes(d)){this.handleEnd(t);return}if(r.cancel.includes(d)){this.handleCancel(t);return}const{collisionRect:u}=s.current,c=u?{x:u.left,y:u.top}:bt;this.referenceCoordinates||(this.referenceCoordinates=c);const h=o(t,{active:n,context:s.current,currentCoordinates:c});if(h){const p=ra(h,c),b={x:0,y:0},{scrollableAncestors:x}=s.current;for(const m of x){const N=t.code,{isTop:_,isRight:y,isLeft:g,isBottom:w,maxScroll:I,minScroll:L}=_l(m),k=Of(m),C={x:Math.min(N===q.Right?k.right-k.width/2:k.right,Math.max(N===q.Right?k.left:k.left+k.width/2,h.x)),y:Math.min(N===q.Down?k.bottom-k.height/2:k.bottom,Math.max(N===q.Down?k.top:k.top+k.height/2,h.y))},j=N===q.Right&&!y||N===q.Left&&!g,O=N===q.Down&&!w||N===q.Up&&!_;if(j&&C.x!==h.x){const V=m.scrollLeft+p.x,D=N===q.Right&&V<=I.x||N===q.Left&&V>=L.x;if(D&&!p.y){m.scrollTo({left:V,behavior:l});return}D?b.x=m.scrollLeft-V:b.x=N===q.Right?m.scrollLeft-I.x:m.scrollLeft-L.x,b.x&&m.scrollBy({left:-b.x,behavior:l});break}else if(O&&C.y!==h.y){const V=m.scrollTop+p.y,D=N===q.Down&&V<=I.y||N===q.Up&&V>=L.y;if(D&&!p.x){m.scrollTo({top:V,behavior:l});return}D?b.y=m.scrollTop-V:b.y=N===q.Down?m.scrollTop-I.y:m.scrollTop-L.y,b.y&&m.scrollBy({top:-b.y,behavior:l});break}}this.handleMove(t,Fn(ra(h,this.referenceCoordinates),b))}}}handleMove(t,n){const{onMove:s}=this.props;t.preventDefault(),s(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Il.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:s=wl,onActivation:a}=t,{active:r}=n;const{code:o}=e.nativeEvent;if(s.start.includes(o)){const l=r.activatorNode.current;return l&&e.target!==l?!1:(e.preventDefault(),a?.({event:e.nativeEvent}),!0)}return!1}}];function Gi(e){return!!(e&&"distance"in e)}function Ki(e){return!!(e&&"delay"in e)}class Kr{constructor(t,n,s){var a;s===void 0&&(s=$f(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:r}=t,{target:o}=r;this.props=t,this.events=n,this.document=Hn(o),this.documentListeners=new bs(this.document),this.listeners=new bs(s),this.windowListeners=new bs(Ke(o)),this.initialCoordinates=(a=mr(r))!=null?a:bt,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:s}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(rt.Resize,this.handleCancel),this.windowListeners.add(rt.DragStart,Vi),this.windowListeners.add(rt.VisibilityChange,this.handleCancel),this.windowListeners.add(rt.ContextMenu,Vi),this.documentListeners.add(rt.Keydown,this.handleKeydown),n){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Ki(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Gi(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:s,onPending:a}=this.props;a(s,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(rt.Click,Vf,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(rt.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:s,initialCoordinates:a,props:r}=this,{onMove:o,options:{activationConstraint:l}}=r;if(!a)return;const d=(n=mr(t))!=null?n:bt,u=ra(a,d);if(!s&&l){if(Gi(l)){if(l.tolerance!=null&&ar(u,l.tolerance))return this.handleCancel();if(ar(u,l.distance))return this.handleStart()}if(Ki(l)&&ar(u,l.tolerance))return this.handleCancel();this.handlePending(l,u);return}t.cancelable&&t.preventDefault(),o(d)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===q.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Kf={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class on extends Kr{constructor(t){const{event:n}=t,s=Hn(n.target);super(t,Kf,s)}}on.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:s}=t;return!n.isPrimary||n.button!==0?!1:(s?.({event:n}),!0)}}];const zf={move:{name:"mousemove"},end:{name:"mouseup"}};var xr;(function(e){e[e.RightClick=2]="RightClick"})(xr||(xr={}));class Xf extends Kr{constructor(t){super(t,zf,Hn(t.event.target))}}Xf.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:s}=t;return n.button===xr.RightClick?!1:(s?.({event:n}),!0)}}];const rr={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Wf extends Kr{constructor(t){super(t,rr)}static setup(){return window.addEventListener(rr.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(rr.move.name,t)};function t(){}}}Wf.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:s}=t;const{touches:a}=n;return a.length>1?!1:(s?.({event:n}),!0)}}];var xs;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(xs||(xs={}));var oa;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(oa||(oa={}));function qf(e){let{acceleration:t,activator:n=xs.Pointer,canScroll:s,draggingRect:a,enabled:r,interval:o=5,order:l=oa.TreeOrder,pointerCoordinates:d,scrollableAncestors:u,scrollableAncestorRects:c,delta:h,threshold:p}=e;const b=Yf({delta:h,disabled:!r}),[x,m]=rf(),N=f.useRef({x:0,y:0}),_=f.useRef({x:0,y:0}),y=f.useMemo(()=>{switch(n){case xs.Pointer:return d?{top:d.y,bottom:d.y,left:d.x,right:d.x}:null;case xs.DraggableRect:return a}},[n,a,d]),g=f.useRef(null),w=f.useCallback(()=>{const L=g.current;if(!L)return;const k=N.current.x*_.current.x,C=N.current.y*_.current.y;L.scrollBy(k,C)},[]),I=f.useMemo(()=>l===oa.TreeOrder?[...u].reverse():u,[l,u]);f.useEffect(()=>{if(!r||!u.length||!y){m();return}for(const L of I){if(s?.(L)===!1)continue;const k=u.indexOf(L),C=c[k];if(!C)continue;const{direction:j,speed:O}=Mf(L,C,y,t,p);for(const V of["x","y"])b[V][j[V]]||(O[V]=0,j[V]=0);if(O.x>0||O.y>0){m(),g.current=L,x(w,o),N.current=O,_.current=j;return}}N.current={x:0,y:0},_.current={x:0,y:0},m()},[t,w,s,m,r,o,JSON.stringify(y),JSON.stringify(b),x,u,I,c,JSON.stringify(p)])}const Hf={x:{[we.Backward]:!1,[we.Forward]:!1},y:{[we.Backward]:!1,[we.Forward]:!1}};function Yf(e){let{delta:t,disabled:n}=e;const s=pr(t);return Fs(a=>{if(n||!s||!a)return Hf;const r={x:Math.sign(t.x-s.x),y:Math.sign(t.y-s.y)};return{x:{[we.Backward]:a.x[we.Backward]||r.x===-1,[we.Forward]:a.x[we.Forward]||r.x===1},y:{[we.Backward]:a.y[we.Backward]||r.y===-1,[we.Forward]:a.y[we.Forward]||r.y===1}}},[n,t,s])}function Qf(e,t){const n=t!=null?e.get(t):void 0,s=n?n.node.current:null;return Fs(a=>{var r;return t==null?null:(r=s??a)!=null?r:null},[s,t])}function Jf(e,t){return f.useMemo(()=>e.reduce((n,s)=>{const{sensor:a}=s,r=a.activators.map(o=>({eventName:o.eventName,handler:t(o.handler,s)}));return[...n,...r]},[]),[e,t])}var _s;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(_s||(_s={}));var gr;(function(e){e.Optimized="optimized"})(gr||(gr={}));const zi=new Map;function Zf(e,t){let{dragging:n,dependencies:s,config:a}=t;const[r,o]=f.useState(null),{frequency:l,measure:d,strategy:u}=a,c=f.useRef(e),h=N(),p=ys(h),b=f.useCallback(function(_){_===void 0&&(_=[]),!p.current&&o(y=>y===null?_:y.concat(_.filter(g=>!y.includes(g))))},[p]),x=f.useRef(null),m=Fs(_=>{if(h&&!n)return zi;if(!_||_===zi||c.current!==e||r!=null){const y=new Map;for(let g of e){if(!g)continue;if(r&&r.length>0&&!r.includes(g.id)&&g.rect.current){y.set(g.id,g.rect.current);continue}const w=g.node.current,I=w?new Gr(d(w),w):null;g.rect.current=I,I&&y.set(g.id,I)}return y}return _},[e,r,n,h,d]);return f.useEffect(()=>{c.current=e},[e]),f.useEffect(()=>{h||b()},[n,h]),f.useEffect(()=>{r&&r.length>0&&o(null)},[JSON.stringify(r)]),f.useEffect(()=>{h||typeof l!="number"||x.current!==null||(x.current=setTimeout(()=>{b(),x.current=null},l))},[l,h,b,...s]),{droppableRects:m,measureDroppableContainers:b,measuringScheduled:r!=null};function N(){switch(u){case _s.Always:return!1;case _s.BeforeDragging:return n;default:return!n}}}function Cl(e,t){return Fs(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function ep(e,t){return Cl(e,t)}function tp(e){let{callback:t,disabled:n}=e;const s=Br(t),a=f.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:r}=window;return new r(s)},[s,n]);return f.useEffect(()=>()=>a?.disconnect(),[a]),a}function ya(e){let{callback:t,disabled:n}=e;const s=Br(t),a=f.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:r}=window;return new r(s)},[n]);return f.useEffect(()=>()=>a?.disconnect(),[a]),a}function np(e){return new Gr(Zn(e),e)}function Xi(e,t,n){t===void 0&&(t=np);const[s,a]=f.useState(null);function r(){a(d=>{if(!e)return null;if(e.isConnected===!1){var u;return(u=d??n)!=null?u:null}const c=t(e);return JSON.stringify(d)===JSON.stringify(c)?d:c})}const o=tp({callback(d){if(e)for(const u of d){const{type:c,target:h}=u;if(c==="childList"&&h instanceof HTMLElement&&h.contains(e)){r();break}}}}),l=ya({callback:r});return Ct(()=>{r(),e?(l?.observe(e),o?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),o?.disconnect())},[e]),s}function sp(e){const t=Cl(e);return gl(e,t)}const Wi=[];function ap(e){const t=f.useRef(e),n=Fs(s=>e?s&&s!==Wi&&e&&t.current&&e.parentNode===t.current.parentNode?s:Vr(e):Wi,[e]);return f.useEffect(()=>{t.current=e},[e]),n}function rp(e){const[t,n]=f.useState(null),s=f.useRef(e),a=f.useCallback(r=>{const o=sr(r.target);o&&n(l=>l?(l.set(o,br(o)),new Map(l)):null)},[]);return f.useEffect(()=>{const r=s.current;if(e!==r){o(r);const l=e.map(d=>{const u=sr(d);return u?(u.addEventListener("scroll",a,{passive:!0}),[u,br(u)]):null}).filter(d=>d!=null);n(l.length?new Map(l):null),s.current=e}return()=>{o(e),o(r)};function o(l){l.forEach(d=>{const u=sr(d);u?.removeEventListener("scroll",a)})}},[a,e]),f.useMemo(()=>e.length?t?Array.from(t.values()).reduce((r,o)=>Fn(r,o),bt):Tl(e):bt,[e,t])}function qi(e,t){t===void 0&&(t=[]);const n=f.useRef(null);return f.useEffect(()=>{n.current=null},t),f.useEffect(()=>{const s=e!==bt;s&&!n.current&&(n.current=e),!s&&n.current&&(n.current=null)},[e]),n.current?ra(e,n.current):bt}function ip(e){f.useEffect(()=>{if(!Ea)return;const t=e.map(n=>{let{sensor:s}=n;return s.setup==null?void 0:s.setup()});return()=>{for(const n of t)n?.()}},e.map(t=>{let{sensor:n}=t;return n}))}function op(e,t){return f.useMemo(()=>e.reduce((n,s)=>{let{eventName:a,handler:r}=s;return n[a]=o=>{r(o,t)},n},{}),[e,t])}function jl(e){return f.useMemo(()=>e?Af(e):null,[e])}const Hi=[];function lp(e,t){t===void 0&&(t=Zn);const[n]=e,s=jl(n?Ke(n):null),[a,r]=f.useState(Hi);function o(){r(()=>e.length?e.map(d=>yl(d)?s:new Gr(t(d),d)):Hi)}const l=ya({callback:o});return Ct(()=>{l?.disconnect(),o(),e.forEach(d=>l?.observe(d))},[e]),a}function cp(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Ps(t)?t:e}function dp(e){let{measure:t}=e;const[n,s]=f.useState(null),a=f.useCallback(u=>{for(const{target:c}of u)if(Ps(c)){s(h=>{const p=t(c);return h?{...h,width:p.width,height:p.height}:p});break}},[t]),r=ya({callback:a}),o=f.useCallback(u=>{const c=cp(u);r?.disconnect(),c&&r?.observe(c),s(c?t(c):null)},[t,r]),[l,d]=aa(o);return f.useMemo(()=>({nodeRef:l,rect:n,setRef:d}),[n,l,d])}const up=[{sensor:on,options:{}},{sensor:Il,options:{}}],hp={current:{}},Qs={draggable:{measure:$i},droppable:{measure:$i,strategy:_s.WhileDragging,frequency:gr.Optimized},dragOverlay:{measure:Zn}};class gs extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,s;return(n=(s=this.get(t))==null?void 0:s.node.current)!=null?n:void 0}}const fp={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new gs,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:ia},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Qs,measureDroppableContainers:ia,windowRect:null,measuringScheduled:!1},pp={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:ia,draggableNodes:new Map,over:null,measureDroppableContainers:ia},_a=f.createContext(pp),Ll=f.createContext(fp);function mp(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new gs}}}function bp(e,t){switch(t.type){case Ee.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case Ee.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case Ee.DragEnd:case Ee.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Ee.RegisterDroppable:{const{element:n}=t,{id:s}=n,a=new gs(e.droppable.containers);return a.set(s,n),{...e,droppable:{...e.droppable,containers:a}}}case Ee.SetDroppableDisabled:{const{id:n,key:s,disabled:a}=t,r=e.droppable.containers.get(n);if(!r||s!==r.key)return e;const o=new gs(e.droppable.containers);return o.set(n,{...r,disabled:a}),{...e,droppable:{...e.droppable,containers:o}}}case Ee.UnregisterDroppable:{const{id:n,key:s}=t,a=e.droppable.containers.get(n);if(!a||s!==a.key)return e;const r=new gs(e.droppable.containers);return r.delete(n),{...e,droppable:{...e.droppable,containers:r}}}default:return e}}function xp(e){let{disabled:t}=e;const{active:n,activatorEvent:s,draggableNodes:a}=f.useContext(_a),r=pr(s),o=pr(n?.id);return f.useEffect(()=>{if(!t&&!s&&r&&o!=null){if(!$r(r)||document.activeElement===r.target)return;const l=a.get(o);if(!l)return;const{activatorNode:d,node:u}=l;if(!d.current&&!u.current)return;requestAnimationFrame(()=>{for(const c of[d.current,u.current]){if(!c)continue;const h=cf(c);if(h){h.focus();break}}})}},[s,t,a,o,r]),null}function gp(e,t){let{transform:n,...s}=t;return e!=null&&e.length?e.reduce((a,r)=>r({transform:a,...s}),n):n}function vp(e){return f.useMemo(()=>({draggable:{...Qs.draggable,...e?.draggable},droppable:{...Qs.droppable,...e?.droppable},dragOverlay:{...Qs.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function Np(e){let{activeNode:t,measure:n,initialRect:s,config:a=!0}=e;const r=f.useRef(!1),{x:o,y:l}=typeof a=="boolean"?{x:a,y:a}:a;Ct(()=>{if(!o&&!l||!t){r.current=!1;return}if(r.current||!s)return;const u=t?.node.current;if(!u||u.isConnected===!1)return;const c=n(u),h=gl(c,s);if(o||(h.x=0),l||(h.y=0),r.current=!0,Math.abs(h.x)>0||Math.abs(h.y)>0){const p=vl(u);p&&p.scrollBy({top:h.y,left:h.x})}},[t,o,l,s,n])}const kl=f.createContext({...bt,scaleX:1,scaleY:1});var Ht;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ht||(Ht={}));const es=f.memo(function(t){var n,s,a,r;let{id:o,accessibility:l,autoScroll:d=!0,children:u,sensors:c=up,collisionDetection:h=Tf,measuring:p,modifiers:b,...x}=t;const m=f.useReducer(bp,void 0,mp),[N,_]=m,[y,g]=mf(),[w,I]=f.useState(Ht.Uninitialized),L=w===Ht.Initialized,{draggable:{active:k,nodes:C,translate:j},droppable:{containers:O}}=N,V=k!=null?C.get(k):null,D=f.useRef({initial:null,translated:null}),$=f.useMemo(()=>{var Le;return k!=null?{id:k,data:(Le=V?.data)!=null?Le:hp,rect:D}:null},[k,V]),B=f.useRef(null),[se,Te]=f.useState(null),[de,tt]=f.useState(null),Me=ys(x,Object.values(x)),Et=Us("DndDescribedBy",o),Rt=f.useMemo(()=>O.getEnabled(),[O]),ue=vp(p),{droppableRects:Be,measureDroppableContainers:nt,measuringScheduled:ze}=Zf(Rt,{dragging:L,dependencies:[j.x,j.y],config:ue.droppable}),he=Qf(C,k),Oe=f.useMemo(()=>de?mr(de):null,[de]),Pe=$d(),Xe=ep(he,ue.draggable.measure);Np({activeNode:k!=null?C.get(k):null,config:Pe.layoutShiftCompensation,initialRect:Xe,measure:ue.draggable.measure});const z=Xi(he,ue.draggable.measure,Xe),Mt=Xi(he?he.parentElement:null),be=f.useRef({activatorEvent:null,active:null,activeNode:he,collisionRect:null,collisions:null,droppableRects:Be,draggableNodes:C,draggingNode:null,draggingNodeRect:null,droppableContainers:O,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),W=O.getNodeFor((n=be.current.over)==null?void 0:n.id),ee=dp({measure:ue.dragOverlay.measure}),fe=(s=ee.nodeRef.current)!=null?s:he,yt=L?(a=ee.rect)!=null?a:z:null,Vs=!!(ee.nodeRef.current&&ee.rect),ui=sp(Vs?null:z),Fa=jl(fe?Ke(fe):null),Gt=ap(L?W??he:null),Gs=lp(Gt),Ks=gp(b,{transform:{x:j.x-ui.x,y:j.y-ui.y,scaleX:1,scaleY:1},activatorEvent:de,active:$,activeNodeRect:z,containerNodeRect:Mt,draggingNodeRect:yt,over:be.current.over,overlayNodeRect:ee.rect,scrollableAncestors:Gt,scrollableAncestorRects:Gs,windowRect:Fa}),hi=Oe?Fn(Oe,j):null,fi=rp(Gt),Rd=qi(fi),Md=qi(fi,[z]),kn=Fn(Ks,Rd),An=yt?Cf(yt,Ks):null,cs=$&&An?h({active:$,collisionRect:An,droppableRects:Be,droppableContainers:Rt,pointerCoordinates:hi}):null,pi=yf(cs,"id"),[Kt,mi]=f.useState(null),Od=Vs?Ks:Fn(Ks,Md),Pd=wf(Od,(r=Kt?.rect)!=null?r:null,z),Ua=f.useRef(null),bi=f.useCallback((Le,We)=>{let{sensor:qe,options:zt}=We;if(B.current==null)return;const st=C.get(B.current);if(!st)return;const He=Le.nativeEvent,_t=new qe({active:B.current,activeNode:st,event:He,options:zt,context:be,onAbort(Ce){if(!C.get(Ce))return;const{onDragAbort:Tt}=Me.current,Ot={id:Ce};Tt?.(Ot),y({type:"onDragAbort",event:Ot})},onPending(Ce,Xt,Tt,Ot){if(!C.get(Ce))return;const{onDragPending:us}=Me.current,Wt={id:Ce,constraint:Xt,initialCoordinates:Tt,offset:Ot};us?.(Wt),y({type:"onDragPending",event:Wt})},onStart(Ce){const Xt=B.current;if(Xt==null)return;const Tt=C.get(Xt);if(!Tt)return;const{onDragStart:Ot}=Me.current,ds={activatorEvent:He,active:{id:Xt,data:Tt.data,rect:D}};ps.unstable_batchedUpdates(()=>{Ot?.(ds),I(Ht.Initializing),_({type:Ee.DragStart,initialCoordinates:Ce,active:Xt}),y({type:"onDragStart",event:ds}),Te(Ua.current),tt(He)})},onMove(Ce){_({type:Ee.DragMove,coordinates:Ce})},onEnd:Sn(Ee.DragEnd),onCancel:Sn(Ee.DragCancel)});Ua.current=_t;function Sn(Ce){return async function(){const{active:Tt,collisions:Ot,over:ds,scrollAdjustedTranslate:us}=be.current;let Wt=null;if(Tt&&us){const{cancelDrop:hs}=Me.current;Wt={activatorEvent:He,active:Tt,collisions:Ot,delta:us,over:ds},Ce===Ee.DragEnd&&typeof hs=="function"&&await Promise.resolve(hs(Wt))&&(Ce=Ee.DragCancel)}B.current=null,ps.unstable_batchedUpdates(()=>{_({type:Ce}),I(Ht.Uninitialized),mi(null),Te(null),tt(null),Ua.current=null;const hs=Ce===Ee.DragEnd?"onDragEnd":"onDragCancel";if(Wt){const Ba=Me.current[hs];Ba?.(Wt),y({type:hs,event:Wt})}})}}},[C]),Fd=f.useCallback((Le,We)=>(qe,zt)=>{const st=qe.nativeEvent,He=C.get(zt);if(B.current!==null||!He||st.dndKit||st.defaultPrevented)return;const _t={active:He};Le(qe,We.options,_t)===!0&&(st.dndKit={capturedBy:We.sensor},B.current=zt,bi(qe,We))},[C,bi]),xi=Jf(c,Fd);ip(c),Ct(()=>{z&&w===Ht.Initializing&&I(Ht.Initialized)},[z,w]),f.useEffect(()=>{const{onDragMove:Le}=Me.current,{active:We,activatorEvent:qe,collisions:zt,over:st}=be.current;if(!We||!qe)return;const He={active:We,activatorEvent:qe,collisions:zt,delta:{x:kn.x,y:kn.y},over:st};ps.unstable_batchedUpdates(()=>{Le?.(He),y({type:"onDragMove",event:He})})},[kn.x,kn.y]),f.useEffect(()=>{const{active:Le,activatorEvent:We,collisions:qe,droppableContainers:zt,scrollAdjustedTranslate:st}=be.current;if(!Le||B.current==null||!We||!st)return;const{onDragOver:He}=Me.current,_t=zt.get(pi),Sn=_t&&_t.rect.current?{id:_t.id,rect:_t.rect.current,data:_t.data,disabled:_t.disabled}:null,Ce={active:Le,activatorEvent:We,collisions:qe,delta:{x:st.x,y:st.y},over:Sn};ps.unstable_batchedUpdates(()=>{mi(Sn),He?.(Ce),y({type:"onDragOver",event:Ce})})},[pi]),Ct(()=>{be.current={activatorEvent:de,active:$,activeNode:he,collisionRect:An,collisions:cs,droppableRects:Be,draggableNodes:C,draggingNode:fe,draggingNodeRect:yt,droppableContainers:O,over:Kt,scrollableAncestors:Gt,scrollAdjustedTranslate:kn},D.current={initial:yt,translated:An}},[$,he,cs,An,C,fe,yt,Be,O,Kt,Gt,kn]),qf({...Pe,delta:j,draggingRect:An,pointerCoordinates:hi,scrollableAncestors:Gt,scrollableAncestorRects:Gs});const Ud=f.useMemo(()=>({active:$,activeNode:he,activeNodeRect:z,activatorEvent:de,collisions:cs,containerNodeRect:Mt,dragOverlay:ee,draggableNodes:C,droppableContainers:O,droppableRects:Be,over:Kt,measureDroppableContainers:nt,scrollableAncestors:Gt,scrollableAncestorRects:Gs,measuringConfiguration:ue,measuringScheduled:ze,windowRect:Fa}),[$,he,z,de,cs,Mt,ee,C,O,Be,Kt,nt,Gt,Gs,ue,ze,Fa]),Bd=f.useMemo(()=>({activatorEvent:de,activators:xi,active:$,activeNodeRect:z,ariaDescribedById:{draggable:Et},dispatch:_,draggableNodes:C,over:Kt,measureDroppableContainers:nt}),[de,xi,$,z,_,Et,C,Kt,nt]);return S.createElement(xl.Provider,{value:g},S.createElement(_a.Provider,{value:Bd},S.createElement(Ll.Provider,{value:Ud},S.createElement(kl.Provider,{value:Pd},u)),S.createElement(xp,{disabled:l?.restoreFocus===!1})),S.createElement(gf,{...l,hiddenTextDescribedById:Et}));function $d(){const Le=se?.autoScrollEnabled===!1,We=typeof d=="object"?d.enabled===!1:d===!1,qe=L&&!Le&&!We;return typeof d=="object"?{...d,enabled:qe}:{enabled:qe}}}),Ep=f.createContext(null),Yi="button",yp="Draggable";function _p(e){let{id:t,data:n,disabled:s=!1,attributes:a}=e;const r=Us(yp),{activators:o,activatorEvent:l,active:d,activeNodeRect:u,ariaDescribedById:c,draggableNodes:h,over:p}=f.useContext(_a),{role:b=Yi,roleDescription:x="draggable",tabIndex:m=0}=a??{},N=d?.id===t,_=f.useContext(N?kl:Ep),[y,g]=aa(),[w,I]=aa(),L=op(o,t),k=ys(n);Ct(()=>(h.set(t,{id:t,key:r,node:y,activatorNode:w,data:k}),()=>{const j=h.get(t);j&&j.key===r&&h.delete(t)}),[h,t]);const C=f.useMemo(()=>({role:b,tabIndex:m,"aria-disabled":s,"aria-pressed":N&&b===Yi?!0:void 0,"aria-roledescription":x,"aria-describedby":c.draggable}),[s,b,m,N,x,c.draggable]);return{active:d,activatorEvent:l,activeNodeRect:u,attributes:C,isDragging:N,listeners:s?void 0:L,node:y,over:p,setNodeRef:g,setActivatorNodeRef:I,transform:_}}function Tp(){return f.useContext(Ll)}const wp="Droppable",Ip={timeout:25};function Cp(e){let{data:t,disabled:n=!1,id:s,resizeObserverConfig:a}=e;const r=Us(wp),{active:o,dispatch:l,over:d,measureDroppableContainers:u}=f.useContext(_a),c=f.useRef({disabled:n}),h=f.useRef(!1),p=f.useRef(null),b=f.useRef(null),{disabled:x,updateMeasurementsFor:m,timeout:N}={...Ip,...a},_=ys(m??s),y=f.useCallback(()=>{if(!h.current){h.current=!0;return}b.current!=null&&clearTimeout(b.current),b.current=setTimeout(()=>{u(Array.isArray(_.current)?_.current:[_.current]),b.current=null},N)},[N]),g=ya({callback:y,disabled:x||!o}),w=f.useCallback((C,j)=>{g&&(j&&(g.unobserve(j),h.current=!1),C&&g.observe(C))},[g]),[I,L]=aa(w),k=ys(t);return f.useEffect(()=>{!g||!I.current||(g.disconnect(),h.current=!1,g.observe(I.current))},[I,g]),f.useEffect(()=>(l({type:Ee.RegisterDroppable,element:{id:s,key:r,disabled:n,node:I,rect:p,data:k}}),()=>l({type:Ee.UnregisterDroppable,key:r,id:s})),[s]),f.useEffect(()=>{n!==c.current.disabled&&(l({type:Ee.SetDroppableDisabled,id:s,key:r,disabled:n}),c.current.disabled=n)},[s,r,n,l]),{active:o,rect:p,isOver:d?.id===s,node:I,over:d,setNodeRef:L}}function ln(e,t,n){const s=e.slice();return s.splice(n<0?s.length+n:n,0,s.splice(t,1)[0]),s}function jp(e,t){return e.reduce((n,s,a)=>{const r=t.get(s);return r&&(n[a]=r),n},Array(e.length))}function Xs(e){return e!==null&&e>=0}function Lp(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function kp(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Al=e=>{let{rects:t,activeIndex:n,overIndex:s,index:a}=e;const r=ln(t,s,n),o=t[a],l=r[a];return!l||!o?null:{x:l.left-o.left,y:l.top-o.top,scaleX:l.width/o.width,scaleY:l.height/o.height}},Ws={scaleX:1,scaleY:1},ts=e=>{var t;let{activeIndex:n,activeNodeRect:s,index:a,rects:r,overIndex:o}=e;const l=(t=r[n])!=null?t:s;if(!l)return null;if(a===n){const u=r[o];return u?{x:0,y:n<o?u.top+u.height-(l.top+l.height):u.top-l.top,...Ws}:null}const d=Ap(r,a,n);return a>n&&a<=o?{x:0,y:-l.height-d,...Ws}:a<n&&a>=o?{x:0,y:l.height+d,...Ws}:{x:0,y:0,...Ws}};function Ap(e,t,n){const s=e[t],a=e[t-1],r=e[t+1];return s?n<t?a?s.top-(a.top+a.height):r?r.top-(s.top+s.height):0:r?r.top-(s.top+s.height):a?s.top-(a.top+a.height):0:0}const Sl="Sortable",Dl=S.createContext({activeIndex:-1,containerId:Sl,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Al,disabled:{draggable:!1,droppable:!1}});function ns(e){let{children:t,id:n,items:s,strategy:a=Al,disabled:r=!1}=e;const{active:o,dragOverlay:l,droppableRects:d,over:u,measureDroppableContainers:c}=Tp(),h=Us(Sl,n),p=l.rect!==null,b=f.useMemo(()=>s.map(L=>typeof L=="object"&&"id"in L?L.id:L),[s]),x=o!=null,m=o?b.indexOf(o.id):-1,N=u?b.indexOf(u.id):-1,_=f.useRef(b),y=!Lp(b,_.current),g=N!==-1&&m===-1||y,w=kp(r);Ct(()=>{y&&x&&c(b)},[y,b,x,c]),f.useEffect(()=>{_.current=b},[b]);const I=f.useMemo(()=>({activeIndex:m,containerId:h,disabled:w,disableTransforms:g,items:b,overIndex:N,useDragOverlay:p,sortedRects:jp(b,d),strategy:a}),[m,h,w.draggable,w.droppable,g,b,N,d,p,a]);return S.createElement(Dl.Provider,{value:I},t)}const Sp=e=>{let{id:t,items:n,activeIndex:s,overIndex:a}=e;return ln(n,s,a).indexOf(t)},Dp=e=>{let{containerId:t,isSorting:n,wasDragging:s,index:a,items:r,newIndex:o,previousItems:l,previousContainerId:d,transition:u}=e;return!u||!s||l!==r&&a===o?!1:n?!0:o!==a&&t===d},Rp={duration:200,easing:"ease"},Rl="transform",Mp=jt.Transition.toString({property:Rl,duration:0,easing:"linear"}),Op={roleDescription:"sortable"};function Pp(e){let{disabled:t,index:n,node:s,rect:a}=e;const[r,o]=f.useState(null),l=f.useRef(n);return Ct(()=>{if(!t&&n!==l.current&&s.current){const d=a.current;if(d){const u=Zn(s.current,{ignoreTransform:!0}),c={x:d.left-u.left,y:d.top-u.top,scaleX:d.width/u.width,scaleY:d.height/u.height};(c.x||c.y)&&o(c)}}n!==l.current&&(l.current=n)},[t,n,s,a]),f.useEffect(()=>{r&&o(null)},[r]),r}function cn(e){let{animateLayoutChanges:t=Dp,attributes:n,disabled:s,data:a,getNewIndex:r=Sp,id:o,strategy:l,resizeObserverConfig:d,transition:u=Rp}=e;const{items:c,containerId:h,activeIndex:p,disabled:b,disableTransforms:x,sortedRects:m,overIndex:N,useDragOverlay:_,strategy:y}=f.useContext(Dl),g=Fp(s,b),w=c.indexOf(o),I=f.useMemo(()=>({sortable:{containerId:h,index:w,items:c},...a}),[h,a,w,c]),L=f.useMemo(()=>c.slice(c.indexOf(o)),[c,o]),{rect:k,node:C,isOver:j,setNodeRef:O}=Cp({id:o,data:I,disabled:g.droppable,resizeObserverConfig:{updateMeasurementsFor:L,...d}}),{active:V,activatorEvent:D,activeNodeRect:$,attributes:B,setNodeRef:se,listeners:Te,isDragging:de,over:tt,setActivatorNodeRef:Me,transform:Et}=_p({id:o,data:I,attributes:{...Op,...n},disabled:g.draggable}),Rt=af(O,se),ue=!!V,Be=ue&&!x&&Xs(p)&&Xs(N),nt=!_&&de,ze=nt&&Be?Et:null,Oe=Be?ze??(l??y)({rects:m,activeNodeRect:$,activeIndex:p,overIndex:N,index:w}):null,Pe=Xs(p)&&Xs(N)?r({id:o,items:c,activeIndex:p,overIndex:N}):w,Xe=V?.id,z=f.useRef({activeId:Xe,items:c,newIndex:Pe,containerId:h}),Mt=c!==z.current.items,be=t({active:V,containerId:h,isDragging:de,isSorting:ue,id:o,index:w,items:c,newIndex:z.current.newIndex,previousItems:z.current.items,previousContainerId:z.current.containerId,transition:u,wasDragging:z.current.activeId!=null}),W=Pp({disabled:!be,index:w,node:C,rect:k});return f.useEffect(()=>{ue&&z.current.newIndex!==Pe&&(z.current.newIndex=Pe),h!==z.current.containerId&&(z.current.containerId=h),c!==z.current.items&&(z.current.items=c)},[ue,Pe,h,c]),f.useEffect(()=>{if(Xe===z.current.activeId)return;if(Xe&&!z.current.activeId){z.current.activeId=Xe;return}const fe=setTimeout(()=>{z.current.activeId=Xe},50);return()=>clearTimeout(fe)},[Xe]),{active:V,activeIndex:p,attributes:B,data:I,rect:k,index:w,newIndex:Pe,items:c,isOver:j,isSorting:ue,isDragging:de,listeners:Te,node:C,overIndex:N,over:tt,setNodeRef:Rt,setActivatorNodeRef:Me,setDroppableNodeRef:O,setDraggableNodeRef:se,transform:W??Oe,transition:ee()};function ee(){if(W||Mt&&z.current.newIndex===w)return Mp;if(!(nt&&!$r(D)||!u)&&(ue||be))return jt.Transition.toString({...u,property:Rl})}}function Fp(e,t){var n,s;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e?.draggable)!=null?n:t.draggable,droppable:(s=e?.droppable)!=null?s:t.droppable}}q.Down,q.Right,q.Up,q.Left;const Up=({table:e})=>{const{updateTable:t,updateTablesState:n,removeTable:s,createIndex:a,createField:r,createTable:o,schemas:l,databaseType:d,readonly:u}=H(),{schemasDisplayed:c}=ba(),{openTableSchemaDialog:h}=Gn(),{t:p}=Q(),{focusOnTable:b}=va(),[x,m]=S.useState(!1),[N,_]=S.useState(e.name),y=S.useRef(null),{listeners:g}=cn({id:e.id}),w=f.useCallback(()=>{x&&(N.trim()&&t(e.id,{name:N.trim()}),m(!1))},[N,e.id,t,x]),I=f.useCallback(()=>{m(!1),_(e.name)},[e.name]);Rs(y,w),en("Enter",w),en("Escape",I);const L=B=>{B.stopPropagation(),m(!0)},k=f.useCallback(B=>{B.stopPropagation(),b(e.id)},[b,e.id]),C=f.useCallback(()=>{s(e.id)},[e.id,s]),j=f.useCallback(({schema:B})=>{n(se=>se.map(Te=>Te.id===e.id||!Te.schema?{...Te,schema:B.name}:Te))},[e.id,n]),O=f.useCallback(()=>{h({table:e,schemas:l,onConfirm:j,allowSchemaCreation:!0})},[h,e,l,j]),V=f.useCallback(B=>{B.stopPropagation();const se=Gd(e);se.name=`${se.name}_copy`,se.x+=30,se.y+=50,o(se)},[o,e]),D=f.useCallback(()=>i.jsxs(sn,{children:[i.jsx(an,{children:i.jsx(_e,{children:i.jsx(Wn,{})})}),i.jsxs(rn,{className:"w-fit min-w-40",children:[i.jsx($n,{children:p("side_panel.tables_section.table.table_actions.title")}),i.jsx(wt,{}),l.length>0||vn?.[d]?i.jsxs(i.Fragment,{children:[i.jsx(It,{children:i.jsxs(Je,{className:"flex justify-between gap-4",onClick:B=>{B.stopPropagation(),O()},children:[p("side_panel.tables_section.table.table_actions.change_schema"),i.jsx(xa,{className:"size-3.5"})]})}),i.jsx(wt,{})]}):null,i.jsxs(It,{children:[i.jsxs(Je,{className:"flex justify-between gap-4",onClick:B=>{B.stopPropagation(),r(e.id)},children:[p("side_panel.tables_section.table.table_actions.add_field"),i.jsx(ur,{className:"size-3.5"})]}),i.jsxs(Je,{className:"flex justify-between gap-4",onClick:B=>{B.stopPropagation(),a(e.id)},children:[p("side_panel.tables_section.table.table_actions.add_index"),i.jsx(fr,{className:"size-3.5"})]})]}),i.jsx(wt,{}),i.jsx(It,{children:i.jsxs(Je,{onClick:V,className:"flex justify-between",children:[p("side_panel.tables_section.table.table_actions.duplicate_table"),i.jsx(ch,{className:"size-3.5"})]})}),i.jsx(wt,{}),i.jsx(It,{children:i.jsxs(Je,{onClick:C,className:"flex justify-between !text-red-700",children:[p("side_panel.tables_section.table.table_actions.delete_table"),i.jsx(vt,{className:"size-3.5 text-red-700"})]})})]})]}),[e.id,r,a,C,V,p,O,l.length,d]),$=f.useMemo(()=>{if(c.length>1)return e.schema??vn[d]},[e.schema,c.length,d]);return f.useEffect(()=>{e.name.trim()&&_(e.name.trim())},[e.name]),i.jsxs("div",{className:"group flex h-11 flex-1 items-center justify-between gap-1 overflow-hidden",children:[u?null:i.jsx("div",{className:"flex cursor-move items-center justify-center",...g,children:i.jsx(zn,{className:"size-4 text-muted-foreground"})}),i.jsx("div",{className:"flex min-w-0 flex-1 px-1",children:x?i.jsx(Ne,{ref:y,autoFocus:!0,type:"text",placeholder:e.name,value:N,onClick:B=>B.stopPropagation(),onChange:B=>_(B.target.value),className:"h-7 w-full focus-visible:ring-0"}):u?i.jsxs("div",{className:"truncate px-2 py-0.5",children:[e.name,i.jsx("span",{className:"text-xs text-muted-foreground",children:$?` (${$})`:""})]}):i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:i.jsxs("div",{onDoubleClick:L,className:"text-editable truncate px-2 py-0.5",children:[e.name,i.jsx("span",{className:"text-xs text-muted-foreground",children:$?` (${$})`:""})]})}),i.jsx(ve,{children:p("tool_tips.double_click_to_edit")})]})}),i.jsx("div",{className:"flex flex-row-reverse",children:x?i.jsx(_e,{onClick:w,children:i.jsx(Kn,{})}):i.jsxs(i.Fragment,{children:[u?null:i.jsx("div",{children:D()}),i.jsxs("div",{className:"flex flex-row-reverse md:hidden md:group-hover:flex",children:[u?null:i.jsx(_e,{onClick:L,children:i.jsx(Xn,{})}),i.jsx(_e,{onClick:k,children:i.jsx(Ms,{})})]})]})})]})},vr=S.forwardRef(({className:e,...t},n)=>i.jsx(Na,{...t,ref:n,variant:"default",className:P("h-8 w-[32px] p-2 text-xs text-slate-500 hover:bg-primary-foreground hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200","data-[state=on]:text-orange-600 dark:data-[state=on]:text-orange-400",e)}));vr.displayName=Na.displayName;const Bp=({field:e,table:t,databaseType:n,updateField:s,removeField:a,open:r,onOpenChange:o})=>{const{readonly:l}=H(),{t:d}=Q(),[u,c]=S.useState(e),[h,p]=S.useState(!1),b=f.useMemo(()=>r??h,[r,h]),x=f.useCallback(C=>{o?o(C):p(C)},[o,p]),m=S.useMemo(()=>{if(!e.primaryKey)return!1;for(const C of t.fields)if(C.id!==e.id&&C.primaryKey)return!1;return!0},[t.fields,e.primaryKey,e.id]);f.useEffect(()=>{c(e)},[e]);const N=f.useCallback(C=>{s(C)},[s]),_=nu(N,200),y=f.useRef(e);f.useEffect(()=>{b&&!ah(y.current,u)&&_({comments:u.comments,characterMaximumLength:u.characterMaximumLength,precision:u.precision,scale:u.scale,unique:u.unique,default:u.default,increment:u.increment,isArray:u.isArray}),y.current=u},[u,_,b]);const g=f.useMemo(()=>gi(e.type.id,n),[e.type.id,n]),w=f.useMemo(()=>Kd(e.type.name),[e.type.name]),I=f.useMemo(()=>zd(e.type.name,n),[e.type.name,n]),L=f.useMemo(()=>Xd(e.type.name)&&!u.nullable,[e.type.name,u.nullable]),k=f.useMemo(()=>u.nullable||l||L,[u.nullable,l,L]);return i.jsxs(qo,{open:b,onOpenChange:C=>{x(C),C&&c(e)},children:[i.jsx(Ho,{asChild:!0,children:i.jsx(K,{variant:"ghost",className:"h-8 w-[32px] p-2 text-slate-500 hover:bg-primary-foreground hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",children:i.jsx(Yo,{className:"size-3.5"})})}),i.jsx(Qo,{className:"w-52",children:i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("div",{className:"text-sm font-semibold",children:d("side_panel.tables_section.table.field_actions.title")}),i.jsx(Zt,{orientation:"horizontal"}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(Ye,{htmlFor:"width",className:"text-subtitle",children:d("side_panel.tables_section.table.field_actions.unique")}),i.jsx(Ys,{checked:u.unique,disabled:m||l,onCheckedChange:C=>c(j=>({...j,unique:!!C}))})]}),w?i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(Ye,{htmlFor:"increment",className:"text-subtitle",children:d("side_panel.tables_section.table.field_actions.auto_increment")}),i.jsx(Ys,{checked:L?!0:u.increment??!1,disabled:k,onCheckedChange:C=>c(j=>({...j,increment:!!C}))})]}):null,I?i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(Ye,{htmlFor:"isArray",className:"text-subtitle",children:"Array"}),i.jsx(Ys,{checked:u.isArray??!1,disabled:l,onCheckedChange:C=>c(j=>({...j,isArray:!!C}))})]}):null,i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx(Ye,{htmlFor:"default",className:"text-subtitle",children:d("side_panel.tables_section.table.field_actions.default_value")}),i.jsx(Ne,{value:u.default??"",onChange:C=>c(j=>({...j,default:C.target.value||null})),placeholder:d("side_panel.tables_section.table.field_actions.no_default"),className:"w-full rounded-md bg-muted text-sm",readOnly:l})]}),g?.fieldAttributes?.hasCharMaxLength?i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx(Ye,{htmlFor:"width",className:"text-subtitle",children:d("side_panel.tables_section.table.field_actions.character_length")}),g?.fieldAttributes?.hasCharMaxLengthOption?i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(Ls,{value:u.characterMaximumLength==="max"?"max":u.characterMaximumLength?"custom":"none",onValueChange:C=>{c(C==="max"?j=>({...j,characterMaximumLength:"max"}):C==="custom"?j=>({...j,characterMaximumLength:"255"}):j=>({...j,characterMaximumLength:null}))},disabled:l,children:[i.jsx(ks,{className:"w-full bg-muted",children:i.jsx(As,{placeholder:"Select length"})}),i.jsxs(Ss,{children:[i.jsx(je,{value:"none",children:"No length"}),i.jsx(je,{value:"max",children:"MAX"}),i.jsx(je,{value:"custom",children:"Custom"})]})]}),u.characterMaximumLength&&u.characterMaximumLength!=="max"?i.jsx(Ne,{value:u.characterMaximumLength,type:"number",min:"1",max:g?.fieldAttributes?.maxLength||void 0,onChange:C=>c(j=>({...j,characterMaximumLength:C.target.value})),className:"w-24 rounded-md bg-muted text-sm",readOnly:l}):null]}):i.jsx(Ne,{value:u.characterMaximumLength??"",type:"number",onChange:C=>c(j=>({...j,characterMaximumLength:C.target.value})),className:"w-full rounded-md bg-muted text-sm",readOnly:l})]}):null,g?.fieldAttributes?.precision||g?.fieldAttributes?.scale?i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"flex flex-1 flex-col gap-2",children:[i.jsx(Ye,{htmlFor:"width",className:"text-subtitle",children:d("side_panel.tables_section.table.field_actions.precision")}),i.jsx(Ne,{value:u.precision??"",type:"number",max:g?.fieldAttributes?.precision?(g?.fieldAttributes?.precision).max:void 0,min:g?.fieldAttributes?.precision?(g?.fieldAttributes?.precision).min:void 0,placeholder:g?.fieldAttributes?.precision?`${(g?.fieldAttributes?.precision).default}`:"Optional",onChange:C=>c(j=>({...j,precision:C.target.value?parseInt(C.target.value):void 0})),className:"w-full rounded-md bg-muted text-sm",readOnly:l})]}),i.jsxs("div",{className:"flex flex-1 flex-col gap-2",children:[i.jsx(Ye,{htmlFor:"width",className:"text-subtitle",children:d("side_panel.tables_section.table.field_actions.scale")}),i.jsx(Ne,{value:u.scale??"",max:g?.fieldAttributes?.scale?(g?.fieldAttributes?.scale).max:void 0,min:g?.fieldAttributes?.scale?(gi(e.type.id)?.fieldAttributes?.scale).min:void 0,placeholder:g?.fieldAttributes?.scale?`${(g?.fieldAttributes?.scale).default}`:"Optional",type:"number",onChange:C=>c(j=>({...j,scale:C.target.value?parseInt(C.target.value):void 0})),className:"w-full rounded-md bg-muted text-sm",readOnly:l})]})]}):null,i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx(Ye,{htmlFor:"width",className:"text-subtitle",children:d("side_panel.tables_section.table.field_actions.comments")}),i.jsx(cl,{value:u.comments??void 0,onChange:C=>c(j=>({...j,comments:C.target.value})),placeholder:d("side_panel.tables_section.table.field_actions.no_comments"),className:"w-full rounded-md bg-muted text-sm",readOnly:l})]})]}),l?null:i.jsxs(i.Fragment,{children:[i.jsx(Zt,{orientation:"horizontal"}),i.jsxs(K,{variant:"outline",className:"flex gap-2 !text-red-700",onClick:a,children:[i.jsx(vt,{className:"size-3.5 text-red-700"}),d("side_panel.tables_section.table.field_actions.delete_field")]})]})]})})]})},$p=({table:e,field:t,updateField:n,removeField:s,databaseType:a,readonly:r=!1})=>{const{t:o}=Q(),{attributes:l,listeners:d,setNodeRef:u,transform:c,transition:h}=cn({id:t.id}),{dataFieldOptions:p,handleDataTypeChange:b,handlePrimaryKeyToggle:x,handleNullableToggle:m,handleNameChange:N,generateFieldSuffix:_,fieldName:y,nullable:g,primaryKey:w}=rh(e,t,n),I={transform:jt.Translate.toString(c),transition:h},L=Wd(t.type.name),[k,C]=f.useState(!1),j=f.useCallback(()=>{C(!0)},[]);return i.jsxs("div",{className:"flex flex-1 touch-none flex-row justify-between gap-2 p-1",ref:u,style:I,...l,children:[i.jsxs("div",{className:"flex flex-1 items-center justify-start gap-1 overflow-hidden",children:[r?null:i.jsx("div",{className:"flex w-4 shrink-0 cursor-move items-center justify-center",...d,children:i.jsx(zn,{className:"size-3.5  text-muted-foreground"})}),i.jsxs("span",{className:"relative min-w-0 flex-1",children:[i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:i.jsx(Ne,{className:"h-8 w-full !truncate focus-visible:ring-0",type:"text",placeholder:o("side_panel.tables_section.table.field_name"),value:y,onChange:O=>N(O.target.value),readOnly:r})}),i.jsx(ve,{children:t.name})]}),t.comments?i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:i.jsx("div",{className:"absolute right-0 top-0 h-full w-[10px] cursor-pointer",onClick:j,children:i.jsx("div",{className:"pointer-events-none absolute right-0 top-0 size-0 border-l-[10px] border-t-[10px] border-l-transparent border-t-pink-500"})})}),i.jsx(ve,{className:"max-w-xs",children:i.jsxs("div",{children:[i.jsx("div",{className:"font-normal text-white/70 dark:text-black/70",children:"Comment:"}),i.jsx("div",{className:"whitespace-pre-wrap break-words",children:t.comments})]})})]}):null]}),i.jsxs(xe,{children:[i.jsx(ge,{className:"flex h-8 min-w-0 flex-1",asChild:!0,children:i.jsx("span",{children:i.jsx(sa,{className:"flex h-8 min-h-8 w-full",popoverClassName:"min-w-[350px]",options:p,placeholder:o("side_panel.tables_section.table.field_type"),value:t.type.id,valueSuffix:qd(t,{databaseType:a}),optionSuffix:O=>_(O.value),onChange:b,emptyPlaceholder:o("side_panel.tables_section.table.no_types_found"),readonly:r})})}),i.jsxs(ve,{children:[t.type.name,t.characterMaximumLength?`(${t.characterMaximumLength})`:""]})]})]}),i.jsxs("div",{className:"flex shrink-0 items-center justify-end gap-1",children:[i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:i.jsx("span",{children:i.jsx(vr,{pressed:g,onPressedChange:m,disabled:r||L,children:"N"})})}),i.jsx(ve,{children:g?"Null":"Not Null"})]}),i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:i.jsx("span",{children:i.jsx(vr,{pressed:w,onPressedChange:x,disabled:r,children:i.jsx(al,{className:"h-3.5"})})})}),i.jsx(ve,{children:o("side_panel.tables_section.table.primary_key")})]}),i.jsx(Bp,{field:t,table:e,updateField:n,removeField:s,databaseType:a,open:k,onOpenChange:C})]})]})},Nr=S.forwardRef((e,t)=>i.jsx(Na,{...e,ref:t,variant:"default",className:"h-8 w-[32px] p-2 text-xs text-slate-500 hover:bg-primary-foreground hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"}));Nr.displayName=Na.displayName;const Vp=[{label:"B-tree (default)",value:"btree"},{label:"Hash",value:"hash"}],Gp=({fields:e,index:t,updateIndex:n,removeIndex:s})=>{const{t:a}=Q(),{databaseType:r,readonly:o}=H(),l=e.map(h=>({label:h.name,value:h.id})),d=f.useCallback(h=>{const p=Array.isArray(h)?h:[h];t.type==="hash"&&p.length>0?n({fieldIds:[p[p.length-1]]}):n({fieldIds:p})},[t.type,n]),u=f.useMemo(()=>Vp.filter(h=>Hd[r]?.includes(h.value)),[r]),c=f.useCallback(h=>{{const p=h;p==="hash"&&t.fieldIds.length>1?n({type:p,fieldIds:[t.fieldIds[0]]}):n({type:p})}},[n,t.fieldIds]);return i.jsxs("div",{className:"flex flex-1 flex-row justify-between gap-2 p-1",children:[i.jsx(sa,{className:"flex h-8 min-h-8 min-w-0 flex-1",multiple:!0,oneLine:!0,options:l,placeholder:a("side_panel.tables_section.table.index_select_fields"),value:t.fieldIds,onChange:d,emptyPlaceholder:a("side_panel.tables_section.table.no_types_found"),keepOrder:!0,disabled:t.isPrimaryKey??!1,readonly:o}),i.jsxs("div",{className:"flex shrink-0 gap-1",children:[t.isPrimaryKey?i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:i.jsx("span",{children:i.jsx(Nr,{pressed:!0,disabled:!0,children:i.jsx(al,{className:"h-3.5"})})})}),i.jsx(ve,{children:a("side_panel.tables_section.table.primary_key")})]}):i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:i.jsx("span",{children:i.jsx(Nr,{pressed:t.unique,onPressedChange:h=>n({unique:!!h}),disabled:o,children:"U"})})}),i.jsx(ve,{children:a("side_panel.tables_section.table.index_actions.unique")})]}),t.isPrimaryKey?i.jsx("div",{className:"h-8 w-[32px]"}):i.jsxs(qo,{children:[i.jsx(Ho,{asChild:!0,children:i.jsx(K,{variant:"ghost",className:"h-8 w-[32px] p-2 text-slate-500 hover:bg-primary-foreground hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",children:i.jsx(Yo,{className:"size-3.5"})})}),i.jsx(Qo,{className:"w-52",children:i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("div",{className:"text-sm font-semibold",children:a("side_panel.tables_section.table.index_actions.title")}),i.jsx(Zt,{orientation:"horizontal"}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx(Ye,{htmlFor:"width",className:"text-subtitle",children:a("side_panel.tables_section.table.index_actions.name")}),i.jsx(Ne,{value:t.name,onChange:h=>n({name:h.target.value}),readOnly:o})]}),i.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[i.jsx(Ye,{htmlFor:"width",className:"text-subtitle",children:a("side_panel.tables_section.table.index_actions.unique")}),i.jsx(Ys,{checked:t.unique,onCheckedChange:h=>n({unique:!!h}),disabled:o})]}),u.length>0?i.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[i.jsx(Ye,{htmlFor:"indexType",className:"text-subtitle",children:a("side_panel.tables_section.table.index_actions.index_type")}),i.jsx(sa,{options:u,value:t.type||"btree",onChange:c,readonly:o})]}):null,o?null:i.jsxs(i.Fragment,{children:[i.jsx(Zt,{orientation:"horizontal"}),i.jsxs(K,{variant:"outline",className:"flex gap-2 !text-red-700",onClick:s,children:[i.jsx(vt,{className:"size-3.5 text-red-700"}),a("side_panel.tables_section.table.index_actions.delete_index")]})]})]})})]})]})]})},Kp=({table:e})=>{const{updateField:t,removeField:n,createField:s,createIndex:a,removeIndex:r,updateIndex:o,updateTable:l,readonly:d,databaseType:u}=H(),{t:c}=Q(),{color:h}=e,[p,b]=S.useState(["fields"]),x=Qn(Yn(on)),m=f.useCallback((g,w)=>{if(t(e.id,g,w),w.primaryKey===!1){const I=e.fields.filter(L=>L.id!==g&&L.primaryKey);I.length===1&&t(e.id,I[0].id,{unique:!0},{updateHistory:!1})}},[e.id,e.fields,t]),N=g=>{const{active:w,over:I}=g;if(w?.id!==I?.id&&I&&w){const L=e.fields,k=L.findIndex(j=>j.id===w.id),C=L.findIndex(j=>j.id===I.id);l(e.id,{fields:ln(L,k,C)})}},_=f.useCallback(g=>{g.stopPropagation(),b(w=>w.includes("indexes")?w:[...w,"indexes"]),a(e.id)},[a,e.id,b]),y=f.useCallback(g=>{g.stopPropagation(),s(e.id)},[s,e.id]);return i.jsxs("div",{className:"flex flex-col gap-1 rounded-b-md border-l-[6px] px-1",style:{borderColor:h},children:[i.jsxs(ma,{type:"multiple",className:"w-full",value:p,onValueChange:g=>b(g),children:[i.jsxs(mn,{value:"fields",className:"mb-2 border-y-0",children:[i.jsx(bn,{iconPosition:"right",className:"group flex flex-1 p-0 px-2 py-1 text-xs text-subtitle hover:bg-secondary",asChild:!0,children:i.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[i.jsxs("div",{className:"flex flex-row items-center gap-1",children:[i.jsx(ur,{className:"size-4"}),c("side_panel.tables_section.table.fields")]}),d?null:i.jsx("div",{className:"flex flex-row-reverse",children:i.jsx("div",{className:"hidden flex-row-reverse group-hover:flex",children:i.jsx(K,{variant:"ghost",className:"size-4 p-0 text-xs hover:bg-primary-foreground",onClick:y,children:i.jsx(Jt,{className:"size-4 shrink-0 text-muted-foreground transition-transform duration-200"})})})})]})}),i.jsx(xn,{className:"flex flex-col pb-0 pt-1",children:i.jsxs(es,{sensors:x,collisionDetection:Jn,onDragEnd:N,children:[i.jsx(ns,{items:e.fields,strategy:ts,children:e.fields.map(g=>i.jsx($p,{field:g,table:e,updateField:w=>m(g.id,w),removeField:()=>n(e.id,g.id),databaseType:u,readonly:d},g.id))}),d?null:i.jsx("div",{className:"flex justify-start p-1",children:i.jsxs(K,{variant:"ghost",className:"flex h-7 items-center gap-1 px-2 text-xs",onClick:y,children:[i.jsx(Jt,{className:"size-4 text-muted-foreground"}),c("side_panel.tables_section.table.add_field")]})})]})})]}),i.jsxs(mn,{value:"indexes",className:"mb-2 border-y-0",children:[i.jsx(bn,{iconPosition:"right",className:"group flex flex-1 p-0 px-2 py-1 text-xs text-subtitle hover:bg-secondary",asChild:!0,children:i.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[i.jsxs("div",{className:"flex flex-row items-center gap-1",children:[i.jsx(fr,{className:"size-4"}),c("side_panel.tables_section.table.indexes")]}),d?null:i.jsx("div",{className:"flex flex-row-reverse",children:i.jsx("div",{className:"hidden flex-row-reverse group-hover:flex",children:i.jsx(K,{variant:"ghost",className:"size-4 p-0 text-xs hover:bg-primary-foreground",onClick:_,children:i.jsx(Jt,{className:"size-4 shrink-0 text-muted-foreground transition-transform duration-200"})})})})]})}),i.jsxs(xn,{className:"pb-0 pt-1",children:[[...e.indexes].sort((g,w)=>g.isPrimaryKey&&!w.isPrimaryKey?-1:!g.isPrimaryKey&&w.isPrimaryKey?1:0).map(g=>i.jsx(Gp,{index:g,removeIndex:()=>r(e.id,g.id),updateIndex:w=>o(e.id,g.id,w),fields:e.fields},g.id)),d?null:i.jsx("div",{className:"flex justify-start p-1",children:i.jsxs(K,{variant:"ghost",className:"flex h-7 items-center gap-1 px-2 text-xs",onClick:_,children:[i.jsx(Jt,{className:"size-4 text-muted-foreground"}),c("side_panel.tables_section.table.add_index")]})})]})]}),i.jsxs(mn,{value:"comments",className:"border-y-0",children:[i.jsx(bn,{iconPosition:"right",className:"group flex flex-1 p-0 px-2 py-1 text-xs text-subtitle hover:bg-secondary",asChild:!0,children:i.jsx("div",{className:"flex flex-1 items-center justify-between",children:i.jsxs("div",{className:"flex flex-row items-center gap-1",children:[i.jsx(ih,{className:"size-4"}),c("side_panel.tables_section.table.comments")]})})}),i.jsx(xn,{className:"pb-0 pt-1",children:i.jsx(cl,{value:e.comments??void 0,onChange:g=>l(e.id,{comments:g.target.value}),placeholder:c("side_panel.tables_section.table.no_comments"),className:"w-full rounded-md bg-muted text-sm focus-visible:ring-0",readOnly:d})})]})]}),d?null:i.jsx(Zt,{className:""}),i.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[!e.isView&&!d?i.jsx(Mr,{color:h,onChange:g=>l(e.id,{color:g})}):i.jsx("div",{}),d?null:i.jsxs("div",{className:"flex gap-1",children:[i.jsxs(K,{variant:"outline",className:"h-8 p-2 text-xs",onClick:_,children:[i.jsx(fr,{className:"h-4"}),c("side_panel.tables_section.table.add_index")]}),i.jsxs(K,{variant:"outline",className:"h-8 p-2 text-xs",onClick:y,children:[i.jsx(ur,{className:"h-4"}),c("side_panel.tables_section.table.add_field")]})]})]})]})},Ml=S.forwardRef(({table:e},t)=>{const{attributes:n,setNodeRef:s,transform:a,transition:r}=cn({id:e.id}),o={transform:jt.Translate.toString(a),transition:r};return i.jsx(mn,{value:e.id,className:"border-none",ref:t,children:i.jsxs("div",{className:"w-full rounded-md border-b",ref:s,style:o,...n,children:[i.jsx(bn,{className:"w-full rounded-md border-l-[6px] px-2 py-0 hover:bg-accent hover:no-underline data-[state=open]:rounded-b-none",style:{borderColor:e.color},asChild:!0,children:i.jsx(Up,{table:e})}),i.jsx(xn,{children:i.jsx(Kp,{table:e})})]})})});Ml.displayName="TableListItem";const zp=({tables:e})=>{const{updateTablesState:t}=H(),{openTableFromSidebar:n,openedTableInSidebar:s}=Ve(),a=S.useRef(null),r=f.useMemo(()=>e.reduce((c,h)=>(c[h.id]=S.createRef(),c),{}),[e]),o=f.useCallback(c=>r[c]?.current?.scrollIntoView({behavior:"smooth",block:"start"}),[r]),l=Qn(Yn(on)),d=c=>{const{active:h,over:p}=c;if(h?.id!==p?.id&&p&&h){const b=e.findIndex(N=>N.id===h.id),x=e.findIndex(N=>N.id===p.id),m=ln(e,b,x).reduce((N,_,y)=>(N.set(_.id,y),N),new Map);t(N=>N.map(_=>({id:_.id,order:m.get(_.id)})))}},u=f.useCallback(()=>{s&&a.current!==s&&(a.current=s,o(s))},[o,s]);return i.jsx(ma,{type:"single",collapsible:!0,className:"flex w-full flex-col gap-1",value:s,onValueChange:n,onAnimationEnd:u,children:i.jsx(es,{sensors:l,collisionDetection:Jn,onDragEnd:d,children:i.jsx(ns,{items:e,strategy:ts,children:e.sort((c,h)=>c.order&&h.order===void 0?-1:c.order===void 0&&h.order?1:c.order!==void 0&&h.order!==void 0?(c.order??0)-(h.order??0):c.isView===h.isView?c.name.localeCompare(h.name):c.isView?1:-1).map(c=>i.jsx(Ml,{table:c,ref:r[c.id]},c.id))})})})},Xp="/assets/empty_state-FM0xVkGj.png",Wp="/assets/empty_state_dark-CGFOiUtp.png";function qp({className:e,...t}){return i.jsx("div",{"data-slot":"empty",className:P("flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12",e),...t})}function Hp({className:e,...t}){return i.jsx("div",{"data-slot":"empty-header",className:P("flex max-w-sm flex-col items-center gap-2 text-center",e),...t})}const Yp=Or("mb-2 flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:shrink-0",{variants:{variant:{default:"bg-transparent",icon:"flex size-10 shrink-0 items-center justify-center rounded-lg bg-muted text-foreground [&_svg:not([class*='size-'])]:size-6"}},defaultVariants:{variant:"default"}});function Qp({className:e,variant:t="default",...n}){return i.jsx("div",{"data-slot":"empty-icon","data-variant":t,className:P(Yp({variant:t,className:e})),...n})}function Jp({className:e,...t}){return i.jsx("div",{"data-slot":"empty-title",className:P("text-lg font-medium tracking-tight",e),...t})}function Zp({className:e,...t}){return i.jsx("div",{"data-slot":"empty-description",className:P("text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4",e),...t})}function Qi({className:e,...t}){return i.jsx("div",{"data-slot":"empty-content",className:P("flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm",e),...t})}const ss=f.forwardRef(({title:e,description:t,className:n,titleClassName:s,descriptionClassName:a,imageClassName:r,primaryAction:o,secondaryAction:l,footerAction:d},u)=>{const{effectiveTheme:c}=Os(),h=f.useMemo(()=>!!(o||l),[o,l]),p=f.useMemo(()=>!!d,[d]),b=f.useMemo(()=>c==="dark"?Wp:Xp,[c]);return i.jsx("div",{ref:u,className:P("flex flex-1 flex-col items-center justify-center space-y-1",n),children:i.jsxs(qp,{children:[i.jsxs(Hp,{children:[i.jsx(Qp,{variant:"icon",children:i.jsx("img",{src:b,alt:"Empty state",className:P("p-2",r)})}),i.jsx(Jp,{className:s,children:e}),i.jsx(Zp,{className:a,children:t})]}),h&&i.jsx(Qi,{children:i.jsxs("div",{className:"flex gap-2",children:[o&&i.jsxs(K,{onClick:o.onClick,disabled:o.disabled,className:"h-8 font-normal",children:[o.label,o.icon]}),l&&i.jsxs(K,{variant:"outline",onClick:l.onClick,disabled:l.disabled,className:"h-8 font-normal",children:[l.label,l.icon]})]})}),p&&d&&i.jsx(K,{variant:"link",asChild:!!d.href,className:"text-muted-foreground",size:"sm",disabled:d.disabled,onClick:d.href?void 0:d.onClick,children:d.href?i.jsxs("a",{href:d.href,children:[d.label,d.icon]}):i.jsxs("span",{children:[d.label,d.icon]})}),!h&&!p&&i.jsx(Qi,{})]})})});ss.displayName="EmptyState";const Ol=S.forwardRef(({className:e,variant:t,size:n,asChild:s=!1,alternatives:a,children:r,onClick:o,dropdownTriggerClassName:l,chevronDownIconClassName:d,...u},c)=>{const h=s?Vn:"button",p=(a?.length??0)>0;return i.jsxs("div",{className:"inline-flex items-stretch",children:[i.jsx(h,{className:P(dr({variant:t,size:n}),{"rounded-r-none":p},e),ref:c,onClick:o,...u,children:r}),p?i.jsxs(sn,{children:[i.jsx(an,{asChild:!0,children:i.jsx("button",{className:P(dr({variant:t,size:n}),"rounded-l-none border-l border-l-primary/5 px-2 min-w-0",e?.includes("h-")&&e.match(/h-\d+/)?.[0],e?.includes("text-")&&e.match(/text-\w+/)?.[0],l),type:"button",children:i.jsx(vu,{className:P("size-4 shrink-0",d)})})}),i.jsx(rn,{align:"end",children:a.map((b,x)=>{const m=i.jsx(Je,{onClick:b.onClick,disabled:b.disabled,className:P(b.className),children:i.jsxs("span",{className:"flex w-full items-center justify-between gap-2",children:[b.label,b.icon]})},x);return b.tooltip?i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:m}),i.jsx(ve,{side:"left",children:b.tooltip})]},x):m})})]}):null]})});Ol.displayName="ButtonWithAlternatives";const em=()=>{const{createTable:e,tables:t,databaseType:n,readonly:s}=H(),{filter:a,schemasDisplayed:r}=ba(),{openTableSchemaDialog:o}=Gn(),l=Dr(),{t:d}=Q(),{openTableFromSidebar:u}=Ve(),[c,h]=S.useState(""),{showDBViews:p}=Pr(),b=S.useRef(null),x=f.useMemo(()=>{const w=k=>!c?.trim?.()||k.name.toLowerCase().includes(c.toLowerCase()),I=k=>Nu({table:{id:k.id,schema:k.schema},filter:a,options:{defaultSchema:vn[n]}}),L=k=>p?!0:!k.isView;return t.filter(I).filter(w).filter(L)},[t,c,a,n,p]),m=f.useCallback(()=>{const I=-l.x/l.zoom+80/l.zoom,L=-l.y/l.zoom+80/l.zoom;return{centerX:I,centerY:L}},[l.x,l.y,l.zoom]),N=f.useCallback(async({schema:w})=>{const{centerX:I,centerY:L}=m(),k=await e({x:I,y:L,schema:w?.name});u(k.id)},[e,u,m]),_=f.useCallback(async({schema:w})=>{const{centerX:I,centerY:L}=m(),k=await e({x:I,y:L,schema:w?.name,isView:!0});u(k.id)},[e,u,m]),y=f.useCallback(async({view:w})=>{if(h(""),r.length>1)o({onConfirm:w?_:N,schemas:r});else{const I=r.length===1?r[0]:void 0;w?_({schema:I}):N({schema:I})}},[_,N,r,o,h]),g=f.useCallback(()=>{h("")},[]);return i.jsxs("section",{className:"flex flex-1 flex-col overflow-hidden px-2","data-vaul-no-drag":!0,children:[i.jsxs("div",{className:"flex items-center justify-between gap-4 py-1",children:[i.jsx("div",{className:"flex-1",children:i.jsx(Ne,{ref:b,type:"text",placeholder:d("side_panel.tables_section.filter"),className:"h-8 w-full focus-visible:ring-0",value:c,onChange:w=>h(w.target.value)})}),s?null:i.jsxs(Ol,{variant:"secondary",className:"h-8 p-2 text-xs",onClick:()=>y({view:!1}),dropdownTriggerClassName:"px-1",chevronDownIconClassName:"!size-3.5",alternatives:p?[{label:d("side_panel.tables_section.add_view"),onClick:()=>y({view:!0}),icon:i.jsx(Eu,{className:"size-4"}),className:"text-xs"}]:[],children:[i.jsx(Jo,{className:"h-4"}),d("side_panel.tables_section.add_table")]})]}),i.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:i.jsx(Ds,{className:"h-full",children:t.length===0?i.jsx(ss,{title:d("side_panel.tables_section.empty_state.title"),description:d("side_panel.tables_section.empty_state.description"),className:"mt-20",secondaryAction:s?void 0:{label:d("side_panel.tables_section.add_table"),onClick:()=>y({view:!1})}}):c&&x.length===0?i.jsxs("div",{className:"mt-10 flex flex-col items-center gap-2",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:d("side_panel.tables_section.no_results")}),i.jsxs(K,{variant:"outline",size:"sm",onClick:g,className:"gap-1",children:[i.jsx(wn,{className:"size-3.5"}),d("side_panel.tables_section.clear")]})]}):i.jsx(zp,{tables:x})})})]})},Pl=({customType:e,tables:t})=>{const n=e.name;for(const s of t)for(const a of s.fields)if(a.type.name===n)return!0;return!1},tm=({customType:e})=>{const{updateCustomType:t,removeCustomType:n,highlightedCustomType:s,highlightCustomTypeId:a,tables:r,databaseType:o,readonly:l}=H(),{schemasDisplayed:d}=ba(),{t:u}=Q(),[c,h]=S.useState(!1),[p,b]=S.useState(e.name),x=S.useRef(null),{listeners:m}=cn({id:e.id}),N=f.useCallback(()=>{c&&(p.trim()&&t(e.id,{name:p.trim()}),h(!1))},[p,e.id,t,c]),_=f.useCallback(()=>{h(!1),b(e.name)},[e.name]);Rs(x,N),en("Enter",N),en("Escape",_);const y=j=>{j.stopPropagation(),h(!0)},g=f.useCallback(j=>{j.stopPropagation(),n(e.id)},[e.id,n]),w=f.useMemo(()=>s?.id===e.id,[s,e.id]),I=f.useCallback(j=>{j.stopPropagation(),a(w?void 0:e.id)},[e.id,a,w]),L=f.useMemo(()=>Pl({customType:e,tables:r}),[e,r]),k=f.useCallback(()=>i.jsxs(sn,{children:[i.jsx(an,{children:i.jsx(_e,{children:i.jsx(Wn,{})})}),i.jsxs(rn,{className:"w-fit min-w-40",children:[i.jsx($n,{children:u("side_panel.custom_types_section.custom_type.custom_type_actions.title")}),i.jsx(wt,{}),i.jsxs(It,{children:[i.jsxs(Je,{onClick:I,disabled:!L,className:"flex justify-between",children:[u(w?"side_panel.custom_types_section.custom_type.custom_type_actions.clear_field_highlight":"side_panel.custom_types_section.custom_type.custom_type_actions.highlight_fields"),i.jsx(rl,{className:"size-3.5"})]}),l?null:i.jsxs(Je,{onClick:g,className:"flex justify-between !text-red-700",children:[u("side_panel.custom_types_section.custom_type.custom_type_actions.delete_custom_type"),i.jsx(vt,{className:"size-3.5 text-red-700"})]})]})]})]}),[g,u,I,L,w,l]),C=f.useMemo(()=>{if(d.length>1)return e.schema??vn[o]},[e.schema,d.length,o]);return i.jsxs("div",{className:"group flex h-11 flex-1 items-center justify-between gap-1 overflow-hidden",children:[l?null:i.jsx("div",{className:"flex cursor-move items-center justify-center",...m,children:i.jsx(zn,{className:"size-4 text-muted-foreground"})}),i.jsx("div",{className:"flex min-w-0 flex-1 px-1",children:c?i.jsx(Ne,{ref:x,autoFocus:!0,type:"text",placeholder:e.name,value:p,onClick:j=>j.stopPropagation(),onChange:j=>b(j.target.value),className:"h-7 w-full focus-visible:ring-0"}):l?i.jsxs("div",{className:"truncate px-2 py-0.5",children:[e.name,i.jsx("span",{className:"text-xs text-muted-foreground",children:C?` (${C})`:""})]}):i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:i.jsxs("div",{onDoubleClick:y,className:"text-editable truncate px-2 py-0.5",children:[e.name,i.jsx("span",{className:"text-xs text-muted-foreground",children:C?` (${C})`:""})]})}),i.jsx(ve,{children:u("tool_tips.double_click_to_edit")})]})}),i.jsx("div",{className:"flex flex-row-reverse items-center",children:c?i.jsx(_e,{onClick:N,children:i.jsx(Kn,{})}):i.jsxs(i.Fragment,{children:[i.jsx("div",{children:k()}),e.kind===Qt.enum?i.jsx(dh,{variant:"outline",className:"h-fit bg-background px-2 text-xs md:group-hover:hidden",children:hr[e.kind]}):null,l?null:i.jsx("div",{className:"flex flex-row-reverse md:hidden md:group-hover:flex",children:i.jsx(_e,{onClick:y,children:i.jsx(Xn,{})})})]})})]})},nm=({values:e,addValue:t,removeValue:n})=>{const{t:s}=Q(),[a,r]=f.useState(""),{readonly:o}=H(),l=f.useCallback(()=>{a.trim()&&!e.includes(a.trim())&&(t(a.trim()),r(""))},[a,e,t]),d=f.useCallback(u=>{u.key==="Enter"&&(u.preventDefault(),l())},[l]);return i.jsxs("div",{className:"flex flex-col gap-2 text-xs",children:[i.jsxs("div",{className:"flex flex-row items-center gap-1",children:[i.jsx(Mh,{className:"size-4 text-subtitle"}),i.jsx("div",{className:"font-bold text-subtitle",children:s("side_panel.custom_types_section.custom_type.enum_values")})]}),i.jsx("div",{className:"flex flex-col gap-1",children:e.map((u,c)=>i.jsxs("div",{className:"flex items-center justify-between gap-1 rounded-md border border-border bg-muted/30 px-2 py-1",children:[i.jsx("span",{className:"flex-1 truncate text-sm font-medium",children:u}),o?null:i.jsx(K,{variant:"ghost",className:"size-6 p-0 text-muted-foreground hover:bg-destructive/10 hover:text-destructive",onClick:()=>n(u),children:i.jsx(wn,{className:"size-3.5"})})]},c))}),e.length===0?i.jsx("div",{className:"py-2 text-muted-foreground",children:s("side_panel.custom_types_section.custom_type.no_values")}):null,o?null:i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Ne,{value:a,onChange:u=>r(u.target.value),onKeyDown:d,placeholder:"Add enum value...",className:"h-8 flex-1 text-xs focus-visible:ring-0"}),i.jsx(K,{variant:"outline",className:"h-8 px-2 text-xs",onClick:l,disabled:!a.trim()||e.includes(a.trim()),children:i.jsx(Jt,{className:"size-3.5"})})]})]})},sm=({field:e,onRemove:t})=>{const{attributes:n,listeners:s,setNodeRef:a,transform:r,transition:o,isDragging:l}=cn({id:e.field}),{readonly:d}=H(),u={transform:jt.Transform.toString(r),transition:o,opacity:l?.5:1};return i.jsxs("div",{ref:a,style:u,className:"flex items-center gap-2 rounded-md border p-2",children:[d?null:i.jsx("div",{className:"flex cursor-move items-center justify-center",...n,...s,children:i.jsx(zn,{className:"size-3 text-muted-foreground"})}),i.jsx("div",{className:"flex-1 text-sm",children:e.field}),i.jsx("div",{className:"text-xs text-muted-foreground",children:e.type}),d?null:i.jsx(K,{variant:"ghost",size:"sm",className:"size-6 p-0 text-muted-foreground hover:text-red-500",onClick:t,children:i.jsx(wn,{className:"size-3"})})]})},am=({fields:e,addField:t,removeField:n,reorderFields:s})=>{const{t:a}=Q(),{currentDiagram:r,customTypes:o,readonly:l}=H(),[d,u]=f.useState(""),[c,h]=f.useState(""),p=f.useMemo(()=>Yd[r.databaseType]||[],[r.databaseType]),b=f.useMemo(()=>o.map(g=>({id:g.name,name:g.name})),[o]),x=Qn(Yn(on)),m=f.useCallback(g=>{const{active:w,over:I}=g;if(w?.id!==I?.id&&I&&w){const L=e.findIndex(C=>C.field===w.id),k=e.findIndex(C=>C.field===I.id);if(L!==-1&&k!==-1){const C=ln(e,L,k);s(C)}}},[e,s]),N=f.useCallback(()=>{if(d.trim()&&c.trim()){if(e.some(w=>w.field===d.trim()))return;t({field:d.trim(),type:c.trim()}),u(""),h("")}},[d,c,t,e]),_=f.useCallback(g=>{g.key==="Enter"&&(g.preventDefault(),N())},[N]),y=f.useCallback(g=>{n(g)},[n]);return i.jsxs("div",{className:"flex flex-col gap-2 text-xs",children:[i.jsxs("div",{className:"flex flex-row items-center gap-1",children:[i.jsx(Uh,{className:"size-4 text-subtitle"}),i.jsx("div",{className:"font-bold text-subtitle",children:a("side_panel.custom_types_section.custom_type.composite_fields")})]}),e.length===0?i.jsx("div",{className:"py-2 text-muted-foreground",children:a("side_panel.custom_types_section.custom_type.no_fields")}):i.jsx(es,{sensors:x,collisionDetection:Jn,onDragEnd:m,children:i.jsx(ns,{items:e.map(g=>g.field),strategy:ts,children:i.jsx("div",{className:"flex flex-col gap-1",children:e.map(g=>i.jsx(sm,{field:g,onRemove:()=>y(g)},g.field))})})}),l?null:i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Ne,{placeholder:a("side_panel.custom_types_section.custom_type.field_name_placeholder"),value:d,onChange:g=>u(g.target.value),onKeyDown:_,className:"h-8 flex-1 text-xs"}),i.jsxs(Ls,{value:c,onValueChange:h,children:[i.jsx(ks,{className:"h-8 w-32 text-xs",children:i.jsx(As,{placeholder:a("side_panel.custom_types_section.custom_type.field_type_placeholder")})}),i.jsxs(Ss,{children:[i.jsxs(Es,{children:[i.jsx(vi,{children:"Standard Types"}),p.map(g=>i.jsx(je,{value:g.name,children:g.name},g.id))]}),b.length>0?i.jsxs(i.Fragment,{children:[i.jsx(su,{}),i.jsxs(Es,{children:[i.jsx(vi,{children:"Custom Types"}),b.map(g=>i.jsx(je,{value:g.name,children:g.name},g.id))]})]}):null]})]})]}),i.jsxs(K,{variant:"ghost",size:"sm",className:"h-6 gap-1 self-start text-xs",onClick:N,disabled:!d.trim()||!c.trim(),children:[i.jsx(Jt,{className:"size-3"}),a("side_panel.custom_types_section.custom_type.add_field")]})]})]})},rm=({customType:e})=>{const{removeCustomType:t,updateCustomType:n,highlightedCustomType:s,highlightCustomTypeId:a,tables:r,readonly:o}=H(),{t:l}=Q(),d=f.useCallback(()=>{t(e.id)},[e.id,t]),u=f.useCallback(g=>{n(e.id,{kind:g})},[e.id,n]),c=f.useCallback(g=>{n(e.id,{values:[...e.values||[],g]})},[e.id,e.values,n]),h=f.useCallback(g=>{n(e.id,{values:(e.values||[]).filter(w=>w!==g)})},[e.id,e.values,n]),p=f.useCallback(g=>{n(e.id,{fields:[...e.fields||[],g]})},[e.id,e.fields,n]),b=f.useCallback(g=>{n(e.id,{fields:(e.fields||[]).filter(w=>w.field!==g.field)})},[e.id,e.fields,n]),x=f.useCallback(g=>{n(e.id,{fields:g})},[e.id,n]),m=f.useCallback(()=>{s?.id===e.id?a(void 0):a(e.id)},[e.id,a,s?.id]),N=f.useMemo(()=>Pl({customType:e,tables:r}),[e,r]),_=f.useMemo(()=>s?.id===e.id,[s,e.id]),y=f.useCallback(()=>i.jsxs(K,{variant:"ghost",disabled:!N,className:"flex h-8 w-full items-center justify-center p-2 text-xs",onClick:m,children:[i.jsx(rl,{className:"mr-1 size-3.5"}),l(_?"side_panel.custom_types_section.custom_type.custom_type_actions.clear_field_highlight":"side_panel.custom_types_section.custom_type.custom_type_actions.highlight_fields")]}),[_,N,m,l]);return i.jsxs("div",{className:"my-1 flex flex-col rounded-b-md px-1",children:[i.jsxs("div",{className:"flex flex-col gap-6",children:[i.jsxs("div",{className:"flex flex-col gap-2 text-xs",children:[i.jsxs("div",{className:"flex flex-row items-center gap-1",children:[i.jsx(vh,{className:"size-4 text-subtitle"}),i.jsx("div",{className:"font-bold text-subtitle",children:l("side_panel.custom_types_section.custom_type.kind")})]}),i.jsxs(Ls,{value:e.kind,onValueChange:u,disabled:o,children:[i.jsx(ks,{className:"h-8",children:i.jsx(As,{})}),i.jsx(Ss,{children:i.jsxs(Es,{children:[i.jsx(je,{value:Qt.composite,children:hr[Qt.composite]}),i.jsx(je,{value:Qt.enum,children:hr[Qt.enum]})]})})]})]}),e.kind===Qt.enum?i.jsx(nm,{values:e.values||[],addValue:c,removeValue:h}):i.jsx(am,{fields:e.fields||[],addField:p,removeField:b,reorderFields:x})]}),i.jsxs("div",{className:"flex flex-col items-center justify-center pt-2",children:[N?y():i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:i.jsx("span",{children:y()})}),i.jsx(ve,{children:l("side_panel.custom_types_section.custom_type.no_fields_tooltip")})]}),o?null:i.jsxs(K,{variant:"ghost",className:"flex h-8 w-full items-center justify-center p-2 text-xs",onClick:d,children:[i.jsx(vt,{className:"mr-1 size-3.5 text-red-700"}),i.jsx("div",{className:"text-red-700",children:l("side_panel.custom_types_section.custom_type.delete_custom_type")})]})]})]})},Fl=S.forwardRef(({customType:e},t)=>{const{attributes:n,setNodeRef:s,transform:a,transition:r}=cn({id:e.id}),o={transform:jt.Translate.toString(a),transition:r};return i.jsx(mn,{value:e.id,className:"border-none",ref:t,children:i.jsxs("div",{className:"w-full rounded-md border-b",ref:s,style:o,...n,children:[i.jsx(bn,{className:"w-full rounded-md bg-slate-50 px-2 py-0 hover:bg-accent hover:no-underline data-[state=open]:rounded-b-none dark:bg-slate-900",asChild:!0,children:i.jsx(tm,{customType:e})}),i.jsx(xn,{className:"border-x border-slate-100 p-1 pb-0 dark:border-slate-800",children:i.jsx(rm,{customType:e})})]})})});Fl.displayName="CustomTypeListItem";const im=({customTypes:e})=>{const{updateCustomType:t}=H(),{openCustomTypeFromSidebar:n,openedCustomTypeInSidebar:s}=Ve(),a=S.useRef(null),r=f.useMemo(()=>e.reduce((c,h)=>(c[h.id]=S.createRef(),c),{}),[e]),o=f.useCallback(c=>r[c]?.current?.scrollIntoView({behavior:"smooth",block:"start"}),[r]),l=Qn(Yn(on)),d=f.useCallback(c=>{const{active:h,over:p}=c;if(h?.id!==p?.id&&p&&h){const b=e.findIndex(N=>N.id===h.id),x=e.findIndex(N=>N.id===p.id);ln(e,b,x).forEach((N,_)=>{t(N.id,{order:_})})}},[e,t]),u=f.useCallback(()=>{s&&a.current!==s&&(a.current=s,o(s))},[o,s]);return i.jsx(ma,{type:"single",collapsible:!0,className:"flex w-full flex-col gap-1",value:s,onValueChange:n,onAnimationEnd:u,children:i.jsx(es,{sensors:l,collisionDetection:Jn,onDragEnd:d,children:i.jsx(ns,{items:e,strategy:ts,children:e.sort((c,h)=>c.order&&h.order===void 0?-1:c.order===void 0&&h.order?1:c.order!=null&&h.order!=null?c.order-h.order:c.name.localeCompare(h.name)).map(c=>i.jsx(Fl,{customType:c,ref:r[c.id]},c.id))})})})},om=()=>{const{t:e}=Q(),{customTypes:t,createCustomType:n,readonly:s}=H(),[a,r]=S.useState(""),o=S.useRef(null),l=f.useMemo(()=>t.filter(c=>!a?.trim?.()||c.name.toLowerCase().includes(a.toLowerCase())),[t,a]),d=f.useCallback(()=>{r("")},[]),u=f.useCallback(async()=>{await n()},[n]);return i.jsxs("section",{className:"flex flex-1 flex-col overflow-hidden px-2","data-vaul-no-drag":!0,children:[i.jsxs("div",{className:"flex items-center justify-between gap-4 py-1",children:[i.jsx("div",{className:"flex-1",children:i.jsx(Ne,{ref:o,type:"text",placeholder:e("side_panel.custom_types_section.filter"),className:"h-8 w-full focus-visible:ring-0",value:a,onChange:c=>r(c.target.value)})}),s?null:i.jsxs(K,{variant:"secondary",size:"sm",className:"h-8 px-2",onClick:u,children:[i.jsx(Jt,{className:"mr-1 size-4"}),"New Type"]})]}),i.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:i.jsx(Ds,{className:"h-full",children:t.length===0?i.jsx(ss,{title:e("side_panel.custom_types_section.empty_state.title"),description:e("side_panel.custom_types_section.empty_state.description"),className:"mt-20",secondaryAction:s?void 0:{label:"New Type",onClick:u}}):a&&l.length===0?i.jsxs("div",{className:"mt-10 flex flex-col items-center gap-2",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:e("side_panel.custom_types_section.no_results")}),i.jsxs(K,{variant:"outline",size:"sm",onClick:d,className:"gap-1",children:[i.jsx(wn,{className:"size-3.5"}),e("side_panel.custom_types_section.clear")]})]}):i.jsx(im,{customTypes:l})})})]})},lm=e=>!e||e.length===0?"":e.filter(t=>t.kind===Qt.enum).map(t=>{const n=t.schema?`"${t.schema}"."${t.name.replace(/"/g,'\\"')}"`:`"${t.name.replace(/"/g,'\\"')}"`,s=(t.values||[]).map(a=>`    "${a.replace(/"/g,'\\"')}"`).join(`
`);return`Enum ${n} {
${s}
}
`}).join(`
`),cm=e=>{switch(e){case le.SQL_SERVER:return"mssql";case le.MYSQL:case le.MARIADB:return"mysql";case le.POSTGRESQL:case le.COCKROACHDB:case le.SQLITE:case le.ORACLE:return"postgres";default:return"postgres"}},dm=e=>{const t=e.tables?.map(s=>{const a={...s};return s.name==="relation"&&(a.fields=s.fields.map(r=>{const o={...r};return r.name==="from"?o.name="source":r.name==="to"&&(o.name="target"),o})),a})||[],n=e.relationships?.map(s=>{const a=e.tables?.find(d=>d.name==="relation");if(!a)return s;const r={...s},o=a.fields.find(d=>d.name==="from");if(o&&s.targetFieldId===o.id){const u=t.find(c=>c.name==="relation")?.fields.find(c=>c.name==="source");u&&(r.targetFieldId=u.id)}const l=a.fields.find(d=>d.name==="to");if(l&&s.targetFieldId===l.id){const u=t.find(c=>c.name==="relation")?.fields.find(c=>c.name==="target");u&&(r.targetFieldId=u.id)}return r})||[];return{...e,tables:t,relationships:n}},um=e=>{let t=e;const n=new Set;let s=0;return t=t.replace(/ADD CONSTRAINT (\w+) FOREIGN KEY/g,(o,l)=>n.has(l)?`ADD CONSTRAINT ${l}_${++s} FOREIGN KEY`:(n.add(l),o)),t=t.split(`
`).map(o=>{const d=/ALTER\s+TABLE\s+(?:["[]?(\S+?)[\]"]?\.)?["[]?(\S+?)[\]"]?\s+ADD\s+CONSTRAINT\s+\S+\s+FOREIGN\s+KEY\s*\(["[]?([^)"]+)[\]"]?\)\s+REFERENCES\s+(?:["[]?\S+?[\]"]?\.)?"?[[]?\2[\]]?"?\s*\(["[]?([^)"]+)[\]"]?\)\s*;/i.exec(o);if(d){const u=d[3].trim(),c=d[4].trim();if(u===c)return`-- ${o}`}return o}).join(`
`),t=t.replace(/::regclass/g,""),t=t.replace(/: :regclass/g,""),t=t.replace(/CREATE\s+(?:UNIQUE\s+)?INDEX\s+\S+\s+ON\s+\S+\s*\(([^)]+)\)/gi,(o,l)=>{const d=l.split(",").map(c=>c.trim()),u=[...new Set(d)];return o.replace(l,u.join(", "))}),t=t.replace(/char\s+\(/g,"char("),t=t.replace(/character\s+\(/g,"character("),t=t.replace(/DEFAULT\s+([A-Z]{3})(?=\s|,|$)/g,"DEFAULT '$1'"),t=t.replace(/DEFAULT\s+([A-Z])(?=\s|,|$)/g,"DEFAULT '$1'"),t=t.replace(/DEFAULT\s+NOW(?=\s|,|$)/gi,"DEFAULT NOW()"),t=t.replace(/\?\?/g,"__"),t},hm=(e,t)=>{let n=t+1;const s=e.length;for(;n<s;){const a=e[n];if(a==="]")return n;if(a==="'"||a==='"'){const o=a==="'"&&e[n+1]==="'"&&e[n+2]==="'"?"'''":a,l=o.length;for(n+=l;n<s;)if(e[n]==="\\")n+=2;else if(e.startsWith(o,n)){n+=l;break}else n++;continue}n++}return-1},fm=e=>{const t=/Ref\s+"([^"]+)"\s*:\s*(?:"([^"]+)"\.)?"([^"]+)"\."([^"]+)"\s*([<>*])\s*(?:"([^"]+)"\.)?"([^"]+)"\."([^"]+)"/g,n=[];let s;for(;(s=t.exec(e))!==null;)n.push({refName:s[1],sourceSchema:s[2]||void 0,sourceTable:s[3],sourceField:s[4],direction:s[5],targetSchema:s[6]||void 0,targetTable:s[7],targetField:s[8]});const a={};let r=0;for(;r<e.length;){const x=/Table\s+(?:"([^"]+)"(?:\."([^"]+)")?|(\[?[^\s[]+\]?\.\[?[^\s\]]+\]?)|(\[?[^\s[{]+\]?))\s*{/g;x.lastIndex=r;const m=x.exec(e);if(!m)break;let N;m[1]&&m[2]?N=`${m[1]}.${m[2]}`:m[1]?N=m[1]:N=m[3]||m[4];const _=N.replace(/\[([^\]]+)\]/g,"$1"),y=m.index+m[0].length-1;let g=1;const w=y+1;let I=w;for(let L=w;L<e.length&&g>0;L++)e[L]==="{"?g++:e[L]==="}"&&(g--,g===0&&(I=L));if(g===0){const L=e.substring(w,I),k=e.substring(m.index,I+1);a[_]={start:m.index,end:I+1,content:L,fullMatch:k},r=I+1}else r=m.index+m[0].length}if(n.length===0||Object.keys(a).length===0)return e;const o=new Map(Object.entries(a)),l=new Map;n.forEach(x=>{let m,N,_,y;x.direction==="<"?(m=x.targetSchema?`${x.targetSchema}.${x.targetTable}`:x.targetTable,N=x.targetField,_=`ref: < ${x.sourceSchema?`"${x.sourceSchema}"."${x.sourceTable}"."${x.sourceField}"`:`"${x.sourceTable}"."${x.sourceField}"`}`,y=x.sourceTable):(m=x.sourceSchema?`${x.sourceSchema}.${x.sourceTable}`:x.sourceTable,N=x.sourceField,_=`ref: > ${x.targetSchema?`"${x.targetSchema}"."${x.targetTable}"."${x.targetField}"`:`"${x.targetTable}"."${x.targetField}"`}`,y=x.targetTable);const g=`${m}.${N}`,w=l.get(g)||{table:m,refs:[],relatedTables:[]};w.refs.push(_),w.relatedTables.push(y),l.set(g,w)}),l.forEach((x,m)=>{const N=m.lastIndexOf("."),_=m.substring(0,N),y=m.substring(N+1),g=o.get(_);if(!g)return;const w=new RegExp(`^([ \\t]*)"${y}"\\s+`),I=g.content.split(`
`);let L=!1;const k=I.map(C=>{const j=w.exec(C);if(!j)return C;L=!0;const O=j[1],V=C.indexOf("["),D=V!==-1?C.substring(0,V).trim():C.trim(),$=V!==-1?C.substring(V+1,hm(C,V)):null,B=$?[$.trim(),...x.refs]:x.refs;return`${O}${D} [${B.join(", ")}]`});L&&(g.content=k.join(`
`),o.set(_,g))});let d="",u=0;const c=Object.entries(a).sort(([,x],[,m])=>x.start-m.start);for(const[,x]of c){d+=e.substring(u,x.start);const m=x.fullMatch;let N=x.content;const _=N.split(`
`),y=[];for(let I=0;I<_.length;I++){const L=_[I],k=L.trimEnd();k===""&&I===_.length-1||k===""&&I<_.length-1&&_[I+1].trim().startsWith("}")||y.push(L)}N=y.join(`
`),N.endsWith(`
`)||(N=N+`
`);const w=`${m.substring(0,m.indexOf("{")+1)}${N}}`;d+=w,u=x.end}return d+=e.substring(u),d.split(`
`).filter(x=>!x.trim().startsWith("Ref ")).join(`
`).trim().replace(/\n\s*\n\s*\n/g,`

`).replace(/}\n(?=Table)/g,`}

`)},pm=e=>{if(!e.relationships)return e;const t=new Set,n=new Set,s=e.relationships.filter(a=>{const r=`${a.sourceTableId}-${a.sourceFieldId}->${a.targetTableId}-${a.targetFieldId}`,o=[`${a.sourceTableId}-${a.sourceFieldId}`,`${a.targetTableId}-${a.targetFieldId}`].sort().join("<->");return t.has(r)||n.has(o)?!1:(t.add(r),n.add(o),!0)});return{...e,relationships:s}},Ji=e=>e.replace(/"char "/g,'"char"').replace(/char \(([0-9]+)\)/g,"char($1)").replace(/"char \(([0-9]+)\)"/g,'"char($1)"').replace(/"character \(([0-9]+)\)"/g,'"character($1)"').replace(/character \(([0-9]+)\)/g,"character($1)"),Zi=e=>e.replace(/(\s+"[^"]+"\s+)"([^"\s]+\[\])"/g,"$1$2"),mm=e=>e.replace(/Table\s+\[([^\]]+)\]\.\[([^\]]+)\]/g,'Table "$1"."$2"'),bm=e=>e.replace(/Table\s+((?:"[^"]*"\.)?"[^"]*(?:\n[^"]*)*")\s*\{/g,(t,n)=>`Table ${n.replace(/\n\s*/g,"")} {`),xm=(e,t)=>{if(!t||t.length===0)return e;let n=e;return t.forEach(s=>{s.fields.filter(r=>r.increment).forEach(r=>{const o=s.schema?`"${s.schema.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"\\."${s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`:`"${s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`,l=r.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=new RegExp(`(Table ${o} \\{[^}]*?^\\s*"${l}"[^\\[\\n]+)(\\[[^\\]]*\\])`,"gms");n=n.replace(d,(u,c,h)=>{if(h.includes("increment"))return u;const p=h.replace("]",", increment]");return c+p})})}),n},gm=(e,t)=>{if(!t||t.length===0)return e;let n=e;const s=a=>a.replace(/\r?\n/g," ").replace(/\s+/g," ").trim().replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"');return t.forEach(a=>{const r=a.schema?`"${a.schema.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"\\."${a.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`:`"${a.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`;if(a.comments){const l=s(a.comments),d=new RegExp(`(Table ${r} \\{)([\\s\\S]*?)(^\\})`,"gm");n=n.replace(d,(u,c,h,p)=>/^\s*Note:\s*'/m.test(h)?u:`${c}${h}
  Note: '${l}'
${p}`)}a.fields.filter(l=>l.comments).forEach(l=>{const d=l.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),u=s(l.comments),c=new RegExp(`(Table ${r} \\{[^}]*?^\\s*"${d}"\\s+\\S+(?:\\([^)]*\\))?(?:\\[\\])?)(\\s*\\[[^\\]]*\\])?`,"gms");n=n.replace(c,(h,p,b)=>{if(b&&b.includes("note:"))return h;if(b){const x=b.replace("]",`, note: '${u}']`);return p+x}else return p+` [note: '${u}']`})})}),n},vm=(e,t)=>{if(!t||t.length===0)return e;let n=e;return t.forEach(s=>{const a=s.indexes.find(r=>r.isPrimaryKey);if(a?.name){const r=s.fields.filter(o=>o.primaryKey);if(r.length>=1){const o=r.map(c=>c.name).join(", "),l=s.schema?`"${s.schema.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"\\."${s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`:`"${s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`,d=new RegExp(`(Table ${l} \\{[^}]*?Indexes \\{[^}]*?)(\\(${o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\) \\[pk\\])`,"gs"),u=`$1(${o}) [pk, name: "${a.name}"]`;n=n.replace(d,u)}}}),n},Nm=(e,t)=>{if(!t||t.length===0)return e;const n=new Map;t.forEach((a,r)=>{const o=n.get(a.name)||[];o.push({table:a,index:r}),n.set(a.name,o)});let s=e;return n.forEach((a,r)=>{if(a.length===1){const o=a[0].table;if(o.schema){const l=o.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=o.schema.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(!new RegExp(`Table\\s+"${d}"\\."${l}"\\s*{`,"g").test(s)){const c=new RegExp(`Table\\s+"${l}"\\s*{`,"g"),h=`Table "${o.schema}"."${o.name}" {`;s=s.replace(c,h);const p=new RegExp(`(Ref\\s+"[^"]+")\\s*:\\s*"${l}"\\."([^"]+)"`,"g");s=s.replace(p,`$1:"${o.schema}"."${o.name}"."$2"`);const b=new RegExp(`([<>])\\s*"${l}"\\."([^"]+)"`,"g");s=s.replace(b,`$1 "${o.schema}"."${o.name}"."$2"`)}}}else{const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=a.filter(({table:c})=>{const h=new RegExp(`Table\\s+"${c.schema}"\\.\\s*"${o}"\\s*{`,"g");return!s.match(h)}),d=new RegExp(`Table\\s+"${o}"\\s*{`,"g");let u=0;s=s.replace(d,c=>{if(u>=l.length)return c;const h=l[u];return u++,h&&h.table.schema?`Table "${h.table.schema}"."${r}" {`:c})}}),s},Em=e=>e.split(`
`).filter(s=>s.trim().startsWith("Ref ")).join(`
`).trim();function ym(e){const t=e.tables?.map(x=>{const m=x.fields.filter(N=>N.name!=="");return{...x,fields:m}})??[],n=new Set,s=t.filter(x=>{if(x.fields.length===0)return!1;const m=x.schema?`${x.schema}.${x.name}`:x.name;return n.has(m)?!1:(n.add(m),!0)}),a={...e,tables:s,relationships:e.relationships?.filter(x=>{const m=s.find(g=>g.id===x.sourceTableId),N=s.find(g=>g.id===x.targetTableId),_=m?.fields.some(g=>g.id===x.sourceFieldId),y=N?.fields.some(g=>g.id===x.targetFieldId);return m&&N&&_&&y})??[]},r=dm(a),o=x=>{const m=new Map,N=x.fields.map(_=>{const y=m.get(_.name)||0;if(y>0){const g=`${_.name}_${y+1}`;return{..._,name:g}}return m.set(_.name,y+1),_});return{...x,fields:N,indexes:(x.indexes||[]).filter(_=>!_.isPrimaryKey).map(_=>({..._,name:_.name||`idx_${Math.random().toString(36).substring(2,8)}`}))}},l=pm({...r,tables:r.tables?.map(o)??[],relationships:r.relationships?.map((x,m)=>{const N=x.name?x.name.replace(/[^\w]/g,"_"):Math.random().toString(36).substring(2,8);return{...x,name:`fk_${m}_${N}`}})??[]});let d="",u="",c="";const h=lm(l.customTypes);let p;try{c=au({diagram:l,targetDatabaseType:e.databaseType,isDBMLFlow:!0}),c=um(c),d=Zi(Ji(bm(mm(ru.importer.import(c,cm(e.databaseType)))))),d=Nm(d,s),d=vm(d,s),d=xm(d,s),d=gm(d,s),h&&(d=h+`

`+d),u=Zi(Ji(fm(d))),d=d.replace(/\n\s*\n\s*\n/g,`

`),u=u.replace(/\n\s*\n\s*\n/g,`

`),d.endsWith(`
`)||(d+=`
`),u.endsWith(`
`)||(u+=`
`)}catch(x){console.error("Error during DBML generation process:",x,"Input SQL was:",c),p=x instanceof Error?x.message:"Unknown error";const m=`// Error generating DBML: ${p}`;d=m,u=m,d.startsWith("// Error generating DBML:")&&h&&(d=h+`

`+d),u.startsWith("// Error generating DBML:")&&h&&(u=h+`

`+u)}const b=Em(d);return{standardDbml:d,inlineDbml:u,relationshipsDbml:b,error:p}}const In=({type:e,schema:t,otherSchema:n,parentName:s,otherParentName:a,name:r,otherName:o})=>`${e}-${t?`${t}.`:""}${n?`${n}.`:""}${s?`${s}.`:""}${a?`${a}.`:""}${r}${o?`.${o}`:""}`,ms=e=>In({type:"table",schema:e.schema,name:e.name}),_m=(e,t)=>In({type:"field",schema:e.schema,parentName:e.name,name:t.name}),Tm=(e,t)=>In({type:"index",schema:e.schema,parentName:e.name,name:t.name}),wm=(e,t)=>{const n=t[e.sourceTableId],s=t[e.targetTableId],a=t[e.sourceFieldId],r=t[e.targetFieldId];return!n||!s||!a||!r?null:In({type:"relationship",schema:n.schema,otherSchema:s.schema,parentName:n.name,otherParentName:s.name,name:a.name,otherName:r.name})},Ul=e=>In({type:"customType",schema:e.schema,name:e.name}),Im=(e,t)=>{const n=t[e.dependentTableId],s=t[e.tableId];return!n||!s?null:In({type:"dependency",schema:n.schema,otherSchema:s.schema,name:n.name,otherName:s.name})},Cm=e=>In({type:"area",name:e.name}),jm=e=>{const t={},n={};return e.tables?.forEach(s=>{const a=ms(s);t[a]=s.id,n[s.id]={schema:s.schema,name:s.name,color:s.color},s.fields?.forEach(r=>{const o=_m(s,r);t[o]=r.id,n[r.id]={schema:s.schema,name:r.name}}),s.indexes?.forEach(r=>{const o=Tm(s,r);t[o]=r.id})}),e.relationships?.forEach(s=>{const a=wm(s,n);a&&(t[a]=s.id)}),e.customTypes?.forEach(s=>{const a=Ul(s);t[a]=s.id}),e.dependencies?.forEach(s=>{const a=Im(s,n);a&&(t[a]=s.id)}),e.areas?.forEach(s=>{const a=Cm(s);t[a]=s.id}),{objectKeysToIdsMap:t,sourceIdToDataMap:n}},Lm=({targetTables:e,sourceTables:t,defaultDatabaseSchema:n})=>{if(!e)return{tables:[],idMappings:{tables:{},fields:{}}};if(!t)return{tables:e,idMappings:{tables:{},fields:{}}};const s={tables:{},fields:{}},a=new Map;return t.forEach(o=>{const l=ms(o);a.set(l,o)}),{tables:e.map(o=>{const l=ms(o);let d=a.get(l);if(!d&&o.schema){const m=ms({...o,schema:void 0});d=a.get(m)}if(!d&&n)if(o.schema)o.schema;else{const m=ms({...o,schema:n});d=a.get(m)}if(!d)return o;const u=d.id;s.tables[o.id]=u;const c=new Map;d.fields?.forEach(m=>{c.set(m.name,m)});const h=o.fields?.map(m=>{const N=c.get(m.name);return N?(s.fields[m.id]=N.id,{...m,id:N.id,createdAt:N.createdAt}):m}),p=new Map;d.indexes?.forEach(m=>{p.set(m.name,m)});const b=o.indexes?.map(m=>{const N=p.get(m.name);if(N)return{...m,id:N.id,name:N.name,createdAt:N.createdAt};const _=m.fieldIds.map(g=>s.fields[g]||g),y=d.indexes?.find(g=>p.has(g.name)&&o.indexes?.some(I=>I.name===g.name)||g.fieldIds.length!==_.length||!g.fieldIds.every((I,L)=>I===_[L])?!1:g.unique===m.unique&&!!g.isPrimaryKey==!!m.isPrimaryKey);return y?{...m,name:y.name,id:y.id,createdAt:y.createdAt}:m}),x={...d,fields:h,indexes:b,comments:o.comments};return o.fields&&(x.fields=x.fields?.map(m=>{const N=o.fields?.find(_=>_.name===m.name);return N?{...m,nullable:N.nullable,unique:N.unique,primaryKey:N.primaryKey,type:N.type}:m})),x}),idMappings:s}},km=(e,t)=>e?e.map(n=>{const s=Ul(n),a=t[s];return a?{...n,id:a}:n}):[],Am=(e,t,n)=>{if(!e||e.length===0)return[];if(!t||t.length===0)return e.map(r=>{let o=r.sourceTableId,l=r.targetTableId,d=r.sourceFieldId,u=r.targetFieldId;for(const[c,h]of Object.entries(n.tables))c===r.sourceTableId&&(o=h),c===r.targetTableId&&(l=h);for(const[c,h]of Object.entries(n.fields))c===r.sourceFieldId&&(d=h),c===r.targetFieldId&&(u=h);return{...r,sourceTableId:o,targetTableId:l,sourceFieldId:d,targetFieldId:u}});const s=[],a=new Set;return t.forEach(r=>{const o=e.find(l=>{const d=n.tables[l.sourceTableId],u=n.tables[l.targetTableId],c=n.fields[l.sourceFieldId],h=n.fields[l.targetFieldId],p=r.sourceTableId===d&&r.targetTableId===u&&r.sourceFieldId===c&&r.targetFieldId===h,b=r.sourceTableId===u&&r.targetTableId===d&&r.sourceFieldId===h&&r.targetFieldId===c;return p||b});if(o){a.add(o.id);const l={...r,sourceCardinality:o.sourceCardinality,targetCardinality:o.targetCardinality};r.sourceSchema||delete l.sourceSchema,r.targetSchema||delete l.targetSchema,s.push(l)}}),e.forEach(r=>{if(!a.has(r.id)){let o=r.sourceTableId,l=r.targetTableId,d=r.sourceFieldId,u=r.targetFieldId;for(const[c,h]of Object.entries(n.tables))c===r.sourceTableId&&(o=h),c===r.targetTableId&&(l=h);for(const[c,h]of Object.entries(n.fields))c===r.sourceFieldId&&(d=h),c===r.targetFieldId&&(u=h);s.push({...r,sourceTableId:o,targetTableId:l,sourceFieldId:d,targetFieldId:u})}}),s},Sm=(e,t,n)=>e?t?e.map(s=>{const a=t.find(r=>{const o=n.tables[s.tableId],l=n.tables[s.dependentTableId];return r.tableId===o&&r.dependentTableId===l});return a?{...s,id:a.id,tableId:n.tables[s.tableId]||s.tableId,dependentTableId:n.tables[s.dependentTableId]||s.dependentTableId}:{...s,tableId:n.tables[s.tableId]||s.tableId,dependentTableId:n.tables[s.dependentTableId]||s.dependentTableId}}):e:[],Dm=(e,t)=>e?e.map(n=>({...n,indexes:n.indexes?.map(s=>({...s,fieldIds:s.fieldIds.map(a=>t.fields[a]||a)}))})):[],Rm=({sourceDiagram:e,targetDiagram:t})=>{const{objectKeysToIdsMap:n}=jm(e),{tables:s,idMappings:a}=Lm({targetTables:t.tables,sourceTables:e.tables,defaultDatabaseSchema:vn[e.databaseType]}),r=km(t.customTypes,n),o=[...e.customTypes?.filter(p=>p.kind===Qt.composite)??[],...r],l=Am(t.relationships,e.relationships,a),d=Sm(t.dependencies,e.dependencies,a),u=Dm(s,a),c=[...l].sort((p,b)=>{const x=e.relationships?.find(y=>y.id===p.id),m=e.relationships?.find(y=>y.id===b.id);if(!x||!m)return 0;const N=e.relationships?.indexOf(x)??0,_=e.relationships?.indexOf(m)??0;return N-_});return{...e,tables:u.sort((p,b)=>(p.order??0)-(b.order??0)),areas:t.areas,notes:t.notes,relationships:c,dependencies:d,customTypes:o}};var Bl=typeof global=="object"&&global&&global.Object===Object&&global,Mm=typeof self=="object"&&self&&self.Object===Object&&self,Ut=Bl||Mm||Function("return this")(),Lt=Ut.Symbol,$l=Object.prototype,Om=$l.hasOwnProperty,Pm=$l.toString,fs=Lt?Lt.toStringTag:void 0;function Fm(e){var t=Om.call(e,fs),n=e[fs];try{e[fs]=void 0;var s=!0}catch{}var a=Pm.call(e);return s&&(t?e[fs]=n:delete e[fs]),a}var Um=Object.prototype,Bm=Um.toString;function $m(e){return Bm.call(e)}var Vm="[object Null]",Gm="[object Undefined]",eo=Lt?Lt.toStringTag:void 0;function as(e){return e==null?e===void 0?Gm:Vm:eo&&eo in Object(e)?Fm(e):$m(e)}function Nn(e){return e!=null&&typeof e=="object"}var Km="[object Symbol]";function Ta(e){return typeof e=="symbol"||Nn(e)&&as(e)==Km}function Vl(e,t){for(var n=-1,s=e==null?0:e.length,a=Array(s);++n<s;)a[n]=t(e[n],n,e);return a}var xt=Array.isArray,to=Lt?Lt.prototype:void 0,no=to?to.toString:void 0;function Gl(e){if(typeof e=="string")return e;if(xt(e))return Vl(e,Gl)+"";if(Ta(e))return no?no.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var zm=/\s/;function Xm(e){for(var t=e.length;t--&&zm.test(e.charAt(t)););return t}var Wm=/^\s+/;function qm(e){return e&&e.slice(0,Xm(e)+1).replace(Wm,"")}function Un(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var so=NaN,Hm=/^[-+]0x[0-9a-f]+$/i,Ym=/^0b[01]+$/i,Qm=/^0o[0-7]+$/i,Jm=parseInt;function Zm(e){if(typeof e=="number")return e;if(Ta(e))return so;if(Un(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Un(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=qm(e);var n=Ym.test(e);return n||Qm.test(e)?Jm(e.slice(2),n?2:8):Hm.test(e)?so:+e}var ao=1/0,eb=17976931348623157e292;function tb(e){if(!e)return e===0?e:0;if(e=Zm(e),e===ao||e===-ao){var t=e<0?-1:1;return t*eb}return e===e?e:0}function nb(e){var t=tb(e),n=t%1;return t===t?n?t-n:t:0}function wa(e){return e}var sb="[object AsyncFunction]",ab="[object Function]",rb="[object GeneratorFunction]",ib="[object Proxy]";function Kl(e){if(!Un(e))return!1;var t=as(e);return t==ab||t==rb||t==sb||t==ib}var ir=Ut["__core-js_shared__"],ro=(function(){var e=/[^.]+$/.exec(ir&&ir.keys&&ir.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""})();function ob(e){return!!ro&&ro in e}var lb=Function.prototype,cb=lb.toString;function Cn(e){if(e!=null){try{return cb.call(e)}catch{}try{return e+""}catch{}}return""}var db=/[\\^$.*+?()[\]{}|]/g,ub=/^\[object .+?Constructor\]$/,hb=Function.prototype,fb=Object.prototype,pb=hb.toString,mb=fb.hasOwnProperty,bb=RegExp("^"+pb.call(mb).replace(db,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function xb(e){if(!Un(e)||ob(e))return!1;var t=Kl(e)?bb:ub;return t.test(Cn(e))}function gb(e,t){return e?.[t]}function jn(e,t){var n=gb(e,t);return xb(n)?n:void 0}var Er=jn(Ut,"WeakMap");function vb(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var Nb=800,Eb=16,yb=Date.now;function _b(e){var t=0,n=0;return function(){var s=yb(),a=Eb-(s-n);if(n=s,a>0){if(++t>=Nb)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function Tb(e){return function(){return e}}var io=(function(){try{var e=jn(Object,"defineProperty");return e({},"",{}),e}catch{}})(),wb=io?function(e,t){return io(e,"toString",{configurable:!0,enumerable:!1,value:Tb(t),writable:!0})}:wa,Ib=_b(wb);function Cb(e,t,n,s){e.length;for(var a=n+1;a--;)if(t(e[a],a,e))return a;return-1}var jb=9007199254740991,Lb=/^(?:0|[1-9]\d*)$/;function zl(e,t){var n=typeof e;return t=t??jb,!!t&&(n=="number"||n!="symbol"&&Lb.test(e))&&e>-1&&e%1==0&&e<t}function Xl(e,t){return e===t||e!==e&&t!==t}var oo=Math.max;function kb(e,t,n){return t=oo(t===void 0?e.length-1:t,0),function(){for(var s=arguments,a=-1,r=oo(s.length-t,0),o=Array(r);++a<r;)o[a]=s[t+a];a=-1;for(var l=Array(t+1);++a<t;)l[a]=s[a];return l[t]=n(o),vb(e,this,l)}}function Ab(e,t){return Ib(kb(e,t,wa),e+"")}var Sb=9007199254740991;function zr(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Sb}function Ia(e){return e!=null&&zr(e.length)&&!Kl(e)}var Db=Object.prototype;function Wl(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Db;return e===n}function ql(e,t){for(var n=-1,s=Array(e);++n<e;)s[n]=t(n);return s}var Rb="[object Arguments]";function lo(e){return Nn(e)&&as(e)==Rb}var Hl=Object.prototype,Mb=Hl.hasOwnProperty,Ob=Hl.propertyIsEnumerable,Xr=lo((function(){return arguments})())?lo:function(e){return Nn(e)&&Mb.call(e,"callee")&&!Ob.call(e,"callee")};function Pb(){return!1}var Yl=typeof exports=="object"&&exports&&!exports.nodeType&&exports,co=Yl&&typeof module=="object"&&module&&!module.nodeType&&module,Fb=co&&co.exports===Yl,uo=Fb?Ut.Buffer:void 0,Ub=uo?uo.isBuffer:void 0,yr=Ub||Pb,Bb="[object Arguments]",$b="[object Array]",Vb="[object Boolean]",Gb="[object Date]",Kb="[object Error]",zb="[object Function]",Xb="[object Map]",Wb="[object Number]",qb="[object Object]",Hb="[object RegExp]",Yb="[object Set]",Qb="[object String]",Jb="[object WeakMap]",Zb="[object ArrayBuffer]",ex="[object DataView]",tx="[object Float32Array]",nx="[object Float64Array]",sx="[object Int8Array]",ax="[object Int16Array]",rx="[object Int32Array]",ix="[object Uint8Array]",ox="[object Uint8ClampedArray]",lx="[object Uint16Array]",cx="[object Uint32Array]",ne={};ne[tx]=ne[nx]=ne[sx]=ne[ax]=ne[rx]=ne[ix]=ne[ox]=ne[lx]=ne[cx]=!0;ne[Bb]=ne[$b]=ne[Zb]=ne[Vb]=ne[ex]=ne[Gb]=ne[Kb]=ne[zb]=ne[Xb]=ne[Wb]=ne[qb]=ne[Hb]=ne[Yb]=ne[Qb]=ne[Jb]=!1;function dx(e){return Nn(e)&&zr(e.length)&&!!ne[as(e)]}function ux(e){return function(t){return e(t)}}var Ql=typeof exports=="object"&&exports&&!exports.nodeType&&exports,vs=Ql&&typeof module=="object"&&module&&!module.nodeType&&module,hx=vs&&vs.exports===Ql,or=hx&&Bl.process,ho=(function(){try{var e=vs&&vs.require&&vs.require("util").types;return e||or&&or.binding&&or.binding("util")}catch{}})(),fo=ho&&ho.isTypedArray,Jl=fo?ux(fo):dx,fx=Object.prototype,px=fx.hasOwnProperty;function Zl(e,t){var n=xt(e),s=!n&&Xr(e),a=!n&&!s&&yr(e),r=!n&&!s&&!a&&Jl(e),o=n||s||a||r,l=o?ql(e.length,String):[],d=l.length;for(var u in e)(t||px.call(e,u))&&!(o&&(u=="length"||a&&(u=="offset"||u=="parent")||r&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||zl(u,d)))&&l.push(u);return l}function mx(e,t){return function(n){return e(t(n))}}var bx=mx(Object.keys,Object),xx=Object.prototype,gx=xx.hasOwnProperty;function vx(e){if(!Wl(e))return bx(e);var t=[];for(var n in Object(e))gx.call(e,n)&&n!="constructor"&&t.push(n);return t}function Wr(e){return Ia(e)?Zl(e):vx(e)}function Nx(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var Ex=Object.prototype,yx=Ex.hasOwnProperty;function _x(e){if(!Un(e))return Nx(e);var t=Wl(e),n=[];for(var s in e)s=="constructor"&&(t||!yx.call(e,s))||n.push(s);return n}function Tx(e){return Ia(e)?Zl(e,!0):_x(e)}var wx=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ix=/^\w*$/;function qr(e,t){if(xt(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Ta(e)?!0:Ix.test(e)||!wx.test(e)||t!=null&&e in Object(t)}var Ts=jn(Object,"create");function Cx(){this.__data__=Ts?Ts(null):{},this.size=0}function jx(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Lx="__lodash_hash_undefined__",kx=Object.prototype,Ax=kx.hasOwnProperty;function Sx(e){var t=this.__data__;if(Ts){var n=t[e];return n===Lx?void 0:n}return Ax.call(t,e)?t[e]:void 0}var Dx=Object.prototype,Rx=Dx.hasOwnProperty;function Mx(e){var t=this.__data__;return Ts?t[e]!==void 0:Rx.call(t,e)}var Ox="__lodash_hash_undefined__";function Px(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ts&&t===void 0?Ox:t,this}function En(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}En.prototype.clear=Cx;En.prototype.delete=jx;En.prototype.get=Sx;En.prototype.has=Mx;En.prototype.set=Px;function Fx(){this.__data__=[],this.size=0}function Ca(e,t){for(var n=e.length;n--;)if(Xl(e[n][0],t))return n;return-1}var Ux=Array.prototype,Bx=Ux.splice;function $x(e){var t=this.__data__,n=Ca(t,e);if(n<0)return!1;var s=t.length-1;return n==s?t.pop():Bx.call(t,n,1),--this.size,!0}function Vx(e){var t=this.__data__,n=Ca(t,e);return n<0?void 0:t[n][1]}function Gx(e){return Ca(this.__data__,e)>-1}function Kx(e,t){var n=this.__data__,s=Ca(n,e);return s<0?(++this.size,n.push([e,t])):n[s][1]=t,this}function Bt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}Bt.prototype.clear=Fx;Bt.prototype.delete=$x;Bt.prototype.get=Vx;Bt.prototype.has=Gx;Bt.prototype.set=Kx;var ws=jn(Ut,"Map");function zx(){this.size=0,this.__data__={hash:new En,map:new(ws||Bt),string:new En}}function Xx(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function ja(e,t){var n=e.__data__;return Xx(t)?n[typeof t=="string"?"string":"hash"]:n.map}function Wx(e){var t=ja(this,e).delete(e);return this.size-=t?1:0,t}function qx(e){return ja(this,e).get(e)}function Hx(e){return ja(this,e).has(e)}function Yx(e,t){var n=ja(this,e),s=n.size;return n.set(e,t),this.size+=n.size==s?0:1,this}function $t(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}$t.prototype.clear=zx;$t.prototype.delete=Wx;$t.prototype.get=qx;$t.prototype.has=Hx;$t.prototype.set=Yx;var Qx="Expected a function";function Hr(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Qx);var n=function(){var s=arguments,a=t?t.apply(this,s):s[0],r=n.cache;if(r.has(a))return r.get(a);var o=e.apply(this,s);return n.cache=r.set(a,o)||r,o};return n.cache=new(Hr.Cache||$t),n}Hr.Cache=$t;var Jx=500;function Zx(e){var t=Hr(e,function(s){return n.size===Jx&&n.clear(),s}),n=t.cache;return t}var eg=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tg=/\\(\\)?/g,ng=Zx(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(eg,function(n,s,a,r){t.push(a?r.replace(tg,"$1"):s||n)}),t});function sg(e){return e==null?"":Gl(e)}function ec(e,t){return xt(e)?e:qr(e,t)?[e]:ng(sg(e))}function La(e){if(typeof e=="string"||Ta(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}function tc(e,t){t=ec(t,e);for(var n=0,s=t.length;e!=null&&n<s;)e=e[La(t[n++])];return n&&n==s?e:void 0}function nc(e,t,n){var s=e==null?void 0:tc(e,t);return s===void 0?n:s}function sc(e,t){for(var n=-1,s=t.length,a=e.length;++n<s;)e[a+n]=t[n];return e}var po=Lt?Lt.isConcatSpreadable:void 0;function ag(e){return xt(e)||Xr(e)||!!(po&&e&&e[po])}function rg(e,t,n,s,a){var r=-1,o=e.length;for(n||(n=ag),a||(a=[]);++r<o;){var l=e[r];n(l)?sc(a,l):a[a.length]=l}return a}function mo(e){var t=e==null?0:e.length;return t?rg(e):[]}function ig(){this.__data__=new Bt,this.size=0}function og(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function lg(e){return this.__data__.get(e)}function cg(e){return this.__data__.has(e)}var dg=200;function ug(e,t){var n=this.__data__;if(n instanceof Bt){var s=n.__data__;if(!ws||s.length<dg-1)return s.push([e,t]),this.size=++n.size,this;n=this.__data__=new $t(s)}return n.set(e,t),this.size=n.size,this}function Ft(e){var t=this.__data__=new Bt(e);this.size=t.size}Ft.prototype.clear=ig;Ft.prototype.delete=og;Ft.prototype.get=lg;Ft.prototype.has=cg;Ft.prototype.set=ug;function ac(e,t){for(var n=-1,s=e==null?0:e.length,a=0,r=[];++n<s;){var o=e[n];t(o,n,e)&&(r[a++]=o)}return r}function hg(){return[]}var fg=Object.prototype,pg=fg.propertyIsEnumerable,bo=Object.getOwnPropertySymbols,mg=bo?function(e){return e==null?[]:(e=Object(e),ac(bo(e),function(t){return pg.call(e,t)}))}:hg;function bg(e,t,n){var s=t(e);return xt(e)?s:sc(s,n(e))}function xo(e){return bg(e,Wr,mg)}var _r=jn(Ut,"DataView"),Tr=jn(Ut,"Promise"),wr=jn(Ut,"Set"),go="[object Map]",xg="[object Object]",vo="[object Promise]",No="[object Set]",Eo="[object WeakMap]",yo="[object DataView]",gg=Cn(_r),vg=Cn(ws),Ng=Cn(Tr),Eg=Cn(wr),yg=Cn(Er),Yt=as;(_r&&Yt(new _r(new ArrayBuffer(1)))!=yo||ws&&Yt(new ws)!=go||Tr&&Yt(Tr.resolve())!=vo||wr&&Yt(new wr)!=No||Er&&Yt(new Er)!=Eo)&&(Yt=function(e){var t=as(e),n=t==xg?e.constructor:void 0,s=n?Cn(n):"";if(s)switch(s){case gg:return yo;case vg:return go;case Ng:return vo;case Eg:return No;case yg:return Eo}return t});var _o=Ut.Uint8Array,_g="__lodash_hash_undefined__";function Tg(e){return this.__data__.set(e,_g),this}function wg(e){return this.__data__.has(e)}function la(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new $t;++t<n;)this.add(e[t])}la.prototype.add=la.prototype.push=Tg;la.prototype.has=wg;function Ig(e,t){for(var n=-1,s=e==null?0:e.length;++n<s;)if(t(e[n],n,e))return!0;return!1}function Cg(e,t){return e.has(t)}var jg=1,Lg=2;function rc(e,t,n,s,a,r){var o=n&jg,l=e.length,d=t.length;if(l!=d&&!(o&&d>l))return!1;var u=r.get(e),c=r.get(t);if(u&&c)return u==t&&c==e;var h=-1,p=!0,b=n&Lg?new la:void 0;for(r.set(e,t),r.set(t,e);++h<l;){var x=e[h],m=t[h];if(s)var N=o?s(m,x,h,t,e,r):s(x,m,h,e,t,r);if(N!==void 0){if(N)continue;p=!1;break}if(b){if(!Ig(t,function(_,y){if(!Cg(b,y)&&(x===_||a(x,_,n,s,r)))return b.push(y)})){p=!1;break}}else if(!(x===m||a(x,m,n,s,r))){p=!1;break}}return r.delete(e),r.delete(t),p}function kg(e){var t=-1,n=Array(e.size);return e.forEach(function(s,a){n[++t]=[a,s]}),n}function Ag(e){var t=-1,n=Array(e.size);return e.forEach(function(s){n[++t]=s}),n}var Sg=1,Dg=2,Rg="[object Boolean]",Mg="[object Date]",Og="[object Error]",Pg="[object Map]",Fg="[object Number]",Ug="[object RegExp]",Bg="[object Set]",$g="[object String]",Vg="[object Symbol]",Gg="[object ArrayBuffer]",Kg="[object DataView]",To=Lt?Lt.prototype:void 0,lr=To?To.valueOf:void 0;function zg(e,t,n,s,a,r,o){switch(n){case Kg:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Gg:return!(e.byteLength!=t.byteLength||!r(new _o(e),new _o(t)));case Rg:case Mg:case Fg:return Xl(+e,+t);case Og:return e.name==t.name&&e.message==t.message;case Ug:case $g:return e==t+"";case Pg:var l=kg;case Bg:var d=s&Sg;if(l||(l=Ag),e.size!=t.size&&!d)return!1;var u=o.get(e);if(u)return u==t;s|=Dg,o.set(e,t);var c=rc(l(e),l(t),s,a,r,o);return o.delete(e),c;case Vg:if(lr)return lr.call(e)==lr.call(t)}return!1}var Xg=1,Wg=Object.prototype,qg=Wg.hasOwnProperty;function Hg(e,t,n,s,a,r){var o=n&Xg,l=xo(e),d=l.length,u=xo(t),c=u.length;if(d!=c&&!o)return!1;for(var h=d;h--;){var p=l[h];if(!(o?p in t:qg.call(t,p)))return!1}var b=r.get(e),x=r.get(t);if(b&&x)return b==t&&x==e;var m=!0;r.set(e,t),r.set(t,e);for(var N=o;++h<d;){p=l[h];var _=e[p],y=t[p];if(s)var g=o?s(y,_,p,t,e,r):s(_,y,p,e,t,r);if(!(g===void 0?_===y||a(_,y,n,s,r):g)){m=!1;break}N||(N=p=="constructor")}if(m&&!N){var w=e.constructor,I=t.constructor;w!=I&&"constructor"in e&&"constructor"in t&&!(typeof w=="function"&&w instanceof w&&typeof I=="function"&&I instanceof I)&&(m=!1)}return r.delete(e),r.delete(t),m}var Yg=1,wo="[object Arguments]",Io="[object Array]",qs="[object Object]",Qg=Object.prototype,Co=Qg.hasOwnProperty;function Jg(e,t,n,s,a,r){var o=xt(e),l=xt(t),d=o?Io:Yt(e),u=l?Io:Yt(t);d=d==wo?qs:d,u=u==wo?qs:u;var c=d==qs,h=u==qs,p=d==u;if(p&&yr(e)){if(!yr(t))return!1;o=!0,c=!1}if(p&&!c)return r||(r=new Ft),o||Jl(e)?rc(e,t,n,s,a,r):zg(e,t,d,n,s,a,r);if(!(n&Yg)){var b=c&&Co.call(e,"__wrapped__"),x=h&&Co.call(t,"__wrapped__");if(b||x){var m=b?e.value():e,N=x?t.value():t;return r||(r=new Ft),a(m,N,n,s,r)}}return p?(r||(r=new Ft),Hg(e,t,n,s,a,r)):!1}function Yr(e,t,n,s,a){return e===t?!0:e==null||t==null||!Nn(e)&&!Nn(t)?e!==e&&t!==t:Jg(e,t,n,s,Yr,a)}var Zg=1,ev=2;function tv(e,t,n,s){var a=n.length,r=a;if(e==null)return!r;for(e=Object(e);a--;){var o=n[a];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++a<r;){o=n[a];var l=o[0],d=e[l],u=o[1];if(o[2]){if(d===void 0&&!(l in e))return!1}else{var c=new Ft,h;if(!(h===void 0?Yr(u,d,Zg|ev,s,c):h))return!1}}return!0}function ic(e){return e===e&&!Un(e)}function nv(e){for(var t=Wr(e),n=t.length;n--;){var s=t[n],a=e[s];t[n]=[s,a,ic(a)]}return t}function oc(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function sv(e){var t=nv(e);return t.length==1&&t[0][2]?oc(t[0][0],t[0][1]):function(n){return n===e||tv(n,e,t)}}function av(e,t){return e!=null&&t in Object(e)}function rv(e,t,n){t=ec(t,e);for(var s=-1,a=t.length,r=!1;++s<a;){var o=La(t[s]);if(!(r=e!=null&&n(e,o)))break;e=e[o]}return r||++s!=a?r:(a=e==null?0:e.length,!!a&&zr(a)&&zl(o,a)&&(xt(e)||Xr(e)))}function iv(e,t){return e!=null&&rv(e,t,av)}var ov=1,lv=2;function cv(e,t){return qr(e)&&ic(t)?oc(La(e),t):function(n){var s=nc(n,e);return s===void 0&&s===t?iv(n,e):Yr(t,s,ov|lv)}}function lc(e){return function(t){return t?.[e]}}function dv(e){return function(t){return tc(t,e)}}function uv(e){return qr(e)?lc(La(e)):dv(e)}function cc(e){return typeof e=="function"?e:e==null?wa:typeof e=="object"?xt(e)?cv(e[0],e[1]):sv(e):uv(e)}function hv(e,t,n,s){for(var a=-1,r=e==null?0:e.length;++a<r;){var o=e[a];t(s,o,n(o),e)}return s}function fv(e){return function(t,n,s){for(var a=-1,r=Object(t),o=s(t),l=o.length;l--;){var d=o[++a];if(n(r[d],d,r)===!1)break}return t}}var dc=fv();function pv(e,t){return e&&dc(e,t,Wr)}function mv(e,t){return function(n,s){if(n==null)return n;if(!Ia(n))return e(n,s);for(var a=n.length,r=-1,o=Object(n);++r<a&&s(o[r],r,o)!==!1;);return n}}var bv=mv(pv);function xv(e,t,n,s){return bv(e,function(a,r,o){t(s,a,n(a),o)}),s}function gv(e,t){return function(n,s){var a=xt(n)?hv:xv,r=t?t():{};return a(n,e,cc(s),r)}}function vv(e){return Nn(e)&&Ia(e)}function ie(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function Nv(e){return typeof e=="function"?e:wa}var Ev=Math.max,yv=Math.min;function _v(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var a=s-1;return n!==void 0&&(a=nb(n),a=n<0?Ev(s+a,0):yv(a,s-1)),Cb(e,cc(t),a)}function Tv(e){return e&&e.length?e[0]:void 0}function Is(e,t){return e==null?e:dc(e,Nv(t),Tx)}var dt=gv(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),wv=Math.max;function Iv(e){if(!(e&&e.length))return[];var t=0;return e=ac(e,function(n){if(vv(n))return t=wv(n.length,t),!0}),ql(t,function(n){return Vl(e,lc(n))})}var Ir=Ab(Iv),T=(e=>(e.SPACE="<space>",e.TAB="<tab>",e.NEWLINE="<newline>",e.COMMA="<comma>",e.LPAREN="<lparen>",e.RPAREN="<rparen>",e.LBRACE="<lbrace>",e.RBRACE="<rbrace>",e.LBRACKET="<lbracket>",e.RBRACKET="<rbracket>",e.LANGLE="<langle>",e.RANGLE="<rangle>",e.OP="<op>",e.EOF="<eof>",e.NUMERIC_LITERAL="<number>",e.STRING_LITERAL="<string>",e.COLOR_LITERAL="<color>",e.FUNCTION_EXPRESSION="<function-expression>",e.QUOTED_STRING="<variable>",e.IDENTIFIER="<identifier>",e.SEMICOLON="<semicolon>",e.COLON="<colon>",e.TILDE="<tilde>",e.SINGLE_LINE_COMMENT="<single-line-comment>",e.MULTILINE_COMMENT="<multiline-comment>",e))(T||{});function Cv(e){switch(e.kind){case"<newline>":case"<space>":case"<tab>":case"<single-line-comment>":case"<multiline-comment>":return!0;default:return!1}}function jv(e){if(!e)return!1;switch(e){case"+":case"-":case"*":case"/":case"%":case"<":case">":case"=":case"!":case".":case"&":case"|":return!0;default:return!1}}function jo(e){return e!==void 0&&e.kind==="<op>"}class Ze{constructor(t,n,s,a,r){this.kind=t,this.startPos=n,this.endPos=s,this.value=a,this.leadingTrivia=[],this.trailingTrivia=[],this.leadingInvalid=[],this.trailingInvalid=[],this.isInvalid=r,this.start=n.offset,this.end=s.offset}static create(t,n,s,a,r){return new Ze(t,n,s,a,r)}}function uc(e){return e.trailingTrivia.find(({kind:t})=>t===T.NEWLINE)!==void 0}function Lo(e,t){return t.leadingTrivia.find(({kind:n})=>n===T.NEWLINE)!==void 0||uc(e)}function Cr(e){return e.trailingTrivia.find(({kind:t})=>[T.SPACE,T.TAB].includes(t))!==void 0}function hc(e){return e.trailingTrivia.length===0?e.end:hc(ie(e.trailingTrivia))}function fc(e){return e.leadingTrivia.length===0?e.start:fc(e.leadingTrivia[0])}function Lv(e){return[T.SINGLE_LINE_COMMENT,T.MULTILINE_COMMENT].includes(e.kind)}class kv{constructor(){this.id=0}reset(){this.id=0}nextId(){return this.id++}}class oe{constructor(t,n,s){this.id=t,this.kind=n;const a=s.find(o=>o!==void 0&&!Number.isNaN(o.start));a?(this.startPos=a.startPos,this.fullStart=a instanceof Ze?fc(a):a.fullStart):(this.startPos={offset:NaN,column:NaN,line:NaN},this.fullStart=NaN);const r=[...s].reverse().find(o=>o!==void 0&&!Number.isNaN(o.end));r?(this.endPos=r.endPos,this.fullEnd=r instanceof Ze?hc(r):r.fullEnd):(this.endPos={offset:NaN,column:NaN,line:NaN},this.fullEnd=NaN),this.start=this.startPos.offset,this.end=this.endPos.offset}}var gn=(e=>(e.PROGRAM="<program>",e.ELEMENT_DECLARATION="<element-declaration>",e.ATTRIBUTE="<attribute>",e.IDENTIFIER_STREAM="<identifer-stream>",e.LITERAL="<literal>",e.VARIABLE="<variable>",e.PREFIX_EXPRESSION="<prefix-expression>",e.INFIX_EXPRESSION="<infix-expression>",e.POSTFIX_EXPRESSION="<postfix-expression>",e.FUNCTION_EXPRESSION="<function-expression>",e.FUNCTION_APPLICATION="<function-application>",e.BLOCK_EXPRESSION="<block-expression>",e.LIST_EXPRESSION="<list-expression>",e.TUPLE_EXPRESSION="<tuple-expression>",e.CALL_EXPRESSION="<call-expression>",e.PRIMARY_EXPRESSION="<primary-expression>",e.GROUP_EXPRESSION="<group-expression>",e.DUMMY="<dummy>",e.ARRAY="<array>",e.PARTIAL_INJECTION="<partial-injection>",e))(gn||{});class it extends oe{constructor({body:t=[],eof:n},s){super(s,"<program>",[...t,n]),this.body=t,this.eof=n}}class Z extends oe{constructor({type:t,name:n,as:s,alias:a,attributeList:r,bodyColon:o,body:l},d){if(super(d,"<element-declaration>",[t,n,s,a,r,o,l]),l&&o&&!(l instanceof Y||l instanceof Z))throw new Error("If an element has a simple body, it must be a function application node");this.type=t,this.name=n,this.as=s,this.alias=a,this.attributeList=r,this.bodyColon=o,this.body=l}}class ht extends oe{constructor({identifiers:t=[]},n){super(n,"<identifer-stream>",t||[]),this.identifiers=t}}class ft extends oe{constructor({name:t,colon:n,value:s},a){super(a,"<attribute>",[t,n,s]),this.name=t,this.value=s,this.colon=n}}class ot extends oe{constructor({op:t,expression:n},s){super(s,"<prefix-expression>",[t,n]),this.op=t,this.expression=n}}class kt extends oe{constructor({op:t,leftExpression:n,rightExpression:s},a){super(a,"<infix-expression>",[n,t,s]),this.op=t,this.leftExpression=n,this.rightExpression=s}}class ka extends oe{constructor({op:t,expression:n},s){super(s,"<postfix-expression>",[n,t]),this.op=t,this.expression=n}}class lt extends oe{constructor({value:t},n){super(n,"<function-expression>",[t]),this.value=t}}class Y extends oe{constructor({callee:t,args:n=[]},s){super(s,"<function-application>",[t,...n]),this.callee=t,this.args=n}}class Nt extends oe{constructor({blockOpenBrace:t,body:n=[],blockCloseBrace:s},a){super(a,"<block-expression>",[t,...n,s]),this.blockOpenBrace=t,this.body=n,this.blockCloseBrace=s}}class yn extends oe{constructor({op:t,partial:n},s){super(s,"<partial-injection>",[t,n]),this.partial=n}}class re extends oe{constructor({listOpenBracket:t,elementList:n=[],commaList:s=[],listCloseBracket:a},r){super(r,"<list-expression>",[t,...pc(n,s),a]),this.listOpenBracket=t,this.elementList=n,this.commaList=s,this.listCloseBracket=a}}class At extends oe{constructor({tupleOpenParen:t,elementList:n=[],commaList:s=[],tupleCloseParen:a},r){super(r,"<tuple-expression>",[t,...pc(n,s),a]),this.tupleOpenParen=t,this.elementList=n,this.commaList=s,this.tupleCloseParen=a}}class Qr extends At{constructor({groupOpenParen:t,expression:n,groupCloseParen:s},a){super({tupleOpenParen:t,elementList:n&&[n],commaList:[],tupleCloseParen:s},a),this.kind="<group-expression>"}}class ct extends oe{constructor({callee:t,argumentList:n},s){super(s,"<call-expression>",[t,n]),this.callee=t,this.argumentList=n}}class rs extends oe{constructor({literal:t},n){super(n,"<literal>",[t]),this.literal=t}}class gt extends oe{constructor({variable:t},n){super(n,"<variable>",[t]),this.variable=t}}class Ue extends oe{constructor({expression:t},n){super(n,"<primary-expression>",[t]),this.expression=t}}class Hs extends oe{constructor({pre:t},n){const s=Ze.create(T.SPACE,t.endPos,t.endPos," ",!1);super(n,"<dummy>",[s])}}class _n extends oe{constructor({expression:t,indexer:n},s){super(s,"<array>",[t,n]),this.array=t,this.indexer=n}}function pc(e,t){if(!e||e.length===0)return t||[];if(!t||t.length===0)return e||[];const[n]=e,[s]=t;return(n.start<s.start?mo(Ir(e,t)):mo(Ir(t,e))).filter(a=>a!==null)}class me{constructor(t){this.value=t}unwrap(){return this.value}unwrap_or(t){return this.value}and_then(t){return t(this.value)}map(t){return new me(t(this.value))}isOk(){return!0}}class te{constructor(){this.value=void 0}unwrap(){throw new Error("Trying to unwrap a None value")}unwrap_or(t){return t}and_then(t){return new te}map(t){return new te}isOk(){return!1}}var M=(e=>(e.Schema="Schema",e.Table="Table",e.Column="Column",e.TableGroup="TableGroup",e.TableGroupField="TableGroup field",e.Enum="Enum",e.EnumField="Enum field",e.Note="Note",e.TablePartial="TablePartial",e.TablePartialInjection="TablePartialInjection",e))(M||{});function Jr(e){return`Schema:${e}`}function ca(e){return`Table:${e}`}function Aa(e){return`Column:${e}`}function Zr(e){return`Enum:${e}`}function ei(e){return`Enum field:${e}`}function ti(e){return`TableGroup:${e}`}function ni(e){return`TableGroup field:${e}`}function Av(e){return`Note:${e}`}function si(e){return`TablePartial:${e}`}function mc(e){return`TablePartialInjection:${e}`}function Js(e,t){switch(t){case"Column":return Aa(e);case"Enum":return Zr(e);case"Enum field":return ei(e);case"Schema":return Jr(e);case"Table":return ca(e);case"TableGroup":return ti(e);case"TableGroup field":return ni(e);case"TablePartial":return si(e);default:throw new Error("Unreachable")}}function pt(e){const[t,n]=e.split(":");return Object.values(M).includes(t)?new me({name:n,kind:t}):new te}function Sv(e){const t=pt(e).unwrap_or(void 0);if(!t)return!1;const{kind:n,name:s}=t;return n==="Schema"&&s==="public"}function Dv(e){const t=pt(e).unwrap_or(void 0);if(!t)return!1;const{kind:n}=t;return n==="TablePartialInjection"}function Rv(e){const t=pt(e).unwrap_or(void 0);if(!t)return null;const{kind:n,name:s}=t;return n==="TablePartialInjection"?Js(s,"TablePartial"):null}class Mv{constructor(){this.id=0}reset(){this.id=0}nextId(){return this.id++}}class bc{constructor({symbolTable:t},n){this.references=[],this.id=n,this.symbolTable=t}}class Ov{constructor({symbolTable:t,declaration:n},s){this.references=[],this.id=s,this.symbolTable=t,this.declaration=n}}class Pv{constructor({declaration:t},n){this.references=[],this.id=n,this.declaration=t}}class xc{constructor({symbolTable:t,declaration:n},s){this.references=[],this.id=s,this.symbolTable=t,this.declaration=n}}class ai{constructor({declaration:t},n){this.references=[],this.id=n,this.declaration=t}}class Fv{constructor({symbolTable:t,declaration:n},s){this.references=[],this.id=s,this.symbolTable=t,this.declaration=n}}class Uv{constructor({declaration:t},n){this.references=[],this.id=n,this.declaration=t}}class Bv{constructor({symbolTable:t,declaration:n},s){this.references=[],this.id=s,this.symbolTable=t,this.declaration=n}}class $v{constructor({declaration:t},n){this.references=[],this.id=n,this.declaration=t}}class Vv{constructor({injectorFieldSymbol:t,injectorDeclaration:n},s){this.references=[],this.id=s,this.injectorDeclaration=n,this.injectorFieldSymbol=t}}function Gv(e){return[Jr,ca,Zr,ti,Aa,ei,ni,si,mc].map(t=>t(e))}function Kv(e){return e instanceof ai?Vv:null}function Sa(e){return!!e.match(new RegExp("(\\p{L}|_|\\p{M})","gu"))}function da(e){const[t]=e;return t>="0"&&t<="9"}function zv(e){const[t]=e;return da(t)||Sa(t)&&t.toLowerCase()>="a"&&t.toLowerCase()<="f"}function Mn(e){return Sa(e)||da(e)}function ko(e,t){const n=[],s=Math.min(e.length,t.length);for(let a=0;a<s;a+=1)n.push(e[a],t[a]);return n.push(...e.slice(s),...t.slice(s)),n}function Ns(e,t){return e>=t.start&&e<t.end}function gc(e){var t;return e instanceof ot?`${(t=e.op)==null?void 0:t.value}${gc(e.expression)}`:e.expression.literal.value}function jr(e){var t;return e instanceof ot?((t=e.op)==null?void 0:t.value)==="-"?-jr(e.expression):jr(e.expression):Number.parseFloat(e.expression.literal.value)}var v=(e=>(e[e.UNKNOWN_SYMBOL=1e3]="UNKNOWN_SYMBOL",e[e.UNEXPECTED_SYMBOL=1001]="UNEXPECTED_SYMBOL",e[e.UNEXPECTED_EOF=1002]="UNEXPECTED_EOF",e[e.UNEXPECTED_NEWLINE=1003]="UNEXPECTED_NEWLINE",e[e.UNKNOWN_TOKEN=1004]="UNKNOWN_TOKEN",e[e.UNEXPECTED_TOKEN=1005]="UNEXPECTED_TOKEN",e[e.UNEXPECTED_ELEMENT_DECLARATION=1006]="UNEXPECTED_ELEMENT_DECLARATION",e[e.MISSING_SPACES=1007]="MISSING_SPACES",e[e.UNKNOWN_PREFIX_OP=1008]="UNKNOWN_PREFIX_OP",e[e.INVALID_OPERAND=1009]="INVALID_OPERAND",e[e.EMPTY_ATTRIBUTE_NAME=1010]="EMPTY_ATTRIBUTE_NAME",e[e.INVALID_ESCAPE_SEQUENCE=1011]="INVALID_ESCAPE_SEQUENCE",e[e.INVALID_NAME=3e3]="INVALID_NAME",e[e.UNEXPECTED_NAME=3001]="UNEXPECTED_NAME",e[e.NAME_NOT_FOUND=3002]="NAME_NOT_FOUND",e[e.DUPLICATE_NAME=3003]="DUPLICATE_NAME",e[e.INVALID_ALIAS=3004]="INVALID_ALIAS",e[e.UNEXPECTED_ALIAS=3005]="UNEXPECTED_ALIAS",e[e.UNEXPECTED_SETTINGS=3006]="UNEXPECTED_SETTINGS",e[e.INVALID_SETTINGS=3007]="INVALID_SETTINGS",e[e.UNEXPECTED_SIMPLE_BODY=3008]="UNEXPECTED_SIMPLE_BODY",e[e.UNEXPECTED_COMPLEX_BODY=3009]="UNEXPECTED_COMPLEX_BODY",e[e.INVALID_TABLE_CONTEXT=3010]="INVALID_TABLE_CONTEXT",e[e.UNKNOWN_TABLE_SETTING=3011]="UNKNOWN_TABLE_SETTING",e[e.DUPLICATE_TABLE_SETTING=3012]="DUPLICATE_TABLE_SETTING",e[e.INVALID_TABLEGROUP_CONTEXT=3013]="INVALID_TABLEGROUP_CONTEXT",e[e.INVALID_TABLEGROUP_ELEMENT_NAME=3014]="INVALID_TABLEGROUP_ELEMENT_NAME",e[e.DUPLICATE_TABLEGROUP_ELEMENT_NAME=3015]="DUPLICATE_TABLEGROUP_ELEMENT_NAME",e[e.DUPLICATE_TABLEGROUP_FIELD_NAME=3016]="DUPLICATE_TABLEGROUP_FIELD_NAME",e[e.INVALID_TABLEGROUP_FIELD=3017]="INVALID_TABLEGROUP_FIELD",e[e.EMPTY_TABLE=3018]="EMPTY_TABLE",e[e.INVALID_COLUMN=3019]="INVALID_COLUMN",e[e.INVALID_COLUMN_NAME=3020]="INVALID_COLUMN_NAME",e[e.UNKNOWN_COLUMN_SETTING=3021]="UNKNOWN_COLUMN_SETTING",e[e.INVALID_COLUMN_TYPE=3022]="INVALID_COLUMN_TYPE",e[e.DUPLICATE_COLUMN_NAME=3023]="DUPLICATE_COLUMN_NAME",e[e.DUPLICATE_COLUMN_SETTING=3024]="DUPLICATE_COLUMN_SETTING",e[e.INVALID_COLUMN_SETTING_VALUE=3025]="INVALID_COLUMN_SETTING_VALUE",e[e.INVALID_ENUM_CONTEXT=3026]="INVALID_ENUM_CONTEXT",e[e.INVALID_ENUM_ELEMENT_NAME=3027]="INVALID_ENUM_ELEMENT_NAME",e[e.INVALID_ENUM_ELEMENT=3028]="INVALID_ENUM_ELEMENT",e[e.DUPLICATE_ENUM_ELEMENT_NAME=3029]="DUPLICATE_ENUM_ELEMENT_NAME",e[e.UNKNOWN_ENUM_ELEMENT_SETTING=3030]="UNKNOWN_ENUM_ELEMENT_SETTING",e[e.DUPLICATE_ENUM_ELEMENT_SETTING=3031]="DUPLICATE_ENUM_ELEMENT_SETTING",e[e.INVALID_ENUM_ELEMENT_SETTING=3032]="INVALID_ENUM_ELEMENT_SETTING",e[e.EMPTY_ENUM=3033]="EMPTY_ENUM",e[e.INVALID_REF_CONTEXT=3034]="INVALID_REF_CONTEXT",e[e.UNKNOWN_REF_SETTING=3035]="UNKNOWN_REF_SETTING",e[e.DUPLICATE_REF_SETTING=3036]="DUPLICATE_REF_SETTING",e[e.INVALID_REF_SETTING_VALUE=3037]="INVALID_REF_SETTING_VALUE",e[e.INVALID_REF_RELATIONSHIP=3038]="INVALID_REF_RELATIONSHIP",e[e.INVALID_REF_FIELD=3039]="INVALID_REF_FIELD",e[e.EMPTY_REF=3040]="EMPTY_REF",e[e.REF_REDEFINED=3041]="REF_REDEFINED",e[e.INVALID_NOTE_CONTEXT=3042]="INVALID_NOTE_CONTEXT",e[e.INVALID_NOTE=3043]="INVALID_NOTE",e[e.NOTE_REDEFINED=3044]="NOTE_REDEFINED",e[e.NOTE_CONTENT_REDEFINED=3045]="NOTE_CONTENT_REDEFINED",e[e.EMPTY_NOTE=3046]="EMPTY_NOTE",e[e.INVALID_INDEXES_CONTEXT=3047]="INVALID_INDEXES_CONTEXT",e[e.INVALID_INDEXES_FIELD=3048]="INVALID_INDEXES_FIELD",e[e.INVALID_INDEX=3049]="INVALID_INDEX",e[e.UNKNOWN_INDEX_SETTING=3050]="UNKNOWN_INDEX_SETTING",e[e.DUPLICATE_INDEX_SETTING=3051]="DUPLICATE_INDEX_SETTING",e[e.UNEXPECTED_INDEX_SETTING_VALUE=3052]="UNEXPECTED_INDEX_SETTING_VALUE",e[e.INVALID_INDEX_SETTING_VALUE=3053]="INVALID_INDEX_SETTING_VALUE",e[e.INVALID_PROJECT_CONTEXT=3054]="INVALID_PROJECT_CONTEXT",e[e.PROJECT_REDEFINED=3055]="PROJECT_REDEFINED",e[e.INVALID_PROJECT_FIELD=3056]="INVALID_PROJECT_FIELD",e[e.INVALID_CUSTOM_CONTEXT=3057]="INVALID_CUSTOM_CONTEXT",e[e.INVALID_CUSTOM_ELEMENT_VALUE=3058]="INVALID_CUSTOM_ELEMENT_VALUE",e[e.INVALID_ELEMENT_IN_SIMPLE_BODY=3059]="INVALID_ELEMENT_IN_SIMPLE_BODY",e[e.INVALID_TABLE_PARTIAL_CONTEXT=3060]="INVALID_TABLE_PARTIAL_CONTEXT",e[e.INVALID_TABLE_PARTIAL_ELEMENT_NAME=3061]="INVALID_TABLE_PARTIAL_ELEMENT_NAME",e[e.INVALID_TABLE_PARTIAL_SETTING_VALUE=3062]="INVALID_TABLE_PARTIAL_SETTING_VALUE",e[e.DUPLICATE_TABLE_PARTIAL_ELEMENT_NAME=3063]="DUPLICATE_TABLE_PARTIAL_ELEMENT_NAME",e[e.DUPLICATE_TABLE_PARTIAL_SETTING=3064]="DUPLICATE_TABLE_PARTIAL_SETTING",e[e.INVALID_TABLE_PARTIAL_INJECTION=3065]="INVALID_TABLE_PARTIAL_INJECTION",e[e.INVALID_TABLE_PARTIAL_INJECTION_OP=3066]="INVALID_TABLE_PARTIAL_INJECTION_OP",e[e.INVALID_TABLE_PARTIAL_INJECTION_NAME=3067]="INVALID_TABLE_PARTIAL_INJECTION_NAME",e[e.DUPLICATE_TABLE_PARTIAL_INJECTION_NAME=3068]="DUPLICATE_TABLE_PARTIAL_INJECTION_NAME",e[e.UNKNOWN_TABLE_PARTIAL_SETTING=3069]="UNKNOWN_TABLE_PARTIAL_SETTING",e[e.INVALID_TABLE_SETTING_VALUE=3070]="INVALID_TABLE_SETTING_VALUE",e[e.INVALID_CHECKS_CONTEXT=3071]="INVALID_CHECKS_CONTEXT",e[e.INVALID_CHECKS_FIELD=3072]="INVALID_CHECKS_FIELD",e[e.INVALID_CHECK=3073]="INVALID_CHECK",e[e.UNKNOWN_CHECK_SETTING=3074]="UNKNOWN_CHECK_SETTING",e[e.DUPLICATE_CHECK_SETTING=3075]="DUPLICATE_CHECK_SETTING",e[e.INVALID_CHECK_SETTING_VALUE=3076]="INVALID_CHECK_SETTING_VALUE",e[e.BINDING_ERROR=4e3]="BINDING_ERROR",e[e.UNSUPPORTED=5e3]="UNSUPPORTED",e[e.CIRCULAR_REF=5001]="CIRCULAR_REF",e[e.SAME_ENDPOINT=5002]="SAME_ENDPOINT",e[e.UNEQUAL_FIELDS_BINARY_REF=5003]="UNEQUAL_FIELDS_BINARY_REF",e[e.CONFLICTING_SETTING=5004]="CONFLICTING_SETTING",e[e.TABLE_REAPPEAR_IN_TABLEGROUP=5005]="TABLE_REAPPEAR_IN_TABLEGROUP",e))(v||{});class E extends Error{constructor(t,n,s){super(n),this.code=t,this.diagnostic=n,this.nodeOrToken=s,this.start=s.start,this.end=s.end,this.name=this.constructor.name,Object.setPrototypeOf(this,E.prototype)}}class et{constructor(t,n){this.value=t,this.errors=n===void 0?[]:n}getValue(){return this.value}getErrors(){return this.errors}chain(t){const n=t(this.value),s=[...this.errors,...n.errors];return new et(n.value,s)}map(t){return new et(t(this.value),this.errors)}}function Xv(e,t,n){if(!e||!tn(e)||t.length===0)return new te;const s=[...t],a=Ao(e).unwrap(),r=s.pop();if(!(r instanceof Nt))return new te;const o=ie(s)instanceof re?s.pop():void 0;if(s.length===3){const l=Ao(s[1]).value;return!l||!Lr(l)?new te:new me(n.create(Z,{type:a,name:s[0],as:l,alias:s[2],attributeList:o,body:r}))}return s.length===1?new me(n.create(Z,{type:a,name:s[0],attributeList:o,body:r})):s.length===0?new me(n.create(Z,{type:a,attributeList:o,body:r})):new te}function Lr(e){return e?.kind===T.IDENTIFIER&&e.value==="as"}function U(e){e&&(e instanceof Ze?Wv(e):qv(e))}function Wv(e){e.kind!==T.EOF&&(e.isInvalid=!0)}function qv(e){if(e instanceof Z)U(e.type),U(e.name),U(e.as),U(e.alias),U(e.bodyColon),U(e.attributeList),U(e.body);else if(e instanceof ht)e.identifiers.forEach(U);else if(e instanceof ft)U(e.name),U(e.colon),U(e.value);else if(e instanceof ot)U(e.op),U(e.expression);else if(e instanceof kt)U(e.leftExpression),U(e.op),U(e.rightExpression);else if(e instanceof ka)U(e.op),U(e.expression);else if(e instanceof Nt)U(e.blockOpenBrace),e.body.forEach(U),U(e.blockCloseBrace);else if(e instanceof re)U(e.listOpenBracket),e.commaList.forEach(U),e.elementList.forEach(U),U(e.listCloseBracket);else if(e instanceof At)U(e.tupleOpenParen),e.commaList.forEach(U),e.elementList.forEach(U),U(e.tupleCloseParen);else if(e instanceof ct)U(e.callee),U(e.argumentList);else if(e instanceof Y)U(e.callee),e.args.forEach(U);else if(e instanceof Ue)U(e.expression);else if(e instanceof lt)U(e.value);else if(e instanceof gt)U(e.variable);else if(e instanceof rs)U(e.literal);else throw e instanceof Qr?new Error("This case is handled by the TupleExpressionNode case"):new Error("Unreachable case in markInvalidNode")}function vc(e){return!!(e!=null&&e.isInvalid)}function ke(...e){return e.filter(t=>t!==void 0)}function Hv(e){if(e instanceof it)return ke(...e.body,e.eof);if(e instanceof Z)return ke(e.type,e.name,e.as,e.alias,e.attributeList,e.bodyColon,e.body);if(e instanceof ft)return ke(e.name,e.colon,e.value);if(e instanceof ht)return e.identifiers;if(e instanceof rs)return e.literal?[e.literal]:[];if(e instanceof gt)return ke(e.variable);if(e instanceof ot)return ke(e.op,e.expression);if(e instanceof kt)return ke(e.leftExpression,e.op,e.rightExpression);if(e instanceof ka)return ke(e.expression,e.op);if(e instanceof lt)return ke(e.value);if(e instanceof Y)return ke(e.callee,...e.args);if(e instanceof Nt)return ke(e.blockOpenBrace,...e.body,e.blockCloseBrace);if(e instanceof re)return ke(e.listOpenBracket,...ko(e.elementList,e.commaList),e.listCloseBracket);if(e instanceof At)return ke(e.tupleOpenParen,...ko(e.elementList,e.commaList),e.tupleCloseParen);if(e instanceof ct)return ke(e.callee,e.argumentList);if(e instanceof Ue)return ke(e.expression);if(e instanceof _n)return ke(e.array,e.indexer);if(e instanceof yn)return ke(e.partial);throw e instanceof Qr?new Error("This case is already handled by TupleExpressionNode"):new Error("Unreachable - no other possible cases")}function Ao(e){return Ie(e)?new me(e.expression.variable):new te}function De(e){var t;return e instanceof Ue&&(e.expression instanceof gt&&e.expression.variable instanceof Ze&&e.expression.variable.kind===T.QUOTED_STRING||e.expression instanceof rs&&((t=e.expression.literal)==null?void 0:t.kind)===T.STRING_LITERAL)}function Ie(e){return e instanceof Ue&&e.expression instanceof gt&&e.expression.variable instanceof Ze}function tn(e){var t;return e instanceof Ue&&e.expression instanceof gt&&((t=e.expression.variable)==null?void 0:t.kind)===T.IDENTIFIER}function Da(e){var t;return e instanceof kt&&e.leftExpression instanceof oe&&e.rightExpression instanceof oe&&((t=e.op)==null?void 0:t.value)==="."}function ri(e){return Ie(e)?!0:Da(e)&&Ie(e.rightExpression)&&ri(e.leftExpression)}function Bn(e){if(e===void 0)return new te;const t=e.identifiers.map(n=>n.value).join(" ");return t===""?new te:new me(t)}class Yv{constructor(t){this.start={offset:0,line:0,column:0},this.current={offset:0,line:0,column:0},this.tokens=[],this.errors=[],this.text=t}isAtEnd(){return this.current.offset>=this.text.length}advance(){const t=this.peek();return this.current={...this.current},t===`
`?(this.current.line+=1,this.current.column=0):this.current.column+=1,this.current.offset+=1,t}peek(t=0){if(!(this.current.offset+t>=this.text.length))return this.text[this.current.offset+t]}check(t){for(let n=0;n<t.length;n+=1)if(t[n]!==this.peek(n))return!1;return!0}match(t){return this.check(t)?(t.split("").forEach(()=>this.advance()),!0):!1}addToken(t,n=!1){this.tokens.push(this.createToken(t,n))}createToken(t,n=!1){return Ze.create(t,this.start,this.current,this.text.substring(this.start.offset,this.current.offset),n)}lex(){return this.scanTokens(),this.tokens.push(Ze.create(T.EOF,this.start,this.current,"",!1)),this.gatherTrivia(),this.gatherInvalid(),new et(this.tokens,this.errors)}scanTokens(){for(;!this.isAtEnd();){const t=this.advance();switch(t){case" ":this.addToken(T.SPACE);break;case"\r":break;case`
`:this.addToken(T.NEWLINE);break;case"	":this.addToken(T.TAB);break;case",":this.addToken(T.COMMA);break;case"(":this.addToken(T.LPAREN);break;case")":this.addToken(T.RPAREN);break;case"[":this.addToken(T.LBRACKET);break;case"]":this.addToken(T.RBRACKET);break;case"{":this.addToken(T.LBRACE);break;case"}":this.addToken(T.RBRACE);break;case";":this.addToken(T.SEMICOLON);break;case":":this.addToken(T.COLON);break;case"~":this.addToken(T.TILDE);break;case"'":this.match("''")?this.multilineStringLiteral():this.singleLineStringLiteral();break;case'"':this.quotedVariable();break;case"`":this.functionExpression();break;case"#":this.colorLiteral();break;case"/":this.match("/")?this.singleLineComment():this.match("*")?this.multilineComment():this.operator(t);break;default:if(jv(t)){this.operator(t);break}if(Sa(t)){this.identifier();break}if(da(t)){this.numericLiteralOrIdentifier();break}this.addToken(T.OP,!0),this.errors.push(new E(v.UNKNOWN_SYMBOL,`Unexpected token '${t}'`,this.createToken(T.OP,!0)));break}this.start={...this.current}}}gatherTrivia(){let t=!0,n=[],s;const a=[];for(const r of this.tokens)Cv(r)?(n.push(r),r.kind===T.NEWLINE&&s&&(s.trailingTrivia=n,t=!0,s=void 0,n=[])):(t?r.leadingTrivia=n:s.trailingTrivia=n,a.push(r),n=[],s=r,t=!1);this.tokens=a}gatherInvalid(){let t;const n=[],s=[];for(t=0;t<this.tokens.length&&vc(this.tokens[t]);t+=1)s.push(this.tokens[t]);let a=this.tokens[t];for(a.leadingInvalid=[...s,...a.leadingInvalid];t<this.tokens.length;t+=1){const r=this.tokens[t];r.isInvalid?a.trailingInvalid.push(r):(a=r,n.push(r))}this.tokens=n}consumeUntil(t,n,{allowNewline:s,allowEof:a,raw:r,consumeStopSequence:o=!0}){let l="";for(;!this.isAtEnd()&&(s||!this.check(`
`))&&!this.check(n);)this.peek()==="\\"&&!r?(this.advance(),l+=this.escapedString()):l+=this.advance();if(this.isAtEnd()&&!a){const d=this.createToken(t,!0);this.tokens.push(d),this.errors.push(new E(v.UNEXPECTED_EOF,"EOF reached while parsing",d));return}if(this.check(`
`)&&!s){const d=this.createToken(t,!0);this.tokens.push(d),this.errors.push(new E(v.UNEXPECTED_NEWLINE,"Invalid newline encountered while parsing",d));return}o&&this.match(n),this.tokens.push(Ze.create(t,this.start,this.current,l,!1))}singleLineStringLiteral(){this.consumeUntil(T.STRING_LITERAL,"'",{allowNewline:!1,allowEof:!1,raw:!1})}multilineStringLiteral(){this.consumeUntil(T.STRING_LITERAL,"'''",{allowNewline:!0,allowEof:!1,raw:!1})}functionExpression(){this.consumeUntil(T.FUNCTION_EXPRESSION,"`",{allowNewline:!0,allowEof:!1,raw:!0})}quotedVariable(){this.consumeUntil(T.QUOTED_STRING,'"',{allowNewline:!1,allowEof:!1,raw:!1})}singleLineComment(){this.consumeUntil(T.SINGLE_LINE_COMMENT,`
`,{allowNewline:!0,allowEof:!0,raw:!0,consumeStopSequence:!1})}multilineComment(){this.consumeUntil(T.MULTILINE_COMMENT,"*/",{allowNewline:!0,allowEof:!1,raw:!0})}identifier(){for(;!this.isAtEnd()&&Mn(this.peek());)this.advance();this.addToken(T.IDENTIFIER)}operator(t){switch(t){case"<":[">","="].includes(this.peek())&&this.advance();break;case">":this.peek()==="="&&this.advance();break;case"=":this.peek()==="="&&this.advance();break;case"!":this.peek()==="="&&this.advance();break}this.addToken(T.OP)}numericLiteralOrIdentifier(){let t=0;if(this.isAtEnd())return this.addToken(T.NUMERIC_LITERAL);for(;!this.isAtEnd();){const n=this.check(".");if(t+=n?1:0,t>1)break;if(!n&&this.current.offset===this.text.length-1)return this.advance(),this.addToken(T.NUMERIC_LITERAL);if(!n&&!Mn(this.peek()))return this.addToken(T.NUMERIC_LITERAL);if(!n&&!da(this.peek()))break;this.advance()}if(t>0){for(;!this.isAtEnd()&&(this.check(".")||Mn(this.peek()));)this.advance();const n=this.createToken(T.NUMERIC_LITERAL,!0);this.tokens.push(n),this.errors.push(new E(v.UNKNOWN_TOKEN,"Invalid number",n))}else{for(;!this.isAtEnd()&&Mn(this.peek());)this.advance();const n=this.createToken(T.IDENTIFIER,!1);this.tokens.push(n)}}colorLiteral(){for(;!this.isAtEnd()&&Mn(this.peek());)this.advance();this.addToken(T.COLOR_LITERAL)}escapedString(){const t={column:this.current.column-1,offset:this.current.offset-1,line:this.current.line};if(this.isAtEnd())return"\\";switch(this.advance()){case"\r":return this.check(`
`)&&this.advance(),"";case`
`:return"";case"t":return"	";case"n":return`
`;case"\\":return"\\";case"r":return"\r";case"'":return"'";case'"':return'"';case"`":return"`";case"0":return"\0";case"b":return"\b";case"v":return"\v";case"f":return"\f";case" ":return"\\ ";case"u":{let n="";for(let s=0;s<=3;s+=1){if(this.isAtEnd()||!Mn(this.peek()))return this.errors.push(new E(v.INVALID_ESCAPE_SEQUENCE,`Invalid unicode escape sequence '\\u${n}', only unicode escape sequences of the form '\\uHHHH' where H is a hexadecimal number are allowed`,Ze.create(T.STRING_LITERAL,t,this.current,`\\u${n}`,!0))),`\\u${n}`;n+=this.advance()}return String.fromCharCode(parseInt(n,16))}default:return this.text[this.current.offset-1]}}}var Zs=(e=>(e[e.ListExpression=0]="ListExpression",e[e.GroupExpression=1]="GroupExpression",e[e.BlockExpression=2]="BlockExpression",e))(Zs||{});class Qv{constructor(){this.stack=[],this.numberOfNestedLParens=0,this.numberOfNestedLBrackets=0,this.numberOfNestedLBraces=0}push(t){this.stack.push(t),t===0&&(this.numberOfNestedLBrackets+=1),t===1&&(this.numberOfNestedLParens+=1),t===2&&(this.numberOfNestedLBraces+=1)}pop(){const t=this.stack.pop();return t===0&&(this.numberOfNestedLBrackets-=1),t===1&&(this.numberOfNestedLParens-=1),t===2&&(this.numberOfNestedLBraces-=1),t}top(){return ie(this.stack)}isWithinGroupExpressionContext(){return this.numberOfNestedLParens>0}isWithinListExpressionContext(){return this.numberOfNestedLBrackets>0}isWithinBlockExpressionContext(){return this.numberOfNestedLBraces>0}withContextDo(t,n){return()=>{this.push(t);try{return n()}finally{this.pop()}}}findHandlerContext(t,n){if(!(this.numberOfNestedLBraces<=0&&this.numberOfNestedLBrackets<=0&&this.numberOfNestedLParens<=0))for(let s=n;s<t.length-1;s+=1)switch(t[s].kind){case T.COMMA:if(this.isWithinGroupExpressionContext()||this.isWithinListExpressionContext())return[...this.stack].reverse().find(a=>[1,0].includes(a));break;case T.RPAREN:if(this.isWithinGroupExpressionContext())return 1;break;case T.RBRACE:if(this.isWithinBlockExpressionContext())return 2;break;case T.RBRACKET:if(this.isWithinListExpressionContext())return 0;break}}}class Jv{constructor(t){this.generator=t}create(t,n){return new t(n,this.generator.nextId())}}class R{constructor(t,n,s){this.token=t,this.partialNode=n,this.handlerContext=s}}class Zv{constructor(t,n){this.current=0,this.errors=[],this.contextStack=new Qv,this.synchronizeProgram=()=>{const s=this.peek();s.kind!==T.EOF?U(this.advance()):(U(this.peek()),this.logError(s,v.UNEXPECTED_EOF,"Unexpected EOF"))},this.synchronizeElementDeclarationName=()=>{for(;!this.isAtEnd();){const s=this.peek();if(Lr(s)||this.check(T.COLON,T.LBRACE,T.LBRACKET))break;U(s),this.advance()}},this.synchronizeElementDeclarationAlias=()=>{for(;!this.isAtEnd();){const s=this.peek();if(this.check(T.COLON,T.LBRACE,T.LBRACKET))break;U(s),this.advance()}},this.blockExpression=this.contextStack.withContextDo(Zs.BlockExpression,()=>{const s={body:[]},a=()=>this.nodeFactory.create(Nt,s);try{this.consume("Expect an opening brace '{'",T.LBRACE),s.blockOpenBrace=this.previous()}catch(r){if(!(r instanceof R))throw r;if(s.blockOpenBrace=r.partialNode,!this.canHandle(r))throw new R(r.token,a(),r.handlerContext);this.synchronizeBlock()}for(;!this.isAtEnd()&&!this.check(T.RBRACE);)try{if(this.match(T.TILDE)){const r=this.previous(),o=this.variable(),l=this.nodeFactory.create(yn,{op:r,partial:o});s.body.push(l)}else s.body.push(this.canBeField()?this.fieldDeclaration():this.expression())}catch(r){if(!(r instanceof R))throw r;if(s.body.push(r.partialNode),!this.canHandle(r))throw new R(r.token,a(),r.handlerContext);this.synchronizeBlock()}try{this.consume("Expect a closing brace '}'",T.RBRACE),s.blockCloseBrace=this.previous()}catch(r){if(!(r instanceof R))throw r;if(s.blockCloseBrace=r.partialNode,!this.canHandle(r))throw new R(r.token,a(),r.handlerContext);this.synchronizeBlock()}return a()}),this.synchronizeBlock=()=>{if(!this.check(T.RBRACE))for(U(this.advance());!this.isAtEnd();){const s=this.peek();if(this.check(T.RBRACE)||Lo(this.previous(),s))break;U(s),this.advance()}},this.tupleExpression=this.contextStack.withContextDo(Zs.GroupExpression,()=>{const s={elementList:[],commaList:[]},a=()=>this.nodeFactory.create(Qr,{groupOpenParen:s.tupleOpenParen,groupCloseParen:s.tupleCloseParen,expression:s.elementList[0]}),r=()=>this.nodeFactory.create(At,s);try{this.consume("Expect an opening parenthesis '('",T.LPAREN),s.tupleOpenParen=this.previous()}catch(o){if(!(o instanceof R))throw o;if(s.tupleOpenParen=o.partialNode,!this.canHandle(o))throw new R(o.token,r(),o.handlerContext);this.synchronizeTuple()}if(!this.isAtEnd()&&!this.check(T.RPAREN))try{s.elementList.push(this.normalExpression())}catch(o){if(!(o instanceof R))throw o;if(s.elementList.push(o.partialNode),!this.canHandle(o))throw new R(o.token,a(),o.handlerContext);this.synchronizeTuple()}for(;!this.isAtEnd()&&!this.check(T.RPAREN);)try{this.consume("Expect a comma ','",T.COMMA),s.commaList.push(this.previous()),s.elementList.push(this.normalExpression())}catch(o){if(!(o instanceof R))throw o;if(o.partialNode instanceof oe&&s.elementList.push(o.partialNode),!this.canHandle(o))throw new R(o.token,r(),o.handlerContext);this.synchronizeTuple()}try{this.consume("Expect a closing parenthesis ')'",T.RPAREN),s.tupleCloseParen=this.previous()}catch(o){if(!(o instanceof R))throw o;if(s.tupleCloseParen=o.partialNode,!this.canHandle(o))throw new R(o.token,r(),o.handlerContext);this.synchronizeTuple()}return s.elementList.length===1?a():r()}),this.synchronizeTuple=()=>{for(;!this.isAtEnd();){const s=this.peek();if(this.check(T.RPAREN,T.COMMA))break;U(s),this.advance()}},this.listExpression=this.contextStack.withContextDo(Zs.ListExpression,()=>{const s={elementList:[],commaList:[]},a=()=>this.nodeFactory.create(re,s);try{this.consume("Expect an opening bracket '['",T.LBRACKET),s.listOpenBracket=this.previous()}catch(r){if(!(r instanceof R))throw r;if(s.listOpenBracket=r.partialNode,!this.canHandle(r))throw new R(r.token,a(),r.handlerContext);this.synchronizeList()}if(!this.isAtEnd()&&!this.check(T.RBRACKET))try{s.elementList.push(this.attribute())}catch(r){if(!(r instanceof R))throw r;if(s.elementList.push(r.partialNode),!this.canHandle(r))throw new R(r.token,a(),r.handlerContext);this.synchronizeList()}for(;!this.isAtEnd()&&!this.check(T.RBRACKET);)try{this.consume("Expect a comma ','",T.COMMA),s.commaList.push(this.previous()),s.elementList.push(this.attribute())}catch(r){if(!(r instanceof R))throw r;if(r.partialNode instanceof oe&&s.elementList.push(r.partialNode),!this.canHandle(r))throw new R(r.token,a(),r.handlerContext);this.synchronizeList()}try{this.consume("Expect a closing bracket ']'",T.RBRACKET),s.listCloseBracket=this.previous()}catch(r){if(!(r instanceof R))throw r;if(s.listCloseBracket=r.partialNode,!this.canHandle(r))throw new R(r.token,a(),r.handlerContext);this.synchronizeList()}return a()}),this.synchronizeList=()=>{for(;!this.isAtEnd();){const s=this.peek();if(this.check(T.COMMA,T.RBRACKET))break;U(s),this.advance()}},this.synchronizeAttributeName=()=>{for(;!this.isAtEnd();){const s=this.peek();if(this.check(T.COMMA,T.RBRACKET,T.COLON))break;U(s),this.advance()}},this.synchronizeAttributeValue=()=>{for(;!this.isAtEnd();){const s=this.peek();if(this.check(T.COMMA,T.RBRACKET))break;U(s),this.advance()}},this.tokens=t,this.nodeFactory=new Jv(n)}isAtEnd(){return this.current>=this.tokens.length||this.tokens[this.current].kind===T.EOF}advance(){return this.isAtEnd()?ie(this.tokens):this.tokens[this.current++]}peek(t=0){return t+this.current>=this.tokens.length?ie(this.tokens):this.tokens[this.current+t]}match(...t){const n=this.check(...t);return n&&this.advance(),n}check(...t){const n=this.peek();return t.includes(n.kind)}previous(){return this.tokens[this.current-1]}canHandle(t){return t.handlerContext===void 0||t.handlerContext===this.contextStack.top()}consume(t,...n){if(!this.match(...n))throw this.logError(this.peek(),v.UNEXPECTED_TOKEN,t),new R(this.peek(),void 0,this.contextStack.findHandlerContext(this.tokens,this.current))}discardUntil(t,...n){if(this.isAtEnd()||!this.check(...n)){for(U(this.peek()),this.logError(this.advance(),v.UNEXPECTED_TOKEN,t);!this.isAtEnd()&&!this.check(...n);)U(this.advance());return!this.isAtEnd()}return!0}gatherInvalid(){const t=[],n=[];let s,a=0;for(;a<this.tokens.length&&this.tokens[a].isInvalid;a+=1)n.push(this.tokens[a]);for(s=this.tokens[a],s.leadingInvalid=n,t.push(s),a+=1;a<this.tokens.length;a+=1){const r=this.tokens[a];r.isInvalid?s.trailingInvalid.push(r):(s=r,t.push(s))}this.tokens=t}parse(){const t=this.program(),n=this.advance(),s=this.nodeFactory.create(it,{body:t,eof:n});return this.gatherInvalid(),new et({ast:s,tokens:this.tokens},this.errors)}program(){const t=[];for(;!this.isAtEnd();)try{const n=this.elementDeclaration();t.push(n)}catch(n){if(!(n instanceof R))throw n;t.push(n.partialNode),this.synchronizeProgram()}return t}elementDeclaration(){const t={},n=()=>this.nodeFactory.create(Z,t);try{this.consume("Expect an identifier",T.IDENTIFIER),t.type=this.previous()}catch(s){throw s instanceof R?(t.type=s.partialNode,new R(s.token,n(),s.handlerContext)):s}if(!this.check(T.COLON,T.LBRACE,T.LBRACKET))try{t.name=this.normalExpression()}catch(s){if(!(s instanceof R))throw s;if(t.name=s.partialNode,!this.canHandle(s))throw new R(s.token,n(),s.handlerContext);this.synchronizeElementDeclarationName()}if(Lr(this.peek()))if(t.as=this.advance(),this.check(T.COLON,T.LBRACE,T.LBRACKET))this.logError(this.peek(),v.UNEXPECTED_TOKEN,"Expect an alias");else try{t.alias=this.normalExpression()}catch(s){if(!(s instanceof R))throw s;if(t.alias=s.partialNode,!this.canHandle(s))throw new R(s.token,n(),s.handlerContext);this.synchronizeElementDeclarationAlias()}try{t.attributeList=this.check(T.LBRACKET)?this.listExpression():void 0}catch(s){throw s instanceof R?(t.attributeList=s.partialNode,new R(s.token,n(),s.handlerContext)):s}if(!this.discardUntil("Expect an opening brace '{' or a colon ':'",T.LBRACE,T.COLON))return n();try{if(this.match(T.COLON)){t.bodyColon=this.previous();const s=this.expression();s instanceof Z?(U(s),this.logError(s,v.UNEXPECTED_ELEMENT_DECLARATION,"An element's simple body must not be an element declaration")):t.body=s}else t.body=this.blockExpression()}catch(s){throw s instanceof R?(t.body=s.partialNode,new R(s.token,n(),s.handlerContext)):s}return this.nodeFactory.create(Z,t)}fieldDeclaration(){const t={},n=()=>this.nodeFactory.create(Z,t);try{this.consume("Expect an identifier",T.IDENTIFIER),t.type=this.previous()}catch(s){throw s instanceof R?(t.type=s.partialNode,new R(s.token,n(),s.handlerContext)):s}try{this.consume("Expect a colon ':'",T.COLON),t.bodyColon=this.previous()}catch(s){throw s instanceof R?(t.bodyColon=s.partialNode,new R(s.token,n(),s.handlerContext)):s}try{const s=this.expression();s instanceof Z?this.errors.push(new E(v.INVALID_ELEMENT_IN_SIMPLE_BODY,"Simple body cannot be an element declaration",s)):t.body=s}catch(s){throw s instanceof R?(t.body=s.partialNode,new R(s.token,n(),s.handlerContext)):s}return this.nodeFactory.create(Z,t)}expression(){const t={args:[]},n=()=>Xv(t.callee,t.args,this.nodeFactory).unwrap_or(this.nodeFactory.create(Y,t));try{t.callee=this.normalExpression()}catch(a){throw a instanceof R?(t.callee=a.partialNode,new R(a.token,n(),a.handlerContext)):a}if(this.shouldStopExpression())return n();let s=t.callee;for(;!this.shouldStopExpression();){Cr(this.previous())||this.logError(s,v.MISSING_SPACES,"Expect a following space");try{s=this.normalExpression(),t.args.push(s)}catch(a){throw a instanceof R?(s=a.partialNode,t.args.push(s),new R(a.token,n(),a.handlerContext)):a}}return n()}shouldStopExpression(){if(this.isAtEnd()||uc(this.previous()))return!0;const t=this.peek().kind;return t===T.RBRACE||t===T.RBRACKET||t===T.RPAREN||t===T.COMMA||t===T.COLON}normalExpression(){return this.expression_bp(0)}expression_bp(t){let n=this.leftExpression_bp();for(;!this.isAtEnd();){const s=this.peek();if(s.kind===T.LPAREN){const{left:a}=So(s);if(a<t||Lo(this.previous(),s)&&!this.contextStack.isWithinGroupExpressionContext()&&!this.contextStack.isWithinListExpressionContext())break;try{n=this.nodeFactory.create(ct,{callee:n,argumentList:this.tupleExpression()})}catch(r){throw r instanceof R?(n=this.nodeFactory.create(ct,{callee:n,argumentList:r.partialNode}),new R(r.token,n,r.handlerContext)):r}}else if(s.kind===T.LBRACKET){if(Cr(this.previous()))break;try{n=this.nodeFactory.create(_n,{expression:n,indexer:this.listExpression()})}catch(a){throw a instanceof R?(n=this.nodeFactory.create(_n,{expression:n,indexer:a.partialNode}),new R(a.token,n,a.handlerContext)):a}}else if(jo(s)){const a=s,r=So(a);if(r.left!==null){if(r.left<=t)break;this.advance(),n=this.nodeFactory.create(ka,{expression:n,op:a})}else{const o=tN(a);if(o.left===null||o.left<=t)break;this.advance();try{n=this.nodeFactory.create(kt,{leftExpression:n,op:a,rightExpression:a.value==="."?this.extractOperand():this.expression_bp(o.right)})}catch(l){throw l instanceof R?(n=this.nodeFactory.create(kt,{leftExpression:n,op:a,rightExpression:l.partialNode}),new R(l.token,n,l.handlerContext)):l}}}else break}return n}leftExpression_bp(){let t;if(jo(this.peek())){const n={};n.op=this.peek();const s=sN(n.op);if(s.right===null)throw this.logError(n.op,v.UNKNOWN_PREFIX_OP,`Unexpected '${n.op.value}' in an expression`),new R(n.op,this.nodeFactory.create(Hs,{pre:n.op}),this.contextStack.findHandlerContext(this.tokens,this.current));this.advance();try{n.expression=this.expression_bp(s.right)}catch(a){throw a instanceof R?(n.expression=a.partialNode,new R(a.token,this.nodeFactory.create(ot,n),a.handlerContext)):a}t=this.nodeFactory.create(ot,n)}else if(t=this.extractOperand(),t instanceof Hs)throw new R(this.peek(),this.nodeFactory.create(Hs,{pre:this.peek()}),this.contextStack.findHandlerContext(this.tokens,this.current));return t}extractOperand(){return this.check(T.NUMERIC_LITERAL,T.STRING_LITERAL,T.COLOR_LITERAL,T.QUOTED_STRING,T.IDENTIFIER)?this.primaryExpression():this.check(T.FUNCTION_EXPRESSION)?this.functionExpression():this.check(T.LBRACKET)?this.listExpression():this.check(T.LBRACE)?this.blockExpression():this.check(T.LPAREN)?this.tupleExpression():(this.peek().kind===T.EOF?this.logError(this.peek(),v.UNEXPECTED_EOF,"Unexpected EOF"):this.logError(this.peek(),v.INVALID_OPERAND,`Invalid start of operand "${this.peek().value}"`),this.nodeFactory.create(Hs,{pre:this.previous()}))}functionExpression(){const t={};try{this.consume("Expect a function expression",T.FUNCTION_EXPRESSION),t.value=this.previous()}catch(n){throw n instanceof R?(t.value=n.partialNode,new R(n.token,this.nodeFactory.create(lt,t),n.handlerContext)):n}return this.nodeFactory.create(lt,t)}variable(){this.consume("Expect a variable",T.IDENTIFIER);const t=this.previous();return this.nodeFactory.create(gt,{variable:t})}canBeField(){return this.peek().kind===T.IDENTIFIER&&this.peek(1).kind===T.COLON}primaryExpression(){if(this.match(T.COLOR_LITERAL,T.STRING_LITERAL,T.NUMERIC_LITERAL))return this.nodeFactory.create(Ue,{expression:this.nodeFactory.create(rs,{literal:this.previous()})});if(this.match(T.QUOTED_STRING,T.IDENTIFIER))return this.nodeFactory.create(Ue,{expression:this.nodeFactory.create(gt,{variable:this.previous()})});throw this.logError(this.peek(),v.UNEXPECTED_TOKEN,"Expect a variable or literal"),new R(this.peek(),void 0,this.contextStack.findHandlerContext(this.tokens,this.current))}attribute(){const t={};if(this.check(T.COLON,T.RBRACKET,T.COMMA)){const n=this.peek();this.logError(n,v.EMPTY_ATTRIBUTE_NAME,"Expect a non-empty attribute name"),t.name=this.nodeFactory.create(ht,{identifiers:[]})}else try{t.name=this.attributeName()}catch(n){if(!(n instanceof R))throw n;if(t.name=n.partialNode,!this.canHandle(n))throw new R(n.token,this.nodeFactory.create(ft,t),n.handlerContext);this.synchronizeAttributeName()}return this.match(T.COLON)&&(t.colon=this.previous(),t.value=this.attributeValue()),this.nodeFactory.create(ft,t)}attributeValue(){let t;try{t=this.peek().kind===T.IDENTIFIER&&this.peek(1).kind===T.IDENTIFIER?this.attributeName():this.normalExpression()}catch(n){if(!(n instanceof R)||!this.canHandle(n))throw n;t=n.partialNode,this.synchronizeAttributeValue()}return t}attributeName(){const t=[];if(this.peek().kind!==T.IDENTIFIER)return this.primaryExpression();for(;!this.isAtEnd()&&!this.check(T.COLON,T.COMMA,T.RBRACKET);)try{this.consume("Expect an identifier",T.IDENTIFIER),t.push(this.previous())}catch(n){throw n instanceof R?new R(n.token,this.nodeFactory.create(ht,{identifiers:t}),n.handlerContext):n}return this.nodeFactory.create(ht,{identifiers:t})}logError(t,n,s){this.errors.push(new E(n,s,t))}}const eN={"+":{left:9,right:10},"*":{left:11,right:12},"-":{left:9,right:10},"/":{left:11,right:12},"%":{left:11,right:12},"<":{left:7,right:8},"<=":{left:7,right:8},">":{left:7,right:8},">=":{left:7,right:8},"<>":{left:7,right:8},"=":{left:2,right:3},"==":{left:4,right:5},"!=":{left:4,right:5},".":{left:16,right:17}};function tN(e){return eN[e.value]||{left:null,right:null}}const nN={"+":{left:null,right:15},"-":{left:null,right:15},"<":{left:null,right:15},">":{left:null,right:15},"<>":{left:null,right:15},"!":{left:null,right:15}};function sN(e){return nN[e.value]||{left:null,right:null}}const aN={"(":{left:14,right:null}};function So(e){return aN[e.value]||{left:null,right:null}}var F=(e=>(e.Table="table",e.Enum="enum",e.Ref="ref",e.Note="note",e.Project="project",e.Indexes="indexes",e.TableGroup="tablegroup",e.TablePartial="tablepartial",e.Check="checks",e))(F||{}),A=(e=>(e.Color="color",e.HeaderColor="headercolor",e.Note="note",e.PK="pk",e.PrimaryKey="primary key",e.Unique="unique",e.Ref="ref",e.NotNull="not null",e.Null="null",e.Increment="increment",e.Default="default",e.Name="name",e.Type="type",e.Check="check",e.Update="update",e.Delete="delete",e))(A||{});function nn(e){var t;const n=(t=e?.type)==null?void 0:t.value.toLowerCase();switch(n){case F.Enum:case F.Table:case F.Indexes:case F.Note:case F.Project:case F.Ref:case F.TableGroup:case F.TablePartial:case F.Check:return new me(n);default:return new te}}function Vt(e){if(!e)return new te;if(!Da(e))return new me([e]);const t=Vt(e.leftExpression).unwrap_or(void 0);return t?(t.push(e.rightExpression),new me(t)):new te}function $e(e){if(e===void 0)return new te;const t=Vt(e).unwrap_or(void 0);if(!t)return new te;const n=[];for(const s of t){const a=Fe(s).unwrap_or(void 0);if(!a)return new te;n.push(a)}return new me(n)}function Cs(e){if(e===void 0)return new te;const t=Vt(e).unwrap_or(void 0);if(!t||t.length===0)return new te;const n=[];let s;if(!Ie(ie(t))){const a=t.pop();if(Tc(a))s=a.elementList.map(r=>Ae(r).unwrap());else return new te}for(const a of t){const r=Fe(a).unwrap_or(void 0);if(!r)return new te;n.push(r)}return new me({variables:n,tupleElements:s})}function Fe(e){return Ie(e)?new me(e.expression.variable.value):new te}function ua(e){if(Do(e))return e instanceof lt?new me({functional:[e],nonFunctional:[]}):new me({functional:[],nonFunctional:[e]});if(e instanceof At&&e.elementList.every(Do)){const t=e.elementList.filter(s=>s instanceof lt),n=e.elementList.filter(Ie);return new me({functional:t,nonFunctional:n})}return new te}function Ae(e){var t;const n=(t=e?.expression.variable)==null?void 0:t.value;return n===void 0?new te:new me(n)}function rN(e){var t,n;const s=(n=(t=e?.partial)==null?void 0:t.variable)==null?void 0:n.value;return s===void 0?new te:new me(s)}function ye(e){return De(e)?e.expression instanceof gt?new me(e.expression.variable.value):new me(e.expression.literal.value):new te}function iN(e){var t;return!(e instanceof kt)||!Ec((t=e.op)==null?void 0:t.value)?!1:Cs(e.leftExpression).and_then(()=>Cs(e.rightExpression)).unwrap_or(void 0)!==void 0}function oN(e){const t=Cs(e.leftExpression),n=Cs(e.rightExpression);if(!t.isOk()||!n.isOk())return!1;const{tupleElements:s}=t.unwrap(),{tupleElements:a}=n.unwrap();return s?.length===a?.length}function Do(e){return e instanceof Ue&&e.expression instanceof gt||e instanceof lt}function Ro(e,t){var n,s,a,r;let o=t;const l=Sv(e);for(;o;){if((s=(n=o.symbol)==null?void 0:n.symbolTable)!=null&&s.has(e))return(a=o.symbol.symbolTable)==null?void 0:a.get(e);if(((r=o.symbol)==null?void 0:r.declaration)instanceof it&&l)return o.symbol;if(o instanceof it)return;o=o.parent}}class lN{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof it||nn(this.declarationNode.parent).unwrap_or(void 0)!==F.Project?[new E(v.INVALID_CUSTOM_CONTEXT,"A Custom element can only appear in a Project",this.declarationNode)]:[]}validateName(t){return t?[new E(v.UNEXPECTED_NAME,"A Custom element shouldn't have a name",t)]:[]}validateAlias(t){return t?[new E(v.UNEXPECTED_NAME,"A Custom element shouldn't have an alias",t)]:[]}validateSettingList(t){return t?[new E(v.UNEXPECTED_SETTINGS,"A Custom element shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof Nt)return[new E(v.UNEXPECTED_COMPLEX_BODY,"A Custom element can only have an inline field",t)];const n=[];return De(t.callee)||n.push(new E(v.INVALID_CUSTOM_ELEMENT_VALUE,"A Custom element value can only be a string",t)),t.args.length>0&&n.push(...t.args.map(s=>new E(v.INVALID_CUSTOM_ELEMENT_VALUE,"A Custom element value can only be a string",s))),n}}class is{constructor(){this.table=new Map}has(t){return this.table.has(t)}set(t,n){this.table.set(t,n)}get(t,n){return this.table.get(t)||n!==void 0&&this.set(t,n)||n}entries(){return this.table.entries()}forEach(t){return this.table.forEach(t)}}class cN{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.registerElement(),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof Z?[new E(v.INVALID_PROJECT_CONTEXT,"An Enum can only appear top-level",this.declarationNode)]:[]}validateName(t){return t?Nc(t)?[]:[new E(v.INVALID_NAME,"An Enum name must be of the form <enum> or <schema>.<enum>",t)]:[new E(v.NAME_NOT_FOUND,"An Enum must have a name",this.declarationNode)]}validateAlias(t){return t?[new E(v.UNEXPECTED_ALIAS,"An Enum shouldn't have an alias",t)]:[]}registerElement(){const t=[];this.declarationNode.symbol=this.symbolFactory.create(Ov,{declaration:this.declarationNode,symbolTable:new is});const{name:n}=this.declarationNode,s=$e(n);if(s.isOk()){const a=s.unwrap(),r=a.pop(),o=Ra(a,this.publicSymbolTable,this.symbolFactory),l=Zr(r);o.has(l)&&t.push(new E(v.DUPLICATE_NAME,`Enum name ${r} already exists in schema '${a.join(".")||"public"}'`,n)),o.set(l,this.declarationNode.symbol)}return t}validateSettingList(t){return t?[new E(v.UNEXPECTED_SETTINGS,"An Enum shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof Y)return this.validateFields([t]);const[n,s]=dt(t.body,a=>a instanceof Y);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){return t.length===0?[new E(v.EMPTY_ENUM,"An Enum must have at least one element",this.declarationNode)]:t.flatMap(n=>{const s=[];n.callee&&!Ie(n.callee)&&s.push(new E(v.INVALID_ENUM_ELEMENT_NAME,"An enum field must be an identifier or a quoted identifier",n.callee));const a=[...n.args];return ie(a)instanceof re?(s.push(...this.validateFieldSettings(ie(a))),a.pop()):a[0]instanceof re&&(s.push(...this.validateFieldSettings(a[0])),a.shift()),a.length>0&&s.push(...a.map(r=>new E(v.INVALID_ENUM_ELEMENT,"An Enum must have only a field and optionally a setting list",r))),s.push(...this.registerField(n)),s})}validateFieldSettings(t){const n=pe(t),s=n.getErrors(),a=n.getValue();for(const r in a){const o=a[r];r==="note"?(o.length>1&&o.forEach(l=>s.push(new E(v.DUPLICATE_ENUM_ELEMENT_SETTING,"'note' can only appear once",l))),o.forEach(l=>{De(l.value)||s.push(new E(v.INVALID_ENUM_ELEMENT_SETTING,"'note' must be a string",l))})):o.forEach(l=>s.push(new E(v.UNKNOWN_ENUM_ELEMENT_SETTING,`Unknown enum field setting '${r}'`,l)))}return s}validateSubElements(t){return t.flatMap(n=>{if(n.parent=this.declarationNode,!n.type)return[];const s=St(n);return new s(n,this.publicSymbolTable,this.symbolFactory).validate()})}registerField(t){if(t.callee&&Ie(t.callee)){const n=Ae(t.callee).unwrap(),s=ei(n),a=this.symbolFactory.create(Pv,{declaration:t});t.symbol=a;const r=this.declarationNode.symbol.symbolTable;if(r.has(s)){const o=r.get(s);return[new E(v.DUPLICATE_COLUMN_NAME,`Duplicate enum field ${n}`,t),new E(v.DUPLICATE_COLUMN_NAME,`Duplicate enum field ${n}`,o.declaration)]}r.set(s,a)}return[]}}class dN{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.validateBody(this.declarationNode.body)]}validateContext(){const t=new E(v.INVALID_INDEXES_CONTEXT,"An Indexes can only appear inside a Table or a TablePartial",this.declarationNode);if(this.declarationNode.parent instanceof it)return[t];const n=nn(this.declarationNode.parent).unwrap_or(void 0);return n&&[F.Table,F.TablePartial].includes(n)?[]:[t]}validateName(t){return t?[new E(v.UNEXPECTED_NAME,"An Indexes shouldn't have a name",t)]:[]}validateAlias(t){return t?[new E(v.UNEXPECTED_ALIAS,"An Indexes shouldn't have an alias",t)]:[]}validateSettingList(t){return t?[new E(v.UNEXPECTED_SETTINGS,"An Indexes shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof Y)return[new E(v.UNEXPECTED_SIMPLE_BODY,"An Indexes must have a complex body",t)];const[n,s]=dt(t.body,a=>a instanceof Y);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){return t.flatMap(n=>{if(!n.callee)return[];const s=[],a=[n.callee,...n.args];return ie(a)instanceof re&&s.push(...this.validateFieldSetting(a.pop())),a.forEach(r=>{for(;r instanceof ct;)r.argumentList&&!ua(r.argumentList).isOk()&&s.push(new E(v.INVALID_INDEXES_FIELD,"An index field must be an identifier, a quoted identifier, a functional expression or a tuple of such",r.argumentList)),r=r.callee;ua(r).isOk()||s.push(new E(v.INVALID_INDEXES_FIELD,"An index field must be an identifier, a quoted identifier, a functional expression or a tuple of such",r))}),s})}validateFieldSetting(t){const n=pe(t),s=n.getErrors(),a=n.getValue();for(const r in a){const o=a[r];switch(r){case"note":case"name":o.length>1&&o.forEach(l=>s.push(new E(v.DUPLICATE_INDEX_SETTING,`'${r}' can only appear once`,l))),o.forEach(l=>{De(l.value)||s.push(new E(v.INVALID_INDEX_SETTING_VALUE,`'${r}' must be a string`,l))});break;case"unique":case"pk":o.length>1&&o.forEach(l=>s.push(new E(v.DUPLICATE_INDEX_SETTING,`'${r}' can only appear once`,l))),o.forEach(l=>{Qe(l.value)||s.push(new E(v.INVALID_INDEX_SETTING_VALUE,`'${r}' must not have a value`,l))});break;case"type":o.length>1&&o.forEach(l=>s.push(new E(v.DUPLICATE_INDEX_SETTING,"'type' can only appear once",l))),o.forEach(l=>{Ie(l.value)||s.push(new E(v.INVALID_INDEX_SETTING_VALUE,`'type' must be "btree" or "hash"`,l))});break;default:o.forEach(l=>s.push(new E(v.UNKNOWN_INDEX_SETTING,`Unknown index setting '${r}'`,l)))}}return s}validateSubElements(t){return t.flatMap(n=>{if(n.parent=this.declarationNode,!n.type)return[];const s=St(n);return new s(n,this.publicSymbolTable,this.symbolFactory).validate()})}}class uN{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.validateBody(this.declarationNode.body)]}validateContext(){return!(this.declarationNode.parent instanceof it)&&![F.Table,F.TableGroup,F.TablePartial,F.Project].includes(nn(this.declarationNode.parent).unwrap_or(void 0))?[new E(v.INVALID_NOTE_CONTEXT,"A Note can only appear inside a Table, a TableGroup, a TablePartial or a Project. Sticky note can only appear at the global scope.",this.declarationNode)]:[]}validateName(t){if(!(this.declarationNode.parent instanceof it))return t?[new E(v.UNEXPECTED_NAME,"A Note shouldn't have a name",t)]:[];if(!t)return[new E(v.INVALID_NAME,"Sticky note must have a name",this.declarationNode)];const n=$e(t);if(!n.isOk())return[new E(v.INVALID_NAME,"Invalid name for sticky note ",this.declarationNode)];const s=n.unwrap().join("."),a=Av(s);return this.publicSymbolTable.has(a)?[new E(v.DUPLICATE_NAME,`Sticky note "${s}" has already been defined`,t)]:(this.publicSymbolTable.set(a,this.declarationNode.symbol),[])}validateAlias(t){return t?[new E(v.UNEXPECTED_ALIAS,"A Ref shouldn't have an alias",t)]:[]}validateSettingList(t){return t?[new E(v.UNEXPECTED_SETTINGS,"A Note shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof Y)return this.validateFields([t]);const[n,s]=dt(t.body,a=>a instanceof Y);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){const n=[];return t.length===0?[new E(v.EMPTY_NOTE,"A Note must have a content",this.declarationNode)]:(t.length>1&&t.slice(1).forEach(s=>n.push(new E(v.NOTE_CONTENT_REDEFINED,"A Note can only contain one string",s))),De(t[0].callee)||n.push(new E(v.INVALID_NOTE,"A Note content must be a quoted string",t[0])),t[0].args.length>0&&n.push(...t[0].args.map(s=>new E(v.INVALID_NOTE,"A Note can only contain one quoted string",s))),n)}validateSubElements(t){return t.flatMap(n=>{if(n.parent=this.declarationNode,!n.type)return[];const s=St(n);return new s(n,this.publicSymbolTable,this.symbolFactory).validate()})}}class hN{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof Z?[new E(v.INVALID_PROJECT_CONTEXT,"A Project can only appear top-level",this.declarationNode)]:[]}validateName(t){return t?os(t)?[]:[new E(v.INVALID_NAME,"A Project's name is optional or must be an identifier or a quoted identifer",t)]:[]}validateAlias(t){return t?[new E(v.UNEXPECTED_ALIAS,"A Project shouldn't have an alias",t)]:[]}validateSettingList(t){return t?[new E(v.UNEXPECTED_SETTINGS,"A Project shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof Y)return[new E(v.UNEXPECTED_SIMPLE_BODY,"A Project's body must be a block",t)];const[n,s]=dt(t.body,a=>a instanceof Y);return[...n.map(a=>new E(v.INVALID_PROJECT_FIELD,"A Project can not have inline fields",a)),...this.validateSubElements(s)]}validateSubElements(t){return t.flatMap(n=>{if(n.parent=this.declarationNode,!n.type)return[];const s=St(n);return new s(n,this.publicSymbolTable,this.symbolFactory).validate()})}}class fN{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof it?[]:[new E(v.INVALID_REF_CONTEXT,"A Ref must appear top-level",this.declarationNode)]}validateName(t){return t?os(t)?[]:[new E(v.INVALID_NAME,"A Ref's name is optional or must be an identifier or a quoted identifer",t)]:[]}validateAlias(t){return t?[new E(v.UNEXPECTED_ALIAS,"A Ref shouldn't have an alias",t)]:[]}validateSettingList(t){return t?[new E(v.UNEXPECTED_SETTINGS,"A Ref shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof Y)return this.validateFields([t]);const[n,s]=dt(t.body,a=>a instanceof Y);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){if(t.length===0)return[new E(v.EMPTY_REF,"A Ref must have at least one field",this.declarationNode)];const n=[];return t.length>1&&n.push(...t.slice(1).map(s=>new E(v.REF_REDEFINED,"A Ref can only contain one binary relationship",s))),t.forEach(s=>{s.callee&&!iN(s.callee)&&n.push(new E(v.INVALID_REF_FIELD,"A Ref field must be a binary relationship",s.callee)),s.callee&&!oN(s.callee)&&n.push(new E(v.UNEQUAL_FIELDS_BINARY_REF,"Unequal fields in ref endpoints",s.callee));const a=[...s.args];if(ie(a)instanceof re){const r=this.validateFieldSettings(ie(a));n.push(...r),a.pop()}else a[0]instanceof re&&(n.push(...this.validateFieldSettings(a[0])),a.shift());a.length>0&&n.push(...a.map(r=>new E(v.INVALID_REF_FIELD,"A Ref field should only have a single binary relationship",r)))}),n}validateFieldSettings(t){const n=pe(t),s=n.getErrors(),a=n.getValue();for(const r in a){const o=a[r];switch(r){case"delete":case"update":o.length>1&&o.forEach(l=>s.push(new E(v.DUPLICATE_REF_SETTING,`'${r}' can only appear once`,l))),o.forEach(l=>{pN(l.value)||s.push(new E(v.INVALID_REF_SETTING_VALUE,`'${r}' can only have values "cascade", "no action", "set null", "set default" or "restrict"`,l))});break;case"color":o.length>1&&s.push(...o.map(l=>new E(v.DUPLICATE_REF_SETTING,"'color' can only appear once",l))),o.forEach(l=>{Ma(l.value)||s.push(new E(v.INVALID_REF_SETTING_VALUE,"'color' must be a color literal",l))});break;default:o.forEach(l=>s.push(new E(v.UNKNOWN_REF_SETTING,`Unknown ref setting '${r}'`,l)))}}return s}validateSubElements(t){return t.flatMap(n=>{if(n.parent=this.declarationNode,!n.type)return[];const s=St(n);return new s(n,this.publicSymbolTable,this.symbolFactory).validate()})}}function pN(e){if(!(Ie(e)&&e.expression.variable.kind!==T.QUOTED_STRING)&&!(e instanceof ht))return!1;let t;if(e instanceof ht?t=Bn(e).unwrap_or(""):t=e.expression.variable.value,t)switch(t.toLowerCase()){case"cascade":case"no action":case"set null":case"set default":case"restrict":return!0;default:return!1}return!1}class mN{constructor(t,n,s){this.declarationNode=t,this.symbolFactory=s,this.publicSymbolTable=n}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.registerElement(),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof Z?[new E(v.INVALID_TABLE_CONTEXT,"Table must appear top-level",this.declarationNode)]:[]}validateName(t){return t?t instanceof _n?[new E(v.INVALID_NAME,"Invalid array as Table name, maybe you forget to add a space between the name and the setting list?",t)]:Nc(t)?[]:[new E(v.INVALID_NAME,"A Table name must be of the form <table> or <schema>.<table>",t)]:[new E(v.NAME_NOT_FOUND,"A Table must have a name",this.declarationNode)]}validateAlias(t){return t?EN(t)?[]:[new E(v.INVALID_ALIAS,"Table aliases can only contains alphanumeric and underscore unless surrounded by double quotes",t)]:[]}validateSettingList(t){const n=pe(t),s=n.getErrors(),a=n.getValue();return Is(a,(r,o)=>{switch(o){case A.HeaderColor:r.length>1&&s.push(...r.map(l=>new E(v.DUPLICATE_TABLE_SETTING,"'headercolor' can only appear once",l))),r.forEach(l=>{Ma(l.value)||s.push(new E(v.INVALID_TABLE_SETTING_VALUE,"'headercolor' must be a color literal",l.value||l.name))});break;case A.Note:r.length>1&&s.push(...r.map(l=>new E(v.DUPLICATE_TABLE_SETTING,"'note' can only appear once",l))),r.forEach(l=>{De(l.value)||s.push(new E(v.INVALID_TABLE_SETTING_VALUE,"'note' must be a string literal",l.value||l.name))});break;default:s.push(...r.map(l=>new E(v.UNKNOWN_TABLE_SETTING,`Unknown '${o}' setting`,l)))}}),s}registerElement(){const t=[];this.declarationNode.symbol=this.symbolFactory.create(xc,{declaration:this.declarationNode,symbolTable:new is});const{name:n,alias:s}=this.declarationNode,a=$e(n);if(a.isOk()){const r=[...a.unwrap()],o=r.pop(),l=Ra(r,this.publicSymbolTable,this.symbolFactory),d=ca(o);l.has(d)&&t.push(new E(v.DUPLICATE_NAME,`Table name '${o}' already exists in schema '${r.join(".")||"public"}'`,n)),l.set(d,this.declarationNode.symbol)}if(s&&os(s)&&!bN(s.expression.variable.value,a.unwrap_or([]))){const r=Ae(s).unwrap(),o=ca(r);this.publicSymbolTable.has(o)&&t.push(new E(v.DUPLICATE_NAME,`Table name '${r}' already exists`,n)),this.publicSymbolTable.set(o,this.declarationNode.symbol)}return t}validateBody(t){if(!t)return[];if(t instanceof Y)return[new E(v.UNEXPECTED_SIMPLE_BODY,"A Table's body must be a block",t)];const[n,s,a]=t.body.reduce((r,o)=>(o instanceof Y?r[0].push(o):o instanceof yn?r[1].push(o):o instanceof Z&&r[2].push(o),r),[[],[],[]]);return[...this.validateFields(n),...this.validateInjections(s),...this.validateSubElements(a)]}validateInjections(t){return t.flatMap(n=>this.registerInjection(n))}registerInjection(t){var n,s,a;if(!((s=(n=t.partial)==null?void 0:n.variable)!=null&&s.value))return[];const r=(a=t.partial.variable)==null?void 0:a.value,o=mc(r),l=this.symbolFactory.create($v,{declaration:t});t.symbol=l;const d=this.declarationNode.symbol.symbolTable,u=d.get(o);return u?[new E(v.DUPLICATE_TABLE_PARTIAL_INJECTION_NAME,`Duplicate injection ${r}`,t),new E(v.DUPLICATE_TABLE_PARTIAL_INJECTION_NAME,`Duplicate injection ${r}`,u.declaration)]:(d.set(o,l),[])}validateFields(t){return t.flatMap(n=>{if(!n.callee)return[];const s=[];n.args.length===0&&s.push(new E(v.INVALID_COLUMN,"A column must have a type",n.callee)),Ie(n.callee)||s.push(new E(v.INVALID_COLUMN_NAME,"A column name must be an identifier or a quoted identifier",n.callee)),n.args[0]&&!wc(n.args[0])&&s.push(new E(v.INVALID_COLUMN_TYPE,"Invalid column type",n.args[0]));const a=n.args.slice(1);return s.push(...this.validateFieldSetting(a)),s.push(...this.registerField(n)),s})}registerField(t){if(t.callee&&Ie(t.callee)){const n=Ae(t.callee).unwrap(),s=Aa(n),a=this.symbolFactory.create(ai,{declaration:t});t.symbol=a;const r=this.declarationNode.symbol.symbolTable;if(r.has(s)){const o=r.get(s);return[new E(v.DUPLICATE_COLUMN_NAME,`Duplicate column ${n}`,t),new E(v.DUPLICATE_COLUMN_NAME,`Duplicate column ${n}`,o.declaration)]}r.set(s,a)}return[]}validateFieldSetting(t){if(!t.slice(0,-1).every(tn)||!t.slice(-1).every(d=>tn(d)||d instanceof re))return[...t.map(d=>new E(v.INVALID_COLUMN,"These fields must be some inline settings optionally ended with a setting list",d))];if(t.length===0)return[];let n;ie(t)instanceof re&&(n=t.pop());const s=pe(n),a=s.getErrors(),r=s.getValue();t.forEach(d=>{const u=Ae(d).unwrap_or("").toLowerCase();if(u!=="pk"&&u!=="unique"){a.push(new E(v.INVALID_SETTINGS,"Inline column settings can only be `pk` or `unique`",d));return}r[u]===void 0?r[u]=[d]:r[u].push(d)});const o=r[A.PK]||[],l=r[A.PrimaryKey]||[];return o.length>=1&&l.length>=1&&a.push(...[...o,...l].map(d=>new E(v.DUPLICATE_COLUMN_SETTING,"Either one of 'primary key' and 'pk' can appear",d))),Is(r,(d,u)=>{switch(u){case A.Note:d.length>1&&a.push(...d.map(c=>new E(v.DUPLICATE_COLUMN_SETTING,"note can only appear once",c))),d.forEach(c=>{De(c.value)||a.push(new E(v.INVALID_COLUMN_SETTING_VALUE,"'note' must be a quoted string",c.value||c.name))});break;case A.Ref:d.forEach(c=>{_c(c.value)||a.push(new E(v.INVALID_COLUMN_SETTING_VALUE,"'ref' must be a valid unary relationship",c.value||c.name))});break;case A.PrimaryKey:d.length>1&&a.push(...d.map(c=>new E(v.DUPLICATE_COLUMN_SETTING,"primary key can only appear once",c))),d.forEach(c=>{Qe(c.value)||a.push(new E(v.INVALID_COLUMN_SETTING_VALUE,"'primary key' must not have a value",c.value||c.name))});break;case A.PK:d.length>1&&a.push(...d.map(c=>new E(v.DUPLICATE_COLUMN_SETTING,"'pk' can only appear once",c))),d.forEach(c=>{c instanceof ft&&!Qe(c.value)&&a.push(new E(v.INVALID_COLUMN_SETTING_VALUE,"'pk' must not have a value",c.value||c.name))});break;case A.NotNull:{d.length>1&&a.push(...d.map(h=>new E(v.DUPLICATE_COLUMN_SETTING,"'not null' can only appear once",h)));const c=r[A.Null]||[];d.length>=1&&c.length>=1&&a.push(...[...d,...c].map(h=>new E(v.CONFLICTING_SETTING,"'not null' and 'null' can not be set at the same time",h))),d.forEach(h=>{Qe(h.value)||a.push(new E(v.INVALID_COLUMN_SETTING_VALUE,"'not null' must not have a value",h.value||h.name))});break}case A.Null:d.length>1&&a.push(...d.map(c=>new E(v.DUPLICATE_COLUMN_SETTING,"'null' can only appear once",c))),d.forEach(c=>{Qe(c.value)||a.push(new E(v.INVALID_COLUMN_SETTING_VALUE,"'null' must not have a value",c.value||c.name))});break;case A.Unique:d.length>1&&a.push(...d.map(c=>new E(v.DUPLICATE_COLUMN_SETTING,"'unique' can only appear once",c))),d.forEach(c=>{c instanceof ft&&!Qe(c.value)&&a.push(new E(v.INVALID_COLUMN_SETTING_VALUE,"'unique' must not have a value",c.value||c.name))});break;case A.Increment:d.length>1&&a.push(...d.map(c=>new E(v.DUPLICATE_COLUMN_SETTING,"'increment' can only appear once",c))),d.forEach(c=>{c instanceof ft&&!Qe(c.value)&&a.push(new E(v.INVALID_COLUMN_SETTING_VALUE,"'increment' must not have a value",c.value||c.name))});break;case A.Default:d.length>1&&a.push(...d.map(c=>new E(v.DUPLICATE_COLUMN_SETTING,"'default' can only appear once",c))),d.forEach(c=>{yc(c.value)||a.push(new E(v.INVALID_COLUMN_SETTING_VALUE,"'default' must be an enum value, a string literal, number literal, function expression, true, false or null",c.value||c.name))});break;case A.Check:d.forEach(c=>{c.value instanceof lt||a.push(new E(v.INVALID_COLUMN_SETTING_VALUE,"'check' must be a function expression",c.value||c.name))});break;default:d.forEach(c=>a.push(new E(v.UNKNOWN_COLUMN_SETTING,`Unknown column setting '${u}'`,c)))}}),a}validateSubElements(t){const n=t.flatMap(a=>{if(a.parent=this.declarationNode,!a.type)return[];const r=St(a);return new r(a,this.publicSymbolTable,this.symbolFactory).validate()}),s=t.filter(a=>{var r;return((r=a.type)==null?void 0:r.value.toLowerCase())==="note"});return s.length>1&&n.push(...s.map(a=>new E(v.NOTE_REDEFINED,"Duplicate notes are defined",a))),n}}function bN(e,t){return t.length===1&&e===t[0]}class xN{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.registerElement(),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof Z?[new E(v.INVALID_TABLEGROUP_CONTEXT,"TableGroup must appear top-level",this.declarationNode)]:[]}validateName(t){return t?os(t)?[]:[new E(v.INVALID_NAME,"A TableGroup name must be a single identifier",t)]:[new E(v.NAME_NOT_FOUND,"A TableGroup must have a name",this.declarationNode)]}validateAlias(t){return t?[new E(v.UNEXPECTED_ALIAS,"A TableGroup shouldn't have an alias",t)]:[]}registerElement(){const{name:t}=this.declarationNode;this.declarationNode.symbol=this.symbolFactory.create(Fv,{declaration:this.declarationNode,symbolTable:new is});const n=$e(t);if(n.isOk()){const s=n.unwrap(),a=s.pop(),r=Ra(s,this.publicSymbolTable,this.symbolFactory),o=ti(a);if(r.has(o))return[new E(v.DUPLICATE_NAME,`TableGroup name '${a}' already exists`,t)];r.set(o,this.declarationNode.symbol)}return[]}validateSettingList(t){const n=pe(t),s=n.getErrors(),a=n.getValue();return Is(a,(r,o)=>{switch(o){case"color":r.length>1&&s.push(...r.map(l=>new E(v.DUPLICATE_TABLE_SETTING,"'color' can only appear once",l))),r.forEach(l=>{Ma(l.value)||s.push(new E(v.INVALID_TABLE_SETTING_VALUE,"'color' must be a color literal",l.value||l.name))});break;case"note":r.length>1&&s.push(...r.map(l=>new E(v.DUPLICATE_TABLE_SETTING,"'note' can only appear once",l))),r.filter(l=>!De(l.value)).forEach(l=>{s.push(new E(v.INVALID_TABLE_SETTING_VALUE,"'note' must be a string literal",l.value||l.name))});break;default:s.push(...r.map(l=>new E(v.UNKNOWN_TABLE_SETTING,`Unknown '${o}' setting`,l)));break}}),s}validateBody(t){if(!t)return[];if(t instanceof Y)return[new E(v.UNEXPECTED_SIMPLE_BODY,"A TableGroup's body must be a block",t)];const[n,s]=dt(t.body,a=>a instanceof Y);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){return t.flatMap(n=>{const s=[];return n.callee&&!$e(n.callee).isOk()&&s.push(new E(v.INVALID_TABLEGROUP_FIELD,"A TableGroup field must be of the form <table> or <schema>.<table>",n.callee)),this.registerField(n),n.args.length>0&&s.push(...n.args.map(a=>new E(v.INVALID_TABLEGROUP_FIELD,"A TableGroup field should only have a single Table name",a))),s})}validateSubElements(t){const n=t.flatMap(a=>{if(a.parent=this.declarationNode,!a.type)return[];const r=St(a);return new r(a,this.publicSymbolTable,this.symbolFactory).validate()}),s=t.filter(a=>{var r;return((r=a.type)==null?void 0:r.value.toLowerCase())==="note"});return s.length>1&&n.push(...s.map(a=>new E(v.NOTE_REDEFINED,"Duplicate notes are defined",a))),n}registerField(t){if(t.callee&&Ie(t.callee)){const n=Ae(t.callee).unwrap(),s=ni(n),a=this.symbolFactory.create(Uv,{declaration:t});t.symbol=a;const r=this.declarationNode.symbol.symbolTable;if(r.has(s)){const o=r.get(s);return[new E(v.DUPLICATE_TABLEGROUP_FIELD_NAME,`${n} already exists in the group`,t),new E(v.DUPLICATE_TABLEGROUP_FIELD_NAME,`${n} already exists in the group`,o.declaration)]}r.set(s,a)}return[]}}const gN=["-","+"];class vN{constructor(t,n,s){this.declarationNode=t,this.symbolFactory=s,this.publicSymbolTable=n}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.registerElement(),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof Z?[new E(v.INVALID_TABLE_PARTIAL_CONTEXT,"TablePartial must appear top-level",this.declarationNode)]:[]}validateName(t){return t?os(t)?[]:[new E(v.INVALID_NAME,"A TablePartial name must be an identifier or a quoted identifer",t)]:[new E(v.NAME_NOT_FOUND,"A TablePartial must have a name",this.declarationNode)]}validateAlias(t){return t?[new E(v.UNEXPECTED_ALIAS,"A TablePartial shouldn't have an alias",t)]:[]}validateSettingList(t){const n=pe(t),s=n.getErrors(),a=n.getValue();return Is(a,(r,o)=>{switch(o){case A.HeaderColor:r.length>1&&s.push(...r.map(l=>new E(v.DUPLICATE_TABLE_PARTIAL_SETTING,`'${o}' can only appear once`,l))),r.forEach(l=>{Ma(l.value)||s.push(new E(v.INVALID_TABLE_PARTIAL_SETTING_VALUE,`'${o}' must be a color literal`,l.value||l.name))});break;case A.Note:r.length>1&&s.push(...r.map(l=>new E(v.DUPLICATE_TABLE_PARTIAL_SETTING,`'${o}' can only appear once`,l))),r.forEach(l=>{De(l.value)||s.push(new E(v.INVALID_TABLE_PARTIAL_SETTING_VALUE,`'${o}' must be a string literal`,l.value||l.name))});break;default:s.push(...r.map(l=>new E(v.UNKNOWN_TABLE_PARTIAL_SETTING,`Unknown '${o}' setting`,l)))}}),s}registerElement(){const{name:t}=this.declarationNode;this.declarationNode.symbol=this.symbolFactory.create(Bv,{declaration:this.declarationNode,symbolTable:new is});const n=$e(t);if(!n.isOk())return[];const s=n.unwrap(),a=s.pop(),r=Ra(s,this.publicSymbolTable,this.symbolFactory),o=si(a);return r.has(o)?[new E(v.DUPLICATE_NAME,`TablePartial name '${a}' already exists`,t)]:(r.set(o,this.declarationNode.symbol),[])}validateBody(t){if(!t)return[];if(t instanceof Y)return[new E(v.UNEXPECTED_SIMPLE_BODY,"A TablePartial's body must be a block",t)];const[n,s]=dt(t.body,a=>a instanceof Y);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){return t.flatMap(n=>{if(!n.callee)return[];const s=[];n.args.length===0&&s.push(new E(v.INVALID_COLUMN,"A column must have a type",n.callee)),Ie(n.callee)||s.push(new E(v.INVALID_COLUMN_NAME,"A column name must be an identifier or a quoted identifier",n.callee)),n.args[0]&&!wc(n.args[0])&&s.push(new E(v.INVALID_COLUMN_TYPE,"Invalid column type",n.args[0]));const a=n.args.slice(1);return s.push(...this.validateFieldSetting(a),...this.registerField(n)),s})}registerField(t){if(!t.callee||!Ie(t.callee))return[];const n=Ae(t.callee).unwrap(),s=Aa(n),a=this.symbolFactory.create(ai,{declaration:t});t.symbol=a;const r=this.declarationNode.symbol.symbolTable;if(r.has(s)){const o=r.get(s);return[new E(v.DUPLICATE_COLUMN_NAME,`Duplicate column ${n}`,t),new E(v.DUPLICATE_COLUMN_NAME,`Duplicate column ${n}`,o.declaration)]}return r.set(s,a),[]}validateFieldSetting(t){const n=ie(t);if(!t.slice(0,-1).every(tn)||!(tn(n)||n instanceof re))return[...t.map(u=>new E(v.INVALID_COLUMN,"These fields must be some inline settings optionally ended with a setting list",u))];if(t.length===0)return[];let s;ie(t)instanceof re&&(s=t.pop());const a=pe(s),r=a.getErrors(),o=a.getValue();t.forEach(u=>{const c=Ae(u).unwrap_or("").toLowerCase();if(c!==A.PK&&c!==A.Unique){r.push(new E(v.INVALID_SETTINGS,"Inline column settings can only be `pk` or `unique`",u));return}o[c]===void 0?o[c]=[u]:o[c].push(u)});const l=o[A.PK]||[],d=o[A.PrimaryKey]||[];return l.length>=1&&d.length>=1&&r.push(...[...l,...d].map(u=>new E(v.DUPLICATE_COLUMN_SETTING,"Either one of 'primary key' and 'pk' can appear",u))),Is(o,(u,c)=>{switch(c){case A.Note:u.length>1&&r.push(...u.map(h=>new E(v.DUPLICATE_COLUMN_SETTING,`'${c}' can only appear once`,h))),u.forEach(h=>{De(h.value)||r.push(new E(v.INVALID_COLUMN_SETTING_VALUE,`'${c}' must be a quoted string`,h.value||h.name))});break;case A.Ref:u.forEach(h=>{_c(h.value)||r.push(new E(v.INVALID_COLUMN_SETTING_VALUE,`'${c}' must be a valid unary relationship`,h.value||h.name))});break;case A.PrimaryKey:u.length>1&&r.push(...u.map(h=>new E(v.DUPLICATE_COLUMN_SETTING,`'${c}' can only appear once`,h))),u.forEach(h=>{Qe(h.value)||r.push(new E(v.INVALID_COLUMN_SETTING_VALUE,`'${c}' must not have a value`,h.value||h.name))});break;case A.PK:u.length>1&&r.push(...u.map(h=>new E(v.DUPLICATE_COLUMN_SETTING,`'${c}' can only appear once`,h))),u.forEach(h=>{h instanceof ft&&!Qe(h.value)&&r.push(new E(v.INVALID_COLUMN_SETTING_VALUE,`'${c}' must not have a value`,h.value||h.name))});break;case A.NotNull:{u.length>1&&r.push(...u.map(p=>new E(v.DUPLICATE_COLUMN_SETTING,`'${c}' can only appear once`,p)));const h=o[A.Null]||[];u.length>=1&&h.length>=1&&r.push(...[...u,...h].map(p=>new E(v.CONFLICTING_SETTING,"'not null' and 'null' can not be set at the same time",p))),u.forEach(p=>{Qe(p.value)||r.push(new E(v.INVALID_COLUMN_SETTING_VALUE,`'${c}' must not have a value`,p.value||p.name))});break}case A.Null:u.length>1&&r.push(...u.map(h=>new E(v.DUPLICATE_COLUMN_SETTING,`'${c}' can only appear once`,h))),u.forEach(h=>{Qe(h.value)||r.push(new E(v.INVALID_COLUMN_SETTING_VALUE,`'${c}' must not have a value`,h.value||h.name))});break;case A.Unique:u.length>1&&r.push(...u.map(h=>new E(v.DUPLICATE_COLUMN_SETTING,`'${c}' can only appear once`,h))),u.forEach(h=>{h instanceof ft&&!Qe(h.value)&&r.push(new E(v.INVALID_COLUMN_SETTING_VALUE,`'${c}' must not have a value`,h.value||h.name))});break;case A.Increment:u.length>1&&r.push(...u.map(h=>new E(v.DUPLICATE_COLUMN_SETTING,`'${c}' can only appear once`,h))),u.forEach(h=>{h instanceof ft&&!Qe(h.value)&&r.push(new E(v.INVALID_COLUMN_SETTING_VALUE,`'${c}' must not have a value`,h.value||h.name))});break;case A.Default:u.length>1&&r.push(...u.map(h=>new E(v.DUPLICATE_COLUMN_SETTING,`'${c}' can only appear once`,h))),u.forEach(h=>{yc(h.value)||r.push(new E(v.INVALID_COLUMN_SETTING_VALUE,`'${c}' must be a string literal, number literal, function expression, true, false or null`,h.value||h.name))});break;case A.Check:u.forEach(h=>{h.value instanceof lt||r.push(new E(v.INVALID_COLUMN_SETTING_VALUE,"'check' must be a function expression",h.value||h.name))});break;default:u.forEach(h=>r.push(new E(v.UNKNOWN_COLUMN_SETTING,`Unknown column setting '${c}'`,h)))}}),r}validateSubElements(t){const n=t.flatMap(a=>{if(a.parent=this.declarationNode,!a.type)return[];const r=St(a);return new r(a,this.publicSymbolTable,this.symbolFactory).validate()}),s=t.filter(a=>{var r;return((r=a.type)==null?void 0:r.value.toLowerCase())===F.Note});return s.length>1&&n.push(...s.map(a=>new E(v.NOTE_REDEFINED,"Duplicate notes are defined",a))),n}}class NN{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.validateBody(this.declarationNode.body)]}validateContext(){const t=new E(v.INVALID_CHECKS_CONTEXT,"A Checks can only appear inside a Table or a TablePartial",this.declarationNode);if(this.declarationNode.parent instanceof it)return[t];const n=nn(this.declarationNode.parent).unwrap_or(void 0);return n&&[F.Table,F.TablePartial].includes(n)?[]:[t]}validateName(t){return t?[new E(v.UNEXPECTED_NAME,"A Checks shouldn't have a name",t)]:[]}validateAlias(t){return t?[new E(v.UNEXPECTED_ALIAS,"A Checks shouldn't have an alias",t)]:[]}validateSettingList(t){return t?[new E(v.UNEXPECTED_SETTINGS,"A Checks shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof Y)return[new E(v.UNEXPECTED_SIMPLE_BODY,"A Checks must have a complex body",t)];const[n,s]=dt(t.body,a=>a instanceof Y);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){return t.flatMap(n=>{if(!n.callee)return[];const s=[],a=[n.callee,...n.args];return ie(a)instanceof re&&s.push(...this.validateFieldSetting(a.pop())),(a.length>1||!(a[0]instanceof lt))&&s.push(new E(v.INVALID_CHECKS_FIELD,"A check field must be a function expression",n)),s})}validateFieldSetting(t){const n=pe(t),s=n.getErrors(),a=n.getValue();for(const r in a){const o=a[r];r==="name"?(o.length>1&&o.forEach(l=>s.push(new E(v.DUPLICATE_CHECK_SETTING,`'${r}' can only appear once`,l))),o.forEach(l=>{De(l.value)||s.push(new E(v.INVALID_CHECK_SETTING_VALUE,`'${r}' must be a string`,l))})):o.forEach(l=>s.push(new E(v.UNKNOWN_CHECK_SETTING,`Unknown check setting '${r}'`,l)))}return s}validateSubElements(t){return t.flatMap(n=>{if(n.parent=this.declarationNode,!n.type)return[];const s=St(n);return new s(n,this.publicSymbolTable,this.symbolFactory).validate()})}}function St(e){switch(e.type.value.toLowerCase()){case F.Enum:return cN;case F.Table:return mN;case F.TableGroup:return xN;case F.Project:return hN;case F.Ref:return fN;case F.Note:return uN;case F.Indexes:return dN;case F.TablePartial:return vN;case F.Check:return NN;default:return lN}}function Nc(e){return!!$e(e).unwrap_or(!1)}function EN(e){return os(e)}function os(e){return e instanceof Ue&&e.expression instanceof gt}function Ra(e,t,n){var s;e[0]==="public"&&(e=e.slice(1));let a=t;for(const r of e){let o;const l=Jr(r);if(a.has(l)){if(o=(s=a.get(l))==null?void 0:s.symbolTable,!o)throw new Error("Expect a symbol table in a schema symbol")}else{o=new is;const d=n.create(bc,{symbolTable:o});a.set(l,d)}a=o}return a}function Ec(e){return e==="-"||e==="<>"||e===">"||e==="<"}function Ma(e){var t;if(!(e instanceof Ue)||!(e.expression instanceof rs)||((t=e.expression.literal)==null?void 0:t.kind)!==T.COLOR_LITERAL)return!1;const n=e.expression.literal.value;if(n.length!==4&&n.length!==7||n[0]!=="#")return!1;for(let s=1;s<n.length;s+=1)if(!zv(n[s]))return!1;return!0}function Qe(e){return e===void 0}function yc(e){var t;if(De(e)||Tn(e)||tn(e)&&["true","false","null"].includes(e.expression.variable.value.toLowerCase())||e instanceof ot&&gN.includes((t=e.op)==null?void 0:t.value)&&Tn(e.expression)||e instanceof lt)return!0;if(!e||!ri(e))return!1;const n=Vt(e).unwrap();return n.length===2||n.length===3}function Tn(e){var t,n,s;return e instanceof ot?((t=e.op)==null?void 0:t.value)!=="-"&&((n=e.op)==null?void 0:n.value)!=="+"?!1:Tn(e.expression):e instanceof Ue&&e.expression instanceof rs&&((s=e.expression.literal)==null?void 0:s.kind)===T.NUMERIC_LITERAL}function _c(e){var t;if(!(e instanceof ot)||!Ec((t=e.op)==null?void 0:t.value))return!1;const n=$e(e.expression).unwrap_or(void 0);return n!==void 0&&n.length>0}function Tc(e){return e instanceof At&&e.elementList.every(Ie)}function wc(e){if(!(e instanceof ct||Da(e)||e instanceof Ue||e instanceof _n))return!1;if(e instanceof ct){if(e.callee===void 0||e.argumentList===void 0||!e.argumentList.elementList.every(n=>Tn(n)||De(n)||tn(n)))return!1;e=e.callee}for(;e instanceof _n;){if(e.array===void 0||e.indexer===void 0||!e.indexer.elementList.every(n=>!n.colon&&!n.value&&Tn(n.name)))return!1;e=e.array}const t=$e(e).unwrap_or(void 0);return t!==void 0&&t.length>0}function pe(e){const t={},n=[];return e?(e.elementList.forEach(s=>{var a;if(!s.name)return;if(s.name instanceof Ue){n.push(new E(v.INVALID_SETTINGS,"A setting name must be a stream of identifiers",s.name));return}const r=(a=Bn(s.name).unwrap_or(void 0))==null?void 0:a.toLowerCase();r&&(t[r]===void 0?t[r]=[s]:t[r].push(s))}),new et(t,n)):new et({})}class Mo{constructor(t,n){this.ast=t,this.symbolFactory=n,this.publicSchemaSymbol=this.symbolFactory.create(bc,{symbolTable:new is}),this.ast.symbol=this.publicSchemaSymbol,this.ast.symbol.declaration=this.ast}validate(){const t=[];this.ast.body.forEach(s=>{if(s.parent=this.ast,s.type===void 0)return;const a=St(s),r=new a(s,this.publicSchemaSymbol.symbolTable,this.symbolFactory);t.push(...r.validate())});const n=this.ast.body.filter(s=>nn(s).unwrap_or(void 0)===F.Project);return n.length>1&&n.forEach(s=>t.push(new E(v.PROJECT_REDEFINED,"Only one project can exist",s))),new et(this.ast,t)}}class Dt{constructor(t,n){this.declarationNode=t,this.errors=n}bind(){this.bindSettingList(this.declarationNode.attributeList,this.settingList),this.bindBody()}bindSettingList(t,n){t&&t.elementList.forEach(s=>{if(s.name instanceof Ue)return;const a=Bn(s.name).unwrap_or(void 0);if(!a)return;const r=n[a.toLowerCase()];r!=null&&r.shouldBind&&this.scanAndBind(s.value,r)})}bindBody(){const t=this.declarationNode;if(!t.body)return;const{body:n}=t;n instanceof Nt?n.body.forEach(s=>{if(s instanceof Z){if(!s.type||nn(this.declarationNode).unwrap_or(null)===F.TablePartial&&nn(s).unwrap_or(null)===F.Indexes)return;const a=Ic(s);new a(s,this.errors).bind()}else s instanceof Y?this.bindSubfield(s):this.bindPartialInjection(s)}):this.bindSubfield(n)}bindSubfield(t){const n=[t.callee,...t.args],s=ie(n);s instanceof re&&(n.pop(),this.bindSettingList(s,this.subfield.settingList));const{argBinderRules:a}=this.subfield.arg;for(let r=0;r<Math.min(n.length,a.length);r+=1)a[r].shouldBind&&this.scanAndBind(n[r],a[r])}bindPartialInjection(t){var n;(n=this.injectionBinderRule)!=null&&n.shouldBind&&this.scanAndBind(t,this.injectionBinderRule)}scanAndBind(t,n){var s,a;if(t)if(t instanceof Ue){if(t.expression instanceof gt&&(a=n.keywords)!=null&&a.includes((s=t.expression.variable)==null?void 0:s.value.toLowerCase()))return;this.bindFragments([t],n)}else t instanceof kt?Da(t)?this.bindFragments(Vt(t).unwrap_or([]),n):(this.scanAndBind(t.leftExpression,n),this.scanAndBind(t.rightExpression,n)):t instanceof ot?this.scanAndBind(t.expression,n):t instanceof ka?this.scanAndBind(t.expression,n):t instanceof At?t.elementList.forEach(r=>this.scanAndBind(r,n)):t instanceof yn&&this.bindFragments([t],n)}bindFragments(t,n){if(t.length===0)return;const s=t.length===1&&t[0]instanceof yn,a=[...n.topSubnamesSymbolKind],r=s?-1:t.findIndex(h=>!Ie(h)),o=r!==-1&&Tc(t[r])?t[r]:void 0,l=r>=0?a.pop():void 0,d=t.slice(0,r===-1?void 0:r);if(d.length===0)return;const u=[];for(;a.length&&d.length;){const h=a.pop(),p=d.pop(),b=Ae(p).unwrap();u.unshift({index:Js(b,h),referrer:p})}for(;d.length;){const h=d.pop(),p=s?rN(h).unwrap():Ae(h).unwrap();u.unshift({index:Js(p,n.remainingSubnamesSymbolKind),referrer:h})}const c=De(t[0]);return o?o.elementList.forEach(h=>this.resolveIndexStack([...u,{index:Js(Ae(h).unwrap(),l),referrer:h}],n,c)):this.resolveIndexStack(u,n,c)}resolveIndexStack(t,n,s){if(t.length===0)throw new Error("Unreachable - An unresolved name must have at least one name component");const[a,...r]=t,o=Ro(a.index,this.declarationNode);if(o===void 0){const{kind:c,name:h}=pt(a.index).unwrap();this.logError(a.referrer,`Can not find ${c} '${h}'`,n.ignoreNameNotFound||!!n.ignoreNameNotFoundForQuotedVariable&&s);return}o.references.push(a.referrer),a.referrer.referee=o;let l=o.symbolTable,{kind:d,name:u}=pt(a.index).unwrap();for(const c of r){const{kind:h,name:p}=pt(c.index).unwrap(),b=l.get(c.index);if(!b){this.logError(c.referrer,`${d} '${u}' does not have ${h} '${p}'`,n.ignoreNameNotFound);return}if(d=h,u=p,c.referrer.referee=b,b.references.push(c.referrer),!b.symbolTable)break;l=b.symbolTable}}logError(t,n,s){s||this.errors.push(new E(v.BINDING_ERROR,n,t))}resolveInjections(t){var n;const s=(n=this.declarationNode.symbol)==null?void 0:n.symbolTable;if(!s)return;const a=new Map;s.forEach((r,o)=>{var l,d;if(!Dv(o))return;const u=Ro(Rv(o),this.declarationNode),c=(d=(l=u?.declaration)==null?void 0:l.symbol)==null?void 0:d.symbolTable;c&&c.forEach((h,p)=>{s.has(p)||a.set(p,{injectorFieldSymbol:h,injectorDeclaration:r.declaration})})}),a.forEach((r,o)=>{const l=Kv(r.injectorFieldSymbol);if(!l)return;const d=t.create(l,r);s.set(o,d)})}}class yN extends Dt{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!1}]},settingList:{}},this.settingList={}}}class _N extends Dt{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[]},settingList:{}},this.settingList={}}}class TN extends Dt{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!1}]},settingList:{}},this.settingList={}}}class wN extends Dt{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!0,topSubnamesSymbolKind:[M.Table,M.Column],remainingSubnamesSymbolKind:M.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1},{shouldBind:!0,topSubnamesSymbolKind:[M.Table,M.Column],remainingSubnamesSymbolKind:M.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1},{shouldBind:!0,topSubnamesSymbolKind:[M.Table,M.Column],remainingSubnamesSymbolKind:M.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1},{shouldBind:!0,topSubnamesSymbolKind:[M.Table,M.Column],remainingSubnamesSymbolKind:M.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1}]},settingList:{}},this.settingList={}}}class IN extends Dt{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!1}]},settingList:{}},this.settingList={}}}class CN extends Dt{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[]},settingList:{}},this.settingList={}}}class jN extends Dt{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!0,topSubnamesSymbolKind:[M.Table,M.Column],remainingSubnamesSymbolKind:M.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1}]},settingList:{}},this.settingList={}}}class LN extends Dt{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!1},{shouldBind:!0,topSubnamesSymbolKind:[M.Enum],remainingSubnamesSymbolKind:M.Schema,ignoreNameNotFound:!0,ignoreNameNotFoundForQuotedVariable:!0}]},settingList:{ref:{shouldBind:!0,topSubnamesSymbolKind:[M.Table,M.Column],remainingSubnamesSymbolKind:M.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1},default:{shouldBind:!0,topSubnamesSymbolKind:[M.Enum,M.EnumField],remainingSubnamesSymbolKind:M.Schema,ignoreNameNotFound:!1,keywords:["false","true","null"],ignoreNameNotFoundForQuotedVariable:!0},check:{shouldBind:!1}}},this.settingList={},this.injectionBinderRule={shouldBind:!0,topSubnamesSymbolKind:[],remainingSubnamesSymbolKind:M.TablePartial,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1}}}class kN extends Dt{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!0,topSubnamesSymbolKind:[M.Table],remainingSubnamesSymbolKind:M.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1}]},settingList:{}},this.settingList={}}}class AN extends Dt{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!1},{shouldBind:!0,topSubnamesSymbolKind:[M.Enum],remainingSubnamesSymbolKind:M.Schema,ignoreNameNotFound:!0,ignoreNameNotFoundForQuotedVariable:!1}]},settingList:{ref:{shouldBind:!0,topSubnamesSymbolKind:[M.Table,M.Column],remainingSubnamesSymbolKind:M.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1},default:{shouldBind:!1},check:{shouldBind:!1}}},this.settingList={}}}function Ic(e){switch(e.type.value.toLowerCase()){case F.Enum:return TN;case F.Table:return LN;case F.TableGroup:return kN;case F.Project:return CN;case F.Ref:return jN;case F.Note:return IN;case F.Indexes:return wN;case F.TablePartial:return AN;case F.Check:return yN;default:return _N}}class SN{constructor(t){this.ast=t,this.errors=[]}resolve(t){return this.ast.body.map(n=>{if(!n.type)return null;const s=Ic(n),a=new s(n,this.errors);return a.resolveInjections(t),a}).forEach(n=>n?.bind()),new et(this.ast,this.errors)}}class DN{constructor(t){this.generator=t}create(t,n){return new t(n,this.generator.nextId())}}class RN{constructor(t,n){this.ast=t,this.symbolFactory=new DN(n)}analyze(){return new Mo(this.ast,this.symbolFactory).validate().chain(t=>new SN(t).resolve(this.symbolFactory))}validate(){return new Mo(this.ast,this.symbolFactory).validate().chain(t=>new et(t,[]))}}function Oo(e,t){const{variables:n,tupleElements:s}=Cs(e).unwrap();return s?n.length===0?{schemaName:t.schemaName,tableName:t.name,fieldNames:s}:{tableName:n.pop(),schemaName:n.pop()||null,fieldNames:s}:n.length===1?{schemaName:t.schemaName,tableName:t.name,fieldNames:[n[0]]}:{fieldNames:[n.pop()],tableName:n.pop(),schemaName:n.pop()||null}}function Cc(e){switch(e){case"<":return["1","*"];case"<>":return["*","*"];case">":return["*","1"];case"-":return["1","1"];default:throw new Error("Invalid relation op")}}function G(e){return{start:{offset:e.startPos.offset,line:e.startPos.line+1,column:e.startPos.column+1},end:{offset:e.endPos.offset,line:e.endPos.line+1,column:e.endPos.column+1}}}function ha(e){var t;const n=(t=Vt(e).unwrap_or(void 0))==null?void 0:t.pop();return n instanceof At?n.elementList.map(s=>s.referee):[n.referee]}function Ln(e){const t=$e(e).unwrap();return{name:t.pop(),schemaName:t}}function Bs(e){return e.expression.literal.value}function jc(e,t){if(Array.isArray(e)){const a=e.map(({id:o})=>o).sort().join(","),r=t.map(({id:o})=>o).sort().join(",");return a<r?`${a}-${r}`:`${r}-${a}`}const n=e.id.toString(),s=t.id.toString();return n<s?`${n}-${s}`:`${s}-${n}`}function ii(e,t){if(Array.isArray(e)){const a=e.map(({id:o})=>o).sort(),r=t.map(({id:o})=>o).sort();return Ir(a,r).every(([o,l])=>o===l)}const n=e.id,s=t.id;return n===s}function mt(e){const t=e.split(`
`),n=t.slice(t.findIndex(r=>r.trimStart()!=="")),s=n.filter(r=>r.trimStart()),a=Math.min(...s.map(r=>r.length-r.trimStart().length));return n.map(r=>r.slice(a)).join(`
`)}function Lc(e){if(e){if(De(e))return{value:ye(e).unwrap(),type:"string"};if(Tn(e))return{type:"number",value:jr(e)};if(tn(e))return{value:e.expression.variable.value.toLowerCase(),type:"boolean"};if(e instanceof lt&&e.value)return{value:e.value.value,type:"expression"};if(ri(e))return{value:Vt(e).map(ie).and_then(Fe).unwrap(),type:"string"};throw new Error("Unreachable")}}function kc(e){let t=null;e instanceof ct&&(t=e.argumentList.elementList.map(r=>Tn(r)?gc(r):De(r)?ye(r).unwrap():Fe(r).unwrap()).join(","),e=e.callee);let n="";for(;e instanceof _n;)n=`[${e.indexer.elementList.map(r=>r.name.expression.literal.value).join(",")}]${n}`,e=e.array;const{name:s,schemaName:a}=Ln(e);return a.length>1?new et({schemaName:a.length===0?null:a[0],type_name:`${s}${n}${t?`(${t})`:""}`,args:t},[new E(v.UNSUPPORTED,"Nested schema is not supported",e)]):new et({schemaName:a.length===0?null:a[0],type_name:`${s}${n}${t?`(${t})`:""}`,args:t})}class Ac{constructor(t,n){this.declarationNode=t,this.env=n,this.table={name:void 0,schemaName:void 0,alias:null,fields:[],token:void 0,indexes:[],partials:[],checks:[]},this.pkColumns=[]}interpret(){this.table.token=G(this.declarationNode),this.env.tables.set(this.declarationNode,this.table);const t=[...this.interpretName(this.declarationNode.name),...this.interpretAlias(this.declarationNode.alias),...this.interpretSettingList(this.declarationNode.attributeList),...this.interpretBody(this.declarationNode.body)];return this.pkColumns.length>=2&&(this.table.indexes.push({columns:this.pkColumns.map(({name:n,token:s})=>({value:n,type:"column",token:s})),token:{start:{offset:-1,line:-1,column:-1},end:{offset:-1,line:-1,column:-1}},pk:!0}),this.pkColumns.forEach(n=>{n.pk=!1})),t}interpretName(t){const{name:n,schemaName:s}=Ln(t);return s.length>1?(this.table.name=n,this.table.schemaName=s.join("."),[new E(v.UNSUPPORTED,"Nested schema is not supported",t)]):(this.table.name=n,this.table.schemaName=s.length?s[0]:null,[])}interpretAlias(t){if(!t)return[];const n=Ae(t).unwrap_or(null);return n&&(this.env.aliases.push({name:n,kind:"table",value:{tableName:this.table.name,schemaName:this.table.schemaName}}),this.table.alias=n),[]}interpretSettingList(t){var n,s,a;const r=pe(t).getValue();this.table.headerColor=(n=r[A.HeaderColor])!=null&&n.length?Bs((a=(s=r[A.HeaderColor])==null?void 0:s.at(0))==null?void 0:a.value):void 0;const[o]=r[A.Note]||[];return this.table.note=o&&{value:ye(o?.value).map(mt).unwrap(),token:G(o)},[]}interpretBody(t){const[n,s]=dt(t.body,a=>a instanceof Y||a instanceof yn);return[...this.interpretFields(n),...this.interpretSubElements(s)]}interpretSubElements(t){return t.flatMap(n=>{var s;switch((s=n.type)==null?void 0:s.value.toLowerCase()){case F.Note:return this.table.note={value:ye(n.body instanceof Nt?n.body.body[0].callee:n.body.callee).map(mt).unwrap(),token:G(n)},[];case F.Indexes:return this.interpretIndexes(n);case F.Check:return this.interpretChecks(n);default:return[]}})}interpretInjection(t,n){const s={order:n,token:G(t)};return s.name=t.partial.variable.value,this.table.partials.push(s),[]}interpretFields(t){var n;const s=((n=this.declarationNode.symbol)!=null&&n.symbolTable?[...this.declarationNode.symbol.symbolTable.entries()]:[]).filter(([r])=>{const o=pt(r).unwrap_or(null);return o?.kind===M.Column}).length?[]:[new E(v.EMPTY_TABLE,"A Table must have at least one column",this.declarationNode)],a=t.flatMap((r,o)=>r instanceof Y?this.interpretColumn(r):this.interpretInjection(r,o));return[...s,...a]}interpretColumn(t){var n,s,a,r,o,l,d,u,c;const h=[],p={};p.name=Ae(t.callee).unwrap();const b=kc(t.args[0]);p.type=b.getValue(),h.push(...b.getErrors()),p.token=G(t),p.inline_refs=[];const x=t.args.slice(1);if(ie(x)instanceof re){const m=pe(x.pop()).getValue();p.pk=!!((n=m[A.PK])!=null&&n.length)||!!((s=m[A.PrimaryKey])!=null&&s.length),p.increment=!!((a=m[A.Increment])!=null&&a.length),p.unique=!!((r=m[A.Unique])!=null&&r.length),p.not_null=(o=m[A.NotNull])!=null&&o.length?!0:(l=m[A.Null])!=null&&l.length?!1:void 0,p.dbdefault=Lc((u=(d=m[A.Default])==null?void 0:d.at(0))==null?void 0:u.value);const N=(c=m[A.Note])==null?void 0:c.at(0);p.note=N&&{value:ye(N.value).map(mt).unwrap(),token:G(N)};const _=m[A.Ref]||[];p.inline_refs=_.flatMap(g=>{const[w]=ha(g.value.expression);if(ii(w,t.symbol))return h.push(new E(v.SAME_ENDPOINT,"Two endpoints are the same",g)),[];const I=g.value.op,L=$e(g.value.expression).unwrap();let k;if(L.length===1){const[j]=L;k={schemaName:this.table.schemaName,tableName:this.table.name,fieldNames:[j],relation:I.value,token:G(g)}}else if(L.length===2){const[j,O]=L;k={schemaName:null,tableName:j,fieldNames:[O],relation:I.value,token:G(g)}}else if(L.length===3){const[j,O,V]=L;k={schemaName:j,tableName:O,fieldNames:[V],relation:I.value,token:G(g)}}else{h.push(new E(v.UNSUPPORTED,"Nested schema is not supported",g));const j=L.pop(),O=L.pop();k={schemaName:L.join("."),tableName:O,fieldNames:[j],relation:I.value,token:G(g)}}const C=this.registerInlineRefToEnv(t,w,k,g);return h.push(...C),C.length===0?k:[]});const y=m[A.Check]||[];p.checks=y.map(g=>{const w=G(g),I=g.value.value.value;return{token:w,expression:I}})}return p.pk||(p.pk=x.some(m=>Fe(m).unwrap().toLowerCase()==="pk")),p.unique||(p.unique=x.some(m=>Fe(m).unwrap().toLowerCase()==="unique")),this.table.fields.push(p),p.pk&&this.pkColumns.push(p),h}interpretIndexes(t){return this.table.indexes.push(...t.body.body.map(n=>{var s,a,r,o,l,d,u;const c={columns:[]},h=n;c.token=G(h);const p=[h.callee,...h.args];if(ie(p)instanceof re){const b=pe(p.pop()).getValue();c.pk=!!((s=b[A.PK])!=null&&s.length),c.unique=!!((a=b[A.Unique])!=null&&a.length),c.name=ye((o=(r=b[A.Name])==null?void 0:r.at(0))==null?void 0:o.value).unwrap_or(void 0);const x=(l=b[A.Note])==null?void 0:l.at(0);c.note=x&&{value:ye(x.value).unwrap(),token:G(x)},c.type=Fe((u=(d=b[A.Type])==null?void 0:d.at(0))==null?void 0:u.value).unwrap_or(void 0)}return p.flatMap(b=>{if(!(b instanceof ct))return b;const x=[];for(;b instanceof ct;)x.push(b.argumentList),b=b.callee;return x.push(b),x}).forEach(b=>{const{functional:x,nonFunctional:m}=ua(b).unwrap();c.columns.push(...x.map(N=>({value:N.value.value,type:"expression",token:G(N)})),...m.map(N=>({value:Ae(N).unwrap(),type:"column",token:G(N)})))}),c})),[]}interpretChecks(t){return this.table.checks.push(...t.body.body.map(n=>{var s,a;const r={},o=n;if(r.token=G(o),o.args[0]instanceof re){const l=pe(o.args[0]).getValue();r.name=ye((a=(s=l[A.Name])==null?void 0:s.at(0))==null?void 0:a.value).unwrap_or(void 0)}return r.expression=o.callee.value.value,r})),[]}registerInlineRefToEnv(t,n,s,a){const r=jc(t.symbol,n);if(this.env.refIds[r])return[new E(v.CIRCULAR_REF,"References with same endpoints exist",a),new E(v.CIRCULAR_REF,"References with same endpoints exist",this.env.refIds[r])];const o=Cc(s.relation);return this.env.refIds[r]=a,this.env.ref.set(a,{name:null,schemaName:null,token:s.token,endpoints:[{...s,relation:o[1]},{schemaName:this.table.schemaName,tableName:this.table.name,fieldNames:[Fe(t.callee).unwrap()],token:G(t),relation:o[0]}]}),[]}}class MN{constructor(t,n){this.declarationNode=t,this.env=n,this.note={name:void 0,content:void 0,token:void 0}}interpret(){return this.note.token=G(this.declarationNode),this.env.notes.set(this.declarationNode,this.note),[...this.interpretName(this.declarationNode.name),...this.interpretSettingList(this.declarationNode.attributeList),...this.interpretBody(this.declarationNode.body)]}interpretName(t){const{name:n}=Ln(t);return this.note.name=n,[]}interpretSettingList(t){var n,s,a;const r=pe(t).getValue();return this.note.headerColor=(n=r.headercolor)!=null&&n.length?Bs((a=(s=r.headercolor)==null?void 0:s.at(0))==null?void 0:a.value):void 0,[]}interpretBody(t){const[n,s]=dt(t.body,a=>a instanceof Y);return n.length!==1||s.length>0?[new E(v.INVALID_NOTE,"Invalid note syntax",t)]:[...this.interpretNote(n[0])]}interpretNote(t){const n=nc(t,"callee.expression.literal.value","");return this.note.content=mt(n),[]}}class Sc{constructor(t,n){this.declarationNode=t,this.env=n,this.container=this.declarationNode.parent instanceof Z?this.env.tables.get(this.declarationNode.parent):void 0,this.ref={}}interpret(){return this.ref.token=G(this.declarationNode),this.env.ref.set(this.declarationNode,this.ref),[...this.interpretName(this.declarationNode.name),...this.interpretBody(this.declarationNode.body)]}interpretName(t){const n=[],s=$e(this.declarationNode.name).unwrap_or([]);return this.ref.name=s.pop()||null,s.length>1&&n.push(new E(v.UNSUPPORTED,"Nested schema is not supported",this.declarationNode.name)),this.ref.schemaName=s.join(".")||null,n}interpretBody(t){return t instanceof Y?this.interpretField(t):this.interpretField(t.body[0])}interpretField(t){var n,s,a,r,o,l,d;const u=t.callee.op.value,{leftExpression:c,rightExpression:h}=t.callee,p=ha(c),b=ha(h);if(ii(p,b))return[new E(v.SAME_ENDPOINT,"Two endpoints are the same",t)];const x=jc(p,b);if(this.env.refIds[x])return[new E(v.CIRCULAR_REF,"References with same endpoints exist",this.declarationNode),new E(v.CIRCULAR_REF,"References with same endpoints exist",this.env.refIds[x])];if(t.args[0]){const N=pe(t.args[0]).getValue(),_=(s=(n=N.delete)==null?void 0:n.at(0))==null?void 0:s.value;this.ref.onDelete=_ instanceof ht?Bn(_).unwrap_or(void 0):Fe(_).unwrap_or(void 0);const y=(r=(a=N.update)==null?void 0:a.at(0))==null?void 0:r.value;this.ref.onUpdate=y instanceof ht?Bn(y).unwrap_or(void 0):Fe(y).unwrap_or(void 0),this.ref.color=(o=N.color)!=null&&o.length?Bs((d=(l=N.color)==null?void 0:l.at(0))==null?void 0:d.value):void 0}const m=Cc(u);return this.ref.endpoints=[{...Oo(c,this.container),relation:m[0],token:G(c)},{...Oo(h,this.container),relation:m[1],token:G(h)}],this.env.refIds[x]=this.declarationNode,[]}}class Dc{constructor(t,n){this.declarationNode=t,this.env=n,this.tableGroup={tables:[]}}interpret(){const t=[];return this.tableGroup.token=G(this.declarationNode),this.env.tableGroups.set(this.declarationNode,this.tableGroup),t.push(...this.interpretName(this.declarationNode.name),...this.interpretSettingList(this.declarationNode.attributeList),...this.interpretBody(this.declarationNode.body)),t}interpretName(t){const n=[],{name:s,schemaName:a}=Ln(t);return a.length>=2&&(this.tableGroup.name=s,this.tableGroup.schemaName=a.join("."),n.push(new E(v.UNSUPPORTED,"Nested schema is not supported",this.declarationNode.name))),this.tableGroup.name=s,this.tableGroup.schemaName=a[0]||null,n}interpretBody(t){const[n,s]=dt(t.body,a=>a instanceof Y);return[...this.interpretFields(n),...this.interpretSubElements(s)]}interpretSubElements(t){return t.flatMap(n=>{var s;return((s=n.type)==null?void 0:s.value.toLowerCase())==="note"&&(this.tableGroup.note={value:ye(n.body instanceof Nt?n.body.body[0].callee:n.body.callee).map(mt).unwrap(),token:G(n)}),[]})}interpretFields(t){const n=[];return this.tableGroup.tables=t.map(s=>{const a=$e(s.callee).unwrap();a.length>2&&n.push(new E(v.UNSUPPORTED,"Nested schema is not supported",s));const r=Vt(s.callee).unwrap().pop().referee.id;if(this.env.groupOfTable[r]){const o=this.env.groupOfTable[r],{schemaName:l,name:d}=this.env.tableGroups.get(o),u=l?`${l}.${d}`:d;n.push(new E(v.TABLE_REAPPEAR_IN_TABLEGROUP,`Table "${a.join(".")}" already appears in group "${u}"`,s))}else this.env.groupOfTable[r]=this.declarationNode;return{name:a.pop(),schemaName:a.join(".")}}),n}interpretSettingList(t){var n,s,a;const r=pe(t).getValue();this.tableGroup.color=(n=r.color)!=null&&n.length?Bs((a=(s=r.color)==null?void 0:s.at(0))==null?void 0:a.value):void 0;const[o]=r.note||[];return this.tableGroup.note=o&&{value:ye(o?.value).map(mt).unwrap(),token:G(o)},[]}}class Rc{constructor(t,n){this.declarationNode=t,this.env=n,this.enum={values:[]}}interpret(){return this.enum.token=G(this.declarationNode),this.env.enums.set(this.declarationNode,this.enum),[...this.interpretName(this.declarationNode.name),...this.interpretBody(this.declarationNode.body)]}interpretName(t){const{name:n,schemaName:s}=Ln(t);return s.length>1?(this.enum.name=n,this.enum.schemaName=s.join("."),[new E(v.UNSUPPORTED,"Nested schema is not supported",t)]):(this.enum.name=n,this.enum.schemaName=s.length?s[0]:null,[])}interpretBody(t){return t.body.flatMap(n=>{var s;const a=n,r={};r.token=G(a),r.name=Fe(a.callee).unwrap();const o=(s=pe(a.args[0]).getValue().note)==null?void 0:s.at(0);return r.note=o&&{value:ye(o.value).map(mt).unwrap(),token:G(o)},this.enum.values.push(r),[]})}}class Mc{constructor(t,n){this.declarationNode=t,this.env=n,this.tablePartial={name:void 0,fields:[],token:void 0,indexes:[],checks:[]},this.pkColumns=[]}interpret(){this.tablePartial.token=G(this.declarationNode),this.env.tablePartials.set(this.declarationNode,this.tablePartial);const t=[...this.interpretName(this.declarationNode.name),...this.interpretSettingList(this.declarationNode.attributeList),...this.interpretBody(this.declarationNode.body)];return this.pkColumns.length>=2&&(this.tablePartial.indexes.push({columns:this.pkColumns.map(({name:n,token:s})=>({value:n,type:"column",token:s})),token:{start:{offset:-1,line:-1,column:-1},end:{offset:-1,line:-1,column:-1}},pk:!0}),this.pkColumns.forEach(n=>{n.pk=!1})),t}interpretName(t){const{name:n}=Ln(t);return this.tablePartial.name=n,[]}interpretSettingList(t){const n=pe(t).getValue(),s=Tv(n[A.HeaderColor]);this.tablePartial.headerColor=s?Bs(s.value):void 0;const[a]=n[A.Note]||[];return this.tablePartial.note=a&&{value:ye(a?.value).map(mt).unwrap(),token:G(a)},[]}interpretBody(t){const[n,s]=dt(t.body,a=>a instanceof Y);return[...this.interpretFields(n),...this.interpretSubElements(s)]}interpretSubElements(t){return t.flatMap(n=>{var s;switch((s=n.type)==null?void 0:s.value.toLowerCase()){case F.Note:return this.tablePartial.note={value:ye(n.body instanceof Nt?n.body.body[0].callee:n.body.callee).map(mt).unwrap(),token:G(n)},[];case F.Indexes:return this.interpretIndexes(n);case F.Check:return this.interpretChecks(n);default:return[]}})}interpretFields(t){return t.flatMap(n=>this.interpretColumn(n))}interpretColumn(t){var n,s,a,r,o,l,d,u,c;const h=[],p={};p.name=Ae(t.callee).unwrap();const b=kc(t.args[0]);p.type=b.getValue(),h.push(...b.getErrors()),p.token=G(t),p.inline_refs=[];const x=t.args.slice(1);if(ie(x)instanceof re){const m=pe(x.pop()).getValue();p.pk=!!((n=m[A.PK])!=null&&n.length)||!!((s=m[A.PrimaryKey])!=null&&s.length),p.increment=!!((a=m[A.Increment])!=null&&a.length),p.unique=!!((r=m[A.Unique])!=null&&r.length),p.not_null=(o=m[A.NotNull])!=null&&o.length?!0:(l=m[A.Null])!=null&&l.length?!1:void 0,p.dbdefault=Lc((u=(d=m[A.Default])==null?void 0:d.at(0))==null?void 0:u.value);const N=(c=m[A.Note])==null?void 0:c.at(0);p.note=N&&{value:ye(N.value).map(mt).unwrap(),token:G(N)};const _=m[A.Ref]||[];p.inline_refs=_.flatMap(g=>{const[w]=ha(g.value.expression);if(ii(w,t.symbol))return h.push(new E(v.SAME_ENDPOINT,"Two endpoints are the same",g)),[];const I=g.value.op,L=$e(g.value.expression).unwrap();let k;if(L.length===2){const[C,j]=L;k={schemaName:null,tableName:C,fieldNames:[j],relation:I.value,token:G(g)}}else if(L.length===3){const[C,j,O]=L;k={schemaName:C,tableName:j,fieldNames:[O],relation:I.value,token:G(g)}}else{h.push(new E(v.UNSUPPORTED,"Unsupported",g));const C=L.pop(),j=L.pop();k={schemaName:L.join("."),tableName:j,fieldNames:[C],relation:I.value,token:G(g)}}return k});const y=m[A.Check]||[];p.checks=y.map(g=>{const w=G(g),I=g.value.value.value;return{token:w,expression:I}})}return p.pk||(p.pk=x.some(m=>Fe(m).unwrap().toLowerCase()==="pk")),p.unique||(p.unique=x.some(m=>Fe(m).unwrap().toLowerCase()==="unique")),this.tablePartial.fields.push(p),p.pk&&this.pkColumns.push(p),h}interpretIndexes(t){return this.tablePartial.indexes.push(...t.body.body.map(n=>{var s,a,r,o,l,d,u;const c={columns:[]},h=n;c.token=G(h);const p=[h.callee,...h.args];if(ie(p)instanceof re){const b=pe(p.pop()).getValue();c.pk=!!((s=b[A.PK])!=null&&s.length),c.unique=!!((a=b[A.Unique])!=null&&a.length),c.name=ye((o=(r=b[A.Name])==null?void 0:r.at(0))==null?void 0:o.value).unwrap_or(void 0);const x=(l=b[A.Note])==null?void 0:l.at(0);c.note=x&&{value:ye(x.value).unwrap(),token:G(x)},c.type=Fe((u=(d=b[A.Type])==null?void 0:d.at(0))==null?void 0:u.value).unwrap_or(void 0)}return p.flatMap(b=>{if(!(b instanceof ct))return b;const x=[];let m=b;for(;m instanceof ct;)x.push(m.argumentList),m=m.callee;return x.push(m),x}).forEach(b=>{const{functional:x,nonFunctional:m}=ua(b).unwrap();c.columns.push(...x.map(N=>({value:N.value.value,type:"expression",token:G(N)})),...m.map(N=>({value:Ae(N).unwrap(),type:"column",token:G(N)})))}),c})),[]}interpretChecks(t){return this.tablePartial.checks.push(...t.body.body.map(n=>{var s,a;const r={},o=n;if(r.token=G(o),o.args[0]instanceof re){const l=pe(o.args[0]).getValue();r.name=ye((a=(s=l[A.Name])==null?void 0:s.at(0))==null?void 0:a.value).unwrap_or(void 0)}return r.expression=o.callee.value.value,r})),[]}}class ON{constructor(t,n){this.declarationNode=t,this.env=n,this.project={enums:[],refs:[],tableGroups:[],tables:[],tablePartials:[]}}interpret(){return this.env.project.set(this.declarationNode,this.project),this.project.token=G(this.declarationNode),[...this.interpretName(this.declarationNode.name),...this.interpretBody(this.declarationNode.body)]}interpretName(t){if(!t)return this.project.name=null,[];const{name:n}=Ln(t);return this.project.name=n,[]}interpretBody(t){return t.body.flatMap(n=>{var s;const a=n;switch((s=a.type)==null?void 0:s.value.toLowerCase()){case"table":{const r=new Ac(a,this.env).interpret();return this.project.tables.push(this.env.tables.get(a)),r}case"ref":{const r=new Sc(a,this.env).interpret();return this.project.refs.push(this.env.ref.get(a)),r}case"tablegroup":{const r=new Dc(a,this.env).interpret();return this.project.tableGroups.push(this.env.tableGroups.get(a)),r}case"enum":{const r=new Rc(a,this.env).interpret();return this.project.enums.push(this.env.enums.get(a)),r}case"note":return this.project.note={value:ye(a.body instanceof Nt?a.body.body[0].callee:a.body.callee).map(mt).unwrap(),token:G(a)},[];case"tablepartial":{const r=new Mc(a,this.env).interpret();return this.project.tablePartials.push(this.env.tablePartials.get(a)),r}default:return this.project[a.type.value.toLowerCase()]=ye(a.body.callee).unwrap(),[]}})}}function PN(e){return{schemas:[],tables:Array.from(e.tables.values()),notes:Array.from(e.notes.values()),refs:Array.from(e.ref.values()),enums:Array.from(e.enums.values()),tableGroups:Array.from(e.tableGroups.values()),aliases:e.aliases,project:Array.from(e.project.values())[0]||{},tablePartials:Array.from(e.tablePartials.values())}}class FN{constructor(t){this.ast=t,this.env={schema:[],tables:new Map,notes:new Map,refIds:{},ref:new Map,enums:new Map,tableGroups:new Map,groupOfTable:{},aliases:[],project:new Map,tablePartials:new Map}}interpret(){const t=this.ast.body.flatMap(n=>{switch(nn(n).unwrap_or(void 0)){case F.Table:return new Ac(n,this.env).interpret();case F.Note:return new MN(n,this.env).interpret();case F.Ref:return new Sc(n,this.env).interpret();case F.TableGroup:return new Dc(n,this.env).interpret();case F.TablePartial:return new Mc(n,this.env).interpret();case F.Enum:return new Rc(n,this.env).interpret();case F.Project:return new ON(n,this.env).interpret();default:return[]}});return new et(PN(this.env),t)}}var J=(e=>(e[e.Function=1]="Function",e[e.Constructor=2]="Constructor",e[e.Field=3]="Field",e[e.Variable=4]="Variable",e[e.Class=5]="Class",e[e.Struct=6]="Struct",e[e.Interface=7]="Interface",e[e.Module=8]="Module",e[e.Property=9]="Property",e[e.Event=10]="Event",e[e.Operator=11]="Operator",e[e.Unit=12]="Unit",e[e.Value=13]="Value",e[e.Constant=14]="Constant",e[e.Enum=15]="Enum",e[e.EnumMember=16]="EnumMember",e[e.Keyword=17]="Keyword",e[e.Text=18]="Text",e[e.Color=19]="Color",e[e.File=20]="File",e[e.Reference=21]="Reference",e[e.Customcolor=22]="Customcolor",e[e.Folder=23]="Folder",e[e.TypeParameter=24]="TypeParameter",e[e.User=25]="User",e[e.Issue=26]="Issue",e[e.Snippet=27]="Snippet",e))(J||{}),ce=(e=>(e[e.None=0]="None",e[e.KeepWhitespace=1]="KeepWhitespace",e[e.InsertAsSnippet=4]="InsertAsSnippet",e))(ce||{});function js(e){switch(e){case M.Schema:return J.Module;case M.Table:case M.TablePartial:return J.Class;case M.Column:case M.TableGroupField:return J.Field;case M.Enum:return J.Enum;case M.EnumField:return J.EnumMember;case M.TableGroup:return J.Struct;default:return J.Text}}function fa(e,t){if(!e||Cr(e))return!1;for(const n of e.trailingTrivia){if(n.start>t)break;if(n.kind===T.NEWLINE&&n.end<=t)return!1}return!0}function Se(){return{suggestions:[]}}function pa(e){return{...e,suggestions:e.suggestions.map(t=>({...t,insertText:` ${t.insertText}`}))}}function Oa(e){return{...e,suggestions:e.suggestions.map(t=>({...t,insertText:t.insertText.split("").every(Sa)?t.insertText:`"${t.insertText}"`}))}}function oi(e,t){return e.getOffsetAt(t)}class Oc{constructor(t,n=[]){this.compiler=t,this.triggerCharacters=n}provideCompletionItems(t,n){var s,a;const r=oi(t,n),o=this.compiler.token.flatStream(),{token:l,index:d}=this.compiler.container.token(r),u=d===void 0?o[0]:o[d+1];if([...l?.trailingTrivia||[],...l?.leadingTrivia||[],...u?.leadingTrivia||[]].find(p=>Lv(p)&&Ns(r,p)))return Se();if(d===void 0)return $o();if([T.STRING_LITERAL,T.QUOTED_STRING].includes(l.kind)&&Ns(r,l))return Se();const c=this.compiler.container.element(r);if(this.compiler.container.scopeKind(r)===ae.TOPLEVEL||c instanceof Z&&c.type&&c.type.start<=r&&c.type.end>=r)return $o();const h=[...this.compiler.container.stack(r)].reverse();for(const p of h)if(p instanceof ot)switch((s=p.op)==null?void 0:s.value){case">":case"<":case"<>":case"-":return Po(this.compiler,r,p)}else if(p instanceof kt)switch((a=p.op)==null?void 0:a.value){case">":case"<":case"<>":case"-":return Po(this.compiler,r,p);case".":return Pc(this.compiler,r,p)}else{if(p instanceof ft)return Fo(this.compiler,r,p);if(p instanceof re)return Fo(this.compiler,r,p);if(p instanceof At)return BN(this.compiler,r);if(p instanceof yn)return UN(this.compiler,r);if(p instanceof Y)return Bo(this.compiler,r,p);if(p instanceof Z&&(p.bodyColon&&r>=p.bodyColon.end||p.body&&Ns(r,p.body)))return Bo(this.compiler,r,void 0)}return Se()}}function UN(e,t){const n=e.container.element(t);return ls(e,t,n,[M.TablePartial])}function Po(e,t,n){const s=e.container.scopeKind(t);if([ae.REF,ae.TABLE,ae.TABLEPARTIAL].includes(s)){const a=ls(e,t,e.container.element(t),[M.Table,M.Schema,M.Column]);return fa(n.op,t)?pa(a):a}return Se()}function ls(e,t,n,s){var a;if(n===void 0)return Se();let r=n;const o={suggestions:[]};for(;r;){if((a=r?.symbol)!=null&&a.symbolTable){const{symbol:l}=r;o.suggestions.push(...e.symbol.members(l).filter(({kind:d})=>s.includes(d)).map(({name:d,kind:u})=>({label:d,insertText:d,insertTextRules:ce.KeepWhitespace,kind:js(u),sortText:js(u).toString().padStart(2,"0"),range:void 0})))}r=r instanceof Z?r.parent:void 0}return Oa(o)}function BN(e,t){var n;switch(e.container.scopeKind(t)){case ae.INDEXES:return Uc(e,t);case ae.REF:{const s=[...e.container.stack(t)];for(;s.length>0;){const a=s.pop();if(a instanceof kt&&((n=a.op)==null?void 0:n.value)===".")return Pc(e,t,a)}}return Fc(e,t)}return Se()}function Fo(e,t,n){const{token:s}=e.container.token(t);if([T.COMMA,T.LBRACKET].includes(s?.kind)){const a=Uo(e,t);return s?.kind===T.COMMA&&fa(s,t)?pa(a):a}if(n.name&&n.name.start<=t&&n.name.end>=t)return Uo(e,t);if(n.name instanceof ht){const a=$N(e,t,Bn(n.name).unwrap_or(""));return s?.kind===T.COLON&&fa(s,t)?pa(a):a}return Se()}function Uo(e,t){const n=e.container.element(t);if(n instanceof it)return Se();const s=e.container.scopeKind(t);if(n.body&&!Ns(t,n.body)){let a;switch(s){case ae.TABLE:case ae.TABLEPARTIAL:a=[A.HeaderColor,A.Note];break;case ae.TABLEGROUP:a=[A.Color,A.Note];break;default:a=[]}return{suggestions:a.map(r=>({label:r,insertText:`${r}: `,kind:J.Field,insertTextRules:ce.KeepWhitespace,range:void 0}))}}switch(s){case ae.TABLE:case ae.TABLEPARTIAL:return{suggestions:[...[A.PK,A.PrimaryKey,A.Null,A.NotNull,A.Increment,A.Unique].map(a=>({label:a,insertText:a,kind:J.Property,insertTextRules:ce.KeepWhitespace,range:void 0})),...[A.Ref,A.Default,A.Note,A.Check].map(a=>({label:a,insertText:`${a}: `,kind:J.Property,insertTextRules:ce.KeepWhitespace,range:void 0}))]};case ae.ENUM:return{suggestions:[...[A.Note].map(a=>({label:a,insertText:`${a}: `,kind:J.Property,insertTextRules:ce.KeepWhitespace,range:void 0}))]};case ae.INDEXES:return{suggestions:[...[A.Unique,A.PK].map(a=>({label:a,insertText:a,insertTextRules:ce.KeepWhitespace,kind:J.Property,range:void 0})),...[A.Note,A.Name,A.Type].map(a=>({label:a,insertText:`${a}: `,kind:J.Property,insertTextRules:ce.KeepWhitespace,range:void 0}))]};case ae.REF:return{suggestions:[A.Update,A.Delete,A.Color].map(a=>({label:a,insertText:`${a}: `,kind:J.Property,insertTextRules:ce.KeepWhitespace,range:void 0}))};case ae.CHECKS:return{suggestions:[A.Name].map(a=>({label:a,insertText:`${a}: `,kind:J.Property,insertTextRules:ce.KeepWhitespace,range:void 0}))}}return Se()}function $N(e,t,n){switch(n?.toLowerCase()){case"update":case"delete":return{suggestions:["cascade","set default","set null","restrict"].map(s=>({label:s,insertText:s,kind:J.Value,insertTextRules:ce.KeepWhitespace,range:void 0}))};case"type":return{suggestions:["btree","hash"].map(s=>({label:s,insertText:`${s}`,kind:J.Value,insertTextRules:ce.KeepWhitespace,range:void 0}))};case"default":return ls(e,t,e.container.element(t),[M.Schema,M.Enum])}return Se()}function Pc(e,t,n){const s=Vt(n).unwrap_or([]);if(s.pop(),s.some(r=>!Ie(r)))return Se();const a=s.map(r=>Fe(r).unwrap());return Oa({suggestions:e.symbol.ofName({nameStack:a,owner:e.container.element(t)}).flatMap(({symbol:r})=>e.symbol.members(r)).map(({kind:r,name:o})=>({label:o,insertText:o,kind:js(r),range:void 0}))})}function Bo(e,t,n){var s;switch(e.container.scopeKind(t)){case ae.TABLE:case ae.TABLEPARTIAL:return GN(e,t,n);case ae.PROJECT:return KN(e,t,n);case ae.INDEXES:return XN(e,t);case ae.ENUM:return VN(e,t,n);case ae.REF:{const a=Fc(e,t);return((s=e.container.token(t).token)==null?void 0:s.kind)===T.COLON&&fa(e.container.token(t).token,t)?pa(a):a}case ae.TABLEGROUP:return zN(e);default:return Se()}}function $o(){return{suggestions:["Table","TableGroup","Enum","Project","Ref","TablePartial"].map(e=>({label:e,insertText:e,insertTextRules:ce.KeepWhitespace,kind:J.Keyword,range:void 0}))}}function VN(e,t,n){return n!=null&&n.callee&&li(t,n)===1?ls(e,t,e.container.element(t),[M.Schema,M.Table,M.Column]):Se()}function GN(e,t,n){const s=["Note","indexes","checks"];if(!(n!=null&&n.callee))return{suggestions:s.map(r=>({label:r,insertText:r,insertTextRules:ce.KeepWhitespace,kind:J.Keyword,range:void 0}))};const a=li(t,n);return a===0?{suggestions:s.map(r=>({label:r,insertText:r,insertTextRules:ce.KeepWhitespace,kind:J.Keyword,range:void 0}))}:a===1?WN(e,t):Se()}function KN(e,t,n){const s=["Table","TableGroup","Enum","Note","Ref","TablePartial"];return n!=null&&n.callee?li(t,n)===0?{suggestions:s.map(a=>({label:a,insertText:a,insertTextRules:ce.KeepWhitespace,kind:J.Keyword,range:void 0}))}:Se():{suggestions:s.map(a=>({label:a,insertText:a,insertTextRules:ce.KeepWhitespace,kind:J.Keyword,range:void 0}))}}function Fc(e,t){return ls(e,t,e.container.element(t),[M.Schema,M.Table,M.Column])}function zN(e){return{suggestions:[...Oa({suggestions:[...e.parse.publicSymbolTable().entries()].flatMap(([t])=>{const n=pt(t).unwrap_or(void 0);if(n===void 0)return[];const{kind:s,name:a}=n;return s!==M.Table&&s!==M.Schema?[]:{label:a,insertText:a,insertTextRules:ce.KeepWhitespace,kind:js(s),range:void 0}})}).suggestions,...["Note"].map(t=>({label:t,insertText:t,insertTextRules:ce.KeepWhitespace,kind:J.Keyword,range:void 0}))]}}function XN(e,t){return Uc(e,t)}function WN(e,t){return{suggestions:[...["integer","int","tinyint","smallint","mediumint","bigint","bit","bool","binary","varbinary","logical","char","nchar","varchar","varchar2","nvarchar","nvarchar2","binary_float","binary_double","float","double","decimal","dec","real","money","smallmoney","enum","tinyblob","tinytext","blob","text","mediumblob","mediumtext","longblob","longtext","ntext","set","inet6","uuid","image","date","time","datetime","datetime2","timestamp","year","smalldatetime","datetimeoffset","XML","sql_variant","uniqueidentifier","CURSOR","BFILE","CLOB","NCLOB","RAW"].map(n=>({label:n,insertText:n,insertTextRules:ce.KeepWhitespace,kind:J.TypeParameter,sortText:J.TypeParameter.toString().padStart(2,"0"),range:void 0})),...ls(e,t,e.container.element(t),[M.Enum,M.Schema]).suggestions]}}function Uc(e,t){const n=e.container.element(t),s=n?.parent;if(!(s?.symbol instanceof xc))return Se();const{symbolTable:a}=s.symbol;return Oa({suggestions:[...a.entries()].flatMap(([r])=>{const o=pt(r).unwrap_or(void 0);if(o===void 0)return[];const{name:l}=o;return{label:l,insertText:l,insertTextRules:ce.KeepWhitespace,kind:js(M.Column),range:void 0}})})}function li(e,t){if(!t.callee)return-1;const n=[t.callee,...t.args],s=n.findIndex(a=>e<=a.end);return s===-1?n.length:s}class Bc{constructor(t){this.compiler=t}provideDefinition(t,n){var s,a;const{uri:r}=t,o=oi(t,n),l=[...this.compiler.container.stack(o)];for(;l.length!==0;){const d=l.pop();if(!(d!=null&&d.referee))continue;let u;if((s=d.referee)!=null&&s.declaration&&[gn.PRIMARY_EXPRESSION,gn.VARIABLE,gn.PARTIAL_INJECTION].includes(d?.kind)?{declaration:u}=d.referee:(a=d.referee)!=null&&a.injectorDeclaration&&(u=d.referee.injectorDeclaration),u){const{startPos:c,endPos:h}=u;return[{range:{startColumn:c.column+1,startLineNumber:c.line+1,endColumn:h.column+1,endLineNumber:h.line+1},uri:r}]}}return[]}}class $c{constructor(t){this.compiler=t}provideReferences(t,n){const{uri:s}=t,a=oi(t,n),r=[...this.compiler.container.stack(a)];for(;r.length!==0;){const o=r.pop();if(o&&[gn.ELEMENT_DECLARATION,gn.FUNCTION_APPLICATION,gn.PRIMARY_EXPRESSION].includes(o?.kind)){const{symbol:l}=o;if(l!=null&&l.references.length)return l.references.map(({startPos:d,endPos:u})=>({range:{startColumn:d.column+1,startLineNumber:d.line+1,endColumn:u.column+1,endLineNumber:u.line+1},uri:s}))}}return[]}}const qN=Object.freeze(Object.defineProperty({__proto__:null,CompletionItemInsertTextRule:ce,CompletionItemKind:J,DBMLCompletionItemProvider:Oc,DBMLDefinitionProvider:Bc,DBMLReferencesProvider:$c},Symbol.toStringTag,{value:"Module"}));var ae=(e=>(e[e.TABLE=0]="TABLE",e[e.ENUM=1]="ENUM",e[e.TABLEGROUP=2]="TABLEGROUP",e[e.INDEXES=3]="INDEXES",e[e.NOTE=4]="NOTE",e[e.REF=5]="REF",e[e.PROJECT=6]="PROJECT",e[e.CUSTOM=7]="CUSTOM",e[e.TOPLEVEL=8]="TOPLEVEL",e[e.TABLEPARTIAL=9]="TABLEPARTIAL",e[e.CHECKS=10]="CHECKS",e))(ae||{});class HN{constructor(){this.source="",this.cache=new Array(16).fill(null),this.nodeIdGenerator=new kv,this.symbolIdGenerator=new Mv,this.token={invalidStream:this.createQuery(6,()=>this.parse.tokens().filter(vc)),flatStream:this.createQuery(7,()=>this.parse.tokens().flatMap(t=>[...t.leadingInvalid,t,...t.trailingInvalid]))},this.parse={source:()=>this.source,_:this.createQuery(0,()=>{const t=new Yv(this.source).lex().chain(n=>new Zv(n,this.nodeIdGenerator).parse()).chain(({ast:n,tokens:s})=>new RN(n,this.symbolIdGenerator).analyze().map(()=>({ast:n,tokens:s})));return t.getErrors().length>0?t:t.chain(({ast:n,tokens:s})=>new FN(n).interpret().map(a=>({ast:n,tokens:s,rawDb:a})))}),ast:this.createQuery(1,()=>this.parse._().getValue().ast),errors:this.createQuery(2,()=>this.parse._().getErrors()),tokens:this.createQuery(4,()=>this.parse._().getValue().tokens),rawDb:this.createQuery(3,()=>this.parse._().getValue().rawDb),publicSymbolTable:this.createQuery(5,()=>this.parse._().getValue().ast.symbol.symbolTable)},this.container={stack:this.createQuery(10,t=>{const n=this.token.flatStream(),{index:s,token:a}=this.container.token(t),r=s===void 0?-1:_v(n,u=>!u.isInvalid,s);if(r===-1)return[this.parse.ast()];const o=n[r].start;let l=this.parse.ast();const d=[l];for(;;){const u=Hv(l).find(c=>Ns(o,c));if(u===void 0||u instanceof Ze)break;d.push(u),l=u}if(a?.kind===T.COLON)return d;for(;d.length>0;){let u=!1;const c=ie(d);if(c instanceof Y){const h=this.parse.source();for(let p=c.end;p<t;p+=1)h[p]===`
`&&(d.pop(),u=!0)}else c instanceof ot||c instanceof kt?this.container.token(t).token!==c.op&&(d.pop(),u=!0):c instanceof re?c.listCloseBracket&&c.end<=t&&(d.pop(),u=!0):c instanceof At?c.tupleCloseParen&&c.end<=t&&(d.pop(),u=!0):c instanceof Nt?c.blockCloseBrace&&c.end<=t&&(d.pop(),u=!0):c instanceof ht||c.end<t&&(d.pop(),u=!0);if(u){const h=ie(d);h instanceof Z&&h.end<=t&&d.pop()}if(!u)break}return d}),token:this.createQuery(11,t=>{const n=this.token.flatStream().findIndex(s=>s.start>=t);return n===void 0?{token:void 0,index:void 0}:n<=0?{token:void 0,index:void 0}:{token:this.token.flatStream()[n-1],index:n-1}}),element:this.createQuery(12,t=>{const n=this.container.stack(t);for(let s=n.length-1;s>=0;s-=1)if(n[s]instanceof Z)return n[s];return this.parse.ast()}),scope:this.createQuery(14,t=>{var n,s;return(s=(n=this.container.element(t))==null?void 0:n.symbol)==null?void 0:s.symbolTable}),scopeKind:this.createQuery(15,t=>{var n;if(this.container.element(t)instanceof it)return 8;switch((n=this.container.element(t).type)==null?void 0:n.value.toLowerCase()){case"table":return 0;case"enum":return 1;case"ref":return 5;case"tablegroup":return 2;case"indexes":return 3;case"note":return 4;case"project":return 6;case"tablepartial":return 9;case"checks":return 10;default:return 7}})},this.symbol={ofName:this.createQuery(8,({nameStack:t,owner:n=this.parse.ast()})=>{var s;if(t.length===0)return[];const a=[];for(let r=n;r;r=r instanceof Z?r.parent:void 0){if(!((s=r.symbol)!=null&&s.symbolTable))continue;const{symbolTable:o}=r.symbol;let l=[o],d=[];for(const u of t)d=l.flatMap(c=>Gv(u).flatMap(h=>{const p=c.get(h),b=pt(h).unwrap_or(void 0);return!p||!b?[]:{...b,symbol:p}})),l=d.flatMap(c=>c.symbol.symbolTable?c.symbol.symbolTable:[]);a.push(...d)}return a},({nameStack:t,owner:n})=>`${t.join(".")}@${n.id}`),members:this.createQuery(9,t=>t.symbolTable?[...t.symbolTable.entries()].map(([n,s])=>({...pt(n).unwrap(),symbol:s})):[])}}createQuery(t,n,s){return a=>{const r=this.cache[t],o=a&&s?s(a):a;if(r!==null){if(!(r instanceof Map))return r;if(r.has(o))return r.get(o)}const l=n(a);return a!==void 0?r instanceof Map?r.set(o,l):(this.cache[t]=new Map,this.cache[t].set(o,l)):this.cache[t]=l,l}}setSource(t){this.source=t,this.cache=new Array(16).fill(null),this.nodeIdGenerator.reset(),this.symbolIdGenerator.reset()}initMonacoServices(){return{definitionProvider:new Bc(this),referenceProvider:new $c(this),autocompletionProvider:new Oc(this)}}}const YN=[" ","[",":",".",">","<","-"];function QN(e,t=""){const n=new HN;t&&n.setSource(t);const s=new qN.DBMLCompletionItemProvider(n,YN),a=e.languages.registerCompletionItemProvider("dbml",s);return{dispose:()=>a.dispose(),updateSource:r=>{n.setSource(r)}}}const JN=e=>e==="dark"?"dbml-dark":"dbml-light",ZN=()=>{const{currentDiagram:e,updateDiagramData:t,databaseType:n,readonly:s}=H(),{effectiveTheme:a}=Os(),{toast:r}=ll(),[o,l]=f.useState("inline"),[d,u]=f.useState(!0),[c,h]=f.useState(""),[p,b]=f.useState(""),x=f.useRef(!0),[m,N]=f.useState(!1),_=f.useRef(),y=f.useRef(),g=f.useRef(),w=f.useCallback((W,ee)=>{_.current=W,y.current=W.createDecorationsCollection(),he.current&&he.current.dispose();const fe=W.onDidAttemptReadOnlyEdit(()=>{ze.current&&clearTimeout(ze.current),N(!1),requestAnimationFrame(()=>{N(!0),ze.current=setTimeout(()=>{N(!1)},600)})});he.current=fe,g.current?.dispose(),g.current=QN(ee,W.getValue())},[]),I=f.useMemo(()=>o==="inline"?p:c,[o,p,c]),L=f.useCallback(()=>{l(W=>W==="inline"?"standard":"inline")},[]),[k,C]=f.useState(!1),[j,O]=f.useState(""),V=f.useRef(j),{calculateDiff:D,originalDiagram:$,resetDiff:B,hasDiff:se,newDiagram:Te}=yu(),{loadDiagramFromData:de}=H(),[tt,Me]=f.useState(),[Et,Rt]=f.useState(),{t:ue}=Q(),{hideLoader:Be,showLoader:nt}=iu(),ze=f.useRef(),he=f.useRef(),Oe=f.useRef(e),Pe=f.useRef($);f.useEffect(()=>{Oe.current=e},[e]),f.useEffect(()=>{Pe.current=$},[$]),f.useEffect(()=>{if(k)return;let W=!1;const ee=new Set;if(e.tables?.forEach(fe=>{fe.fields.forEach(yt=>{yt.name===""&&(W=!0,ee.add(fe.name))})}),W){const fe=Array.from(ee).join(", ");Rt(`Some fields had empty names in tables: [${fe}] and were excluded from the DBML export.`)}},[e.tables,ue,k]),f.useEffect(()=>{if(k){u(!1);return}Me(void 0),Ni(y.current);const W=async()=>{u(!0);const ee=ym(e);ee.error&&r({title:"DBML Export Error",description:`Could not generate DBML: ${ee.error.substring(0,100)}${ee.error.length>100?"...":""}`,variant:"destructive"}),h(ee.standardDbml),b(ee.inlineDbml),u(!1)};setTimeout(()=>W(),0)},[e,r,k]),f.useEffect(()=>{!d&&I&&!k&&(O(I),V.current=I)},[I,d,k]);const Xe=f.useCallback(async W=>{Ni(y.current),Me(void 0);try{const ee=await ou(W,{databaseType:n}),fe=Pe.current??Oe.current,yt={...fe,tables:ee.tables,relationships:ee.relationships,customTypes:ee.customTypes},Vs=Rm({sourceDiagram:fe,targetDiagram:yt});Pe.current&&(B(),de(Pe.current)),D({diagram:fe,newDiagram:Vs,options:{summaryOnly:!0}})}catch(ee){const fe=lu(ee);fe&&(cu({error:fe,model:_.current?.getModel(),editorDecorationsCollection:y.current}),Me(ue("import_dbml_dialog.error.description")+` (1 error found - in line ${fe.line})`))}},[ue,B,de,D,n]),{run:z}=sf(Xe,{wait:1e3});f.useEffect(()=>{!k||!j||j!==V.current&&(V.current=j,z(j))},[j,k,z]);const Mt=f.useCallback(async()=>{j&&Te&&(nt(),await t(Te,{forceUpdateStorage:!0}),B(),O(j),C(!1),V.current=j,Be())},[j,t,Te,B,nt,Be]),be=f.useCallback(()=>{j&&$&&(de($),C(!1),B(),O(I),V.current=I)},[j,de,$,B,I]);return f.useEffect(()=>{g.current?.updateSource(j)},[j]),f.useEffect(()=>(x.current=!0,()=>{x.current=!1,ze.current&&clearTimeout(ze.current),he.current&&(he.current.dispose(),he.current=void 0),g.current&&(g.current.dispose(),g.current=void 0)}),[]),f.useEffect(()=>{const W=be;return()=>{setTimeout(()=>{x.current||W()},0)}},[be]),i.jsxs(i.Fragment,{children:[i.jsx(dl,{code:j,loading:d,actionsTooltipSide:"right",className:"my-0.5",allowCopy:!k,actions:k&&se?[{label:"Accept Changes",icon:Kn,onClick:Mt,className:"h-7 items-center gap-1.5 rounded-md border border-green-200 bg-green-50 px-2.5 py-1.5 text-xs font-medium text-green-600 shadow-sm hover:bg-green-100 dark:border-green-800 dark:bg-green-800 dark:text-green-200 dark:hover:bg-green-700"},{label:"Undo Changes",icon:$h,onClick:be,className:"h-7 items-center gap-1.5 rounded-md border border-red-200 bg-red-50 px-2.5 py-1.5 text-xs font-medium text-red-600 shadow-sm hover:bg-red-100 dark:border-red-800 dark:bg-red-800 dark:text-red-200 dark:hover:bg-red-700"}]:k&&!se?[{label:"View",icon:Ph,onClick:()=>{B(),C(W=>!W)}}]:[{label:`Show ${o==="inline"?"Standard":"Inline"} Refs`,icon:oh,onClick:L},...s?[]:[{label:"Edit",icon:Xn,onClick:()=>C(W=>!W),className:m?"dbml-edit-button-emphasis":void 0}]],editorProps:{height:"100%",defaultLanguage:"dbml",beforeMount:du,theme:JN(a),onMount:w,options:{wordWrap:"off",mouseWheelZoom:!1,readOnly:!k,autoClosingBrackets:"always",autoClosingQuotes:"always",autoSurround:"languageDefined"},onChange:W=>{O(W??"")}}}),Et?i.jsx("div",{className:"my-2 rounded-md border border-blue-200 bg-blue-50 p-3 dark:border-blue-900/50 dark:bg-blue-950/20",children:i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(Ei,{className:"mt-0.5 size-4 shrink-0 text-blue-600 dark:text-blue-400"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Warning"}),i.jsx("p",{className:"mt-0.5 text-xs text-blue-700 dark:text-blue-300",children:Et})]}),i.jsx("button",{onClick:()=>Rt(void 0),className:"rounded p-0.5 text-blue-600 hover:bg-blue-100 dark:text-blue-400 dark:hover:bg-blue-900/50","aria-label":"Close warning",children:i.jsx(wn,{className:"size-3.5"})})]})}):null,tt?i.jsx("div",{className:"my-2 rounded-md border border-orange-200 bg-orange-50 p-3 dark:border-orange-900/50 dark:bg-orange-950/20",children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Ei,{className:"mt-0.5 size-4 shrink-0 text-orange-600 dark:text-orange-400"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-orange-800 dark:text-orange-200",children:"Syntax Error"}),i.jsx("p",{className:"mt-0.5 text-xs text-orange-700 dark:text-orange-300",children:tt||ue("import_dbml_dialog.error.description")})]})]})}):null]})},eE=()=>i.jsx("section",{className:"flex flex-1 flex-col overflow-hidden px-2","data-vaul-no-drag":!0,children:i.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:i.jsx(ZN,{})})}),tE=({relationship:e})=>{const{updateRelationship:t,removeRelationship:n,readonly:s}=H(),{deleteElements:a}=ga(),{t:r}=Q(),{focusOnRelationship:o}=va(),[l,d]=S.useState(!1),[u,c]=S.useState(e.name),h=S.useRef(null),p=f.useCallback(()=>{l&&(u.trim()&&u!==e.name&&t(e.id,{name:u.trim()}),d(!1))},[u,e.id,t,l,e.name]);Rs(h,p),en("Enter",p);const b=_=>{_.stopPropagation(),d(!0)},x=f.useCallback(_=>{_.stopPropagation(),o(e.id,e.sourceTableId,e.targetTableId)},[o,e.id,e.sourceTableId,e.targetTableId]),m=f.useCallback(()=>{n(e.id),a({edges:[{id:e.id}]})},[e.id,n,a]),N=f.useCallback(()=>i.jsxs(sn,{children:[i.jsx(an,{children:i.jsx(_e,{children:i.jsx(Wn,{})})}),i.jsxs(rn,{className:"w-40",children:[i.jsx($n,{children:r("side_panel.refs_section.relationship.relationship_actions.title")}),i.jsx(wt,{}),i.jsx(It,{children:i.jsxs(Je,{onClick:m,className:"flex justify-between !text-red-700",children:[r("side_panel.refs_section.relationship.relationship_actions.delete_relationship"),i.jsx(vt,{className:"size-3.5 text-red-700"})]})})]})]}),[m,r]);return i.jsxs("div",{className:"group flex h-11 flex-1 items-center justify-between gap-1 overflow-hidden",children:[i.jsx("div",{className:"flex min-w-0 flex-1",children:l?i.jsx(Ne,{ref:h,autoFocus:!0,type:"text",placeholder:e.name,value:u,onClick:_=>_.stopPropagation(),onChange:_=>c(_.target.value),className:"h-7 w-full focus-visible:ring-0"}):i.jsx("div",{className:"truncate",children:e.name})}),i.jsx("div",{className:"flex flex-row-reverse items-center",children:l?i.jsx(_e,{onClick:p,children:i.jsx(Kn,{})}):i.jsxs(i.Fragment,{children:[s?null:i.jsx("div",{children:N()}),i.jsxs("div",{className:"flex flex-row-reverse md:hidden md:group-hover:flex",children:[s?null:i.jsx(_e,{onClick:b,children:i.jsx(Xn,{})}),i.jsx(_e,{onClick:x,children:i.jsx(Ms,{})})]})]})})]})},nE=({relationship:e})=>{const{getTable:t,getField:n,updateRelationship:s,removeRelationship:a,readonly:r}=H(),{deleteElements:o}=ga(),{t:l}=Q(),d=f.useMemo(()=>uh({sourceCardinality:e.sourceCardinality,targetCardinality:e.targetCardinality}),[e.sourceCardinality,e.targetCardinality]),u=f.useCallback(m=>{const{sourceCardinality:N,targetCardinality:_}=hh(m);s(e.id,{sourceCardinality:N,targetCardinality:_})},[e.id,s]),c=t(e.targetTableId),h=n(e.targetTableId,e.targetFieldId),p=t(e.sourceTableId),b=n(e.sourceTableId,e.sourceFieldId),x=f.useCallback(()=>{a(e.id),o({edges:[{id:e.id}]})},[e.id,a,o]);return i.jsxs("div",{className:"my-1 flex flex-col rounded-b-md px-1 py-2",children:[i.jsxs("div",{className:"flex flex-col gap-6",children:[i.jsxs("div",{className:"flex items-center justify-between gap-1 text-xs",children:[i.jsxs("div",{className:"flex basis-1/2 flex-col gap-2 overflow-hidden text-xs",children:[i.jsxs("div",{className:"flex flex-row items-center gap-1",children:[i.jsx(Xo,{className:"size-4 text-subtitle"}),i.jsx("div",{className:"font-bold text-subtitle",children:l("side_panel.refs_section.relationship.primary")})]}),i.jsxs(xe,{children:[i.jsx(ge,{children:i.jsxs("div",{className:"truncate text-left text-sm",children:[p?.schema?`${p.schema}.`:"",p?.name,"(",b?.name,")"]})}),i.jsxs(ve,{children:[p?.schema?`${p.schema}.`:"",p?.name,"(",b?.name,")"]})]})]}),i.jsxs("div",{className:"flex basis-1/2 flex-col gap-2 overflow-hidden text-xs",children:[i.jsxs("div",{className:"flex flex-row items-center gap-1",children:[i.jsx(Wo,{className:"size-4 text-subtitle"}),i.jsx("div",{className:"font-bold text-subtitle",children:l("side_panel.refs_section.relationship.foreign")})]}),i.jsxs(xe,{children:[i.jsx(ge,{children:i.jsxs("div",{className:"truncate text-left text-sm",children:[c?.schema?`${c.schema}.`:"",c?.name,"(",h?.name,")"]})}),i.jsxs(ve,{children:[c?.schema?`${c.schema}.`:"",c?.name,"(",h?.name,")"]})]})]})]}),i.jsxs("div",{className:"flex flex-col gap-2 text-xs",children:[i.jsxs("div",{className:"flex flex-row items-center gap-1",children:[i.jsx(Eh,{className:"size-4 text-subtitle"}),i.jsx("div",{className:"font-bold text-subtitle",children:l("side_panel.refs_section.relationship.cardinality")})]}),i.jsxs(Ls,{value:d,onValueChange:u,disabled:r,children:[i.jsx(ks,{className:"h-8",children:i.jsx(As,{})}),i.jsx(Ss,{children:i.jsxs(Es,{children:[i.jsx(je,{value:"one_to_one",children:l("relationship_type.one_to_one")}),i.jsx(je,{value:"one_to_many",children:l("relationship_type.one_to_many")}),i.jsx(je,{value:"many_to_one",children:l("relationship_type.many_to_one")}),d==="many_to_many"?i.jsx(je,{value:"many_to_many",children:l("relationship_type.many_to_many")}):null]})})]})]})]}),r?null:i.jsx("div",{className:"flex flex-1 items-center justify-center pt-2",children:i.jsxs(K,{variant:"ghost",className:"h-8 p-2 text-xs",onClick:x,children:[i.jsx(vt,{className:"mr-1 size-3.5 text-red-700"}),i.jsx("div",{className:"text-red-700",children:l("side_panel.refs_section.relationship.delete_relationship")})]})})]})},Vc=S.forwardRef(({relationship:e},t)=>i.jsxs(mn,{value:e.id,className:"rounded-md",ref:t,children:[i.jsx(bn,{asChild:!0,className:"w-full rounded-md px-2 py-0 hover:bg-accent hover:no-underline data-[state=open]:rounded-b-none",children:i.jsx(tE,{relationship:e})}),i.jsx(xn,{className:"p-1 pb-0",children:i.jsx(nE,{relationship:e})})]}));Vc.displayName="RelationshipListItem";const sE=({dependency:e})=>{const{removeDependency:t,getTable:n}=H(),{fitView:s,deleteElements:a,setEdges:r}=ga(),{t:o}=Q(),{hideSidePanel:l}=Ve(),{isMd:d}=Rr("md"),u=f.useMemo(()=>{const b=n(e.tableId),x=n(e.dependentTableId);return!b||!x?"":`${x.name} -> ${b.name}`},[e.tableId,e.dependentTableId,n]),c=f.useCallback(b=>{b.stopPropagation(),r(x=>x.map(m=>m.id==e.id?{...m,selected:!0}:{...m,selected:!1})),s({duration:500,maxZoom:1,minZoom:1,nodes:[{id:e.tableId},{id:e.dependentTableId}]}),d||l()},[s,e.tableId,e.dependentTableId,r,e.id,d,l]),h=f.useCallback(()=>{t(e.id),a({edges:[{id:e.id}]})},[e.id,t,a]),p=f.useCallback(()=>i.jsxs(sn,{children:[i.jsx(an,{children:i.jsx(_e,{children:i.jsx(Wn,{})})}),i.jsxs(rn,{className:"w-40",children:[i.jsx($n,{children:o("side_panel.refs_section.dependency.dependency_actions.title")}),i.jsx(wt,{}),i.jsx(It,{children:i.jsxs(Je,{onClick:h,className:"flex justify-between !text-red-700",children:[o("side_panel.refs_section.dependency.dependency_actions.delete_dependency"),i.jsx(vt,{className:"size-3.5 text-red-700"})]})})]})]}),[h,o]);return i.jsxs("div",{className:"group flex h-11 flex-1 items-center justify-between gap-1 overflow-hidden",children:[i.jsx("div",{className:"flex min-w-0 flex-1",children:i.jsx("div",{className:"truncate",children:u})}),i.jsxs("div",{className:"flex flex-row-reverse items-center",children:[i.jsx("div",{children:p()}),i.jsx("div",{className:"flex flex-row-reverse md:hidden md:group-hover:flex",children:i.jsx(_e,{onClick:c,children:i.jsx(Ms,{})})})]})]})},aE=({dependency:e})=>{const{getTable:t,removeDependency:n}=H(),{deleteElements:s}=ga(),{t:a}=Q(),r=t(e.tableId),o=t(e.dependentTableId),l=f.useCallback(()=>{n(e.id),s({edges:[{id:e.id}]})},[e.id,n,s]);return i.jsxs("div",{className:"my-1 flex flex-col rounded-b-md px-1",children:[i.jsx("div",{className:"flex flex-col gap-6",children:i.jsxs("div",{className:"flex items-center justify-between gap-1 text-xs",children:[i.jsxs("div",{className:"flex basis-1/2 flex-col gap-2 overflow-hidden text-xs",children:[i.jsxs("div",{className:"flex flex-row items-center gap-1",children:[i.jsx(Wo,{className:"size-4 text-subtitle"}),i.jsx("div",{className:"font-bold text-subtitle",children:a("side_panel.refs_section.dependency.dependent_table")})]}),i.jsxs(xe,{children:[i.jsx(ge,{children:i.jsx("div",{className:"truncate text-left text-sm	",children:o?.name})}),i.jsx(ve,{children:o?.name})]})]}),i.jsxs("div",{className:"flex basis-1/2 flex-col gap-2 overflow-hidden text-xs",children:[i.jsxs("div",{className:"flex flex-row items-center gap-1",children:[i.jsx(Xo,{className:"size-4 text-subtitle"}),i.jsx("div",{className:"font-bold text-subtitle",children:a("side_panel.refs_section.dependency.table")})]}),i.jsxs(xe,{children:[i.jsx(ge,{children:i.jsx("div",{className:"truncate text-left text-sm",children:r?.name})}),i.jsx(ve,{children:r?.name})]})]})]})}),i.jsx("div",{className:"flex flex-1 items-center justify-center pt-2",children:i.jsxs(K,{variant:"ghost",className:"h-8 p-2 text-xs",onClick:l,children:[i.jsx(vt,{className:"mr-1 size-3.5 text-red-700"}),i.jsx("div",{className:"text-red-700",children:a("side_panel.refs_section.dependency.delete_dependency")})]})})]})},Gc=S.forwardRef(({dependency:e},t)=>i.jsxs(mn,{value:e.id,className:"rounded-md",ref:t,children:[i.jsx(bn,{asChild:!0,className:"w-full rounded-md px-2 py-0 hover:bg-accent hover:no-underline data-[state=open]:rounded-b-none",children:i.jsx(sE,{dependency:e})}),i.jsx(xn,{className:"p-1 pb-0",children:i.jsx(aE,{dependency:e})})]}));Gc.displayName="DependencyListItem";const rE=({refs:e})=>{const{openRefFromSidebar:t,openedRefInSidebar:n}=Ve(),s=S.useRef(null),{t:a}=Q(),r=e.reduce((p,b)=>(p[b.id]=S.createRef(),p),{}),o=f.useCallback(p=>r[p]?.current?.scrollIntoView({behavior:"smooth",block:"start"}),[r]),l=f.useCallback(()=>{n&&s.current!==n&&(s.current=n,o(n))},[o,n]),d=f.useMemo(()=>e.filter(p=>p.type==="relationship").length,[e]),u=S.useMemo(()=>`${d} ${a("side_panel.refs_section.relationships")}`,[d,a]),c=f.useMemo(()=>e.filter(p=>p.type==="dependency").length,[e]),h=S.useMemo(()=>`${c} ${a("side_panel.refs_section.dependencies")}`,[c,a]);return i.jsxs(ma,{type:"single",collapsible:!0,className:"flex w-full flex-col gap-1",value:n,onValueChange:t,onAnimationEnd:l,children:[d>0?i.jsx(Ye,{className:"mt-2 px-2 text-xs font-medium text-muted-foreground",children:u}):null,e.filter(p=>p.type==="relationship").map(p=>i.jsx(Vc,{relationship:p.relationship,ref:r[p.id]},p.id)),c>0?i.jsx(Ye,{className:"mt-2 px-2 text-xs font-medium text-muted-foreground",children:h}):null,e.filter(p=>p.type==="dependency").map(p=>i.jsx(Gc,{dependency:p.dependency,ref:r[p.id]},p.id))]})},iE=()=>{const{relationships:e,dependencies:t,databaseType:n,getTable:s,readonly:a}=H(),{filter:r}=ba(),[o,l]=S.useState(""),{closeAllRefsInSidebar:d}=Ve(),{t:u}=Q(),{openCreateRelationshipDialog:c}=Gn(),{showDBViews:h}=Pr(),p=S.useRef(null),b=f.useMemo(()=>{const N=e.map(y=>({id:y.id,type:"relationship",relationship:y})),_=h?t.map(y=>({id:y.id,type:"dependency",dependency:y})):[];return[...N,..._]},[e,t,h]),x=f.useMemo(()=>{const N=y=>{if(!o?.trim?.())return!0;const g=o.toLowerCase();if(y.type==="relationship")return y.relationship.name.toLowerCase().includes(g);{const w=y.dependency,I=s(w.tableId)?.name??"",L=s(w.dependentTableId)?.name??"";return I.toLowerCase().includes(g)||L.toLowerCase().includes(g)}},_=y=>{if(y.type==="relationship"){const g=y.relationship;return _u({tableA:{id:g.sourceTableId,schema:g.sourceSchema},tableB:{id:g.targetTableId,schema:g.targetSchema},filter:r,options:{defaultSchema:vn[n]}})}else{const g=y.dependency;return Tu({tableA:{id:g.tableId,schema:g.schema},tableB:{id:g.dependentTableId,schema:g.dependentSchema},filter:r,options:{defaultSchema:vn[n]}})}};return b.filter(_).filter(N).sort((y,g)=>{if(y.type!==g.type)return y.type==="relationship"?-1:1;if(y.type==="relationship"){const w=y.relationship,I=g.relationship;return w.name.localeCompare(I.name)}else{const w=y.dependency,I=g.dependency,L=s(w.dependentTableId),k=s(w.tableId),C=s(I.dependentTableId),j=s(I.tableId);return`${L?.name}${k?.name}`.localeCompare(`${C?.name}${j?.name}`)}})},[b,o,r,n,s]),m=f.useCallback(async()=>{l(""),c()},[c,l]);return i.jsxs("section",{className:"flex flex-1 flex-col overflow-hidden px-2",children:[i.jsxs("div",{className:"flex items-center justify-between gap-4 py-1",children:[i.jsx("div",{children:i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:i.jsx("span",{children:i.jsx(K,{variant:"ghost",className:"size-8 p-0",onClick:d,children:i.jsx(Dh,{className:"size-4"})})})}),i.jsx(ve,{children:u("side_panel.refs_section.collapse")})]})}),i.jsx("div",{className:"flex-1",children:i.jsx(Ne,{ref:p,type:"text",placeholder:u("side_panel.refs_section.filter"),className:"h-8 w-full focus-visible:ring-0",value:o,onChange:N=>l(N.target.value)})}),a?null:i.jsxs(K,{variant:"secondary",className:"h-8 p-2 text-xs",onClick:m,children:[i.jsx(il,{className:"h-4"}),u("side_panel.refs_section.add_relationship")]})]}),i.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:i.jsx(Ds,{className:"h-full",children:b.length===0?i.jsx(ss,{title:u("side_panel.refs_section.empty_state.title"),description:u("side_panel.refs_section.empty_state.description"),className:"mt-20",secondaryAction:a?void 0:{label:u("side_panel.refs_section.add_relationship"),onClick:m}}):i.jsx(rE,{refs:x})})})]})},Kc=S.forwardRef(({area:e},t)=>{const{updateArea:n,removeArea:s,readonly:a}=H(),{t:r}=Q(),{focusOnArea:o}=va(),[l,d]=S.useState(!1),[u,c]=S.useState(e.name),h=S.useRef(null),{attributes:p,listeners:b,setNodeRef:x,transform:m,transition:N}=cn({id:e.id}),_=Vo(t,x),y={transform:jt.Translate.toString(m),transition:N},g=f.useCallback(()=>{l&&(u.trim()&&n(e.id,{name:u.trim()}),d(!1))},[u,e.id,n,l]),w=f.useCallback(()=>{d(!1),c(e.name)},[e.name]),I=f.useCallback(O=>{O.stopPropagation(),d(!0)},[]),L=f.useCallback(()=>{s(e.id)},[e.id,s]),k=f.useCallback(O=>{n(e.id,{color:O})},[e.id,n]),C=f.useCallback(O=>{O.stopPropagation(),o(e.id)},[o,e.id]);Rs(h,g),en("Enter",g),en("Escape",w);const j=f.useCallback(()=>i.jsxs(sn,{children:[i.jsx(an,{children:i.jsx(_e,{children:i.jsx(Wn,{})})}),i.jsxs(rn,{className:"w-fit min-w-40",children:[i.jsx($n,{children:r("side_panel.areas_section.area.area_actions.title")}),i.jsx(wt,{}),i.jsx(It,{children:i.jsxs(Je,{className:"flex justify-between gap-4",onClick:O=>{O.stopPropagation(),I(O)},children:[r("side_panel.areas_section.area.area_actions.edit_name"),i.jsx(Xn,{className:"size-3.5"})]})}),i.jsx(wt,{}),i.jsx(It,{children:i.jsxs(Je,{onClick:L,className:"flex justify-between !text-red-700",children:[r("side_panel.areas_section.area.area_actions.delete_area"),i.jsx(vt,{className:"size-3.5 text-red-700"})]})})]})]}),[I,L,r]);return i.jsx("div",{className:"w-full rounded-md border border-border hover:bg-accent/5",ref:_,style:{...y,borderLeftWidth:"6px",borderLeftColor:e.color},...p,children:i.jsxs("div",{className:"group flex h-11 items-center justify-between gap-1 overflow-hidden p-2",children:[a?null:i.jsx("div",{className:"flex cursor-move items-center justify-center",...b,children:i.jsx(zn,{className:"size-4 text-muted-foreground"})}),i.jsx("div",{className:"flex min-w-0 flex-1",children:l?i.jsx(Ne,{ref:h,autoFocus:!0,type:"text",placeholder:e.name,value:u,onClick:O=>O.stopPropagation(),onChange:O=>c(O.target.value),className:"h-7 w-full focus-visible:ring-0"}):a?i.jsx("div",{className:"truncate px-2 py-0.5 text-sm font-medium",children:e.name}):i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:i.jsx("div",{onDoubleClick:I,className:"text-editable truncate px-2 py-0.5 text-sm font-medium",children:e.name})}),i.jsx(ve,{children:r("tool_tips.double_click_to_edit")})]})}),i.jsx("div",{className:"flex items-center gap-1",children:l?i.jsx(_e,{onClick:g,children:i.jsx(Kn,{})}):i.jsxs("div",{className:"flex flex-row-reverse items-center gap-1",children:[a?null:j(),i.jsx(Mr,{color:e.color,onChange:k,disabled:a}),i.jsx("div",{className:"hidden md:group-hover:flex",children:i.jsx(_e,{onClick:C,children:i.jsx(Ms,{})})})]})})]})})});Kc.displayName="AreaListItem";const oE=({areas:e})=>{const{updateArea:t}=H(),{openedAreaInSidebar:n}=Ve(),s=S.useRef(null),a=f.useMemo(()=>e.reduce((u,c)=>(u[c.id]=S.createRef(),u),{}),[e]),r=f.useCallback(u=>a[u]?.current?.scrollIntoView({behavior:"smooth",block:"start"}),[a]),o=Qn(Yn(on)),l=u=>{const{active:c,over:h}=u;if(c?.id!==h?.id&&h&&c){const p=e.findIndex(m=>m.id===c.id),b=e.findIndex(m=>m.id===h.id);ln(e,p,b).forEach((m,N)=>{t(m.id,{order:N})})}},d=f.useCallback(()=>{n&&s.current!==n&&(s.current=n,r(n))},[r,n]);return S.useEffect(()=>{d()},[n,d]),i.jsx("div",{className:"flex w-full flex-col gap-1",children:i.jsx(es,{sensors:o,collisionDetection:Jn,onDragEnd:l,children:i.jsx(ns,{items:e,strategy:ts,children:e.sort((u,c)=>u.order&&c.order===void 0?-1:u.order===void 0&&c.order?1:u.order!==void 0&&c.order!==void 0?u.order-c.order:u.name.localeCompare(c.name)).map(u=>i.jsx(Kc,{area:u,ref:a[u.id]},u.id))})})})},lE=()=>{const{createArea:e,areas:t,readonly:n}=H(),s=Dr(),{t:a}=Q(),{openAreaFromSidebar:r}=Ve(),[o,l]=S.useState(""),d=S.useRef(null),u=f.useMemo(()=>{const b=x=>!o?.trim?.()||x.name.toLowerCase().includes(o.toLowerCase());return t.filter(b)},[t,o]),c=f.useCallback(async()=>{const x=-s.x/s.zoom+80/s.zoom,m=-s.y/s.zoom+80/s.zoom,N=await e({x,y:m});r&&r(N.id)},[e,r,s.x,s.y,s.zoom]),h=f.useCallback(async()=>{l(""),c()},[c,l]),p=f.useCallback(()=>{l("")},[]);return i.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden px-2",children:[i.jsxs("div",{className:"flex items-center justify-between gap-4 pb-1",children:[i.jsx("div",{className:"flex-1",children:i.jsx(Ne,{ref:d,type:"text",placeholder:a("side_panel.areas_section.filter"),className:"h-8 w-full focus-visible:ring-0",value:o,onChange:b=>l(b.target.value)})}),n?null:i.jsxs(K,{variant:"secondary",className:"h-8 p-2 text-xs",onClick:h,children:[i.jsx(xa,{className:"h-4"}),a("side_panel.areas_section.add_area")]})]}),i.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:i.jsx(Ds,{className:"h-full",children:t.length===0?i.jsx(ss,{title:a("side_panel.areas_section.empty_state.title"),description:a("side_panel.areas_section.empty_state.description"),className:"mt-20",secondaryAction:n?void 0:{label:a("side_panel.areas_section.add_area"),onClick:h}}):o&&u.length===0?i.jsxs("div",{className:"mt-10 flex flex-col items-center gap-2",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:a("side_panel.areas_section.no_results")}),i.jsxs(K,{variant:"outline",size:"sm",onClick:p,className:"gap-1",children:[i.jsx(wn,{className:"size-3.5"}),a("side_panel.areas_section.clear")]})]}):i.jsx(oE,{areas:u})})})]})},zc=S.forwardRef(({note:e},t)=>{const{updateNote:n,removeNote:s,readonly:a}=H(),{t:r}=Q(),{focusOnNote:o}=va(),{attributes:l,listeners:d,setNodeRef:u,transform:c,transition:h}=cn({id:e.id}),p=Vo(t,u),b={transform:jt.Translate.toString(c),transition:h},x=f.useCallback(()=>{s(e.id)},[e.id,s]),m=f.useCallback(y=>{n(e.id,{color:y})},[e.id,n]),N=f.useCallback(y=>{y.stopPropagation(),o(e.id)},[o,e.id]),_=f.useCallback(()=>i.jsxs(sn,{children:[i.jsx(an,{children:i.jsx(_e,{children:i.jsx(Wn,{})})}),i.jsxs(rn,{className:"w-fit min-w-40",children:[i.jsx($n,{children:r("side_panel.notes_section.note.note_actions.title")}),i.jsx(wt,{}),i.jsx(It,{children:i.jsxs(Je,{onClick:x,className:"flex justify-between !text-red-700",children:[r("side_panel.notes_section.note.note_actions.delete_note"),i.jsx(vt,{className:"size-3.5 text-red-700"})]})})]})]}),[x,r]);return i.jsx("div",{className:"w-full rounded-md border border-border hover:bg-accent/5",ref:p,style:{...b,borderLeftWidth:"6px",borderLeftColor:e.color},...l,children:i.jsxs("div",{className:"group flex min-h-11 items-center justify-between gap-1 overflow-hidden p-2",children:[a?null:i.jsx("div",{className:"flex cursor-move items-center justify-center",...d,children:i.jsx(zn,{className:"size-4 text-muted-foreground"})}),i.jsx("div",{className:"flex min-w-0 flex-1",children:i.jsx("div",{className:"truncate px-2 py-0.5 text-sm",children:e.content||i.jsx("span",{className:"italic text-muted-foreground",children:r("side_panel.notes_section.note.empty_note")})})}),i.jsx("div",{className:"flex items-center gap-1",children:i.jsxs("div",{className:"flex flex-row-reverse items-center gap-1",children:[a?null:_(),i.jsx(Mr,{color:e.color,onChange:m,disabled:a}),i.jsx("div",{className:"hidden md:group-hover:flex",children:i.jsx(_e,{onClick:N,children:i.jsx(Ms,{})})})]})})]})})});zc.displayName="NoteListItem";const cE=({notes:e})=>{const{updateNote:t}=H(),{openedNoteInSidebar:n}=Ve(),s=S.useRef(null),a=f.useMemo(()=>e.reduce((u,c)=>(u[c.id]=S.createRef(),u),{}),[e]),r=f.useCallback(u=>a[u]?.current?.scrollIntoView({behavior:"smooth",block:"start"}),[a]),o=Qn(Yn(on)),l=u=>{const{active:c,over:h}=u;if(c?.id!==h?.id&&h&&c){const p=e.findIndex(m=>m.id===c.id),b=e.findIndex(m=>m.id===h.id);ln(e,p,b).forEach((m,N)=>{t(m.id,{order:N})})}},d=f.useCallback(()=>{n&&s.current!==n&&(s.current=n,r(n))},[r,n]);return S.useEffect(()=>{d()},[n,d]),i.jsx("div",{className:"flex w-full flex-col gap-1",children:i.jsx(es,{sensors:o,collisionDetection:Jn,onDragEnd:l,children:i.jsx(ns,{items:e,strategy:ts,children:e.sort((u,c)=>u.order&&c.order===void 0?-1:u.order===void 0&&c.order?1:u.order!==void 0&&c.order!==void 0?u.order-c.order:u.content.localeCompare(c.content)).map(u=>i.jsx(zc,{note:u,ref:a[u.id]},u.id))})})})},dE=()=>{const{createNote:e,notes:t,readonly:n}=H(),s=Dr(),{t:a}=Q(),{openNoteFromSidebar:r}=Ve(),[o,l]=S.useState(""),d=S.useRef(null),u=f.useMemo(()=>{const b=x=>!o?.trim?.()||x.content.toLowerCase().includes(o.toLowerCase());return t.filter(b)},[t,o]),c=f.useCallback(async()=>{const x=-s.x/s.zoom+80/s.zoom,m=-s.y/s.zoom+80/s.zoom,N=await e({x,y:m});r&&r(N.id)},[e,r,s.x,s.y,s.zoom]),h=f.useCallback(async()=>{l(""),c()},[c,l]),p=f.useCallback(()=>{l("")},[]);return i.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden px-2",children:[i.jsxs("div",{className:"flex items-center justify-between gap-4 pb-1",children:[i.jsx("div",{className:"flex-1",children:i.jsx(Ne,{ref:d,type:"text",placeholder:a("side_panel.notes_section.filter"),className:"h-8 w-full focus-visible:ring-0",value:o,onChange:b=>l(b.target.value)})}),n?null:i.jsxs(K,{variant:"secondary",className:"h-8 p-2 text-xs",onClick:h,children:[i.jsx(ol,{className:"h-4"}),a("side_panel.notes_section.add_note")]})]}),i.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:i.jsx(Ds,{className:"h-full",children:t.length===0?i.jsx(ss,{title:a("side_panel.notes_section.empty_state.title"),description:a("side_panel.notes_section.empty_state.description"),className:"mt-20",secondaryAction:n?void 0:{label:a("side_panel.notes_section.add_note"),onClick:h}}):o&&u.length===0?i.jsxs("div",{className:"mt-10 flex flex-col items-center gap-2",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:a("side_panel.notes_section.no_results")}),i.jsxs(K,{variant:"outline",size:"sm",onClick:p,className:"gap-1",children:[i.jsx(wn,{className:"size-3.5"}),a("side_panel.notes_section.clear")]})]}):i.jsx(cE,{notes:u})})})]})},uE=()=>{const{t:e}=Q(),{selectedVisualsTab:t,selectVisualsTab:n}=Ve();return i.jsx("section",{className:"flex flex-1 flex-col overflow-hidden","data-vaul-no-drag":!0,children:i.jsxs(uu,{value:t,onValueChange:s=>n(s),className:"flex flex-1 flex-col overflow-hidden",children:[i.jsxs("div",{className:"px-2 pt-2",children:[i.jsxs(hu,{className:"grid h-auto w-full grid-cols-2 gap-1 rounded-xl border bg-background p-1",children:[i.jsxs(yi,{value:"areas",className:"gap-1.5 rounded-lg px-3 py-1 text-sm font-medium transition-all data-[state=active]:bg-sky-600 data-[state=active]:text-white data-[state=inactive]:text-muted-foreground data-[state=active]:shadow-sm data-[state=inactive]:hover:bg-muted/50 data-[state=inactive]:hover:text-foreground dark:data-[state=active]:bg-sky-500",children:[i.jsx(xa,{className:"size-3.5"}),e("side_panel.visuals_section.tabs.areas")]}),i.jsxs(yi,{value:"notes",className:"gap-1.5 rounded-lg px-3 py-1 text-sm font-medium transition-all data-[state=active]:bg-sky-600 data-[state=active]:text-white data-[state=inactive]:text-muted-foreground data-[state=active]:shadow-sm data-[state=inactive]:hover:bg-muted/50 data-[state=inactive]:hover:text-foreground dark:data-[state=active]:bg-sky-500",children:[i.jsx(ol,{className:"size-3.5"}),e("side_panel.visuals_section.tabs.notes")]})]}),i.jsx(Zt,{orientation:"horizontal",className:"my-2"})]}),i.jsx(_i,{value:"areas",className:"mt-0 flex flex-1 flex-col overflow-hidden data-[state=inactive]:hidden",children:i.jsx(lE,{})}),i.jsx(_i,{value:"notes",className:"mt-0 flex flex-1 flex-col overflow-hidden data-[state=inactive]:hidden",children:i.jsx(dE,{})})]})})},hE=e=>e==="dark"?"vs-dark":"vs",fE=()=>{const{currentDiagram:e,databaseType:t}=H(),{effectiveTheme:n}=Os(),{toast:s}=ll(),[a,r]=f.useState(!0),[o,l]=f.useState("");f.useEffect(()=>{const u=async()=>{r(!0);try{const c=pu({diagram:e});l(c)}catch(c){s({title:"Data Dictionary Export Error",description:`Could not generate XML: ${c instanceof Error?c.message:String(c)}`,variant:"destructive"}),l("")}r(!1)};setTimeout(()=>u(),0)},[e,t,s]);const d=f.useCallback(()=>{if(!o)return;const u=new Blob([o],{type:"application/xml;charset=utf-8"}),c=URL.createObjectURL(u),h=document.createElement("a");h.href=c,h.download=`${e.name||"data-dictionary"}.xml`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(c),s({title:"Download Started",description:"Your Data Dictionary XML file is being downloaded."})},[o,e.name,s]);return i.jsx(dl,{code:o,loading:a,actionsTooltipSide:"right",className:"my-0.5",allowCopy:!0,actions:[{label:"Download XML",icon:fu,onClick:d,className:"h-7 items-center gap-1.5 rounded-md border border-green-200 bg-green-50 px-2.5 py-1.5 text-xs font-medium text-green-600 shadow-sm hover:bg-green-100 dark:border-green-800 dark:bg-green-800 dark:text-green-200 dark:hover:bg-green-700"}],editorProps:{height:"100%",defaultLanguage:"xml",theme:hE(n),options:{wordWrap:"off",mouseWheelZoom:!1,readOnly:!0,autoClosingBrackets:"always",autoClosingQuotes:"always",autoSurround:"languageDefined"}}})},pE=()=>i.jsx("section",{className:"flex flex-1 flex-col overflow-hidden px-2","data-vaul-no-drag":!0,children:i.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:i.jsx(fE,{})})}),Ly=()=>{const{t:e}=Q(),{databaseType:t}=H(),{selectSidebarSection:n,selectedSidebarSection:s}=Ve(),{isMd:a}=Rr("md");return i.jsxs("aside",{className:"flex h-full flex-col overflow-hidden",children:[a?null:i.jsx("div",{className:"flex justify-center border-b pt-0.5",children:i.jsxs(Ls,{value:s,onValueChange:r=>n(r),children:[i.jsxs(ks,{className:"rounded-none border-none font-semibold shadow-none hover:bg-secondary hover:underline focus:border-transparent focus:ring-0",children:[i.jsx(As,{}),i.jsx("div",{className:"flex flex-1 justify-end px-2 text-xs font-normal text-muted-foreground",children:e("side_panel.view_all_options")})]}),i.jsx(Ss,{children:i.jsxs(Es,{children:[i.jsx(je,{value:"tables",children:e("side_panel.tables_section.tables")}),i.jsx(je,{value:"refs",children:e("side_panel.refs_section.refs")}),i.jsx(je,{value:"areas",children:e("side_panel.areas_section.areas")}),i.jsx(je,{value:"visuals",children:e("side_panel.visuals_section.visuals")}),Go(t)?i.jsx(je,{value:"customTypes",children:e("side_panel.custom_types_section.custom_types")}):null,i.jsx(je,{value:"dataDictionary",children:"Data Dictionary"})]})})]})}),s==="tables"?i.jsx(em,{}):s==="dbml"?i.jsx(eE,{}):s==="refs"?i.jsx(iE,{}):s==="visuals"?i.jsx(uE,{}):s==="dataDictionary"?i.jsx(pE,{}):s==="customTypes"?i.jsx(om,{}):null]})},cr=768;function mE(){const[e,t]=f.useState(void 0);return f.useEffect(()=>{const n=window.matchMedia(`(max-width: ${cr-1}px)`),s=()=>{t(window.innerWidth<cr)};return n.addEventListener("change",s),t(window.innerWidth<cr),()=>n.removeEventListener("change",s)},[]),!!e}const bE=wu,xE=Iu,Xc=f.forwardRef(({className:e,...t},n)=>i.jsx(nl,{className:P("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:n}));Xc.displayName=nl.displayName;const gE=Or("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Wc=f.forwardRef(({side:e="right",className:t,children:n,...s},a)=>i.jsxs(xE,{children:[i.jsx(Xc,{}),i.jsxs(Zo,{ref:a,className:P(gE({side:e}),t),...s,children:[i.jsxs(Cu,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[i.jsx(ju,{className:"size-4"}),i.jsx("span",{className:"sr-only",children:"Close"})]}),n]})]}));Wc.displayName=Zo.displayName;const qc=({className:e,...t})=>i.jsx("div",{className:P("flex flex-col space-y-2 text-center sm:text-left",e),...t});qc.displayName="SheetHeader";const Hc=f.forwardRef(({className:e,...t},n)=>i.jsx(el,{ref:n,className:P("text-lg font-semibold text-foreground",e),...t}));Hc.displayName=el.displayName;const Yc=f.forwardRef(({className:e,...t},n)=>i.jsx(tl,{ref:n,className:P("text-sm text-muted-foreground",e),...t}));Yc.displayName=tl.displayName;const Pa=()=>{const e=S.useContext(Qc);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e},vE="sidebar_state",NE=3600*24*7,EE="16rem",yE="18rem",_E="3rem",TE="4rem",wE="b",Qc=f.createContext(null),IE=f.forwardRef(({defaultOpen:e=!0,open:t,onOpenChange:n,className:s,style:a,children:r,...o},l)=>{const d=mE(),[u,c]=f.useState(!1),[h,p]=f.useState(e),b=t??h,x=f.useCallback(y=>{const g=typeof y=="function"?y(b):y;n?n(g):p(g),document.cookie=`${vE}=${g}; path=/; max-age=${NE}`},[n,b]),m=f.useCallback(()=>d?c(y=>!y):x(y=>!y),[d,x,c]);f.useEffect(()=>{const y=g=>{g.key===wE&&(g.metaKey||g.ctrlKey)&&(g.preventDefault(),m())};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[m]);const N=b?"expanded":"collapsed",_=f.useMemo(()=>({state:N,open:b,setOpen:x,isMobile:d,openMobile:u,setOpenMobile:c,toggleSidebar:m}),[N,b,x,d,u,c,m]);return i.jsx(Qc.Provider,{value:_,children:i.jsx(Qd,{delayDuration:0,children:i.jsx("div",{style:{"--sidebar-width":EE,"--sidebar-width-icon":_E,"--sidebar-width-icon-extended":TE,...a},className:P("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",s),ref:l,...o,children:r})})})});IE.displayName="SidebarProvider";const Jc=f.forwardRef(({side:e="left",variant:t="sidebar",collapsible:n="offcanvas",className:s,children:a,...r},o)=>{const{isMobile:l,state:d,openMobile:u,setOpenMobile:c}=Pa();return n==="none"?i.jsx("div",{className:P("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",s),ref:o,...r,children:a}):l?i.jsx(bE,{open:u,onOpenChange:c,...r,children:i.jsxs(Wc,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":yE},side:e,children:[i.jsxs(qc,{className:"sr-only",children:[i.jsx(Hc,{children:"Sidebar"}),i.jsx(Yc,{children:"Displays the mobile sidebar."})]}),i.jsx("div",{className:"flex size-full flex-col",children:a})]})}):i.jsxs("div",{ref:o,className:"group peer hidden text-sidebar-foreground md:block","data-state":d,"data-collapsible":d==="collapsed"?n:"","data-variant":t,"data-side":e,children:[i.jsx("div",{className:P("relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))] group-data-[collapsible=icon-extended]:w-[calc(var(--sidebar-width-icon-extended)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[collapsible=icon-extended]:w-[--sidebar-width-icon-extended]")}),i.jsx("div",{className:P("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",e==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)] group-data-[collapsible=icon-extended]:w-[calc(var(--sidebar-width-icon-extended)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[collapsible=icon-extended]:w-[--sidebar-width-icon-extended] group-data-[side=left]:border-r group-data-[side=right]:border-l",s),...r,children:i.jsx("div",{"data-sidebar":"sidebar",className:"flex size-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:a})})]})});Jc.displayName="Sidebar";const CE=f.forwardRef(({className:e,onClick:t,...n},s)=>{const{toggleSidebar:a}=Pa();return i.jsxs(K,{ref:s,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:P("h-7 w-7",e),onClick:r=>{t?.(r),a()},...n,children:[i.jsx(Lu,{}),i.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});CE.displayName="SidebarTrigger";const jE=f.forwardRef(({className:e,...t},n)=>{const{toggleSidebar:s}=Pa();return i.jsx("button",{ref:n,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:s,title:"Toggle Sidebar",className:P("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",e),...t})});jE.displayName="SidebarRail";const LE=f.forwardRef(({className:e,...t},n)=>i.jsx("main",{ref:n,className:P("relative flex w-full flex-1 flex-col bg-background","md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",e),...t}));LE.displayName="SidebarInset";const kE=f.forwardRef(({className:e,...t},n)=>i.jsx(Ne,{ref:n,"data-sidebar":"input",className:P("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",e),...t}));kE.displayName="SidebarInput";const Zc=f.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,"data-sidebar":"header",className:P("flex flex-col gap-2 p-2",e),...t}));Zc.displayName="SidebarHeader";const ed=f.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,"data-sidebar":"footer",className:P("flex flex-col gap-2 p-2",e),...t}));ed.displayName="SidebarFooter";const AE=f.forwardRef(({className:e,...t},n)=>i.jsx(Zt,{ref:n,"data-sidebar":"separator",className:P("mx-2 w-auto bg-sidebar-border",e),...t}));AE.displayName="SidebarSeparator";const td=f.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,"data-sidebar":"content",className:P("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden group-data-[collapsible=icon-extended]:overflow-hidden",e),...t}));td.displayName="SidebarContent";const nd=f.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,"data-sidebar":"group",className:P("relative flex w-full min-w-0 flex-col p-2",e),...t}));nd.displayName="SidebarGroup";const SE=f.forwardRef(({className:e,asChild:t=!1,...n},s)=>{const a=t?Vn:"div";return i.jsx(a,{ref:s,"data-sidebar":"group-label",className:P("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0","group-data-[collapsible=icon-extended]:-mt-8 group-data-[collapsible=icon-extended]:opacity-0",e),...n})});SE.displayName="SidebarGroupLabel";const DE=f.forwardRef(({className:e,asChild:t=!1,...n},s)=>{const a=t?Vn:"button";return i.jsx(a,{ref:s,"data-sidebar":"group-action",className:P("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden group-data-[collapsible=icon-extended]:hidden",e),...n})});DE.displayName="SidebarGroupAction";const sd=f.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,"data-sidebar":"group-content",className:P("w-full text-sm",e),...t}));sd.displayName="SidebarGroupContent";const ea=f.forwardRef(({className:e,...t},n)=>i.jsx("ul",{ref:n,"data-sidebar":"menu",className:P("flex w-full min-w-0 flex-col gap-1",e),...t}));ea.displayName="SidebarMenu";const ta=f.forwardRef(({className:e,...t},n)=>i.jsx("li",{ref:n,"data-sidebar":"menu-item",className:P("group/menu-item relative",e),...t}));ta.displayName="SidebarMenuItem";const RE=Or("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon-extended]:h-auto group-data-[collapsible=icon-extended]:flex-col group-data-[collapsible=icon-extended]:gap-1 group-data-[collapsible=icon-extended]:p-2 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate group-data-[collapsible=icon-extended]:[&>span]:w-full group-data-[collapsible=icon-extended]:[&>span]:text-center group-data-[collapsible=icon-extended]:[&>span]:text-[10px] group-data-[collapsible=icon-extended]:[&>span]:leading-tight [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),na=f.forwardRef(({asChild:e=!1,isActive:t=!1,variant:n="default",size:s="default",tooltip:a,className:r,...o},l)=>{const d=e?Vn:"button",{isMobile:u,state:c}=Pa(),h=i.jsx(d,{ref:l,"data-sidebar":"menu-button","data-size":s,"data-active":t,className:P(RE({variant:n,size:s}),r),...o});return a?(typeof a=="string"&&(a={children:a}),i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:h}),i.jsx(ve,{side:"right",align:"center",hidden:c!=="collapsed"||u,...a})]})):h});na.displayName="SidebarMenuButton";const ME=f.forwardRef(({className:e,asChild:t=!1,showOnHover:n=!1,...s},a)=>{const r=t?Vn:"button";return i.jsx(r,{ref:a,"data-sidebar":"menu-action",className:P("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden group-data-[collapsible=icon-extended]:hidden",n&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",e),...s})});ME.displayName="SidebarMenuAction";const OE=f.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,"data-sidebar":"menu-badge",className:P("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",e),...t}));OE.displayName="SidebarMenuBadge";const PE=f.forwardRef(({className:e,showIcon:t=!1,...n},s)=>{const a=f.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return i.jsxs("div",{ref:s,"data-sidebar":"menu-skeleton",className:P("flex h-8 items-center gap-2 rounded-md px-2",e),...n,children:[t&&i.jsx(Ti,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),i.jsx(Ti,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":a}})]})});PE.displayName="SidebarMenuSkeleton";const FE=f.forwardRef(({className:e,...t},n)=>i.jsx("ul",{ref:n,"data-sidebar":"menu-sub",className:P("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",e),...t}));FE.displayName="SidebarMenuSub";const UE=f.forwardRef(({...e},t)=>i.jsx("li",{ref:t,...e}));UE.displayName="SidebarMenuSubItem";const BE=f.forwardRef(({asChild:e=!1,size:t="md",isActive:n,className:s,...a},r)=>{const o=e?Vn:"a";return i.jsx(o,{ref:r,"data-sidebar":"menu-sub-button","data-size":t,"data-active":n,className:P("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden group-data-[collapsible=icon-extended]:hidden",s),...a})});BE.displayName="SidebarMenuSubButton";const ky=()=>{const{selectSidebarSection:e,selectedSidebarSection:t,showSidePanel:n,selectVisualsTab:s}=Ve(),{t:a}=Q(),{isMd:r}=Rr("md"),{effectiveTheme:o}=Os(),{databaseType:l}=H(),{openCreateDiagramDialog:d,openOpenDiagramDialog:u}=Gn(),c=f.useMemo(()=>[{title:a("editor_sidebar.new_diagram"),icon:Jt,onClick:()=>{d()},active:!1},{title:a("editor_sidebar.browse"),icon:Lh,onClick:()=>{u()},active:!1}],[a,d,u]),h=f.useMemo(()=>[{title:a("editor_sidebar.tables"),icon:Jo,onClick:()=>{n(),e("tables")},active:t==="tables"},{title:"DBML",icon:_h,onClick:()=>{n(),e("dbml")},active:t==="dbml"},{title:"Data Dictionary",icon:lh,onClick:()=>{n(),e("dataDictionary")},active:t==="dataDictionary"},{title:a("editor_sidebar.refs"),icon:il,onClick:()=>{n(),e("refs")},active:t==="refs"},...Go(l)?[{title:a("editor_sidebar.custom_types"),icon:Ch,onClick:()=>{n(),e("customTypes")},active:t==="customTypes"}]:[],{title:a("editor_sidebar.visuals"),icon:xa,onClick:()=>{n(),e("visuals"),s("areas")},active:t==="visuals"}],[e,t,a,n,l,s]),p=f.useMemo(()=>[{title:"Discord",icon:ku,onClick:()=>window.open("https://discord.gg/QeFwyWSKwC","_blank"),active:!1},{title:"Twitter",icon:Au,onClick:()=>window.open("https://x.com/intent/follow?screen_name=jonathanfishner","_blank"),active:!1},{title:"Docs",icon:xh,onClick:()=>window.open("https://docs.chartdb.io","_blank"),active:!1}],[]);return i.jsxs(Jc,{side:"left",collapsible:"icon-extended",variant:"sidebar",className:"relative h-full",children:[r?null:i.jsx(Zc,{children:i.jsx("a",{href:"https://chartdb.io",className:"cursor-pointer",rel:"noreferrer",children:i.jsx("img",{src:o==="light"?fh:ph,alt:"chartDB",className:"h-4 max-w-fit"})})}),i.jsx(td,{children:i.jsx(nd,{children:i.jsxs(sd,{children:[i.jsx(ea,{children:c.map(b=>i.jsx(ta,{children:i.jsx(na,{className:"justify-center space-y-0.5 !px-0 hover:bg-gray-200 data-[active=true]:bg-gray-100 data-[active=true]:text-pink-600 data-[active=true]:hover:bg-pink-100 dark:hover:bg-gray-800 dark:data-[active=true]:bg-gray-900 dark:data-[active=true]:text-pink-400 dark:data-[active=true]:hover:bg-pink-950",isActive:b.active,asChild:!0,children:i.jsxs("button",{onClick:b.onClick,children:[i.jsx(b.icon,{}),i.jsx("span",{children:b.title.split(" ").map((x,m)=>i.jsx("div",{children:x},m))})]})})},b.title))}),i.jsx(Zt,{className:"my-2"}),i.jsx(ea,{children:h.map(b=>i.jsx(ta,{children:i.jsx(na,{className:"justify-center space-y-0.5 !px-0 hover:bg-gray-200 data-[active=true]:bg-gray-100 data-[active=true]:text-pink-600 data-[active=true]:hover:bg-pink-100 dark:hover:bg-gray-800 dark:data-[active=true]:bg-gray-900 dark:data-[active=true]:text-pink-400 dark:data-[active=true]:hover:bg-pink-950",isActive:b.active,asChild:!0,children:i.jsxs("button",{onClick:b.onClick,children:[i.jsx(b.icon,{}),i.jsx("span",{children:b.title.split(" ").map((x,m)=>i.jsx("div",{children:x},m))})]})})},b.title))})]})})}),i.jsx(ed,{children:i.jsx(ea,{children:p.map(b=>i.jsxs(ta,{children:[b.badge&&i.jsx("span",{className:"absolute -right-1 -top-1 rounded-full bg-pink-500 px-[3px] py-px text-[8px] font-semibold text-white",children:b.badge}),i.jsx(na,{className:"justify-center space-y-0.5 !px-0 hover:bg-gray-200 data-[active=true]:bg-gray-100 data-[active=true]:text-pink-600 data-[active=true]:hover:bg-pink-100 dark:hover:bg-gray-800 dark:data-[active=true]:bg-gray-900 dark:data-[active=true]:text-pink-400 dark:data-[active=true]:hover:bg-pink-950",isActive:b.active,asChild:!0,children:i.jsxs("button",{onClick:b.onClick,children:[i.jsx(b.icon,{}),i.jsx("span",{children:b.title})]})})]},b.title))})})]})},Ay=()=>{const{diagramName:e,updateDiagramName:t,currentDiagram:n}=H(),{t:s}=Q(),[a,r]=f.useState(!1),[o,l]=S.useState(e),d=S.useRef(null),{openOpenDiagramDialog:u}=Gn();f.useEffect(()=>{l(e)},[e]);const c=f.useCallback(()=>{o.trim()&&t(o.trim()),r(!1)},[o,t]);Rs(d,c),en("Enter",c),f.useEffect(()=>{if(a){const p=setTimeout(()=>{d.current&&(d.current.focus(),d.current.select())},50);return()=>clearTimeout(p)}},[a]);const h=f.useCallback(p=>{p.stopPropagation(),l(e),r(!0)},[e]);return i.jsx("div",{className:"group",children:i.jsxs("div",{className:P("flex flex-1 flex-row items-center justify-center px-2 py-1 whitespace-nowrap",{"text-editable":!a}),children:[i.jsx(mh,{databaseType:n.databaseType,databaseEdition:n.databaseEdition,onClick:p=>{p.stopPropagation(),u({canClose:!0})}}),i.jsx("div",{className:"flex flex-row items-center gap-1",children:a?i.jsxs(i.Fragment,{children:[i.jsx(Ne,{ref:d,autoFocus:!0,type:"text",placeholder:e,value:o,onClick:p=>p.stopPropagation(),onChange:p=>l(p.target.value),className:"h-7 max-w-[300px] focus-visible:ring-0",style:{width:`${o.length*8+30}px`}}),i.jsx(K,{variant:"ghost",className:"ml-1 flex size-7 p-2 text-slate-500 hover:bg-primary-foreground hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300",onClick:c,children:i.jsx(Kn,{})})]}):i.jsxs(i.Fragment,{children:[i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:i.jsx("h1",{className:P(bu(),"group-hover:underline max-w-[300px] truncate"),onDoubleClick:p=>{h(p)},children:e})}),i.jsx(ve,{children:s("tool_tips.double_click_to_edit")})]}),i.jsx(K,{variant:"ghost",className:"ml-1 hidden size-5 p-0 hover:bg-background/50 group-hover:flex",onClick:h,children:i.jsx(Xn,{strokeWidth:"1.5",className:"!size-3.5 text-slate-600 dark:text-slate-400"})})]})})]})})},Sy=()=>{const{t:e,i18n:t}=Q(),[n,s]=f.useState(!1),a=Jd.map(l=>({label:l.nativeName,value:l.code,description:`(${l.name})`})),r=f.useCallback(l=>{t.changeLanguage(l),s(!1)},[t]),o=f.useMemo(()=>t.languages.map(l=>a.find(d=>d.value===l)).find(l=>l!==void 0)?.value,[t,a]);return i.jsxs(sn,{open:n,onOpenChange:s,children:[i.jsxs(xe,{children:[i.jsx(ge,{asChild:!0,children:i.jsx(an,{asChild:!0,children:i.jsxs("div",{className:P(dr({variant:"outline",size:"icon"}),"size-6 rounded-full md:size-8 cursor-pointer"),children:[i.jsx(Ah,{className:"size-3.5 md:size-4"}),i.jsx("span",{className:"sr-only",children:"Change language"})]})})}),i.jsx(ve,{children:e("language_select.change_language")})]}),i.jsx(rn,{className:"w-56",children:i.jsx("div",{className:"p-2",children:i.jsx(sa,{className:"flex h-8 min-h-8 w-full",options:a,value:o,onChange:r})})})]})};var $s="Menubar",[kr,$E,VE]=Ou($s),[ad]=Zd($s,[VE,sl]),Re=Su(),rd=sl(),[GE,ci]=ad($s),id=f.forwardRef((e,t)=>{const{__scopeMenubar:n,value:s,onValueChange:a,defaultValue:r,loop:o=!0,dir:l,...d}=e,u=Mu(l),c=rd(n),[h,p]=Ko({prop:s,onChange:a,defaultProp:r??"",caller:$s}),[b,x]=f.useState(null);return i.jsx(GE,{scope:n,value:h,onMenuOpen:f.useCallback(m=>{p(m),x(m)},[p]),onMenuClose:f.useCallback(()=>p(""),[p]),onMenuToggle:f.useCallback(m=>{p(N=>N?"":m),x(m)},[p]),dir:u,loop:o,children:i.jsx(kr.Provider,{scope:n,children:i.jsx(kr.Slot,{scope:n,children:i.jsx(Pu,{asChild:!0,...c,orientation:"horizontal",loop:o,dir:u,currentTabStopId:b,onCurrentTabStopIdChange:x,children:i.jsx(zo.div,{role:"menubar",...d,ref:t})})})})})});id.displayName=$s;var di="MenubarMenu",[KE,od]=ad(di),ld=e=>{const{__scopeMenubar:t,value:n,...s}=e,a=$a(),r=n||a||"LEGACY_REACT_AUTO_VALUE",o=ci(di,t),l=Re(t),d=f.useRef(null),u=f.useRef(!1),c=o.value===r;return f.useEffect(()=>{c||(u.current=!1)},[c]),i.jsx(KE,{scope:t,value:r,triggerId:$a(),triggerRef:d,contentId:$a(),wasKeyboardTriggerOpenRef:u,children:i.jsx(Du,{...l,open:c,onOpenChange:h=>{h||o.onMenuClose()},modal:!1,dir:o.dir,...s})})};ld.displayName=di;var Ar="MenubarTrigger",cd=f.forwardRef((e,t)=>{const{__scopeMenubar:n,disabled:s=!1,...a}=e,r=rd(n),o=Re(n),l=ci(Ar,n),d=od(Ar,n),u=f.useRef(null),c=eu(t,u,d.triggerRef),[h,p]=f.useState(!1),b=l.value===d.value;return i.jsx(kr.ItemSlot,{scope:n,value:d.value,disabled:s,children:i.jsx(Fu,{asChild:!0,...r,focusable:!s,tabStopId:d.value,children:i.jsx(Uu,{asChild:!0,...o,children:i.jsx(zo.button,{type:"button",role:"menuitem",id:d.triggerId,"aria-haspopup":"menu","aria-expanded":b,"aria-controls":b?d.contentId:void 0,"data-highlighted":h?"":void 0,"data-state":b?"open":"closed","data-disabled":s?"":void 0,disabled:s,...a,ref:c,onPointerDown:Pt(e.onPointerDown,x=>{!s&&x.button===0&&x.ctrlKey===!1&&(l.onMenuOpen(d.value),b||x.preventDefault())}),onPointerEnter:Pt(e.onPointerEnter,()=>{l.value&&!b&&(l.onMenuOpen(d.value),u.current?.focus())}),onKeyDown:Pt(e.onKeyDown,x=>{s||(["Enter"," "].includes(x.key)&&l.onMenuToggle(d.value),x.key==="ArrowDown"&&l.onMenuOpen(d.value),["Enter"," ","ArrowDown"].includes(x.key)&&(d.wasKeyboardTriggerOpenRef.current=!0,x.preventDefault()))}),onFocus:Pt(e.onFocus,()=>p(!0)),onBlur:Pt(e.onBlur,()=>p(!1))})})})})});cd.displayName=Ar;var zE="MenubarPortal",dd=e=>{const{__scopeMenubar:t,...n}=e,s=Re(t);return i.jsx(Bu,{...s,...n})};dd.displayName=zE;var Sr="MenubarContent",ud=f.forwardRef((e,t)=>{const{__scopeMenubar:n,align:s="start",...a}=e,r=Re(n),o=ci(Sr,n),l=od(Sr,n),d=$E(n),u=f.useRef(!1);return i.jsx($u,{id:l.contentId,"aria-labelledby":l.triggerId,"data-radix-menubar-content":"",...r,...a,ref:t,align:s,onCloseAutoFocus:Pt(e.onCloseAutoFocus,c=>{!o.value&&!u.current&&l.triggerRef.current?.focus(),u.current=!1,c.preventDefault()}),onFocusOutside:Pt(e.onFocusOutside,c=>{const h=c.target;d().some(b=>b.ref.current?.contains(h))&&c.preventDefault()}),onInteractOutside:Pt(e.onInteractOutside,()=>{u.current=!0}),onEntryFocus:c=>{l.wasKeyboardTriggerOpenRef.current||c.preventDefault()},onKeyDown:Pt(e.onKeyDown,c=>{if(["ArrowRight","ArrowLeft"].includes(c.key)){const h=c.target,p=h.hasAttribute("data-radix-menubar-subtrigger"),b=h.closest("[data-radix-menubar-content]")!==c.currentTarget,m=(o.dir==="rtl"?"ArrowRight":"ArrowLeft")===c.key;if(!m&&p||b&&m)return;let y=d().filter(I=>!I.disabled).map(I=>I.value);m&&y.reverse();const g=y.indexOf(l.value);y=o.loop?iy(y,g+1):y.slice(g+1);const[w]=y;w&&o.onMenuOpen(w)}},{checkForDefaultPrevented:!1}),style:{...e.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})});ud.displayName=Sr;var XE="MenubarGroup",WE=f.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,a=Re(n);return i.jsx(qu,{...a,...s,ref:t})});WE.displayName=XE;var qE="MenubarLabel",hd=f.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,a=Re(n);return i.jsx(Hu,{...a,...s,ref:t})});hd.displayName=qE;var HE="MenubarItem",fd=f.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,a=Re(n);return i.jsx(Vu,{...a,...s,ref:t})});fd.displayName=HE;var YE="MenubarCheckboxItem",pd=f.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,a=Re(n);return i.jsx(Xu,{...a,...s,ref:t})});pd.displayName=YE;var QE="MenubarRadioGroup",JE=f.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,a=Re(n);return i.jsx(Yu,{...a,...s,ref:t})});JE.displayName=QE;var ZE="MenubarRadioItem",md=f.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,a=Re(n);return i.jsx(Qu,{...a,...s,ref:t})});md.displayName=ZE;var ey="MenubarItemIndicator",bd=f.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,a=Re(n);return i.jsx(Wu,{...a,...s,ref:t})});bd.displayName=ey;var ty="MenubarSeparator",xd=f.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,a=Re(n);return i.jsx(Gu,{...a,...s,ref:t})});xd.displayName=ty;var ny="MenubarArrow",sy=f.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,a=Re(n);return i.jsx(Ju,{...a,...s,ref:t})});sy.displayName=ny;var gd="MenubarSub",vd=e=>{const{__scopeMenubar:t,children:n,open:s,onOpenChange:a,defaultOpen:r}=e,o=Re(t),[l,d]=Ko({prop:s,defaultProp:r??!1,onChange:a,caller:gd});return i.jsx(Ru,{...o,open:l,onOpenChange:d,children:n})};vd.displayName=gd;var ay="MenubarSubTrigger",Nd=f.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,a=Re(n);return i.jsx(Ku,{"data-radix-menubar-subtrigger":"",...a,...s,ref:t})});Nd.displayName=ay;var ry="MenubarSubContent",Ed=f.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,a=Re(n);return i.jsx(zu,{...a,"data-radix-menubar-content":"",...s,ref:t,style:{...e.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})});Ed.displayName=ry;function iy(e,t){return e.map((n,s)=>e[(t+s)%e.length])}var yd=id,oy=ld,_d=cd,ly=dd,Td=ud,wd=hd,Id=fd,Cd=pd,jd=md,Ld=bd,kd=xd,cy=vd,Ad=Nd,Sd=Ed;const On=oy,Pn=cy,Dd=S.forwardRef(({className:e,...t},n)=>i.jsx(yd,{ref:n,className:P("flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm",e),...t}));Dd.displayName=yd.displayName;const un=S.forwardRef(({className:e,...t},n)=>i.jsx(_d,{ref:n,className:P("flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",e),...t}));un.displayName=_d.displayName;const hn=S.forwardRef(({className:e,inset:t,children:n,...s},a)=>i.jsxs(Ad,{ref:a,className:P("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",t&&"pl-8",e),...s,children:[n,i.jsx(Zu,{className:"ml-auto size-4"})]}));hn.displayName=Ad.displayName;const fn=S.forwardRef(({className:e,...t},n)=>i.jsx(Sd,{ref:n,className:P("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));fn.displayName=Sd.displayName;const pn=S.forwardRef(({className:e,align:t="start",alignOffset:n=-4,sideOffset:s=8,...a},r)=>i.jsx(ly,{children:i.jsx(Td,{ref:r,align:t,alignOffset:n,sideOffset:s,className:P("z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})}));pn.displayName=Td.displayName;const X=S.forwardRef(({className:e,inset:t,...n},s)=>i.jsx(Id,{ref:s,className:P("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...n}));X.displayName=Id.displayName;const qt=S.forwardRef(({className:e,children:t,checked:n,...s},a)=>i.jsxs(Cd,{ref:a,className:P("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:n,...s,children:[i.jsx("span",{className:"absolute left-2 flex size-3.5 items-center justify-center",children:i.jsx(Ld,{children:i.jsx(eh,{className:"size-4"})})}),t]}));qt.displayName=Cd.displayName;const dy=S.forwardRef(({className:e,children:t,...n},s)=>i.jsxs(jd,{ref:s,className:P("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[i.jsx("span",{className:"absolute left-2 flex size-3.5 items-center justify-center",children:i.jsx(Ld,{children:i.jsx(th,{className:"size-4 fill-current"})})}),t]}));dy.displayName=jd.displayName;const uy=S.forwardRef(({className:e,inset:t,...n},s)=>i.jsx(wd,{ref:s,className:P("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...n}));uy.displayName=wd.displayName;const ut=S.forwardRef(({className:e,...t},n)=>i.jsx(kd,{ref:n,className:P("-mx-1 my-1 h-px bg-muted",e),...t}));ut.displayName=kd.displayName;const at=({className:e,...t})=>i.jsx("span",{className:P("ml-auto text-xs tracking-widest text-muted-foreground",e),...t});at.displayname="MenubarShortcut";const Dy=()=>{const{clearDiagramData:e,deleteDiagram:t,updateDiagramUpdatedAt:n,databaseType:s}=H(),{openCreateDiagramDialog:a,openOpenDiagramDialog:r,openExportSQLDialog:o,openImportDatabaseDialog:l,openExportImageDialog:d,openExportDiagramDialog:u,openImportDiagramDialog:c,openExportDataDictionaryDialog:h}=Gn(),{showAlert:p}=nh(),{setTheme:b,theme:x}=Os(),{hideSidePanel:m,isSidePanelShowed:N,showSidePanel:_}=Ve(),{scrollAction:y,setScrollAction:g,setShowCardinality:w,showCardinality:I,setShowFieldAttributes:L,showFieldAttributes:k,setShowMiniMapOnCanvas:C,showMiniMapOnCanvas:j,showDBViews:O,setShowDBViews:V}=Pr(),{t:D}=Q(),{redo:$,undo:B,hasRedo:se,hasUndo:Te}=sh(),{exportImage:de}=mu(),tt=tu(),Me=f.useCallback(()=>{t(),tt("/")},[t,tt]),Et=()=>{a()},Rt=()=>{r()},ue=f.useCallback(()=>{de("svg",{scale:1,transparent:!0,includePatternBG:!1})},[de]),Be=f.useCallback(()=>{d({format:"png"})},[d]),nt=f.useCallback(()=>{d({format:"jpeg"})},[d]),ze=f.useCallback(()=>{window.open("https://docs.chartdb.io","_blank")},[]),he=f.useCallback(()=>{window.open("https://discord.gg/QeFwyWSKwC","_blank")},[]),Oe=f.useCallback(W=>{if(W===le.GENERIC){o({targetDatabaseType:le.GENERIC});return}o({targetDatabaseType:W})},[o]),Pe=f.useCallback(()=>{N?m():_()},[N,_,m]),Xe=f.useCallback(()=>{w(!I)},[I,w]),z=f.useCallback(()=>{L(!k)},[k,L]),Mt=f.useCallback(()=>{C(!j)},[j,C]),be="";return i.jsxs(Dd,{className:"h-8 border-none py-2 shadow-none md:h-10 md:py-0",children:[i.jsxs(On,{children:[i.jsx(un,{children:D("menu.actions.actions")}),i.jsxs(pn,{children:[i.jsx(X,{onClick:Et,children:D("menu.actions.new")}),i.jsxs(X,{onClick:Rt,children:[D("menu.actions.browse"),i.jsx(at,{children:Dn[Rn.OPEN_DIAGRAM].keyCombinationLabel})]}),i.jsxs(X,{onClick:n,children:[D("menu.actions.save"),i.jsx(at,{children:Dn[Rn.SAVE_DIAGRAM].keyCombinationLabel})]}),i.jsx(ut,{}),i.jsxs(Pn,{children:[i.jsx(hn,{children:D("menu.actions.import")}),i.jsxs(fn,{children:[i.jsx(X,{onClick:c,children:".json"}),i.jsx(ut,{}),i.jsx(X,{onClick:()=>l({databaseType:s,importMethods:["ddl","dbml"],initialImportMethod:"ddl"}),children:"SQL"}),i.jsx(X,{onClick:()=>l({databaseType:s,importMethods:["ddl","dbml"],initialImportMethod:"dbml"}),children:"DBML"})]})]}),i.jsx(ut,{}),i.jsxs(Pn,{children:[i.jsx(hn,{children:D("menu.actions.export_sql")}),i.jsxs(fn,{children:[s===le.GENERIC?i.jsx(X,{onClick:()=>Oe(le.GENERIC),children:dn.generic}):null,s!==le.GENERIC?i.jsx(X,{onClick:()=>Oe(s),children:dn[s]}):null,s!==le.POSTGRESQL?i.jsxs(X,{onClick:()=>Oe(le.POSTGRESQL),children:[dn.postgresql,i.jsx(at,{className:"text-base",children:be})]}):null,s!==le.MYSQL?i.jsxs(X,{onClick:()=>Oe(le.MYSQL),children:[dn.mysql,i.jsx(at,{className:"text-base",children:be})]}):null,s!==le.SQL_SERVER?i.jsxs(X,{onClick:()=>Oe(le.SQL_SERVER),children:[dn.sql_server,i.jsx(at,{className:"text-base",children:be})]}):null,s!==le.MARIADB?i.jsxs(X,{onClick:()=>Oe(le.MARIADB),children:[dn.mariadb,i.jsx(at,{className:"text-base",children:be})]}):null,s!==le.SQLITE?i.jsxs(X,{onClick:()=>Oe(le.SQLITE),children:[dn.sqlite,i.jsx(at,{className:"text-base",children:be})]}):null]})]}),i.jsxs(Pn,{children:[i.jsx(hn,{children:D("menu.actions.export_as")}),i.jsxs(fn,{children:[i.jsx(X,{onClick:Be,children:"PNG"}),i.jsx(X,{onClick:nt,children:"JPG"}),i.jsx(X,{onClick:ue,children:"SVG"}),i.jsx(ut,{}),i.jsx(X,{onClick:u,children:"JSON"}),i.jsx(X,{onClick:h,children:"Data Dictionary (XML)"})]})]}),i.jsx(ut,{}),i.jsx(X,{onClick:()=>p({title:D("delete_diagram_alert.title"),description:D("delete_diagram_alert.description"),actionLabel:D("delete_diagram_alert.delete"),closeLabel:D("delete_diagram_alert.cancel"),onAction:Me}),children:D("menu.actions.delete_diagram")})]})]}),i.jsxs(On,{children:[i.jsx(un,{children:D("menu.edit.edit")}),i.jsxs(pn,{children:[i.jsxs(X,{onClick:B,disabled:!Te,children:[D("menu.edit.undo"),i.jsx(at,{children:Dn[Rn.UNDO].keyCombinationLabel})]}),i.jsxs(X,{onClick:$,disabled:!se,children:[D("menu.edit.redo"),i.jsx(at,{children:Dn[Rn.REDO].keyCombinationLabel})]}),i.jsx(ut,{}),i.jsx(X,{onClick:()=>p({title:D("clear_diagram_alert.title"),description:D("clear_diagram_alert.description"),actionLabel:D("clear_diagram_alert.clear"),closeLabel:D("clear_diagram_alert.cancel"),onAction:e}),children:D("menu.edit.clear")})]})]}),i.jsxs(On,{children:[i.jsx(un,{children:D("menu.view.view")}),i.jsxs(pn,{children:[i.jsxs(X,{onClick:Pe,children:[D(N?"menu.view.hide_sidebar":"menu.view.show_sidebar"),i.jsx(at,{children:Dn[Rn.TOGGLE_SIDE_PANEL].keyCombinationLabel})]}),i.jsx(ut,{}),i.jsx(X,{onClick:Xe,children:D(I?"menu.view.hide_cardinality":"menu.view.show_cardinality")}),i.jsx(X,{onClick:z,children:D(k?"menu.view.hide_field_attributes":"menu.view.show_field_attributes")}),i.jsx(X,{onClick:Mt,children:D(j?"menu.view.hide_minimap":"menu.view.show_minimap")}),i.jsx(ut,{}),i.jsxs(Pn,{children:[i.jsx(hn,{children:D("menu.view.zoom_on_scroll")}),i.jsxs(fn,{children:[i.jsx(qt,{checked:y==="zoom",onClick:()=>g("zoom"),children:D("zoom.on")}),i.jsx(qt,{checked:y==="pan",onClick:()=>g("pan"),children:D("zoom.off")})]})]}),i.jsx(ut,{}),i.jsxs(Pn,{children:[i.jsx(hn,{children:D("menu.view.show_views")}),i.jsxs(fn,{children:[i.jsx(qt,{checked:O,onClick:()=>V(!0),children:D("on")}),i.jsx(qt,{checked:!O,onClick:()=>V(!1),children:D("off")})]})]}),i.jsx(ut,{}),i.jsxs(Pn,{children:[i.jsxs(hn,{className:"flex items-center gap-1",children:[i.jsx("span",{children:D("menu.view.theme")}),i.jsx("div",{className:"flex-1"}),i.jsx(at,{children:Dn[Rn.TOGGLE_THEME].keyCombinationLabel})]}),i.jsxs(fn,{children:[i.jsx(qt,{checked:x==="system",onClick:()=>b("system"),children:D("theme.system")}),i.jsx(qt,{checked:x==="light",onClick:()=>b("light"),children:D("theme.light")}),i.jsx(qt,{checked:x==="dark",onClick:()=>b("dark"),children:D("theme.dark")})]})]})]})]}),i.jsxs(On,{children:[i.jsx(un,{children:D("menu.backup.backup")}),i.jsxs(pn,{children:[i.jsx(X,{onClick:u,children:D("menu.backup.export_diagram")}),i.jsx(X,{onClick:c,children:D("menu.backup.restore_diagram")})]})]}),i.jsxs(On,{children:[i.jsx(un,{children:"Tools"}),i.jsxs(pn,{children:[i.jsx(X,{onClick:()=>tt("/dbml-viewer"),children:"DBML Viewer"}),i.jsx(X,{onClick:()=>tt("/data-dictionary-viewer"),children:"Data Dictionary Viewer"})]})]}),i.jsxs(On,{children:[i.jsx(un,{children:D("menu.help.help")}),i.jsxs(pn,{children:[i.jsx(X,{onClick:ze,children:D("menu.help.docs_website")}),i.jsx(X,{onClick:he,children:D("menu.help.join_discord")})]})]})]})};export{Ay as D,ky as E,Sy as L,Dy as M,IE as S,Ly as a,Pa as u};
